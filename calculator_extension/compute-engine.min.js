/** Compute Engine 0.30.2 */
    (function(global,factory){typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'],factory):(global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.ComputeEngine = {}));})(this, (function (exports) { 'use strict';
var ComputeEngine=(()=>{var Lo=Object.defineProperty;var kf=Object.getOwnPropertyDescriptor;var Cf=Object.getOwnPropertyNames;var Af=Object.prototype.hasOwnProperty;var Df=(n,e)=>{for(var t in e)Lo(n,t,{get:e[t],enumerable:!0})},Mf=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Cf(e))!Af.call(n,r)&&r!==t&&Lo(n,r,{get:()=>e[r],enumerable:!(i=kf(e,r))||i.enumerable});return n};var Rf=n=>Mf(Lo({},"__esModule",{value:!0}),n);var wg={};Df(wg,{BoxedType:()=>S,ComputeEngine:()=>Ii,NumericValue:()=>j,version:()=>Ig});var Me=Math.cosh||function(n){return Math.abs(n)<1e-9?1-n:(Math.exp(n)+Math.exp(-n))*.5},en=Math.sinh||function(n){return Math.abs(n)<1e-9?n:(Math.exp(n)-Math.exp(-n))*.5},Pf=function(n){var e=Math.PI/4;if(-e>n||n>e)return Math.cos(n)-1;var t=n*n;return t*(t*(t*(t*(t*(t*(t*(t/20922789888e3-1/87178291200)+1/479001600)-1/3628800)+1/40320)-1/720)+1/24)-1/2)},Lf=function(n,e){var t=Math.abs(n),i=Math.abs(e);return t<3e3&&i<3e3?Math.sqrt(t*t+i*i):(t<i?(t=i,i=n/e):i=e/n,t*Math.sqrt(1+i*i))},Ut=function(){throw SyntaxError("Invalid Param")};function Oo(n,e){var t=Math.abs(n),i=Math.abs(e);return n===0?Math.log(i):e===0?Math.log(t):t<3e3&&i<3e3?Math.log(n*n+e*e)*.5:(n=n/2,e=e/2,.5*Math.log(n*n+e*e)+Math.LN2)}var Of=function(n,e){var t={re:0,im:0};if(n==null)t.re=t.im=0;else if(e!==void 0)t.re=n,t.im=e;else switch(typeof n){case"object":if("im"in n&&"re"in n)t.re=n.re,t.im=n.im;else if("abs"in n&&"arg"in n){if(!Number.isFinite(n.abs)&&Number.isFinite(n.arg))return q.INFINITY;t.re=n.abs*Math.cos(n.arg),t.im=n.abs*Math.sin(n.arg)}else if("r"in n&&"phi"in n){if(!Number.isFinite(n.r)&&Number.isFinite(n.phi))return q.INFINITY;t.re=n.r*Math.cos(n.phi),t.im=n.r*Math.sin(n.phi)}else n.length===2?(t.re=n[0],t.im=n[1]):Ut();break;case"string":t.im=t.re=0;var i=n.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),r=1,o=0;i===null&&Ut();for(var s=0;s<i.length;s++){var a=i[s];a===" "||a==="	"||a===`
`||(a==="+"?r++:a==="-"?o++:a==="i"||a==="I"?(r+o===0&&Ut(),i[s+1]!==" "&&!isNaN(Number(i[s+1]))?(t.im+=parseFloat((o%2?"-":"")+i[s+1]),s++):t.im+=parseFloat((o%2?"-":"")+"1"),r=o=0):((r+o===0||isNaN(Number(a)))&&Ut(),i[s+1]==="i"||i[s+1]==="I"?(t.im+=parseFloat((o%2?"-":"")+a),s++):t.re+=parseFloat((o%2?"-":"")+a),r=o=0))}r+o>0&&Ut();break;case"number":t.im=0,t.re=n;break;default:Ut()}return isNaN(t.re)||isNaN(t.im),t},q=class n{constructor(e,t){this.re=0,this.im=0;var i=Of(e,t);this.re=i.re,this.im=i.im}sign(){var e=this.abs();return new n(this.re/e,this.im/e)}add(e,t){var i=new n(e,t);return this.isInfinite()&&i.isInfinite()?n.NAN:this.isInfinite()||i.isInfinite()?n.INFINITY:new n(this.re+i.re,this.im+i.im)}sub(e,t){var i=new n(e,t);return this.isInfinite()&&i.isInfinite()?n.NAN:this.isInfinite()||i.isInfinite()?n.INFINITY:new n(this.re-i.re,this.im-i.im)}mul(e,t){var i=new n(e,t);return this.isInfinite()&&i.isZero()||this.isZero()&&i.isInfinite()?n.NAN:this.isInfinite()||i.isInfinite()?n.INFINITY:i.im===0&&this.im===0?new n(this.re*i.re,0):new n(this.re*i.re-this.im*i.im,this.re*i.im+this.im*i.re)}div(e,t){var i=new n(e,t);if(this.isZero()&&i.isZero()||this.isInfinite()&&i.isInfinite())return n.NAN;if(this.isInfinite()||i.isZero())return n.INFINITY;if(this.isZero()||i.isInfinite())return n.ZERO;e=this.re,t=this.im;var r=i.re,o=i.im,s,a;return o===0?new n(e/r,t/r):Math.abs(r)<Math.abs(o)?(a=r/o,s=r*a+o,new n((e*a+t)/s,(t*a-e)/s)):(a=o/r,s=o*a+r,new n((e+t*a)/s,(t-e*a)/s))}pow(e,t){var i=new n(e,t);if(e=this.re,t=this.im,i.isZero())return n.ONE;if(i.im===0){if(t===0&&e>0)return new n(Math.pow(e,i.re),0);if(e===0)switch((i.re%4+4)%4){case 0:return new n(Math.pow(t,i.re),0);case 1:return new n(0,Math.pow(t,i.re));case 2:return new n(-Math.pow(t,i.re),0);case 3:return new n(0,-Math.pow(t,i.re))}}if(e===0&&t===0&&i.re>0&&i.im>=0)return n.ZERO;var r=Math.atan2(t,e),o=Oo(e,t);return e=Math.exp(i.re*o-i.im*r),t=i.im*o+i.re*r,new n(e*Math.cos(t),e*Math.sin(t))}sqrt(){var e=this.re,t=this.im,i=this.abs(),r,o;if(e>=0){if(t===0)return new n(Math.sqrt(e),0);r=.5*Math.sqrt(2*(i+e))}else r=Math.abs(t)/Math.sqrt(2*(i-e));return e<=0?o=.5*Math.sqrt(2*(i-e)):o=Math.abs(t)/Math.sqrt(2*(i+e)),new n(r,t<0?-o:o)}exp(){var e=Math.exp(this.re);return this.im,new n(e*Math.cos(this.im),e*Math.sin(this.im))}expm1(){var e=this.re,t=this.im;return new n(Math.expm1(e)*Math.cos(t)+Pf(t),Math.exp(e)*Math.sin(t))}log(){var e=this.re,t=this.im;return t===0&&e>0,new n(Oo(e,t),Math.atan2(t,e))}abs(){return Lf(this.re,this.im)}arg(){return Math.atan2(this.im,this.re)}sin(){var e=this.re,t=this.im;return new n(Math.sin(e)*Me(t),Math.cos(e)*en(t))}cos(){var e=this.re,t=this.im;return new n(Math.cos(e)*Me(t),-Math.sin(e)*en(t))}tan(){var e=2*this.re,t=2*this.im,i=Math.cos(e)+Me(t);return new n(Math.sin(e)/i,en(t)/i)}cot(){var e=2*this.re,t=2*this.im,i=Math.cos(e)-Me(t);return new n(-Math.sin(e)/i,en(t)/i)}sec(){var e=this.re,t=this.im,i=.5*Me(2*t)+.5*Math.cos(2*e);return new n(Math.cos(e)*Me(t)/i,Math.sin(e)*en(t)/i)}csc(){var e=this.re,t=this.im,i=.5*Me(2*t)-.5*Math.cos(2*e);return new n(Math.sin(e)*Me(t)/i,-Math.cos(e)*en(t)/i)}asin(){var e=this.re,t=this.im,i=new n(t*t-e*e+1,-2*e*t).sqrt(),r=new n(i.re-t,i.im+e).log();return new n(r.im,-r.re)}acos(){var e=this.re,t=this.im,i=new n(t*t-e*e+1,-2*e*t).sqrt(),r=new n(i.re-t,i.im+e).log();return new n(Math.PI/2-r.im,r.re)}atan(){var e=this.re,t=this.im;if(e===0){if(t===1)return new n(0,1/0);if(t===-1)return new n(0,-1/0)}var i=e*e+(1-t)*(1-t),r=new n((1-t*t-e*e)/i,-2*e/i).log();return new n(-.5*r.im,.5*r.re)}acot(){var e=this.re,t=this.im;if(t===0)return new n(Math.atan2(1,e),0);var i=e*e+t*t;return i!==0?new n(e/i,-t/i).atan():new n(e!==0?e/0:0,t!==0?-t/0:0).atan()}asec(){var e=this.re,t=this.im;if(e===0&&t===0)return new n(0,1/0);var i=e*e+t*t;return i!==0?new n(e/i,-t/i).acos():new n(e!==0?e/0:0,t!==0?-t/0:0).acos()}acsc(){var e=this.re,t=this.im;if(e===0&&t===0)return new n(Math.PI/2,1/0);var i=e*e+t*t;return i!==0?new n(e/i,-t/i).asin():new n(e!==0?e/0:0,t!==0?-t/0:0).asin()}sinh(){var e=this.re,t=this.im;return new n(en(e)*Math.cos(t),Me(e)*Math.sin(t))}cosh(){var e=this.re,t=this.im;return new n(Me(e)*Math.cos(t),en(e)*Math.sin(t))}tanh(){var e=2*this.re,t=2*this.im,i=Me(e)+Math.cos(t);return new n(en(e)/i,Math.sin(t)/i)}coth(){var e=2*this.re,t=2*this.im,i=Me(e)-Math.cos(t);return new n(en(e)/i,-Math.sin(t)/i)}csch(){var e=this.re,t=this.im,i=Math.cos(2*t)-Me(2*e);return new n(-2*en(e)*Math.cos(t)/i,2*Me(e)*Math.sin(t)/i)}sech(){var e=this.re,t=this.im,i=Math.cos(2*t)+Me(2*e);return new n(2*Me(e)*Math.cos(t)/i,-2*en(e)*Math.sin(t)/i)}asinh(){var e=this.im;this.im=-this.re,this.re=e;var t=this.asin();return this.re=-this.im,this.im=e,e=t.re,t.re=-t.im,t.im=e,t}acosh(){var e=this.acos();if(e.im<=0){var t=e.re;e.re=-e.im,e.im=t}else{var t=e.im;e.im=-e.re,e.re=t}return e}atanh(){var e=this.re,t=this.im,i=e>1&&t===0,r=1-e,o=1+e,s=r*r+t*t,a=s!==0?new n((o*r-t*t)/s,(t*r+o*t)/s):new n(e!==-1?e/0:0,t!==0?t/0:0),u=a.re;return a.re=Oo(a.re,a.im)/2,a.im=Math.atan2(a.im,u)/2,i&&(a.im=-a.im),a}acoth(){var e=this.re,t=this.im;if(e===0&&t===0)return new n(0,Math.PI/2);var i=e*e+t*t;return i!==0?new n(e/i,-t/i).atanh():new n(e!==0?e/0:0,t!==0?-t/0:0).atanh()}acsch(){var e=this.re,t=this.im;if(t===0)return new n(e!==0?Math.log(e+Math.sqrt(e*e+1)):1/0,0);var i=e*e+t*t;return i!==0?new n(e/i,-t/i).asinh():new n(e!==0?e/0:0,t!==0?-t/0:0).asinh()}asech(){var e=this.re,t=this.im;if(this.isZero())return n.INFINITY;var i=e*e+t*t;return i!==0?new n(e/i,-t/i).acosh():new n(e!==0?e/0:0,t!==0?-t/0:0).acosh()}inverse(){if(this.isZero())return n.INFINITY;if(this.isInfinite())return n.ZERO;var e=this.re,t=this.im,i=e*e+t*t;return new n(e/i,-t/i)}conjugate(){return new n(this.re,-this.im)}neg(){return new n(-this.re,-this.im)}ceil(e){return e=Math.pow(10,e||0),new n(Math.ceil(this.re*e)/e,Math.ceil(this.im*e)/e)}floor(e){return e=Math.pow(10,e||0),new n(Math.floor(this.re*e)/e,Math.floor(this.im*e)/e)}round(e){return e=Math.pow(10,e||0),new n(Math.round(this.re*e)/e,Math.round(this.im*e)/e)}equals(e,t){var i=new n(e,t);return Math.abs(i.re-this.re)<=n.EPSILON&&Math.abs(i.im-this.im)<=n.EPSILON}clone(){return new n(this.re,this.im)}toString(){var e=this.re,t=this.im,i="";return this.isNaN()?"NaN":this.isInfinite()?"Infinity":(Math.abs(e)<n.EPSILON&&(e=0),Math.abs(t)<n.EPSILON&&(t=0),t===0?i+e:(e!==0?(i+=e,i+=" ",t<0?(t=-t,i+="-"):i+="+",i+=" "):t<0&&(t=-t,i+="-"),t!==1&&(i+=t),i+"i"))}toVector(){return[this.re,this.im]}valueOf(){return this.im===0?this.re:null}isNaN(){return isNaN(this.re)||isNaN(this.im)}isZero(){return this.im===0&&this.re===0}isFinite(){return isFinite(this.re)&&isFinite(this.im)}isInfinite(){return!(this.isNaN()||this.isFinite())}};q.ZERO=new q(0,0);q.ONE=new q(1,0);q.I=new q(0,1);q.PI=new q(Math.PI,0);q.E=new q(Math.E,0);q.INFINITY=new q(1/0,1/0);q.NAN=new q(NaN,NaN);q.EPSILON=1e-15;var jt=9e15,ot=1e9,$o="0123456789abcdef",Ar="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Dr="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Fo={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-jt,maxE:jt,crypto:!1},Oa,Vn,D=!0,Rr="[DecimalError] ",rt=Rr+"Invalid argument: ",$a=Rr+"Precision limit exceeded",Fa=Rr+"crypto unavailable",Va="[object Decimal]",Re=Math.floor,Se=Math.pow,$f=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Ff=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Vf=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,qa=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,xn=1e7,C=7,qf=9007199254740991,zf=Ar.length-1,Vo=Dr.length-1,y={toStringTag:Va};y.absoluteValue=y.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),I(n)};y.ceil=function(){return I(new this.constructor(this),this.e+1,2)};y.clampedTo=y.clamp=function(n,e){var t,i=this,r=i.constructor;if(n=new r(n),e=new r(e),!n.s||!e.s)return new r(NaN);if(n.gt(e))throw Error(rt+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new r(i)};y.comparedTo=y.cmp=function(n){var e,t,i,r,o=this,s=o.d,a=(n=new o.constructor(n)).d,u=o.s,l=n.s;if(!s||!a)return!u||!l?NaN:u!==l?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-l:0;if(u!==l)return u;if(o.e!==n.e)return o.e>n.e^u<0?1:-1;for(i=s.length,r=a.length,e=0,t=i<r?i:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return i===r?0:i>r^u<0?1:-1};y.cosine=y.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+C,i.rounding=1,t=Gf(i,Za(i,t)),i.precision=n,i.rounding=e,I(Vn==2||Vn==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};y.cubeRoot=y.cbrt=function(){var n,e,t,i,r,o,s,a,u,l,c=this,f=c.constructor;if(!c.isFinite()||c.isZero())return new f(c);for(D=!1,o=c.s*Se(c.s*c,1/3),!o||Math.abs(o)==1/0?(t=Ce(c.d),n=c.e,(o=(n-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=Se(t,1/3),n=Re((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?t="5e"+n:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new f(t),i.s=c.s):i=new f(o.toString()),s=(n=f.precision)+3;;)if(a=i,u=a.times(a).times(a),l=u.plus(c),i=X(l.plus(c).times(a),l.plus(u),s+2,1),Ce(a.d).slice(0,s)===(t=Ce(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(I(a,n+1,0),a.times(a).times(a).eq(c))){i=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(I(i,n+1,1),e=!i.times(i).times(i).eq(c));break}return D=!0,I(i,n,f.rounding,e)};y.decimalPlaces=y.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-Re(this.e/C))*C,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};y.dividedBy=y.div=function(n){return X(this,new this.constructor(n))};y.dividedToIntegerBy=y.divToInt=function(n){var e=this,t=e.constructor;return I(X(e,new t(n),0,1,1),t.precision,t.rounding)};y.equals=y.eq=function(n){return this.cmp(n)===0};y.floor=function(){return I(new this.constructor(this),this.e+1,3)};y.greaterThan=y.gt=function(n){return this.cmp(n)>0};y.greaterThanOrEqualTo=y.gte=function(n){var e=this.cmp(n);return e==1||e===0};y.hyperbolicCosine=y.cosh=function(){var n,e,t,i,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(n=Math.ceil(r/3),e=(1/Lr(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),o=Zt(s,1,o.times(e),new s(1),!0);for(var u,l=n,c=new s(8);l--;)u=o.times(o),o=a.minus(u.times(c.minus(u.times(c))));return I(o,s.precision=t,s.rounding=i,!0)};y.hyperbolicSine=y.sinh=function(){var n,e,t,i,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,i=r.d.length,i<3)r=Zt(o,2,r,r,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,r=r.times(1/Lr(5,n)),r=Zt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),l=new o(20);n--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(l))))}return o.precision=e,o.rounding=t,I(r,e,t,!0)};y.hyperbolicTangent=y.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,X(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};y.inverseCosine=y.acos=function(){var n=this,e=n.constructor,t=n.abs().cmp(1),i=e.precision,r=e.rounding;return t!==-1?t===0?n.isNeg()?In(e,i,r):new e(0):new e(NaN):n.isZero()?In(e,i+4,r).times(.5):(e.precision=i+6,e.rounding=1,n=new e(1).minus(n).div(n.plus(1)).sqrt().atan(),e.precision=i,e.rounding=r,n.times(2))};y.inverseHyperbolicCosine=y.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,D=!1,t=t.times(t).minus(1).sqrt().plus(t),D=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};y.inverseHyperbolicSine=y.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,D=!1,t=t.times(t).plus(1).sqrt().plus(t),D=!0,i.precision=n,i.rounding=e,t.ln())};y.inverseHyperbolicTangent=y.atanh=function(){var n,e,t,i,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(n=o.precision,e=o.rounding,i=r.sd(),Math.max(i,n)<2*-r.e-1?I(new o(r),n,e,!0):(o.precision=t=i-r.e,r=X(r.plus(1),new o(1).minus(r),t+n,1),o.precision=n+4,o.rounding=1,r=r.ln(),o.precision=n,o.rounding=e,r.times(.5))):new o(NaN)};y.inverseSine=y.asin=function(){var n,e,t,i,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,i=o.rounding,e!==-1?e===0?(n=In(o,t+4,i).times(.5),n.s=r.s,n):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=i,r.times(2)))};y.inverseTangent=y.atan=function(){var n,e,t,i,r,o,s,a,u,l=this,c=l.constructor,f=c.precision,d=c.rounding;if(l.isFinite()){if(l.isZero())return new c(l);if(l.abs().eq(1)&&f+4<=Vo)return s=In(c,f+4,d).times(.25),s.s=l.s,s}else{if(!l.s)return new c(NaN);if(f+4<=Vo)return s=In(c,f+4,d).times(.5),s.s=l.s,s}for(c.precision=a=f+10,c.rounding=1,t=Math.min(28,a/C+2|0),n=t;n;--n)l=l.div(l.times(l).plus(1).sqrt().plus(1));for(D=!1,e=Math.ceil(a/C),i=1,u=l.times(l),s=new c(l),r=l;n!==-1;)if(r=r.times(u),o=s.minus(r.div(i+=2)),r=r.times(u),s=o.plus(r.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===o.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),D=!0,I(s,c.precision=f,c.rounding=d,!0)};y.isFinite=function(){return!!this.d};y.isInteger=y.isInt=function(){return!!this.d&&Re(this.e/C)>this.d.length-2};y.isNaN=function(){return!this.s};y.isNegative=y.isNeg=function(){return this.s<0};y.isPositive=y.isPos=function(){return this.s>0};y.isZero=function(){return!!this.d&&this.d[0]===0};y.lessThan=y.lt=function(n){return this.cmp(n)<0};y.lessThanOrEqualTo=y.lte=function(n){return this.cmp(n)<1};y.logarithm=y.log=function(n){var e,t,i,r,o,s,a,u,l=this,c=l.constructor,f=c.precision,d=c.rounding,p=5;if(n==null)n=new c(10),e=!0;else{if(n=new c(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new c(NaN);e=n.eq(10)}if(t=l.d,l.s<0||!t||!t[0]||l.eq(1))return new c(t&&!t[0]?-1/0:l.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(D=!1,a=f+p,s=it(l,a),i=e?Mr(c,a+10):it(n,a),u=X(s,i,a,1),ki(u.d,r=f,d))do if(a+=10,s=it(l,a),i=e?Mr(c,a+10):it(n,a),u=X(s,i,a,1),!o){+Ce(u.d).slice(r+1,r+15)+1==1e14&&(u=I(u,f+1,0));break}while(ki(u.d,r+=10,d));return D=!0,I(u,f,d)};y.minus=y.sub=function(n){var e,t,i,r,o,s,a,u,l,c,f,d,p=this,x=p.constructor;if(n=new x(n),!p.d||!n.d)return!p.s||!n.s?n=new x(NaN):p.d?n.s=-n.s:n=new x(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(l=p.d,d=n.d,a=x.precision,u=x.rounding,!l[0]||!d[0]){if(d[0])n.s=-n.s;else if(l[0])n=new x(p);else return new x(u===3?-0:0);return D?I(n,a,u):n}if(t=Re(n.e/C),c=Re(p.e/C),l=l.slice(),o=c-t,o){for(f=o<0,f?(e=l,o=-o,s=d.length):(e=d,t=c,s=l.length),i=Math.max(Math.ceil(a/C),s)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=l.length,s=d.length,f=i<s,f&&(s=i),i=0;i<s;i++)if(l[i]!=d[i]){f=l[i]<d[i];break}o=0}for(f&&(e=l,l=d,d=e,n.s=-n.s),s=l.length,i=d.length-s;i>0;--i)l[s++]=0;for(i=d.length;i>o;){if(l[--i]<d[i]){for(r=i;r&&l[--r]===0;)l[r]=xn-1;--l[r],l[i]+=xn}l[i]-=d[i]}for(;l[--s]===0;)l.pop();for(;l[0]===0;l.shift())--t;return l[0]?(n.d=l,n.e=Pr(l,t),D?I(n,a,u):n):new x(u===3?-0:0)};y.modulo=y.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?I(new i(t),i.precision,i.rounding):(D=!1,i.modulo==9?(e=X(t,n.abs(),0,3,1),e.s*=n.s):e=X(t,n,0,i.modulo,1),e=e.times(n),D=!0,t.minus(e))};y.naturalExponential=y.exp=function(){return qo(this)};y.naturalLogarithm=y.ln=function(){return it(this)};y.negated=y.neg=function(){var n=new this.constructor(this);return n.s=-n.s,I(n)};y.plus=y.add=function(n){var e,t,i,r,o,s,a,u,l,c,f=this,d=f.constructor;if(n=new d(n),!f.d||!n.d)return!f.s||!n.s?n=new d(NaN):f.d||(n=new d(n.d||f.s===n.s?f:NaN)),n;if(f.s!=n.s)return n.s=-n.s,f.minus(n);if(l=f.d,c=n.d,a=d.precision,u=d.rounding,!l[0]||!c[0])return c[0]||(n=new d(f)),D?I(n,a,u):n;if(o=Re(f.e/C),i=Re(n.e/C),l=l.slice(),r=o-i,r){for(r<0?(t=l,r=-r,s=c.length):(t=c,i=o,s=l.length),o=Math.ceil(a/C),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=l.length,r=c.length,s-r<0&&(r=s,t=c,c=l,l=t),e=0;r;)e=(l[--r]=l[r]+c[r]+e)/xn|0,l[r]%=xn;for(e&&(l.unshift(e),++i),s=l.length;l[--s]==0;)l.pop();return n.d=l,n.e=Pr(l,i),D?I(n,a,u):n};y.precision=y.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(rt+n);return t.d?(e=za(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};y.round=function(){var n=this,e=n.constructor;return I(new e(n),n.e+1,e.rounding)};y.sine=y.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+C,i.rounding=1,t=jf(i,Za(i,t)),i.precision=n,i.rounding=e,I(Vn>2?t.neg():t,n,e,!0)):new i(NaN)};y.squareRoot=y.sqrt=function(){var n,e,t,i,r,o,s=this,a=s.d,u=s.e,l=s.s,c=s.constructor;if(l!==1||!a||!a[0])return new c(!l||l<0&&(!a||a[0])?NaN:a?s:1/0);for(D=!1,l=Math.sqrt(+s),l==0||l==1/0?(e=Ce(a),(e.length+u)%2==0&&(e+="0"),l=Math.sqrt(e),u=Re((u+1)/2)-(u<0||u%2),l==1/0?e="5e"+u:(e=l.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),i=new c(e)):i=new c(l.toString()),t=(u=c.precision)+3;;)if(o=i,i=o.plus(X(s,o,t+2,1)).times(.5),Ce(o.d).slice(0,t)===(e=Ce(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(I(o,u+1,0),o.times(o).eq(s))){i=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(I(i,u+1,1),n=!i.times(i).eq(s));break}return D=!0,I(i,u,c.rounding,n)};y.tangent=y.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=X(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,I(Vn==2||Vn==4?t.neg():t,n,e,!0)):new i(NaN)};y.times=y.mul=function(n){var e,t,i,r,o,s,a,u,l,c=this,f=c.constructor,d=c.d,p=(n=new f(n)).d;if(n.s*=c.s,!d||!d[0]||!p||!p[0])return new f(!n.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?n.s/0:n.s*0);for(t=Re(c.e/C)+Re(n.e/C),u=d.length,l=p.length,u<l&&(o=d,d=p,p=o,s=u,u=l,l=s),o=[],s=u+l,i=s;i--;)o.push(0);for(i=l;--i>=0;){for(e=0,r=u+i;r>i;)a=o[r]+p[i]*d[r-i-1]+e,o[r--]=a%xn|0,e=a/xn|0;o[r]=(o[r]+e)%xn|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),n.d=o,n.e=Pr(o,t),D?I(n,f.precision,f.rounding):n};y.toBinary=function(n,e){return zo(this,2,n,e)};y.toDecimalPlaces=y.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(ze(n,0,ot),e===void 0?e=i.rounding:ze(e,0,8),I(t,n+t.e+1,e))};y.toExponential=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=wn(i,!0):(ze(n,0,ot),e===void 0?e=r.rounding:ze(e,0,8),i=I(new r(i),n+1,e),t=wn(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};y.toFixed=function(n,e){var t,i,r=this,o=r.constructor;return n===void 0?t=wn(r):(ze(n,0,ot),e===void 0?e=o.rounding:ze(e,0,8),i=I(new o(r),n+r.e+1,e),t=wn(i,!1,n+i.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};y.toFraction=function(n){var e,t,i,r,o,s,a,u,l,c,f,d,p=this,x=p.d,g=p.constructor;if(!x)return new g(p);if(l=t=new g(1),i=u=new g(0),e=new g(i),o=e.e=za(x)-p.e-1,s=o%C,e.d[0]=Se(10,s<0?C+s:s),n==null)n=o>0?e:l;else{if(a=new g(n),!a.isInt()||a.lt(l))throw Error(rt+a);n=a.gt(e)?o>0?e:l:a}for(D=!1,a=new g(Ce(x)),c=g.precision,g.precision=o=x.length*C*2;f=X(a,e,0,1,1),r=t.plus(f.times(i)),r.cmp(n)!=1;)t=i,i=r,r=l,l=u.plus(f.times(r)),u=r,r=e,e=a.minus(f.times(r)),a=r;return r=X(n.minus(t),i,0,1,1),u=u.plus(r.times(l)),t=t.plus(r.times(i)),u.s=l.s=p.s,d=X(l,i,o,1).minus(p).abs().cmp(X(u,t,o,1).minus(p).abs())<1?[l,i]:[u,t],g.precision=c,D=!0,d};y.toHexadecimal=y.toHex=function(n,e){return zo(this,16,n,e)};y.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:ze(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(D=!1,t=X(t,n,0,e,1).times(n),D=!0,I(t)):(n.s=t.s,t=n),t};y.toNumber=function(){return+this};y.toOctal=function(n,e){return zo(this,8,n,e)};y.toPower=y.pow=function(n){var e,t,i,r,o,s,a=this,u=a.constructor,l=+(n=new u(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new u(Se(+a,l));if(a=new u(a),a.eq(1))return a;if(i=u.precision,o=u.rounding,n.eq(1))return I(a,i,o);if(e=Re(n.e/C),e>=n.d.length-1&&(t=l<0?-l:l)<=qf)return r=Ga(u,a,t,i),n.s<0?new u(1).div(r):I(r,i,o);if(s=a.s,s<0){if(e<n.d.length-1)return new u(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=Se(+a,l),e=t==0||!isFinite(t)?Re(l*(Math.log("0."+Ce(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(D=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=qo(n.times(it(a,i+t)),i),r.d&&(r=I(r,i+5,1),ki(r.d,i,o)&&(e=i+10,r=I(qo(n.times(it(a,e+t)),e),e+5,1),+Ce(r.d).slice(i+1,i+15)+1==1e14&&(r=I(r,i+1,0)))),r.s=s,D=!0,u.rounding=o,I(r,i,o))};y.toPrecision=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=wn(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(ze(n,1,ot),e===void 0?e=r.rounding:ze(e,0,8),i=I(new r(i),n,e),t=wn(i,n<=i.e||i.e<=r.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};y.toSignificantDigits=y.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(ze(n,1,ot),e===void 0?e=i.rounding:ze(e,0,8)),I(new i(t),n,e)};y.toString=function(){var n=this,e=n.constructor,t=wn(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};y.truncated=y.trunc=function(){return I(new this.constructor(this),this.e+1,1)};y.valueOf=y.toJSON=function(){var n=this,e=n.constructor,t=wn(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function Ce(n){var e,t,i,r=n.length-1,o="",s=n[0];if(r>0){for(o+=s,e=1;e<r;e++)i=n[e]+"",t=C-i.length,t&&(o+=tt(t)),o+=i;s=n[e],i=s+"",t=C-i.length,t&&(o+=tt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function ze(n,e,t){if(n!==~~n||n<e||n>t)throw Error(rt+n)}function ki(n,e,t,i){var r,o,s,a;for(o=n[0];o>=10;o/=10)--e;return--e<0?(e+=C,r=0):(r=Math.ceil((e+1)/C),e%=C),o=Se(10,C-e),a=n[r]%o|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(n[r+1]/o/100|0)==Se(10,e-2)-1||(a==o/2||a==0)&&(n[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==o||!i&&t>3&&a+1==o/2)&&(n[r+1]/o/1e3|0)==Se(10,e-3)-1,s}function kr(n,e,t){for(var i,r=[0],o,s=0,a=n.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=$o.indexOf(n.charAt(s++)),i=0;i<r.length;i++)r[i]>t-1&&(r[i+1]===void 0&&(r[i+1]=0),r[i+1]+=r[i]/t|0,r[i]%=t)}return r.reverse()}function Gf(n,e){var t,i,r;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),r=(1/Lr(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),n.precision+=t,e=Zt(n,1,e.times(r),new n(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var X=function(){function n(i,r,o){var s,a=0,u=i.length;for(i=i.slice();u--;)s=i[u]*r+a,i[u]=s%o|0,a=s/o|0;return a&&i.unshift(a),i}function e(i,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(i[a]!=r[a]){u=i[a]>r[a]?1:-1;break}return u}function t(i,r,o,s){for(var a=0;o--;)i[o]-=a,a=i[o]<r[o]?1:0,i[o]=a*s+i[o]-r[o];for(;!i[0]&&i.length>1;)i.shift()}return function(i,r,o,s,a,u){var l,c,f,d,p,x,g,b,_,k,w,z,be,ke,hn,Br,wi,Ro,yn,Ir,wr=i.constructor,Po=i.s==r.s?1:-1,De=i.d,te=r.d;if(!De||!De[0]||!te||!te[0])return new wr(!i.s||!r.s||(De?te&&De[0]==te[0]:!te)?NaN:De&&De[0]==0||!te?Po*0:Po/0);for(u?(p=1,c=i.e-r.e):(u=xn,p=C,c=Re(i.e/p)-Re(r.e/p)),yn=te.length,wi=De.length,_=new wr(Po),k=_.d=[],f=0;te[f]==(De[f]||0);f++);if(te[f]>(De[f]||0)&&c--,o==null?(ke=o=wr.precision,s=wr.rounding):a?ke=o+(i.e-r.e)+1:ke=o,ke<0)k.push(1),x=!0;else{if(ke=ke/p+2|0,f=0,yn==1){for(d=0,te=te[0],ke++;(f<wi||d)&&ke--;f++)hn=d*u+(De[f]||0),k[f]=hn/te|0,d=hn%te|0;x=d||f<wi}else{for(d=u/(te[0]+1)|0,d>1&&(te=n(te,d,u),De=n(De,d,u),yn=te.length,wi=De.length),Br=yn,w=De.slice(0,yn),z=w.length;z<yn;)w[z++]=0;Ir=te.slice(),Ir.unshift(0),Ro=te[0],te[1]>=u/2&&++Ro;do d=0,l=e(te,w,yn,z),l<0?(be=w[0],yn!=z&&(be=be*u+(w[1]||0)),d=be/Ro|0,d>1?(d>=u&&(d=u-1),g=n(te,d,u),b=g.length,z=w.length,l=e(g,w,b,z),l==1&&(d--,t(g,yn<b?Ir:te,b,u))):(d==0&&(l=d=1),g=te.slice()),b=g.length,b<z&&g.unshift(0),t(w,g,z,u),l==-1&&(z=w.length,l=e(te,w,yn,z),l<1&&(d++,t(w,yn<z?Ir:te,z,u))),z=w.length):l===0&&(d++,w=[0]),k[f++]=d,l&&w[0]?w[z++]=De[Br]||0:(w=[De[Br]],z=1);while((Br++<wi||w[0]!==void 0)&&ke--);x=w[0]!==void 0}k[0]||k.shift()}if(p==1)_.e=c,Oa=x;else{for(f=1,d=k[0];d>=10;d/=10)f++;_.e=f+c*p-1,I(_,a?o+_.e+1:o,s,x)}return _}}();function I(n,e,t,i){var r,o,s,a,u,l,c,f,d,p=n.constructor;e:if(e!=null){if(f=n.d,!f)return n;for(r=1,a=f[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=C,s=e,c=f[d=0],u=c/Se(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/C),a=f.length,d>=a)if(i){for(;a++<=d;)f.push(0);c=u=0,r=1,o%=C,s=o-C+1}else break e;else{for(c=a=f[d],r=1;a>=10;a/=10)r++;o%=C,s=o-C+r,u=s<0?0:c/Se(10,r-s-1)%10|0}if(i=i||e<0||f[d+1]!==void 0||(s<0?c:c%Se(10,r-s-1)),l=t<4?(u||i)&&(t==0||t==(n.s<0?3:2)):u>5||u==5&&(t==4||i||t==6&&(o>0?s>0?c/Se(10,r-s):0:f[d-1])%10&1||t==(n.s<0?8:7)),e<1||!f[0])return f.length=0,l?(e-=n.e+1,f[0]=Se(10,(C-e%C)%C),n.e=-e||0):f[0]=n.e=0,n;if(o==0?(f.length=d,a=1,d--):(f.length=d+1,a=Se(10,C-o),f[d]=s>0?(c/Se(10,r-s)%Se(10,s)|0)*a:0),l)for(;;)if(d==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,f[0]==xn&&(f[0]=1));break}else{if(f[d]+=a,f[d]!=xn)break;f[d--]=0,a=1}for(o=f.length;f[--o]===0;)f.pop()}return D&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function wn(n,e,t){if(!n.isFinite())return ja(n);var i,r=n.e,o=Ce(n.d),s=o.length;return e?(t&&(i=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+tt(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):r<0?(o="0."+tt(-r-1)+o,t&&(i=t-s)>0&&(o+=tt(i))):r>=s?(o+=tt(r+1-s),t&&(i=t-r-1)>0&&(o=o+"."+tt(i))):((i=r+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),t&&(i=t-s)>0&&(r+1===s&&(o+="."),o+=tt(i))),o}function Pr(n,e){var t=n[0];for(e*=C;t>=10;t/=10)e++;return e}function Mr(n,e,t){if(e>zf)throw D=!0,t&&(n.precision=t),Error($a);return I(new n(Ar),e,1,!0)}function In(n,e,t){if(e>Vo)throw Error($a);return I(new n(Dr),e,t,!0)}function za(n){var e=n.length-1,t=e*C+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function tt(n){for(var e="";n--;)e+="0";return e}function Ga(n,e,t,i){var r,o=new n(1),s=Math.ceil(i/C+4);for(D=!1;;){if(t%2&&(o=o.times(e),Pa(o.d,s)&&(r=!0)),t=Re(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Pa(e.d,s)}return D=!0,o}function Ra(n){return n.d[n.d.length-1]&1}function Ua(n,e,t){for(var i,r,o=new n(e[0]),s=0;++s<e.length;){if(r=new n(e[s]),!r.s){o=r;break}i=o.cmp(r),(i===t||i===0&&o.s===t)&&(o=r)}return o}function qo(n,e){var t,i,r,o,s,a,u,l=0,c=0,f=0,d=n.constructor,p=d.rounding,x=d.precision;if(!n.d||!n.d[0]||n.e>17)return new d(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:NaN);for(e==null?(D=!1,u=x):u=e,a=new d(.03125);n.e>-2;)n=n.times(a),f+=5;for(i=Math.log(Se(2,f))/Math.LN10*2+5|0,u+=i,t=o=s=new d(1),d.precision=u;;){if(o=I(o.times(n),u,1),t=t.times(++c),a=s.plus(X(o,t,u,1)),Ce(a.d).slice(0,u)===Ce(s.d).slice(0,u)){for(r=f;r--;)s=I(s.times(s),u,1);if(e==null)if(l<3&&ki(s.d,u-i,p,l))d.precision=u+=10,t=o=a=new d(1),c=0,l++;else return I(s,d.precision=x,p,D=!0);else return d.precision=x,s}s=a}}function it(n,e){var t,i,r,o,s,a,u,l,c,f,d,p=1,x=10,g=n,b=g.d,_=g.constructor,k=_.rounding,w=_.precision;if(g.s<0||!b||!b[0]||!g.e&&b[0]==1&&b.length==1)return new _(b&&!b[0]?-1/0:g.s!=1?NaN:b?0:g);if(e==null?(D=!1,c=w):c=e,_.precision=c+=x,t=Ce(b),i=t.charAt(0),Math.abs(o=g.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)g=g.times(n),t=Ce(g.d),i=t.charAt(0),p++;o=g.e,i>1?(g=new _("0."+t),o++):g=new _(i+"."+t.slice(1))}else return l=Mr(_,c+2,w).times(o+""),g=it(new _(i+"."+t.slice(1)),c-x).plus(l),_.precision=w,e==null?I(g,w,k,D=!0):g;for(f=g,u=s=g=X(g.minus(1),g.plus(1),c,1),d=I(g.times(g),c,1),r=3;;){if(s=I(s.times(d),c,1),l=u.plus(X(s,new _(r),c,1)),Ce(l.d).slice(0,c)===Ce(u.d).slice(0,c))if(u=u.times(2),o!==0&&(u=u.plus(Mr(_,c+2,w).times(o+""))),u=X(u,new _(p),c,1),e==null)if(ki(u.d,c-x,k,a))_.precision=c+=x,l=s=g=X(f.minus(1),f.plus(1),c,1),d=I(g.times(g),c,1),r=a=1;else return I(u,_.precision=w,k,D=!0);else return _.precision=w,u;u=l,r+=2}}function ja(n){return String(n.s*n.s/0)}function Cr(n,e){var t,i,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(i,r),e){if(r-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%C,t<0&&(i+=C),i<r){for(i&&n.d.push(+e.slice(0,i)),r-=C;i<r;)n.d.push(+e.slice(i,i+=C));e=e.slice(i),i=C-e.length}else i-=r;for(;i--;)e+="0";n.d.push(+e),D&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function Uf(n,e){var t,i,r,o,s,a,u,l,c;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),qa.test(e))return Cr(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(Ff.test(e))t=16,e=e.toLowerCase();else if($f.test(e))t=2;else if(Vf.test(e))t=8;else throw Error(rt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Ga(i,new i(t),o,o*2)),l=kr(e,t,xn),c=l.length-1,o=c;l[o]===0;--o)l.pop();return o<0?new i(n.s*0):(n.e=Pr(l,c),n.d=l,D=!1,s&&(n=X(n,r,a*4)),u&&(n=n.times(Math.abs(u)<54?Se(2,u):M.pow(2,u))),D=!0,n)}function jf(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:Zt(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/Lr(5,t)),e=Zt(n,2,e,e);for(var r,o=new n(5),s=new n(16),a=new n(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function Zt(n,e,t,i,r){var o,s,a,u,l=1,c=n.precision,f=Math.ceil(c/C);for(D=!1,u=t.times(t),a=new n(i);;){if(s=X(a.times(u),new n(e++*e++),c,1),a=r?i.plus(s):i.minus(s),i=X(s.times(u),new n(e++*e++),c,1),s=a.plus(i),s.d[f]!==void 0){for(o=f;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=i,i=s,s=o,l++}return D=!0,s.d.length=f+1,s}function Lr(n,e){for(var t=n;--e;)t*=n;return t}function Za(n,e){var t,i=e.s<0,r=In(n,n.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Vn=i?4:1,e;if(t=e.divToInt(r),t.isZero())Vn=i?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Vn=Ra(t)?i?2:3:i?4:1,e;Vn=Ra(t)?i?1:4:i?3:2}return e.minus(r).abs()}function zo(n,e,t,i){var r,o,s,a,u,l,c,f,d,p=n.constructor,x=t!==void 0;if(x?(ze(t,1,ot),i===void 0?i=p.rounding:ze(i,0,8)):(t=p.precision,i=p.rounding),!n.isFinite())c=ja(n);else{for(c=wn(n),s=c.indexOf("."),x?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(c=c.replace(".",""),d=new p(1),d.e=c.length-s,d.d=kr(wn(d),10,r),d.e=d.d.length),f=kr(c,10,r),o=u=f.length;f[--u]==0;)f.pop();if(!f[0])c=x?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=f,n.e=o,n=X(n,d,t,i,0,r),f=n.d,o=n.e,l=Oa),s=f[t],a=r/2,l=l||f[t+1]!==void 0,l=i<4?(s!==void 0||l)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||l||i===6&&f[t-1]&1||i===(n.s<0?8:7)),f.length=t,l)for(;++f[--t]>r-1;)f[t]=0,t||(++o,f.unshift(1));for(u=f.length;!f[u-1];--u);for(s=0,c="";s<u;s++)c+=$o.charAt(f[s]);if(x){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)c+="0";for(f=kr(c,r,e),u=f.length;!f[u-1];--u);for(s=1,c="1.";s<u;s++)c+=$o.charAt(f[s])}else c=c.charAt(0)+"."+c.slice(1);c=c+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)c="0"+c;c="0."+c}else if(++o>u)for(o-=u;o--;)c+="0";else o<u&&(c=c.slice(0,o)+"."+c.slice(o))}c=(e==16?"0x":e==2?"0b":e==8?"0o":"")+c}return n.s<0?"-"+c:c}function Pa(n,e){if(n.length>e)return n.length=e,!0}function Zf(n){return new this(n).abs()}function Hf(n){return new this(n).acos()}function Wf(n){return new this(n).acosh()}function Jf(n,e){return new this(n).plus(e)}function Yf(n){return new this(n).asin()}function Qf(n){return new this(n).asinh()}function Xf(n){return new this(n).atan()}function Kf(n){return new this(n).atanh()}function ed(n,e){n=new this(n),e=new this(e);var t,i=this.precision,r=this.rounding,o=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=In(this,o,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?In(this,i,r):new this(0),t.s=n.s):!n.d||e.isZero()?(t=In(this,o,1).times(.5),t.s=n.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(X(n,e,o,1)),e=In(this,o,1),this.precision=i,this.rounding=r,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(X(n,e,o,1)),t}function nd(n){return new this(n).cbrt()}function td(n){return I(n=new this(n),n.e+1,2)}function id(n,e,t){return new this(n).clamp(e,t)}function rd(n){if(!n||typeof n!="object")throw Error(Rr+"Object expected");var e,t,i,r=n.defaults===!0,o=["precision",1,ot,"rounding",0,8,"toExpNeg",-jt,0,"toExpPos",0,jt,"maxE",0,jt,"minE",-jt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=Fo[t]),(i=n[t])!==void 0)if(Re(i)===i&&i>=o[e+1]&&i<=o[e+2])this[t]=i;else throw Error(rt+t+": "+i);if(t="crypto",r&&(this[t]=Fo[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Fa);else this[t]=!1;else throw Error(rt+t+": "+i);return this}function od(n){return new this(n).cos()}function sd(n){return new this(n).cosh()}function Ha(n){var e,t,i;function r(o){var s,a,u,l=this;if(!(l instanceof r))return new r(o);if(l.constructor=r,La(o)){l.s=o.s,D?!o.d||o.e>r.maxE?(l.e=NaN,l.d=null):o.e<r.minE?(l.e=0,l.d=[0]):(l.e=o.e,l.d=o.d.slice()):(l.e=o.e,l.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){l.s=1/o<0?-1:1,l.e=0,l.d=[0];return}if(o<0?(o=-o,l.s=-1):l.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;D?s>r.maxE?(l.e=NaN,l.d=null):s<r.minE?(l.e=0,l.d=[0]):(l.e=s,l.d=[o]):(l.e=s,l.d=[o]);return}if(o*0!==0){o||(l.s=NaN),l.e=NaN,l.d=null;return}return Cr(l,o.toString())}if(u==="string")return(a=o.charCodeAt(0))===45?(o=o.slice(1),l.s=-1):(a===43&&(o=o.slice(1)),l.s=1),qa.test(o)?Cr(l,o):Uf(l,o);if(u==="bigint")return o<0?(o=-o,l.s=-1):l.s=1,Cr(l,o.toString());throw Error(rt+o)}if(r.prototype=y,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=rd,r.clone=Ha,r.isDecimal=La,r.abs=Zf,r.acos=Hf,r.acosh=Wf,r.add=Jf,r.asin=Yf,r.asinh=Qf,r.atan=Xf,r.atanh=Kf,r.atan2=ed,r.cbrt=nd,r.ceil=td,r.clamp=id,r.cos=od,r.cosh=sd,r.div=ad,r.exp=ud,r.floor=ld,r.hypot=cd,r.ln=fd,r.log=dd,r.log10=md,r.log2=pd,r.max=gd,r.min=hd,r.mod=yd,r.mul=xd,r.pow=bd,r.random=Ed,r.round=vd,r.sign=Nd,r.sin=_d,r.sinh=Sd,r.sqrt=Td,r.sub=Bd,r.sum=Id,r.tan=wd,r.tanh=kd,r.trunc=Cd,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return r.config(n),r}function ad(n,e){return new this(n).div(e)}function ud(n){return new this(n).exp()}function ld(n){return I(n=new this(n),n.e+1,3)}function cd(){var n,e,t=new this(0);for(D=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return D=!0,new this(1/0);t=e}return D=!0,t.sqrt()}function La(n){return n instanceof M||n&&n.toStringTag===Va||!1}function fd(n){return new this(n).ln()}function dd(n,e){return new this(n).log(e)}function pd(n){return new this(n).log(2)}function md(n){return new this(n).log(10)}function gd(){return Ua(this,arguments,-1)}function hd(){return Ua(this,arguments,1)}function yd(n,e){return new this(n).mod(e)}function xd(n,e){return new this(n).mul(e)}function bd(n,e){return new this(n).pow(e)}function Ed(n){var e,t,i,r,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:ze(n,1,ot),i=Math.ceil(n/C),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));o<i;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);o<i;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=i/4}else throw Error(Fa);else for(;o<i;)a[o++]=Math.random()*1e7|0;for(i=a[--o],n%=C,i&&n&&(r=Se(10,C-n),a[o]=(i/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=C)a.shift();for(i=1,r=a[0];r>=10;r/=10)i++;i<C&&(t-=C-i)}return s.e=t,s.d=a,s}function vd(n){return I(n=new this(n),n.e+1,this.rounding)}function Nd(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function _d(n){return new this(n).sin()}function Sd(n){return new this(n).sinh()}function Td(n){return new this(n).sqrt()}function Bd(n,e){return new this(n).sub(e)}function Id(){var n=0,e=arguments,t=new this(e[n]);for(D=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return D=!0,I(t,this.precision,this.rounding)}function wd(n){return new this(n).tan()}function kd(n){return new this(n).tanh()}function Cd(n){return I(n=new this(n),n.e+1,1)}y[Symbol.for("nodejs.util.inspect.custom")]=y.toString;y[Symbol.toStringTag]="Decimal";var M=y.constructor=Ha(Fo);Ar=new M(Ar);Dr=new M(Dr);var Ci=M;var $e="\x1B[0m";var Ht="\x1B[30;1m";var Wa="\x1B[33m",Go="\x1B[34;1m";var Ai="\x1B[36;1m",Ja="\x1B[101;97m";var Or="\x1B[1m";var Uo;function Xa(n){if(!Uo){let t=`^[${["Zyyy","Zinh","Arab","Armn","Beng","Bopo","Cyrl","Deva","Ethi","Geor","Grek","Gujr","Guru","Hang","Hani","Hebr","Hira","Kana","Knda","Khmr","Laoo","Latn","Mlym","Mymr","Orya","Sinh","Taml","Telu","Thaa","Thai","Tibt"].map(i=>`\\p{Script=${i}}`).join("")}]*$`;Uo=new RegExp(t,"u")}return Uo.test(n)}function Te(n){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n)||Wt.test(n)?!0:Xa(n)?/^[\p{XIDS}_]\p{XIDC}*$/u.test(n):!1}var Ad="\\u{FE0F}",Dd="\\u{20E3}",Md="\\u{200D}",Rd="\\p{RI}\\p{RI}",Pd="(?:[\\u{E0020}-\\u{E007E}]+\\u{E007F})",Ya=`(?:\\p{EMod}|${Ad}${Dd}?|${Pd})`,Ld="(?:(?=\\P{XIDC})\\p{Emoji})",Qa=`(?:${Ld}${Ya}*|\\p{Emoji}${Ya}+|${Rd})`,Ka=`(?:${Qa})(${Md}${Qa})*`,Od=new RegExp(`(?:${Ka})+`,"u"),Wt=new RegExp(`^(?:${Ka})+$`,"u");function nn(n){return typeof n!="string"?"not-a-string":n===""?"empty-string":n.normalize()!==n?"expected-nfc":/[\u200E\u200F\u2066-\u2069\u202A-\u202E]/.test(n)?"unexpected-bidi-marker":Wt.test(n)?"valid":/\p{XIDC}/u.test(n)&&Od.test(n)?"unexpected-mixed-emoji":Xa(n)?Te(n)?"valid":Te(n[0])?"invalid-char":"invalid-first-char":"unexpected-script"}var $r=["number","finite_number","complex","finite_complex","imaginary","real","finite_real","rational","finite_rational","integer","finite_integer","non_finite_number"],jo=["indexed_collection","list","tuple"],Fr=[...jo,"collection","set","record","dictionary"],Vr=["scalar",...$r,"boolean","string"],Zo=["value",...Fr,...Vr],Ho=["expression","symbol","function",...Zo],Et=["any","unknown","nothing","never","error",...Ho];var $d={number:$r,non_finite_number:[],finite_number:["finite_complex","finite_real","finite_integer","finite_rational"],complex:["finite_complex","imaginary","finite_real","finite_rational","finite_integer","non_finite_number"],finite_complex:["imaginary","finite_real","finite_rational","finite_integer"],imaginary:[],real:["rational","integer","finite_real","finite_rational","finite_integer","non_finite_number"],finite_real:["finite_rational","finite_integer"],rational:["finite_rational","finite_integer","integer","non_finite_number"],finite_rational:["finite_integer"],integer:["finite_integer","non_finite_number"],finite_integer:[],any:Et,unknown:[],nothing:[],never:[],error:[],value:Zo,scalar:Vr,collection:Fr,indexed_collection:jo,list:[],set:[],tuple:[],record:[],dictionary:[],function:[],symbol:[],boolean:[],string:[],expression:Ho};function Di(n,e){return e==="any"||n==="never"?!0:n==="unknown"||e==="unknown"?!1:n===e?!0:$d[e].includes(n)}function E(n,e){if(typeof n=="string"&&(n=A(n)),typeof e=="string"&&(e=A(e)),e==="any")return!0;if(e==="never")return!1;if(e==="error")return n==="error";if(e==="nothing")return n==="nothing";if(n==="nothing")return!1;if(e==="unknown")return!0;if(n==="unknown")return!1;if(typeof e=="string")return typeof n=="string"?Di(n,e):n.kind==="value"?typeof n.value=="boolean"?e==="boolean":typeof n.value=="number"?Number.isInteger(n.value)?Di("integer",e):Di("number",e):typeof n.value=="boolean"?Di("boolean",e):typeof n.value=="string"?Di("string",e):!1:n.kind==="union"?n.types.every(t=>E(t,e)):n.kind==="intersection"?n.types.some(t=>E(t,e)):n.kind==="negation"?!E(n.type,e):n.kind==="numeric"?!!E(n.type,e):e==="number"?eu(n):e==="symbol"?Wo(n):e==="expression"?Fd(n):e==="function"?ou(n):e==="scalar"?nu(n):e==="value"?ru(n):e==="indexed_collection"?iu(n):e==="collection"?tu(n):e==="tuple"?n.kind==="tuple":e==="list"?n.kind==="list":e==="set"?n.kind==="set":e==="record"?n.kind==="record":e==="dictionary"?n.kind==="dictionary":!1;if(e.kind==="union")return typeof n!="string"&&n.kind==="union"?n.types.every(t=>e.types.some(i=>E(t,i))):e.types.some(t=>E(n,t));if(e.kind==="expression"){if(n==="symbol")return!0;if(typeof n=="string")return!1;if(n.kind==="expression")return e.operator==="Symbol"?Wo(n):n.operator===e.operator;if(n.kind==="symbol")return!0}if(typeof n=="string")return!1;if(e.kind==="reference"){if(n.kind==="reference")return n.name===e.name;if(e.alias===!0&&e.def)return E(n,e.def)}if(n.kind==="union")return n.types.some(t=>E(t,e));if(n.kind==="intersection"&&e.kind==="intersection")return e.types.every(t=>n.types.some(i=>E(i,t)));if(n.kind==="intersection")return n.types.every(t=>E(t,e));if(e.kind==="intersection")return e.types.every(t=>E(n,t));if(n.kind==="signature"&&e.kind==="signature"){if(!E(n.result,e.result))return!1;if(n.optArgs||n.variadicArg){if(e.args){if(!n.args||n.args.length!==e.args.length)return!1;for(let t=0;t<e.args.length;t++)if(!E(e.args[t].type,n.args[t].type))return!1}else if(n.args)return!1;if(e.optArgs){if(!n.optArgs||n.optArgs.length!==e.optArgs.length)return!1;for(let t=0;t<n.optArgs.length;t++)if(!E(e.optArgs[t].type,n.optArgs[t].type))return!1}else if(n.optArgs)return!1;if(e.variadicArg){if(!n.variadicArg||n.variadicMin!=e.variadicMin||!E(e.variadicArg.type,n.variadicArg.type))return!1}else if(n.variadicArg)return!1}else{if(e.args&&!n.args)return!1;let t=0;if(e.args){if(n.args.length<e.args.length)return!1;for(;t<e.args.length;){if(!E(e.args[t].type,n.args[t].type))return!1;t+=1}}if(e.optArgs){if(t>=n.args.length)return!0;for(let i=0;i<e.optArgs.length;i++){if(!E(e.optArgs[i].type,n.args[t].type))return!1;if(t+=1,t>=n.args.length)return!0}}if(e.variadicArg){if(t>=n.args.length&&e.variadicMin===0)return!0;if(e.variadicMin>0&&t+e.variadicMin>n.args.length)return!1;for(;t<n.args.length;){if(!E(e.variadicArg.type,n.args[t].type))return!1;t+=1}}}return!0}if(n.kind==="record"&&e.kind==="record"){for(let t of Object.keys(e.elements))if(!(t in n.elements)||!E(n.elements[t],e.elements[t]))return!1;return!0}if(n.kind==="dictionary"&&e.kind==="dictionary")return E(n.values,e.values);if(e.kind==="indexed_collection")return n.kind==="indexed_collection"||n.kind==="list"?E(n.elements,e.elements):n.kind==="tuple"?n.elements.every(t=>E(t.type,e.elements)):!1;if(e.kind==="collection"){if(n.kind==="collection"||n.kind==="indexed_collection"||n.kind==="list")return E(n.elements,e.elements);if(n.kind==="tuple")return n.elements.every(t=>E(t.type,e.elements));if(n.kind==="set")return E(n.elements,e.elements);if(n.kind==="dictionary")return E(A(`tuple<string, ${U(n.values)}>`),e.elements);if(n.kind==="record")return E(A(`tuple<$string, ${U(oe(...Object.values(n.elements)))}>`),e.elements)}if(n.kind==="tuple"&&e.kind==="tuple"){if(n.elements.length!==e.elements.length)return!1;for(let t=0;t<n.elements.length;t++){let i=n.elements[t],r=e.elements[t];if(!E(i.type,r.type)||i.name!==r.name)return!1}return!0}if(e.kind==="list"&&n.kind==="list"){if(!E(n.elements,e.elements))return!1;if(e.dimensions){if(!n.dimensions||n.dimensions.length!==e.dimensions.length)return!1;for(let t=0;t<n.dimensions.length;t++)if(e.dimensions[t]!==-1&&n.dimensions[t]!==e.dimensions[t])return!1}return!0}if(n.kind==="symbol"&&e.kind==="symbol")return n.name===e.name;if(n.kind==="numeric"&&e.kind==="numeric")return!(!E(n.type,e.type)||(n.lower??-1/0)<(e.lower??-1/0)||(n.upper??1/0)>(e.upper??1/0));if(e.kind==="set"&&n.kind==="set")return!!E(n.elements,e.elements);if(n.kind==="negation"&&e.kind==="negation")return E(n.type,e.type);if(e.kind==="negation")return!E(n,e.type);if(e.kind==="value"&&n.kind==="value")return e.value===n.value;if(n.kind==="value"){if(typeof n.value=="boolean")return E("boolean",e);if(typeof n.value=="number")return Number.isInteger(n.value)?E("integer",e):E("real",e);if(typeof n.value=="string")return E("string",e)}return!1}function eu(n){return typeof n=="string"?$r.includes(n):n.kind==="value"?typeof n.value=="number":n.kind==="numeric"}function nu(n){return eu(n)?!0:typeof n=="string"?Vr.includes(n):n.kind==="value"?["string","boolean","number"].includes(typeof n.value):!1}function tu(n){return iu(n)?!0:typeof n=="string"?Fr.includes(n):["collection","set","record","dictionary"].includes(n.kind)}function iu(n){return typeof n=="string"?!1:["indexed_collection","list","tuple"].includes(n.kind)}function ru(n){return nu(n)||tu(n)}function ou(n){return n==="function"||typeof n!="string"&&n.kind==="signature"}function Fd(n){return typeof n=="string"&&["expression","symbol","function"].includes(n)||ru(n)||ou(n)||Wo(n)?!0:typeof n=="string"?!1:n.kind==="expression"}function Wo(n){return n==="symbol"?!0:typeof n=="string"?!1:n.kind==="symbol"?!0:n.kind==="expression"?n.operator==="Symbol":!1}var au=3,uu=1,lu=2,Vd=4,qd=5,zd=6,Gd=7,Ud=8,jd=9,Zd=10,Hd=11;function U(n,e=0){if(typeof n=="string")return n;let t="";switch(n.kind){case"value":typeof n.value=="string"?t=`"${n.value}"`:typeof n.value=="boolean"?t=n.value?"true":"false":t=n.value.toString();break;case"reference":t=n.name;break;case"negation":t=`!${U(n.type,au)}`;break;case"union":t=n.types.map(u=>U(u,uu)).join(" | ");break;case"intersection":t=n.types.map(u=>U(u,lu)).join(" & ");break;case"expression":t=`expression<${su(n.operator)}>`;break;case"symbol":t=`symbol<${su(n.name)}>`;break;case"numeric":Number.isFinite(n.lower)&&Number.isFinite(n.upper)?t=`${n.type}<${n.lower}..${n.upper}>`:Number.isFinite(n.lower)?t=`${n.type}<${n.lower}..>`:Number.isFinite(n.upper)?t=`${n.type}<..${n.upper}>`:t=`${n.type}`;break;case"list":if(n.dimensions&&E(n.elements,"number")){if(n.dimensions===void 0)n.elements==="number"&&(t="tensor");else if(n.dimensions.length===1)n.elements==="number"?n.dimensions[0]<0?t="vector":t=`vector<${n.dimensions[0]}>`:n.dimensions[0]<0?t=`vector<${U(n.elements)}>`:t=`vector<${U(n.elements)}^${n.dimensions[0]}>`;else if(n.dimensions.length===2){let u=n.dimensions;n.elements==="number"?u[0]<0&&u[1]<0?t="matrix":t=`matrix<${u[0]}x${u[1]}>`:u[0]<0&&u[1]<0?t=`matrix<${U(n.elements)}>`:t=`matrix<${U(n.elements)}^(${u[0]}x${u[1]})>`}}if(!t){let u=n.dimensions?n.dimensions.length===1?`^${n.dimensions[0].toString()}`:`^(${n.dimensions.join("x")})`:"";t=`list<${U(n.elements)}${u}>`}break;case"record":t=`record<${Object.entries(n.elements).map(([u,l])=>`${u}: ${U(l)}`).join(", ")}>`;break;case"dictionary":t=`dictionary<${U(n.values)}>`;break;case"set":t=`set<${U(n.elements)}>`;break;case"collection":t=`collection<${U(n.elements)}>`;break;case"indexed_collection":t=`indexed_collection<${U(n.elements)}>`;break;case"tuple":if(n.elements.length===0)t="tuple";else if(n.elements.length===1){let[u]=n.elements;t=`tuple<${Jt(u)}>`}else t="tuple<"+n.elements.map(u=>Jt(u)).join(", ")+">";break;case"signature":let r=n.args?n.args.map(u=>Jt(u)).join(", "):"",o=n.optArgs?n.optArgs.map(u=>Jt(u)+"?").join(", "):"",s=n.variadicArg?n.variadicMin===0?`${Jt(n.variadicArg)}*`:`${Jt(n.variadicArg)}+`:"";t=`(${[r,o,s].filter(u=>u).join(", ")}) -> ${U(n.result)}`;break;default:t="error"}return e>0&&e>Wd(n.kind)?`(${t})`:t}function Jt(n){return n.name?`${n.name}: ${U(n.type)}`:U(n.type)}function su(n){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n)?n:`\`${n}\``}function Wd(n){switch(n){case"negation":return au;case"union":return uu;case"intersection":return lu;case"list":return Vd;case"record":return qd;case"dictionary":return zd;case"set":return Gd;case"collection":case"indexed_collection":return Ud;case"tuple":return jd;case"signature":return Zd;case"value":return Hd;default:return 0}}function Jd(n,e){if(n===e)return 0;if(n.length===0)return e.length;if(e.length===0)return n.length;let t=Array.from({length:n.length+1},(r,o)=>o),i=new Array(n.length+1);for(let r=1;r<=e.length;r++){i[0]=r;for(let o=1;o<=n.length;o++){let s=n[o-1]===e[r-1]?0:1;i[o]=Math.min(t[o]+1,i[o-1]+1,t[o-1]+s)}[t,i]=[i,t]}return t[n.length]}function Mi(n,e){let i=null,r=1/0,o=n.length;for(let s of e){if(Math.abs(o-s.length)>7)continue;let a=Jd(n,s);if(a===0)return s;a<=7&&a<r&&(r=a,i=s)}return i}var Jo=class{buffer;pos;_valueParser;_typeResolver;constructor(e,t){this.buffer=e,this.pos=0,this._valueParser=t?.valueParser??(()=>null),this._typeResolver=t?.typeResolver??{forward:()=>{},resolve:()=>{},get names(){return[]}}}error(...e){throw new Error(`
Invalid type
|   ${this.buffer}
|   ${" ".repeat(this.pos)}^
|   
|   ${e.filter(t=>t!==void 0).join(`
|   `)}
`)}peek(){return this.buffer[this.pos]}consume(){return this.buffer[this.pos++]}match(e){if(e.length===1&&this.buffer[this.pos]===e)return this.pos++,!0;let t=this.pos;return this.buffer.slice(t,t+e.length)===e?(this.pos+=e.length,!0):!1}expectClosingBracket(){this.skipWhitespace(),this.match(">")||this.error('Expected ">".')}skipWhitespace(){for(;this.pos<this.buffer.length&&/\s/.test(this.buffer[this.pos]);)this.pos++}isEOF(){return this.pos>=this.buffer.length}parseValue(){let e=this.pos;this.skipWhitespace();let t=this._valueParser(this);return t!==null?{kind:"value",value:t}:(this.pos=e,null)}parseTypeReference(){let e=this.pos;this.skipWhitespace();let t=this.match("type");this.skipWhitespace();let i=this.parseIdentifier();if(i!==null){let r=this._typeResolver.resolve(i);if(r)return r;if(t){let o=this._typeResolver.forward(i);if(o)return o}}return this.pos=e,null}parsePrimitiveType(){this.skipWhitespace(),this.isEOF()&&this.error("Unexpected end of input");for(let e of Et)if(this.match(e))return e;return null}parseArguments(){let e=[],t=[],i,r,o=this.pos;for(;;){let a=this.parseNamedElement();if(a===null){if(this.skipWhitespace(),this.peek()===")")break;this.pos=o,this.skipWhitespace(),this.match(",")&&this.error('Expected a valid argument after ","');break}if(this.match("?")?(i!==void 0&&this.error("Optional arguments cannot be used with variadic arguments"),t.push(a)):this.match("*")?(t.length>0&&this.error("Variadic arguments cannot be used with optional arguments"),i!==void 0&&this.error("There can be only one variadic argument"),i=0,r=a):this.match("+")?(t.length>0&&this.error("Variadic arguments cannot be used with optional arguments"),i!==void 0&&this.error("There can be only one variadic argument"),i=1,r=a):(t.length>0&&this.error("Optional arguments must come after required arguments"),i!==void 0&&this.error("Variadic arguments must come last"),e.push(a)),this.skipWhitespace(),o=this.pos,!this.match(","))break}let s=Yd([...e,...t,...r?[r]:[]]);return s&&this.error(`Duplicate argument name "${s}"`),[e,t,r,i]}parseFunctionSignature(){let e=[],t=[],i,r;this.skipWhitespace();let o=this.pos;if(this.match("()")||this.match("(")&&([e,t,i,r]=this.parseArguments(),this.skipWhitespace(),this.match(")")||this.error("Expected a closing parenthesis `)` after arguments.")),this.skipWhitespace(),!this.match("->"))return this.pos=o,null;this.skipWhitespace(),this.isEOF()&&this.error("Expected a return type after `->`.","Use `any` for any type or `nothing` for no return value, or `never` for a function that never returns");let s=this.parseType();return s===null&&this.error("Expected a return type after `->`.","Use `any` for any type or `nothing` for no return value, or `never` for a function that never returns",this.parseUnexpectedToken()),e.length===0&&(e=void 0),t.length===0&&(t=void 0),!t&&!i?{kind:"signature",args:e,result:s}:!t&&i?{kind:"signature",args:e,variadicArg:i,variadicMin:r,result:s}:{kind:"signature",args:e,optArgs:t,variadicArg:i,variadicMin:r,result:s}}parsePositiveIntegerLiteral(){let e=0;for(this.skipWhitespace();/[0-9]/.test(this.peek());)e=e*10+parseInt(this.consume());return e===0?null:e}parseOptionalDimension(){let e=this.parsePositiveIntegerLiteral();return e===null&&this.match("?")&&(e=-1),e}parseDimensions(){let e=this.pos,t=this.match("("),i=[],r=this.parseOptionalDimension();if(r===null){this.pos=e;return}do{if(i.push(r),this.skipWhitespace(),!this.match("x"))break;this.skipWhitespace(),r=this.parseOptionalDimension(),r===null&&this.error("Expected a positive integer literal or `?`.","For example : `matrix<integer^2x3>` or `matrix<integer^?x?>`")}while(!0);return this.skipWhitespace(),t&&!this.match(")")&&this.error('Expected ")".',"For example `matrix<integer^(2x3)>`"),i}parseList(){if(this.skipWhitespace(),this.match("list<")){let i=this.parseDimensions();if(i!==void 0)return this.expectClosingBracket(),{kind:"list",elements:"any",dimensions:i};let r=this.parseTypeMaybe();return r&&this.match("^")&&(i=this.parseDimensions(),i===void 0&&this.error("Expected dimensions after `^`.","For example `list<number^2x3>`")),r||this.error("Expected a type after `list<`.","Use `list<any>` for a list of any type","For example `list<number>` or `list<string>`"),this.expectClosingBracket(),{kind:"list",elements:r??"any",dimensions:i}}if(this.match("list(")&&this.error("Use `list<type>` instead of `list(type)`.","For example `list<number>`"),this.match("vector<")){let i=this.parseType(),r;if(i&&this.match("^")){let o=this.parsePositiveIntegerLiteral();o===null&&this.error("Expected a positive integer literal.","For example `vector<3>`","Use `vector` for a vector of unknown size"),r=[o]}else i||(i="number",r=this.parseDimensions());return this.expectClosingBracket(),{kind:"list",elements:i,dimensions:r}}if(this.match("vector(")&&this.error("Use `vector<...>` instead of `vector(...)`.","For example `vector<3>` or `vector<integer^3>`"),this.match("vector"))return{kind:"list",elements:"number"};if(this.match("matrix<")){let i=this.parseType(),r;return i&&this.match("^")?(r=this.parseDimensions(),r===void 0&&this.error("Expected dimensions","For example `matrix<number^2x3>`","Use `matrix` for a matrix of unknown size")):i||(i="number",r=this.parseDimensions()),this.expectClosingBracket(),{kind:"list",elements:i,dimensions:r}}if(this.match("matrix(")&&this.error("Use `matrix<...>` instead of `matrix(...)`.","For example `matrix<3x2>` or `matrix<integer^3x2>`"),this.match("matrix"))return{kind:"list",elements:"number",dimensions:[-1,-1]};if(this.match("tensor<")){let i=this.parseType()??"number";return this.expectClosingBracket(),{kind:"list",elements:i,dimensions:void 0}}if(this.match("tensor"))return{kind:"list",elements:"number",dimensions:void 0};if(!this.match("list<"))return null;let e=this.parseTypeMaybe();e===null&&this.error('Expected a type. Use "[any]" for a collection of any type');let t=this.match("^")?this.parseDimensions():void 0;return this.expectClosingBracket(),{kind:"list",elements:e,dimensions:t}}parseName(){let e=this.pos;if(this.skipWhitespace(),this.isEOF())return null;let t=this.parseVerbatimString();if(t===null){if(!/[a-zA-Z_]/.test(this.peek()))return null;for(t="";!this.isEOF()&&/[a-zA-Z0-9_]/.test(this.peek());)t+=this.consume()}if(this.skipWhitespace(),!this.match(":")){if(this.match("?:")){let i=this.parseTypeMaybe();this.error("Optional qualifier must come after the type",`Use "${t}: ${i?U(i):"number"}?"`)}return this.pos=e,null}return t}parseVerbatimString(){if(this.skipWhitespace(),this.isEOF())return null;let e="";if(this.match("`")){for(;!this.match("`");)this.isEOF()&&this.error("Expected closing backtick"),this.match("\\`")?e+="`":this.match("\\\\")?e+="\\":e+=this.consume();return e}return null}parseIdentifier(){let e=this.parseVerbatimString();if(e!==null)return e;if(/[0-9_]/.test(this.peek()))return null;for(e="";!this.isEOF()&&/[a-zA-Z0-9_]/.test(this.peek());)e+=this.consume();return e.length===0?null:e}parseNamedElement(){let e=this.pos,t=this.parseName();if(t!==null){let r=this.parseType();return r===null&&this.error(`Expected a valid type after "${t}:"`,this.parseUnexpectedToken()),this.skipWhitespace(),{name:t,type:r}}let i=this.parseType();return i===null?(this.pos=e,null):{type:i}}parseTupleElements(){let e=[],t=this.pos,i=this.parseNamedElement();if(i===null)return[];let r=i.name!==void 0;for(;e.push(i),this.skipWhitespace(),!!this.match(",");)t=this.pos,i=this.parseNamedElement(),i===null&&(this.pos=t,this.error("Expected a type or unexpected comma")),r&&!i.name&&(this.pos=t,this.error("All tuple elements should be named, or none.","Previous elements were named, but this one isn't.")),!r&&i.name&&(this.pos=t,this.error("All tuple elements should be named, or none.","Previous elements were not named, but this one is."));return e}parseTuple(){if(this.skipWhitespace(),!this.match("tuple<"))return this.match("tuple(")&&this.error("Use `tuple<type>` instead of `tuple(type)`.","For example `tuple<number, boolean>` or `tuple<x: integer, y: integer>`"),null;let e=this.parseTupleElements();return this.expectClosingBracket(),{kind:"tuple",elements:e}}parseGroup(){let e=this.pos;if(this.skipWhitespace(),!this.match("("))return null;let t=this.parseType();return t===null?(this.pos=e,null):(this.skipWhitespace(),this.match(")")&&(this.skipWhitespace(),!this.match("->"))?t:(this.pos=e,null))}parseSet(){if(this.skipWhitespace(),!this.match("set<")){if(this.match("set(")){let t=this.parseTypeMaybe()??"number";this.error(`Use \`set<${t}>\` instead of \`set(${t})\`.`)}return this.match("set")?"set":null}let e=this.parseTypeMaybe();return e===null&&this.error("Expected a type.","Use `set<number>` for a set of numbers"),this.expectClosingBracket(),{kind:"set",elements:e}}parseRecordKeyValue(){let e=[];for(;;){let i=this.parseIdentifier();i===null&&this.error("Expected a name for the key.","For example `record<key: string>`.","Use backticks for special characters.","For example `record<`duraci\xF3n`: number>`"),this.skipWhitespace(),this.match(":")||this.error("Expected a type separated by a `:` after the key.",`For example \`record<${qr(i)}: string>\``,"Use backticks for special characters.","For example `record<`duraci\xF3n`: string>`");let r=this.parseTypeMaybe();if(r===null&&this.error("Expected a type for the value. Use `any` for any type.",`For example \`record<${qr(i)}: any>.\``),e.push([i,r]),this.skipWhitespace(),!this.match(","))break}if(new Set(e.map(([i])=>i)).size!==e.length){let i=e.find(([r],o)=>e.slice(o+1).some(([s])=>s===r))?.[0];this.error(`Duplicate record key "${i}"`,"Keys in a record must be unique.")}return e}parseRecord(){if(this.skipWhitespace(),this.match("record<")){let e=this.parseRecordKeyValue();if(this.skipWhitespace(),!this.match(">")){let t=e[e.length-1]??["key","number"];this.match("?")&&this.error('Unexpected token "?".',`To indicate an optional key, use a specific type, for example \`record<${qr(t[0])}: ${t[1]} | nothing>\``),this.error("Expected a closing `>`.",`For example \`record<${qr(t[0])}: ${t[1]}>\``)}return{kind:"record",elements:Object.fromEntries(e)}}return this.match("record")?"record":null}parseDictionary(){if(this.match("dictionary<")){this.skipWhitespace();let e=this.parseType();return e===null&&this.error("Expected a type."),this.skipWhitespace(),this.match(",")&&this.error("Dictionary types cannot have keys, only values.","For example `dictionary<string>`"),this.expectClosingBracket(),{kind:"dictionary",values:e}}return this.match("dictionary")?"dictionary":null}parseCollection(){if(this.skipWhitespace(),this.match("indexed_collection<")){let t=this.parseType();return t===null&&this.error("Expected a type.","Use `indexed_collection<number>` for an indexed collection of numbers"),this.expectClosingBracket(),{kind:"indexed_collection",elements:t}}if(this.match("indexed_collection"))return"indexed_collection";if(!this.match("collection<"))return this.match("collection(")&&this.error("Use `collection<type>` instead of `collection(type)`.","For example `collection<number>`"),this.match("collection")?"collection":null;let e=this.parseType();return e===null&&this.error("Expected a type.","Use `collection<number>` for a collection of numbers"),this.expectClosingBracket(),{kind:"collection",elements:e}}parseExpression(){if(!this.match("expression<"))return null;let e=this.parseIdentifier();return e===null&&this.error("Expected the name of the operator for the expression.","For example `expression<Multiply>`.","Use backticks for special characters.","For example `expression<`\u534A\u5F84`>`"),this.expectClosingBracket(),{kind:"expression",operator:e}}parseSymbol(){if(!this.match("symbol<"))return null;let e=this.parseIdentifier();return e===null&&this.error("Expected a name for the symbol.","For example `symbol<True>`.","Use backticks for special characters.","For example `symbol<`\u534A\u5F84`>`"),this.expectClosingBracket(),{kind:"symbol",name:e}}parseNumericType(){let e=i=>{if(i.skipWhitespace(),i.match(".."))return-1/0;let r=zr(i);if(typeof r!="number"&&i.error("Expected a number"),i.skipWhitespace(),i.match(".."))return r;i.error('Expected ".." after lower bound',"For example `integer<-oo..10>` or `integer<0..10>`")},t=i=>{if(i.skipWhitespace(),i.match(">"))return;let r=zr(i);return typeof r!="number"&&i.error("Expected a number"),i.expectClosingBracket(),r};for(let i of["real","finite_real","rational","finite_rational","integer","finite_integer"]){if(!this.match(i+"<"))continue;let r=e(this)??-1/0,o=t(this)??1/0;return(Number.isNaN(r)||Number.isNaN(o))&&this.error("Invalid numeric type","Lower and upper bounds must be valid numbers"),r===-1/0&&o===1/0?i:(r>o&&this.error(`Invalid range: ${r}..${o}`,"The lower bound must be less than the upper bound"),{kind:"numeric",type:i,lower:r,upper:o})}return null}parseStringType(){return this.match("string")?"string":null}parsePrimary(){let e=this.parseMaybePrimary();if(e===null){let t=this.pos;this.parseNamedElement()!==null&&(this.match("?"),this.match("*"),this.match("+"),this.skipWhitespace(),(this.match("->")||this.match(","))&&this.error("Function arguments must be enclosed in parentheses","For example `(x: number) -> number`"),this.match(")")&&this.error("An opening parenthesis seems to be missing")),this.pos=t,zr(this)!==null&&this.error("Unexpected value"),this.pos=t,this.error('Unexpected token"',this.parseUnexpectedToken())}return e}parseUnexpectedToken(){let e=this.pos,t,i="";for(;!this.isEOF()&&/[a-zA-Z0-9_]/.test(this.peek());)i+=this.consume();if(!i)return;let r=null;return i==="map"&&(r="dictionary"),r??=Mi(i,[...this._typeResolver.names,...Et,"vector","matrix"]),r&&(t=`Did you mean "${r}"?`),this.pos=e,t}parseMaybePrimary(){return this.parseGroup()??this.parseNegationType()??this.parseCollection()??this.parseList()??this.parseSet()??this.parseDictionary()??this.parseRecord()??this.parseTuple()??this.parseExpression()??this.parseSymbol()??this.parseNumericType()??this.parseStringType()??this.parsePrimitiveType()??this.parseValue()??this.parseTypeReference()}parseNegationType(){return this.match("!")?{kind:"negation",type:this.parsePrimary()}:null}parseIntersectionType(){let e=this.parseFunctionSignature()??this.parseMaybePrimary();if(e===null)return null;let t=[e];for(this.skipWhitespace();this.match("&");)this.skipWhitespace(),t.push(this.parsePrimary());return t.length===1?t[0]:{kind:"intersection",types:t}}parseUnionType(){let e=this.parseIntersectionType();if(e===null)return null;let t=[e];for(this.skipWhitespace();this.match("|");)e=this.parseIntersectionType(),e===null&&this.error("Expected type"),t.push(e);return t.length===1?t[0]:{kind:"union",types:t}}parseType(){if(this.skipWhitespace(),this.isEOF())return null;if(this.peek()==="("){let e=this.parseFunctionSignature();if(e)return e}return this.parseUnionType()}parseTypeMaybe(){try{return this.parseType()}catch(e){}return null}parse(){let e=this.parseType();return e===null&&(this.parseIdentifier()!==null&&(this.skipWhitespace(),this.match(":")&&this.error("Function signatures must be enclosed in parentheses","For example `(x: number) -> number`")),this.error("Syntax error. The type was not recognized.")),this.skipWhitespace(),(this.match("->")||this.match("?")||this.match("*")||this.match("+"))&&this.error("Function signatures must be enclosed in parentheses","For example `(x: number) -> number`"),this.isEOF()||this.error("Unexpected character. Could be some mismatched parentheses."),e}};function zr(n){let e=n.pos;if(n.skipWhitespace(),/["]/.test(n.peek())){let t=n.consume(),i="";for(;n.peek()!==t;)n.isEOF()&&n.error("Expected closing quote"),n.match("\\"+t)?i+=t:i+=n.consume();return n.consume(),i}if(n.match("0x")){let t=0;for(;/[0-9a-fA-F]/.test(n.peek());)t=t*16+parseInt(n.consume(),16);return t}if(n.match("0b")){let t=0;for(;/[01]/.test(n.peek());)t=t*2+parseInt(n.consume());return t}if(/[-0-9\.]/.test(n.peek())){let t=0,i=1;if(n.match("-")&&(i=-1),n.match("+")&&(i=1),!/[0-9]/.test(n.peek()))return n.pos=e,null;for(;/[0-9]/.test(n.peek());)t=t*10+parseInt(n.consume());if(n.peek()==="."){let r=n.pos;if(n.consume(),!/[0-9]/.test(n.peek()))return n.pos=r,i*t;let o=0,s=1;for(;/[0-9]/.test(n.peek());)o=o*10+parseInt(n.consume()),s*=10;t+=o/s}if(n.match("e")||n.match("E")){let r=0,o=1;for(n.match("+")&&(o=1),n.match("-")&&(o=-1);/[0-9]/.test(n.peek());)r=r*10+parseInt(n.consume());t*=Math.pow(10,o*r)}return i*t}return n.match("true")?!0:n.match("false")?!1:n.match("nan")?NaN:n.match("infinity")||n.match("+infinity")||n.match("oo")||n.match("\u221E")||n.match("+oo")||n.match("+\u221E")?1/0:n.match("-infinity")||n.match("-oo")||n.match("-\u221E")?-1/0:n.match("nan")?NaN:(n.pos=e,null)}function A(n,e){return n===void 0?void 0:st(n)?n:typeof n!="string"?void 0:new Jo(n,{valueParser:zr,typeResolver:e}).parse()}function Yd(n){let e=new Set;for(let{name:t}of n)if(t){if(e.has(t))return t;e.add(t)}return""}function qr(n){return/[^a-zA-Z0-9_]/.test(n)?"`"+n.replace(/`/g,"\\`")+"`":n}function Qd(n,e){return n===e?n:n==="nothing"||e==="nothing"?"nothing":n==="any"?e:e==="any"?n:n==="never"?e:e==="never"?n:n==="unknown"?e:e==="unknown"||E(n,e)?n:E(e,n)?e:fu(n,e)}function Xd(n,e){return n===e?n:n==="any"||e==="any"?"any":n==="never"?e:e==="never"?n:n==="unknown"?e:e==="unknown"?n:n==="nothing"?e:e==="nothing"?n:E(n,e)?e:E(e,n)?n:fu(n,e)}function vt(...n){return n.length===0?"nothing":n.length===1?n[0]:n.reduce((e,t)=>Qd(e,t))}function oe(...n){return n.length===0?"nothing":n.length===1?n[0]:n.reduce((e,t)=>Xd(e,t))}function Gr(n){return n=typeof n=="string"?A(n):n,typeof n!="string"&&n.kind==="signature"}function We(n){if(n){if(n==="function")return"any";if(typeof n!="string"&&n.kind==="signature")return n.result}}function bn(n){if(n==="collection"||n==="indexed_collection"||n==="list"||n==="set"||n==="tuple"||n==="dictionary"||n==="record")return"any";if(typeof n!="string"){if(n.kind==="collection"||n.kind==="indexed_collection"||n.kind==="list"||n.kind==="set")return n.elements;if(n.kind==="tuple")return oe(...n.elements.map(e=>e.type));if(n.kind==="dictionary")return A(`tuple<string, ${n.values}>`);if(n.kind==="record")return A(`tuple<string, ${U(oe(...Object.values(n.elements)))}>`)}}function cu(n){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n)}function st(n){return typeof n=="string"?Et.includes(n):typeof n!="object"||!("kind"in n)?!1:n.kind==="signature"||n.kind==="union"||n.kind==="intersection"||n.kind==="negation"||n.kind==="tuple"||n.kind==="list"||n.kind==="record"||n.kind==="dictionary"||n.kind==="set"||n.kind==="function"||n.kind==="collection"||n.kind==="indexed_collection"||n.kind==="reference"}function fu(n,e){return n===e?n:n==="any"||e==="any"?"any":n==="never"?e:e==="never"?n:n==="unknown"?e:e==="unknown"?n:n==="nothing"?e:e==="nothing"?n:ue(n,e,"non_finite_number")?"non_finite_number":ue(n,e,"finite_integer")?"finite_integer":ue(n,e,"integer")?"integer":ue(n,e,"finite_rational")?"finite_rational":ue(n,e,"rational")?"rational":ue(n,e,"finite_real")?"finite_real":ue(n,e,"real")?"real":ue(n,e,"imaginary")?"imaginary":ue(n,e,"finite_complex")?"finite_complex":ue(n,e,"complex")?"complex":ue(n,e,"finite_number")?"finite_number":ue(n,e,"number")?"number":ue(n,e,"list")?"list":ue(n,e,"record")?"record":ue(n,e,"dictionary")?"dictionary":ue(n,e,"set")?"set":ue(n,e,"tuple")?"tuple":ue(n,e,"indexed_collection")?"indexed_collection":ue(n,e,"collection")?"collection":ue(n,e,"scalar")?"scalar":ue(n,e,"value")?"value":ue(n,e,"function")?"function":ue(n,e,"expression")?"expression":"any"}function ue(n,e,t){return!!(E(n,t)&&E(e,t))}var S=class n{static unknown=new n("unknown");static number=new n("number");static non_finite_number=new n("non_finite_number");static finite_number=new n("finite_number");static finite_integer=new n("finite_integer");static finite_real=new n("finite_real");static string=new n("string");static dictionary=new n("dictionary");static setNumber=new n("set<number>");static setComplex=new n("set<complex>");static setImaginary=new n("set<imaginary>");static setReal=new n("set<real>");static setRational=new n("set<rational>");static setFiniteInteger=new n("set<finite_integer>");static setInteger=new n("set<integer>");type;static widen(...e){return new n(oe(...e.map(t=>t instanceof n?t.type:t)))}static narrow(...e){return new n(vt(...e.map(t=>t instanceof n?t.type:t)))}constructor(e,t){typeof e=="string"?this.type=A(e,t):this.type=e}matches(e){return e instanceof n?E(this.type,e.type):E(this.type,e)}is(e){return E(this.type,e)&&E(e,this.type)}get isUnknown(){return this.type==="unknown"}toString(){return U(this.type)}toJSON(){return U(this.type)}[Symbol.toPrimitive](e){return e==="string"?this.toString():null}valueOf(){return U(this.type)}};function Yo(n){let e=[],t=(i,r=[])=>{if(i.length===0)e.push(r);else for(let o=0;o<i.length;o++){let s=i.slice(),a=s.splice(o,1);t(s.slice(),r.concat(a))}};return t(n),e}function du(n){for(let e in n)e.startsWith("_")&&n.hasOwnProperty(e)&&Object.defineProperty(n,e,{enumerable:!1,configurable:!0,writable:!0,value:n[e]})}var Ur=class{_listeners=new Array(300);_pending=!1;_version=0;listen(e){for(let i of this._listeners)if(i.deref()===e)return()=>this._unsubscribe(e);let t=new WeakRef(e);return this._listeners.push(t),()=>this._unsubscribe(e)}_unsubscribe(e){this._listeners=this._listeners.filter(t=>{let i=t.deref();return i!==void 0&&i!==e})}notify(){if(this._pending)return;this._pending=!0;let e=this._version+1;queueMicrotask(()=>{if(e!==this._version+1){this._pending=!1;return}this.notifyNow()})}notifyNow(){this._version++,this._listeners=this._listeners.filter(e=>{let t=e.deref();try{t?.onConfigurationChange?.()}catch(i){console.error("Listener error:",i)}return t!==void 0}),this._pending=!1}};function Qo(n,e,t={}){let{contract:i=.125,step:r=1,power:o=2,atol:s=1e-16,rtol:a=s>0?0:Math.sqrt(Number.EPSILON),maxeval:u=1e6,breaktol:l=2}=t;if(!isFinite(e))return Qo(b=>n(1/b),1/e,{rtol:a,atol:s,maxeval:u,contract:Math.abs(i)>1?1/i:i,step:1/r,power:o});let c=r,f=Math.pow(1/i,o),d=n(e+c),p=[d],x=1/0,g=1;for(;g<u;){g+=1,c*=i,p.push(n(e+c));let b=f,_=1/0;for(let k=p.length-2;k>=0;k--){let w=p[k];p[k]=p[k+1]+(p[k+1]-p[k])/(b-1);let z=Math.abs(p[k]-w);_=Math.min(_,z),z<x&&(d=p[k],x=z),b*=f}if(_>l*x||!isFinite(_)||x<=Math.max(a*Math.abs(d),s))break}return[d,x]}function ie(n){if(typeof n=="bigint")return n;if(typeof n=="number")return Number.isInteger(n)?n>=Number.MAX_SAFE_INTEGER&&n<=Number.MAX_SAFE_INTEGER?BigInt(n):ie(n.toString()):null;if(n instanceof M)return n.isInteger()?ie(n.toString()):null;let e=n.toLowerCase(),t=e.match(/([+-]?[0-9]*)(?:\.([0-9]+))?e([+-]?[0-9]+)$/);if(t){let o=parseInt(t[3])-(t[2]?t[2].length:0);if(o<0)return null;e=(t[1]??"")+(t[2]??"")+"0".repeat(o)}if(e.indexOf(".")>=0||!/^[+-]?[0-9]+$/.test(e))return null;try{return BigInt(e)}catch(r){return console.error(r.message),null}}var pu=0x3ffffffffffe5,Xo=new Set([2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997,1009,1013,1019,1021,1031,1033,1039,1049,1051,1061,1063,1069,1087,1091,1093,1097,1103,1109,1117,1123,1129,1151,1153,1163,1171,1181,1187,1193,1201,1213,1217,1223,1229,1231,1237,1249,1259,1277,1279,1283,1289,1291,1297,1301,1303,1307,1319,1321,1327,1361,1367,1373,1381,1399,1409,1423,1427,1429,1433,1439,1447,1451,1453,1459,1471,1481,1483,1487,1489,1493,1499,1511,1523,1531,1543,1549,1553,1559,1567,1571,1579,1583,1597,1601,1607,1609,1613,1619,1621,1627,1637,1657,1663,1667,1669,1693,1697,1699,1709,1721,1723,1733,1741,1747,1753,1759,1777,1783,1787,1789,1801,1811,1823,1831,1847,1861,1867,1871,1873,1877,1879,1889,1901,1907,1913,1931,1933,1949,1951,1973,1979,1987,1993,1997,1999,2003,2011,2017,2027,2029,2039,2053,2063,2069,2081,2083,2087,2089,2099,2111,2113,2129,2131,2137,2141,2143,2153,2161,2179,2203,2207,2213,2221,2237,2239,2243,2251,2267,2269,2273,2281,2287,2293,2297,2309,2311,2333,2339,2341,2347,2351,2357,2371,2377,2381,2383,2389,2393,2399,2411,2417,2423,2437,2441,2447,2459,2467,2473,2477,2503,2521,2531,2539,2543,2549,2551,2557,2579,2591,2593,2609,2617,2621,2633,2647,2657,2659,2663,2671,2677,2683,2687,2689,2693,2699,2707,2711,2713,2719,2729,2731,2741,2749,2753,2767,2777,2789,2791,2797,2801,2803,2819,2833,2837,2843,2851,2857,2861,2879,2887,2897,2903,2909,2917,2927,2939,2953,2957,2963,2969,2971,2999,3001,3011,3019,3023,3037,3041,3049,3061,3067,3079,3083,3089,3109,3119,3121,3137,3163,3167,3169,3181,3187,3191,3203,3209,3217,3221,3229,3251,3253,3257,3259,3271,3299,3301,3307,3313,3319,3323,3329,3331,3343,3347,3359,3361,3371,3373,3389,3391,3407,3413,3433,3449,3457,3461,3463,3467,3469,3491,3499,3511,3517,3527,3529,3533,3539,3541,3547,3557,3559,3571,3581,3583,3593,3607,3613,3617,3623,3631,3637,3643,3659,3671,3673,3677,3691,3697,3701,3709,3719,3727,3733,3739,3761,3767,3769,3779,3793,3797,3803,3821,3823,3833,3847,3851,3853,3863,3877,3881,3889,3907,3911,3917,3919,3923,3929,3931,3943,3947,3967,3989,4001,4003,4007,4013,4019,4021,4027,4049,4051,4057,4073,4079,4091,4093,4099,4111,4127,4129,4133,4139,4153,4157,4159,4177,4201,4211,4217,4219,4229,4231,4241,4243,4253,4259,4261,4271,4273,4283,4289,4297,4327,4337,4339,4349,4357,4363,4373,4391,4397,4409,4421,4423,4441,4447,4451,4457,4463,4481,4483,4493,4507,4513,4517,4519,4523,4547,4549,4561,4567,4583,4591,4597,4603,4621,4637,4639,4643,4649,4651,4657,4663,4673,4679,4691,4703,4721,4723,4729,4733,4751,4759,4783,4787,4789,4793,4799,4801,4813,4817,4831,4861,4871,4877,4889,4903,4909,4919,4931,4933,4937,4943,4951,4957,4967,4969,4973,4987,4993,4999,5003,5009,5011,5021,5023,5039,5051,5059,5077,5081,5087,5099,5101,5107,5113,5119,5147,5153,5167,5171,5179,5189,5197,5209,5227,5231,5233,5237,5261,5273,5279,5281,5297,5303,5309,5323,5333,5347,5351,5381,5387,5393,5399,5407,5413,5417,5419,5431,5437,5441,5443,5449,5471,5477,5479,5483,5501,5503,5507,5519,5521,5527,5531,5557,5563,5569,5573,5581,5591,5623,5639,5641,5647,5651,5653,5657,5659,5669,5683,5689,5693,5701,5711,5717,5737,5741,5743,5749,5779,5783,5791,5801,5807,5813,5821,5827,5839,5843,5849,5851,5857,5861,5867,5869,5879,5881,5897,5903,5923,5927,5939,5953,5981,5987,6007,6011,6029,6037,6043,6047,6053,6067,6073,6079,6089,6091,6101,6113,6121,6131,6133,6143,6151,6163,6173,6197,6199,6203,6211,6217,6221,6229,6247,6257,6263,6269,6271,6277,6287,6299,6301,6311,6317,6323,6329,6337,6343,6353,6359,6361,6367,6373,6379,6389,6397,6421,6427,6449,6451,6469,6473,6481,6491,6521,6529,6547,6551,6553,6563,6569,6571,6577,6581,6599,6607,6619,6637,6653,6659,6661,6673,6679,6689,6691,6701,6703,6709,6719,6733,6737,6761,6763,6779,6781,6791,6793,6803,6823,6827,6829,6833,6841,6857,6863,6869,6871,6883,6899,6907,6911,6917,6947,6949,6959,6961,6967,6971,6977,6983,6991,6997,7001,7013,7019,7027,7039,7043,7057,7069,7079,7103,7109,7121,7127,7129,7151,7159,7177,7187,7193,7207,7211,7213,7219,7229,7237,7243,7247,7253,7283,7297,7307,7309,7321,7331,7333,7349,7351,7369,7393,7411,7417,7433,7451,7457,7459,7477,7481,7487,7489,7499,7507,7517,7523,7529,7537,7541,7547,7549,7559,7561,7573,7577,7583,7589,7591,7603,7607,7621,7639,7643,7649,7669,7673,7681,7687,7691,7699,7703,7717,7723,7727,7741,7753,7757,7759,7789,7793,7817,7823,7829,7841,7853,7867,7873,7877,7879,7883,7901,7907,7919]),mu=7919;function gu(n){if(Number.isInteger(n)&&n>=0&&n<Number.MAX_SAFE_INTEGER,n<=3)return{[n]:1};let e={},t=0;for(;n%2===0;)t+=1,n/=2;for(t>0&&(e[2]=t),t=0;n%3===0;)t+=1,n/=3;t>0&&(e[3]=t);let i=!1;for(;!i;){if(n===1)return e;let r=Math.sqrt(n);i=!0;for(let o=6;o<=r+6;o+=6){if(n%(o-1)===0){e[o-1]=(e[o-1]??0)+1,n/=o-1,i=!1;break}if(n%(o+1)===0){e[o+1]=(e[o+1]??0)+1,n/=o+1,i=!1;break}}}return e[n]!==void 0?e[n]+=1:e[n]=1,e}function Ko(n){if(!Number.isInteger(n)||!Number.isFinite(n)||Number.isNaN(n)||n<=1)return!1;if(n<=mu)return Xo.has(n);for(let e of Xo)if(n%e===0)return!1;return n<pu&&Kd(n),np(n,30)?void 0:!1}function Kd(n){if(n===1)return 1;if(n%2===0)return 2;if(n%3===0)return 3;if(n%5===0)return 5;let e=Math.floor(Math.sqrt(n)),t=7;for(;t<=e;){if(n%t===0)return t;if(n%(t+4)===0)return t+4;if(n%(t+6)===0)return t+6;if(n%(t+10)===0)return t+10;if(n%(t+12)===0)return t+12;if(n%(t+16)===0)return t+16;if(n%(t+22)===0)return t+22;if(n%(t+24)===0)return t+24;t+=30}return n}function hu(n){if(n<=1)return!1;if(n<=mu)return Ko(Number(n));for(let e of Xo)if(n%BigInt(e)===BigInt(0))return!1;return n<pu&&(n=ep(n)),tp(n,30)?void 0:!1}function ep(n){if(n===BigInt(1))return BigInt(1);if(n%BigInt(2)===BigInt(0))return BigInt(2);if(n%BigInt(3)===BigInt(0))return BigInt(3);if(n%BigInt(5)===BigInt(0))return BigInt(5);let e=BigInt(Math.floor(Math.sqrt(Number(n)))),t=BigInt(7);for(;t<=e;){if(n%t===BigInt(0))return t;if(n%(t+BigInt(4))===BigInt(0))return t+BigInt(4);if(n%(t+BigInt(6))===BigInt(0))return t+BigInt(6);if(n%(t+BigInt(10))===BigInt(0))return t+BigInt(10);if(n%(t+BigInt(12))===BigInt(0))return t+BigInt(12);if(n%(t+BigInt(16))===BigInt(0))return t+BigInt(16);if(n%(t+BigInt(22))===BigInt(0))return t+BigInt(22);if(n%(t+BigInt(24))===BigInt(0))return t+BigInt(24);t+=BigInt(30)}return n}function np(n,e){let t=0,i=n-1;for(;i%2===0;)i/=2,++t;e:do{let r=Math.pow(2+Math.floor(Math.random()*(n-3)),i)%n;if(!(r===1||r===n-1)){for(let o=t-1;o--;){if(r=r*r%n,r===1)return!1;if(r===n-1)continue e}return!1}}while(--e);return!0}function tp(n,e){let t=0,i=n-BigInt(1);for(;i%BigInt(2)===BigInt(0);)i=i/BigInt(2),++t;e:do{let r=BigInt(2+Math.floor(Math.random()*(Number(n)-3)))**i%n;if(!(r===BigInt(1)||r===n-BigInt(1))){for(let o=t-1;o--;){if(r=r*r%n,r===BigInt(1))return!1;if(r===n-BigInt(1))continue e}return!1}}while(--e);return!0}var ch=[BigInt(4),BigInt(2),BigInt(4),BigInt(2),BigInt(4),BigInt(6),BigInt(2),BigInt(6)];var es=21,ip=53,kn=Math.floor(Math.log10(Math.pow(2,ip))),ns=1e-10,$=1e6,yu=1024,Ri=1e6;function Yt(n,e){if(n>=Number.MAX_SAFE_INTEGER)return[1,n];if(n===0)return[0,0];if(n===1)return[1,1];if(Number.isInteger(n)&&n>0&&n<Number.MAX_SAFE_INTEGER,e===2){let o=[[0,0],[1,1],[1,2],[1,3],[2,1],[1,5],[1,6],[1,7],[1,8],[3,1],[1,10],[1,11],[2,3],[1,13],[1,14],[1,15],[4,1],[1,17],[3,2],[1,19],[1,20]][n];if(o)return o}let t=gu(n),i=1,r=1;for(let o of Object.keys(t)){let s=parseInt(o);i=i*Math.pow(s,Math.floor(t[o]/e)),r=r*Math.pow(s,t[o]%e)}return[i,r]}function Pe(n,e){if(n===0)return e;if(e===0||n===e)return n;if(!Number.isInteger(n)||!Number.isInteger(e))return NaN;for(;e!==0;)[n,e]=[e,n%e];return n<0?-n:n}function Nt(n,e){return n*e/Pe(n,e)}function ts(n){if(!Number.isInteger(n)||n<0)return NaN;if(n>=170)return 1/0;let e=1;for(let t=2;t<=n;t++)e=e*t;return e}function xu(n){if(!Number.isInteger(n)||n<0)return NaN;if(n<0)return NaN;if(n<=1)return 1;let e=n;for(;n>2;)n-=2,e*=n;return e}function is(n,e=ns){return typeof n=="number"&&Math.abs(n)<=e?0:n}function bu(n,e,t=.1){return(n(e-4*t)/280-4*n(e-3*t)/105+n(e-2*t)/5-4*n(e-t)/5+4*n(e+t)/5-n(e+2*t)/5+4*n(e+3*t)/105-n(e+4*t)/280)/t}function at(n,e,t=1){if(t===0){let o=at(n,e,-1),s=at(n,e,1);return o===void 0||s===void 0?NaN:Math.abs(o-s)>1e-5?NaN:(o+s)/2}let[i,r]=Qo(n,e,{step:t>0?1:-1});return i}function*rs(){yield[0,1];for(let n=1;;n++)for(let e=0;e<=n;e++){let t=n-e;t!==0&&Pe(e,t)===1&&(yield[e,t],yield[-e,t])}}function*Eu(){yield[0,1];for(let n=1;;n++)for(let e=0;e<=n;e++){let t=n-e;t!==0&&Pe(e,t)===1&&(yield[e,t])}}function*vu(){yield[0,0];for(let n=1;;n++)for(let e=0;e<=n;e++){let t=n-e;if(t===0||Pe(e,t)!==1)continue;let i=e/t;for(let r=0;r<=n;r++){let o=n-r;if(o===0||Pe(r,o)!==1)continue;let s=r/o;yield[i,s],yield[-i,s],yield[i,-s],yield[-i,-s]}}}function*Nu(){yield 0;for(let n=1;;n++)yield n,yield-n}var Pi=["Error","'missing'"];function qn(n){return!!(typeof n=="number"||Qt(n)||typeof n=="string"&&tn(n))}function Qt(n){return n!==null&&typeof n=="object"&&"num"in n}function jr(n){return n!==null&&typeof n=="object"&&"sym"in n}function rp(n){return n!==null&&typeof n=="object"&&"str"in n}function op(n){return n!==null&&typeof n=="object"&&"dict"in n&&typeof n.dict=="object"&&!Array.isArray(n.dict)&&n.dict!==null}function Li(n){return n!==null&&typeof n=="object"&&"fn"in n&&Array.isArray(n.fn)&&n.fn.length>0&&typeof n.fn[0]=="string"}function F(n){return n==null?null:typeof n=="object"&&"str"in n?n.str:typeof n!="string"?null:n.length>=2&&n.at(0)==="'"&&n.at(-1)==="'"?n.substring(1,n.length-1):tn(n)||Ge(n)?null:n}function ss(n){if(n==null||F(n)!==null)return null;let e=h(n);return e?[e,...N(n).map(t=>ss(t)).filter(t=>t!==null)]:n}function h(n){return Array.isArray(n)?n[0]:n==null?"":Li(n)?n.fn[0]:""}function N(n){return Array.isArray(n)?n.slice(1):n!==void 0&&Li(n)?n.fn.slice(1):[]}function m(n,e){return Array.isArray(n)?n[e]??null:n===null||!Li(n)?null:n.fn[e]??null}function J(n){return n==null?0:Array.isArray(n)?Math.max(0,n.length-1):Li(n)?Math.max(0,n.fn.length-1):0}function as(n){return n==null?null:h(n)==="Hold"?m(n,1):n}function T(n){return typeof n=="string"&&Ge(n)?n.length>=2&&n.at(0)==="`"&&n.at(-1)==="`"?n.slice(1,-1):n:n==null?null:jr(n)?n.sym:null}function _u(n){let e=h(n);if(e==="KeyValuePair"||e==="Tuple"||e==="Pair"){let[t,i]=N(n),r=F(t);return r?[r,i??"Nothing"]:null}return null}function us(n){if(n===null)return null;if(op(n))return n;let e=_u(n);if(e)return{[e[0]]:e[1]};if(h(n)==="Dictionary"){let t={},i=N(n);for(let r=1;r<J(n);r++){let o=_u(i[r]);o&&(t[o[0]]=o[1])}return t}return null}function ls(n){return{dict:n}}function sp(n){if(n=n.toLowerCase().replace(/[nd]$/,"").replace(/[\u0009-\u000d\u0020\u00a0]/g,""),n==="nan")return NaN;if(/^(infinity|\+infinity|oo|\+oo)$/i.test(n))return 1/0;if(/^(-infinity|-oo)$/.test(n))return-1/0;if(/\([0-9]+\)/.test(n)){let[e,t,i,r]=n.match(/(.+)\(([0-9]+)\)(.*)$/)??[];n=t+i.repeat(Math.ceil(16/i.length))+(r??"")}return parseFloat(n)}function R(n){return typeof n=="number"?n:typeof n=="string"&&tn(n)?sp(n):n!==void 0&&Qt(n)?R(n.num):null}function Xt(n){if(n==null)return null;if(T(n)==="Half")return[1,2];let e=h(n);if(!e)return null;let t=null,i=null;if(e==="Negate"){let r=Xt(N(n)[0]);if(r)return[-r[0],r[1]]}if(e==="Rational"||e==="Divide"){let[r,o]=N(n);t=R(r)??NaN,i=R(o)??NaN}if(e==="Power"){let[r,o]=N(n),s=R(o);s===1?(t=R(r),i=1):s===-1&&(t=1,i=R(r))}if(e==="Multiply"){let[r,o]=N(n);if(h(o)==="Power"){let[s,a]=N(o);R(a)===-1&&(t=R(r),i=R(s))}}return t===null||i===null?null:Number.isInteger(t)&&Number.isInteger(i)?[t,i]:null}function Zr(n,e){let t=null;if(Array.isArray(n)&&(t=n),Li(n)&&(t=n.fn),t===null)return[];let i=1,r=[];for(;i<t.length;)r.push(e(t[i])),i+=1;return r}function Kt(n,e,t){let i=h(e),r=h(t);return i===n&&r===n?[n,...N(e),...N(t)]:i===n?[n,...N(e),t]:r===n?[n,e,...N(t)]:[n,e,t]}function zn(n){if(n==null)return null;let e=h(n);if(e==="Delimiter"){if(n=m(n,1),n===null)return[];if(e=h(n),e!=="Sequence")return[n]}return e!=="Sequence"?null:N(n)}function Y(n){return n==null||n==="Nothing"?!0:h(n)==="Sequence"&&J(n)===0}function V(n){return Y(n)?Pi:n}function os(n){return n[0]==="Square"?os(n.slice(1))+2:n.reduce((e,t)=>e+Oi(t),0)}function Oi(n){if(n===null)return 0;if(typeof n=="number"||typeof n=="string"||qn(n)||jr(n)||rp(n))return 1;if(Array.isArray(n))return os(n);if("fn"in n)return os(n.fn);let e=us(n);if(e){let t=Object.keys(e);return 1+t.length+t.reduce((i,r)=>i+Oi(e[r]),0)}return 0}function tn(n){return/^(nan|oo|\+oo|-oo|infinity|\+infinity|-infinity)$/i.test(n)||/^[+-]?(0|[1-9][0-9]*)(\.[0-9]+)?(\([0-9]+\))?([eE][+-]?[0-9]+)?$/.test(n)}function Ge(n){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n)||n.length>=2&&n[0]==="`"&&n[n.length-1]==="`"}function Hr(n){return n.length>=2&&n[0]==="'"&&n[n.length-1]==="'"?!0:!tn(n)&&!Ge(n)}function ap(n){let e=[];for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);if(i>=55296&&i<=56319){let r=n.charCodeAt(t+1);if(r>=56320&&r<=57343){let o=i-55296,s=r-56320;i=2**16+o*2**10+s,t++}}e.push(i)}return e}var Wr=8205,Su=[127462,127487];function Tu(n){return n===Wr||n===65038||n===65039||n>=127995&&n<=128e3||n>=129456&&n<=129460||n>=917536&&n<=917632}function up(n){return n>=Su[0]&&n<=Su[1]}function Bu(n){if(/^[\u0020-\u00FF]*$/.test(n))return n;let e=[],t=ap(n),i=0;for(;i<t.length;){let r=t[i++],o=t[i];if(o===Wr){let s=i-1;for(i+=2;t[i]===Wr;)i+=2;e.push(String.fromCodePoint(...t.slice(s,2*i-s+1)))}else if(Tu(o)){let s=i-1;for(;Tu(t[i]);)i+=t[i]===Wr?2:1;e.push(String.fromCodePoint(...t.slice(s,2*i-s-1)))}else up(r)?(i+=1,e.push(String.fromCodePoint(...t.slice(i-2,2)))):e.push(String.fromCodePoint(r))}return e}var cs=class{s;pos;obeyspaces=!1;constructor(e){e=e.replace(/[\u200E\u200F\u2066-\u2069\u202A-\u202E]/g,""),e=e.replace(/\u2212/g,"-"),this.s=Bu(e),this.pos=0}end(){return this.pos>=this.s.length}get(){return this.pos<this.s.length?this.s[this.pos++]:""}peek(){return this.s[this.pos]}match(e){let t;return typeof this.s=="string"?t=e.exec(this.s.slice(this.pos)):t=e.exec(this.s.slice(this.pos).join("")),t?.[0]?(this.pos+=t[0].length,t[0]):null}next(){if(this.end())return null;if(!this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]+/))return"<space>";if(this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]/))return"<space>";let e=this.get();if(e==="\\"){if(!this.end()){let t=this.match(/^[a-zA-Z]+/);if(t)this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]*/);else if(t=this.get(),t===" ")return"<space>";return"\\"+t}}else{if(e==="{")return"<{>";if(e==="}")return"<}>";if(e==="^"){if(this.peek()==="^"){this.get();let t=this.match(/^(\^(\^(\^(\^[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f][0-9a-f]/);if(t)return String.fromCodePoint(parseInt(t.slice(t.lastIndexOf("^")+1),16))}return e}else if(e==="#"){if(!this.end()){let t=!1;if(/[0-9?]/.test(this.peek())&&(t=!0,this.pos+1<this.s.length)){let i=this.s[this.pos+1];t=/[^0-9A-Za-z]/.test(i)}return t?"#"+this.get():"#"}}else if(e==="$")return this.peek()==="$"?(this.get(),"<$$>"):"<$>"}return e}};function lp(n,e){let t=n.next();if(!t)return[];let i=[];if(t!=="\\relax"){if(t==="\\noexpand")t=n.next(),t&&i.push(t);else if(t==="\\obeyspaces")n.obeyspaces=!0;else if(t==="\\space"||t==="~")i.push("<space>");else if(t==="\\bgroup")i.push("<{>");else if(t==="\\egroup")i.push("<}>");else if(t==="\\string")t=n.next(),t&&(t[0]==="\\"?Array.from(t).forEach(r=>i.push(r==="\\"?"\\backslash":r)):t==="<{>"?i.push("\\{"):t==="<space>"?i.push("~"):t==="<}>"&&i.push("\\}"));else if(t==="\\csname"){for(;n.peek()==="<space>";)n.next();let r="",o=!1,s=[];do{if(s.length===0)if(/^#[0-9?]$/.test(n.peek())){let a=n.get().slice(1);s=Ee(e?.[a]??e?.["?"]??"\\placeholder{}",e),t=s[0]}else t=n.next(),s=t?[t]:[];o=s.length===0,!o&&t==="\\endcsname"&&(o=!0,s.shift()),o||(o=t==="<$>"||t==="<$$>"||t==="<{>"||t==="<}>"||!!t&&t.length>1&&t[0]==="\\"),o||(r+=s.shift())}while(!o);r&&i.push("\\"+r),i=i.concat(s)}else if(t!=="\\endcsname")if(t.length>1&&t[0]==="#"){let r=t.slice(1);i=i.concat(Ee(e?.[r]??e?.["?"]??"\\placeholder{}",e))}else i.push(t)}return i}function Ee(n,e=[]){let t=n.toString().split(/\r?\n/),i="",r="";for(let a of t){i+=r,r=" ";let u=a.match(/((?:\\%)|[^%])*/);u!==null&&(i+=u[0])}let o=new cs(i),s=[];do s.push(...lp(o,e));while(!o.end());return s}function Jr(n){return Ee(n).length}function v(n){let e="",t="";for(let i of n)i!=null&&(typeof i=="string"&&(/[a-zA-Z]/.test(i[0])&&(t+=e),/\\[a-zA-Z]+\*?$/.test(i)?e=" ":e=""),t+=i.toString());return t}function ei(n,e,t){return e.includes(n)&&(e=`{${e}}`),/^[0-9]$/.test(t)?`${e}${n}${t}`:`${e}${n}{${t}}`}function En(n){let e=[];if(Array.isArray(n))for(let i of n)Array.isArray(i)?e=[...e,...i]:e.push(i);else e=[n];return v(e.map(i=>({"<space>":" ","<$$>":"$$","<$>":"$","<{>":"{","<}>":"}"})[i]??i))}var L=245,$i=260,Gn=270,de=275,Ue=390,Un=600,fs=650,ds=700,ps=810;function Iu(n){return!("kind"in n)||n.kind==="expression"}function wu(n){return"kind"in n&&n.kind==="symbol"}function Fi(n){return"kind"in n&&n.kind==="matchfix"}function ms(n){return"kind"in n&&n.kind==="infix"}function Yr(n){return"kind"in n&&n.kind==="prefix"}function gs(n){return"kind"in n&&n.kind==="postfix"}function ku(n){return"kind"in n&&n.kind==="environment"}var Cu=[{name:"To",latexTrigger:["\\to"],kind:"infix",precedence:270},{latexTrigger:["\\rightarrow"],kind:"infix",precedence:270,parse:"To"}];function Au(n,e){return"normal"}function Du(n,e){return"normal"}function Mu(n,e){return e>2?"solidus":"radical"}function Ru(n,e){if(e>3)return"inline-solidus";if(h(n)==="Divide"){let[t,i]=N(n),[r,o]=[Oi(t),Oi(i)];if(o<=2&&r>5)return"factor";if(r<=2&&o>5)return"reciprocal"}return"quotient"}function Pu(n,e){return"boolean"}function Lu(n,e){return"solidus"}function Ou(n,e){return"compact"}function ni(n,e,t){n.indexOf("#1")<0&&n.indexOf("#2")<0&&(n=`#1 ${n} #2`);let i=n.split(/(#\d+)/).filter(r=>r.trim()!=="").map(r=>r.trim());return v(i.map(r=>{switch(r){case"#1":return e;case"#2":return t;default:return r}}))}function cp(n){if(h(n)!=="Multiply")return[[],[]];let e=[],t=[];for(let i of N(n))if(h(i)==="Power"){let r=m(i,1),o=m(i,2);if(h(o)==="Negate"){let s=m(o,1);r&&s&&t.push(["Power",r,s])}else{let s=R(o)??NaN;s===-1?r&&t.push(r):s<0?r&&t.push(["Power",r,-s]):e.push(i)}}else if(h(i)==="Rational"&&J(i)===2||h(i)==="Divide"){let r=m(i,1),o=m(i,2);R(r)!==1&&e.push(r),R(o)!==1&&t.push(o)}else{let r=Xt(i);r!==null?(r[0]!==1&&e.push(r[0]),t.push(r[1])):e.push(i)}return[e,t]}function fp(n){let e=n.parseOptionalGroup(),t=n.parseGroup()??n.parseToken();return Y(t)?e!==null?["Root",Pi,V(e)]:["Sqrt",Pi]:e!==null?["Root",t,e]:["Sqrt",t]}function Vi(n,e,t,i){return t==null?"\\sqrt{}":(i=i??2,e==="solidus"?n.wrapShort(t)+"^{1/"+n.serialize(i)+"}":e==="quotient"?n.wrapShort(t)+"^{\\frac{1}{"+n.serialize(i)+"}}":R(i)===2?"\\sqrt{"+n.serialize(t)+"}":"\\sqrt["+n.serialize(i)+"]{"+n.serialize(t)+"}")}function dp(n,e){n.level-=1;let t=h(e),i="",r=m(e,1);if(t==="Negate")i="-"+n.wrap(r,de+1);else if(t==="Subtract"){i=n.wrap(r,de);let o=m(e,2);if(o!==null){let s=n.wrap(o,de);s[0]==="-"?i+="+"+s.slice(1):s[0]==="+"?i+="-"+s.slice(1):i=i+"-"+s}}else if(t==="Add"){if(n.options.prettify&&J(e)===2&&n.options.invisiblePlus!=="+"){let[a,u]=[m(e,1),m(e,2)],[l,c]=[a,u],f=R(l),d=Xt(c);if((f===null||d===null)&&([l,c]=[u,a],f=R(l),d=Xt(c)),f!==null&&d!==null&&isFinite(f)&&Number.isInteger(f)&&f>=0&&f<=1e3&&isFinite(d[0])&&isFinite(d[1])&&d[0]>0&&d[0]<=100&&d[1]<=100)return i=ni(n.options.invisiblePlus,n.serialize(l),n.serialize(c)),n.level+=1,i}if(n.options.prettify&&J(e)===2){let[a,u]=qi(r),[l,c]=qi(m(e,2));if(u<0&&c>0)return i=n.wrap(l,de)+"-"+n.wrap(a,de),n.level+=1,i}i=n.serialize(r);let o=J(e)+1,s=N(e);for(let a=2;a<o;a++)if(r=s[a-1],n.options.prettify){let[u,l]=qi(r),c=n.wrap(u,de);l>0?c.startsWith("+")||c.startsWith("-")?i+=c:i+="+"+c:c.startsWith("+")?i+="-"+c.slice(1):c.startsWith("-")?i+="+"+c.slice(1):i+="-"+c}else{let u=n.wrap(r,de);u[0]==="-"||u[0]==="+"?i+=u:i+="+"+u}}return n.level+=1,i}function zu(n,e){if(e===null)return"";n.level-=1;let t="";if(n.options.prettify===!0){let[u,l]=cp(e);l.length>0&&(l.length===1&&l[0]===1?u.length===0?t="1":u.length===1?t=n.serialize(u[0]):t=zu(n,["Multiply",...u]):t=n.serialize(["Divide",u.length===1?u[0]:["Multiply",...u],l.length===1?l[0]:["Multiply",...l]]))}if(t)return n.level+=1,t;let i=!1,r=null,o=J(e)+1,s=N(e);n.options.prettify===!0&&s.length===2&&qn(s[1])&&!qn(s[0])&&(s=[s[1],s[0]]);let a=!1;for(let u=1;u<o;u++){if(r=s[u-1],r===null)continue;let l;if(qn(r)){l=n.serialize(r),l==="-1"&&!t?(t="",i=!i):(l[0]==="-"&&(l=l.slice(1),i=!i),t?t=ni(n.options.multiply,t,l):t=l),a=!0;continue}if(h(r)==="Power"){let c=Xt(m(r,2));if(c!=null){let[f,d]=c;if(f===1&&d!==null){t+=Vi(n,n.rootStyle(r,n.level),m(r,1),d),a=!1;continue}}}if(h(r)==="Power"&&!isNaN(R(m(r,1))??NaN)){l=n.serialize(r),t?t=ni(n.options.multiply,t,l):t=l,a=!0;continue}if(h(r)==="Negate"&&(r=m(r,1),i=!i),l=n.wrap(r,Ue),!t)t=l;else{let c=h(r);a&&(c==="Divide"||c==="Rational")?t=ni(n.options.multiply,t,l):n.options.invisibleMultiply?t=ni(n.options.invisibleMultiply,t,l):t=v([t,l])}a=!1}return n.level+=1,i?"-"+t:t}function pp(n){let e=n.parseGroup(),t=null;if(e===null?(e=n.parseToken(),t=n.parseToken()):t=n.parseGroup(),e=V(e),t=V(t),h(e)==="PartialDerivative"&&(h(t)==="PartialDerivative"||h(t)==="Multiply"&&h(m(t,1))==="PartialDerivative")){let i=m(e,3)??null,r=m(e,1);r==null&&(r=V(n.parseExpression()));let o=[];if(h(t)==="Multiply"){for(let s of N(t))if(h(s)==="PartialDerivative"){let a=m(s,2);a&&o.push(a)}}else{let s=m(t,2);s&&o.push(s)}return o.length>1&&(o=["List",...o]),["PartialDerivative",r,...o,i===null?1:i]}return["Divide",e,t]}function $u(n,e){if(e===null)return"";let t=V(m(e,1)),i=V(m(e,2)),r=n.options.prettify?n.fractionStyle(e,n.level):"quotient";if(r==="inline-solidus"||r==="nice-solidus"){let u=n.wrapShort(t),l=n.wrapShort(i);return r==="inline-solidus"?`${u}/${l}`:`{}^{${u}}\\!\\!/\\!{}_{${l}}`}else{if(r==="reciprocal")return R(t)===1?n.wrap(i)+"^{-1}":n.wrap(t)+n.wrap(i)+"^{-1}";if(r==="factor")return R(i)===1?n.wrap(t):"\\frac{1}{"+n.serialize(i)+"}"+n.wrapString(n.serialize(t),n.groupStyle(e,1))}let o="\\frac";r==="block-quotient"?o="\\dfrac":r==="inline-quotient"&&(o="\\tfrac");let s=n.serialize(t),a=n.serialize(i);return`${o}{${s}}{${a}}`}function hs(n,e){if(!e)return"";let t=h(e),i=V(m(e,1));if(t==="Sqrt")return Vi(n,n.rootStyle(e,n.level-1),i,2);let r=V(m(e,2));if(t==="Root")return Vi(n,n.rootStyle(e,n.level-1),i,r);if(n.options.prettify){let o=R(r)??1;if(o===-1)return n.serialize(["Divide","1",i]);if(o<0)return n.serialize(["Divide","1",["Power",i,-o]]);if(h(r)==="Divide"||h(r)==="Rational"){if(R(m(r,1))===1){let s=n.rootStyle(e,n.level);return Vi(n,s,i,m(r,2))}if(R(m(r,2))===2)return`${n.serialize(["Sqrt",i])}^{${n.serialize(m(r,1))}}`}else if(h(r)==="Power"&&R(m(r,2))===-1){let s=n.rootStyle(e,n.level);return Vi(n,s,i,m(r,1))}}if(h(i)==="Power"){let o=m(i,1),s=m(i,2);return`
      ${n.wrapShort(o)}^{${ei("^",n.wrapShort(s),n.serialize(r))}}`}return ei("^",n.wrapShort(i),n.serialize(r))}var Gu=[{name:"CatalanConstant",symbolTrigger:"G"},{name:"GoldenRatio",latexTrigger:"\\varphi"},{name:"EulerGamma",latexTrigger:"\\gamma"},{name:"Degrees",latexTrigger:["\\degree"],kind:"postfix",precedence:880,parse:(n,e)=>["Degrees",e],serialize:(n,e)=>v([n.serialize(m(e,1)),"\\degree"])},{latexTrigger:["\\degree"],kind:"postfix",precedence:880,parse:(n,e)=>["Degrees",e]},{latexTrigger:["^","<{>","\\circ","<}>"],kind:"postfix",parse:(n,e)=>["Degrees",e]},{latexTrigger:["^","\\circ"],kind:"postfix",parse:(n,e)=>["Degrees",e]},{latexTrigger:["\xB0"],kind:"postfix",precedence:880,parse:(n,e)=>["Degrees",e]},{latexTrigger:["\\ang"],parse:n=>{let e=n.parseGroup();return e===null?["Degrees"]:["Degrees",e]}},{latexTrigger:["\\infty"],parse:"PositiveInfinity"},{name:"PositiveInfinity",serialize:n=>n.options.positiveInfinity},{name:"NegativeInfinity",serialize:n=>n.options.negativeInfinity},{name:"ComplexInfinity",latexTrigger:["\\tilde","\\infty"],serialize:"\\tilde\\infty"},{latexTrigger:["\\tilde","<{>","\\infty","<}>"],parse:"ComplexInfinity"},{name:"Pi",kind:"symbol",latexTrigger:["\\pi"]},{latexTrigger:["\u03C0"],parse:"Pi"},{name:"ExponentialE",latexTrigger:["\\exponentialE"],parse:"ExponentialE",serialize:"\\exponentialE"},{latexTrigger:"\\operatorname{e}",parse:"ExponentialE"},{latexTrigger:"\\mathrm{e}",parse:"ExponentialE"},{kind:"function",symbolTrigger:"exp",parse:"Exp"},{latexTrigger:"\\exp",parse:"Exp"},{name:"ImaginaryUnit",latexTrigger:["\\imaginaryI"]},{latexTrigger:"\\operatorname{i}",parse:"ImaginaryUnit"},{latexTrigger:"\\mathrm{i}",parse:"ImaginaryUnit"},{name:"Abs",kind:"matchfix",openTrigger:"|",closeTrigger:"|",parse:(n,e)=>Y(e)?null:["Abs",e]},{kind:"matchfix",openTrigger:["\\vert"],closeTrigger:["\\vert"],parse:(n,e)=>Y(e)?null:["Abs",e]},{symbolTrigger:"abs",kind:"function",parse:"Abs"},{name:"Add",latexTrigger:["+"],kind:"infix",associativity:"any",precedence:de,parse:(n,e,t)=>{let i=n.parseExpression({...t,minPrec:de});return i===null?null:Kt("Add",e,i)},serialize:dp},{kind:"prefix",latexTrigger:["+"],precedence:de,parse:(n,e)=>n.parseExpression({...e,minPrec:400})},{name:"Ceil",kind:"matchfix",openTrigger:"\\lceil",closeTrigger:"\\rceil",parse:(n,e)=>Y(e)?null:["Ceil",e]},{kind:"matchfix",openTrigger:["\u2308"],closeTrigger:["\u2309"],parse:(n,e)=>Y(e)?null:["Ceil",e]},{symbolTrigger:"ceil",kind:"function",parse:"Ceil"},{name:"Chop",symbolTrigger:"chop",kind:"function",parse:"Chop"},{name:"Complex",precedence:de-1,serialize:(n,e)=>{let t=n.serialize(m(e,1)),i=R(m(e,2));if(i===0)return t;let r=i===1?"\\imaginaryI":i===-1?"-\\imaginaryI":v([n.serialize(m(e,2)),"\\imaginaryI"]);return R(m(e,1))===0?r:i!==null&&i<0?v([t,r]):v([t,"+",r])}},{name:"Divide",latexTrigger:"\\frac",precedence:Un,parse:pp,serialize:$u},{kind:"infix",latexTrigger:"\\over",associativity:"none",precedence:Un,parse:"Divide"},{latexTrigger:["\\/"],kind:"infix",associativity:"left",precedence:Un,parse:"Divide"},{latexTrigger:["/"],kind:"infix",associativity:"left",precedence:Un,parse:"Divide"},{latexTrigger:["\\div"],kind:"infix",associativity:"left",precedence:Un,parse:"Divide"},{name:"Exp",serialize:(n,e)=>{let t=m(e,1);return T(t)||R(t)!==null?v(["\\exponentialE^{",n.serialize(t),"}"]):v(["\\exp",n.wrap(V(t))])}},{name:"Factorial",latexTrigger:["!"],kind:"postfix",precedence:ps},{name:"Factorial2",latexTrigger:["!","!"],kind:"postfix",precedence:ps},{name:"Floor",kind:"matchfix",openTrigger:"\\lfloor",closeTrigger:"\\rfloor",parse:(n,e)=>Y(e)?null:["Floor",e]},{kind:"matchfix",openTrigger:["\u230A"],closeTrigger:["\u230B"],parse:(n,e)=>Y(e)?null:["Floor",e]},{symbolTrigger:"floor",kind:"function",parse:"Floor"},{latexTrigger:["\\Gamma"],parse:"Gamma"},{name:"GCD",latexTrigger:["\\gcd"]},{symbolTrigger:"gcd",kind:"function",parse:"GCD"},{symbolTrigger:"GCD",kind:"function",parse:"GCD"},{name:"Half",serialize:"\\frac12"},{name:"Lg",latexTrigger:["\\lg"],serialize:(n,e)=>"\\log_{10}"+n.wrapArguments(e),parse:n=>{let e=n.parseArguments("implicit");return e===null?"Lg":["Log",...e,10]}},{name:"Lb",latexTrigger:"\\lb",parse:n=>{let e=n.parseArguments("implicit");return e===null?"Log":["Log",e[0],2]}},{name:"Ln",latexTrigger:["\\ln"],parse:n=>qu("Ln",n),serialize:(n,e)=>"\\ln"+n.wrapArguments(e)},{name:"Log",latexTrigger:["\\log"],parse:n=>qu("Log",n),serialize:(n,e)=>{let[t,i]=N(e);return i?v(["\\log_{",n.serialize(i),"}",n.wrap(t)]):"\\log"+n.wrapArguments(e)}},{name:"LCM",symbolTrigger:"lcm",kind:"function"},{symbolTrigger:"LCM",kind:"function",parse:"LCM"},{symbolTrigger:"max",kind:"function",parse:"Max"},{symbolTrigger:"min",kind:"function",parse:"Min"},{name:"Max",latexTrigger:"\\max",kind:"function"},{name:"Min",latexTrigger:"\\min",kind:"function"},{name:"Supremum",latexTrigger:"\\sup",kind:"function"},{name:"Infimum",latexTrigger:"\\inf",kind:"function"},{name:"Limit",latexTrigger:"\\lim",kind:"expression",parse:n=>{if(!n.match("_"))return null;let e=n.parseGroup();if(h(e)!=="To")return null;let t=n.parseArguments("implicit");return t?["Limit",["Function",t[0],m(e,1)],m(e,2)]:null},serialize:(n,e)=>{let t=m(e,1),i=m(t,2),r=m(e,2);return v(["\\lim_{",n.serialize(i),"\\to",n.serialize(r),"}",n.serialize(m(t,1))])}},{name:"MinusPlus",latexTrigger:["\\mp"],kind:"infix",associativity:"any",precedence:Gn},{name:"Multiply",latexTrigger:["\\times"],kind:"infix",associativity:"any",precedence:Ue,serialize:zu},{latexTrigger:["\\cdot"],kind:"infix",associativity:"any",precedence:Ue,parse:(n,e,t)=>{let i=n.parseExpression({...t,minPrec:Ue+2});return i===null?null:Kt("Multiply",e,i)}},{latexTrigger:["*"],kind:"infix",associativity:"any",precedence:Ue,parse:(n,e,t)=>{let i=n.parseExpression({...t,minPrec:Ue+2});return i===null?["Multiply",e,Pi]:Kt("Multiply",e,i)}},{name:"Mod",latexTrigger:"\\bmod",kind:"infix",precedence:Un,serialize:(n,e)=>{if(J(e)!==2)return"";let t=n.serialize(m(e,1)),i=n.serialize(m(e,2));return v([t,"\\bmod",i])}},{latexTrigger:"\\mod",kind:"infix",precedence:Un,parse:"Mod"},{latexTrigger:"\\pmod",kind:"prefix",precedence:L,parse:n=>{let e=n.parseGroup()??n.parseToken();return["Mod",V(e)]}},{name:"Congruent",serialize:(n,e)=>{let t=n.serialize(m(e,1)),i=n.serialize(m(e,2));if(m(e,3)===null)return v([t,"\\equiv",i]);let r=n.serialize(m(e,3));return v([t,"\\equiv",i,"\\pmod{",r,"}"])}},{name:"Negate",latexTrigger:["-"],kind:"prefix",precedence:ds+1,parse:(n,e)=>{n.skipSpace();let t=n.parseExpression({...e,minPrec:ds+3});return t===null?null:["Negate",t]}},{kind:"matchfix",openTrigger:"||",closeTrigger:"||",parse:(n,e)=>Y(e)?null:["Norm",e]},{name:"Norm",kind:"matchfix",openTrigger:["\\left","\\Vert"],closeTrigger:["\\right","\\Vert"],parse:(n,e)=>Y(e)?null:["Norm",e]},{name:"PlusMinus",latexTrigger:["\\pm"],kind:"infix",associativity:"any",precedence:Gn,serialize:(n,e)=>{let t=m(e,1);if(t===null)return"\\pm";if(J(e)===1)return v(["\\pm",n.serialize(t)]);let i=m(e,2);return v([n.serialize(t),"\\pm",n.serialize(i)])}},{latexTrigger:["\\pm"],kind:"prefix",precedence:Gn,parse:(n,e)=>{let t=n.parseExpression({...e,minPrec:400});return["PlusMinus",0,V(t)]}},{latexTrigger:["\\plusmn"],kind:"infix",associativity:"any",precedence:Gn,parse:(n,e,t)=>{let i=n.parseExpression({...t,minPrec:400});return["PlusMinus",e,V(i)]}},{latexTrigger:["\\plusmn"],kind:"prefix",precedence:Gn,parse:(n,e)=>{let t=n.parseExpression({...e,minPrec:400});return["PlusMinus",V(t)]}},{name:"Power",latexTrigger:["^"],kind:"infix",serialize:hs},{latexTrigger:"\\prod",precedence:Ue,name:"Product",parse:Fu("Product","Multiply",Ue),serialize:Vu("\\prod")},{name:"Rational",precedence:Un,serialize:(n,e)=>e&&J(e)===1?"\\operatorname{Rational}"+n.wrapArguments(e):$u(n,e)},{name:"Reduce",serialize:(n,e)=>{let t=m(e,1);if(!t)return"";let i=m(e,2);return T(i)==="Add"?`\\sum ${n.serialize(t)}`:T(i)==="Multiply"?`\\prod ${n.serialize(t)}`:`\\operatorname{Reduce}\\left(${n.serialize(t)}, ${n.serialize(m(e,2))}\\right)`}},{name:"Root",serialize:hs},{name:"Round",symbolTrigger:"round",kind:"function"},{name:"Square",precedence:720,serialize:(n,e)=>n.wrapShort(m(e,1))+"^2"},{latexTrigger:["\\sum"],precedence:de,name:"Sum",parse:Fu("Sum","Add",Ue),serialize:Vu("\\sum")},{name:"Sign",symbolTrigger:"sgn",kind:"function"},{name:"Sqrt",latexTrigger:["\\sqrt"],parse:fp,serialize:hs},{name:"Subtract",latexTrigger:["-"],kind:"infix",associativity:"left",precedence:de+2,parse:(n,e,t)=>{n.index-=1;let i=n.parseExpression({...t,minPrec:de+3});return i===null?null:["Add",e,i]},serialize:(n,e)=>{let t=n.wrap(m(e,1),de+2),i=n.wrap(m(e,2),de+3);return v([t,"-",i])}}];function mp(n,e){if(n!==null){if(T(n))return{index:T(n)??"Nothing",upper:e};if(h(n)==="GreaterEqual"){let t=T(m(n,1))??"Nothing",i=m(n,2)??1;return{index:t,lower:i,upper:e}}if(h(n)==="Equal"){let t=T(m(n,1))??"Nothing",i=m(n,2);if(h(i)==="Range"){let o=m(i,1)??1,s=m(i,2)??void 0;return{index:t,lower:o,upper:s}}return{index:t,lower:i??1,upper:e}}}}function gp(n,e){Y(n)&&(n=null),Y(e)&&(e=null);let t=n===null?[]:zn(n)??[n],i=e===null?[]:zn(e)??[e];return t.map((r,o)=>mp(r,i[o])).filter(r=>r!==void 0)}function Fu(n,e,t){return i=>{i.skipSpace();let r=null,o=null;for(;!(o&&r)&&(i.peek==="_"||i.peek==="^");)i.match("_")?o=i.parseGroup()??i.parseToken():i.match("^")&&(r=i.parseGroup()??i.parseToken()),i.skipSpace();if(!r&&!o){let l=i.parseExpression({minPrec:t});if(l)return["Reduce",l,e]}let s=gp(o,r);i.pushSymbolTable();for(let l of s)i.addSymbol(l.index,"symbol");let a=i.parseExpression({minPrec:t});if(i.popSymbolTable(),a===null)return[n];let u=[];for(let l of s){let c=l.lower,f=l.upper,d=l.index??"Nothing";f!=null?u.push(["Tuple",d,c??1,f]):c!=null?u.push(["Tuple",d,c]):u.push(["Tuple",d])}return[n,a,...u]}}function Vu(n){return(e,t)=>{if(!m(t,1))return n;let i=m(t,2),r=h(i);r!=="Tuple"&&r!=="Triple"&&r!=="Pair"&&r!=="Single"&&(i=null);let o=m(i,1);o!==null&&h(o)==="Hold"&&(o=m(o,1));let s=m(t,1);if(i!=null)return m(t,2)!==null?v([n,e.serialize(s)]):v([n,"_{",e.serialize(m(t,2)),"}",e.serialize(s)]);let a=m(i,2),u=[];o&&T(o)!=="Nothing"&&a?u=[e.serialize(o),"=",e.serialize(a)]:o&&T(o)!=="Nothing"?u=[e.serialize(o)]:a!==null&&(u=[e.serialize(a)]),u.length>0&&(u=["_{",...u,"}"]);let l=[];return m(i,3)!==null&&(l=["^{",e.serialize(m(i,3)),"}"]),v([n,...l,...u,e.serialize(s)])}}function qu(n,e){let t=null;e.match("_")&&(t=e.parseGroup()??e.parseToken());let i=e.parseArguments("implicit");return i===null&&t===null?[n]:i===null?[n,t]:t===null?[n,...i]:t===10?["Log",i[0]]:t===2?["Lb",...i]:["Log",i[0],t]}function qi(n){let e=1,t=n;do{n=t;let i=h(n);if(i==="Negate")e*=-1,t=m(n,1);else if(i==="Multiply"){let[r,o]=qi(m(n,1));o<0&&(e*=-1,r===1?t=["Multiply",...N(n).slice(1)]:t=["Multiply",r,...N(n).slice(1)])}else if(i==="Divide"||i==="Rational"){let[r,o]=qi(m(n,1));o<0&&(e*=-1,t=[i,r,m(n,2)])}else{let r=R(n);r!==null&&r<0&&(e*=-1,t=-r)}}while(t!==n);return[n,e]}var _t=[{latexTrigger:["\\not","<"],kind:"infix",associativity:"any",precedence:246,parse:"NotLess"},{name:"NotLess",latexTrigger:["\\nless"],kind:"infix",associativity:"any",precedence:246},{latexTrigger:["<"],kind:"infix",associativity:"any",precedence:245,parse:"Less"},{name:"Less",latexTrigger:["\\lt"],kind:"infix",associativity:"any",precedence:245},{latexTrigger:["<","="],kind:"infix",associativity:"any",precedence:241,parse:"LessEqual"},{name:"LessEqual",latexTrigger:["\\le"],kind:"infix",associativity:"any",precedence:241},{latexTrigger:["\\leq"],kind:"infix",associativity:"any",precedence:241,parse:"LessEqual"},{latexTrigger:["\\leqslant"],kind:"infix",associativity:"any",precedence:L+5,parse:"LessEqual"},{name:"LessNotEqual",latexTrigger:["\\lneqq"],kind:"infix",associativity:"any",precedence:L},{name:"NotLessNotEqual",latexTrigger:["\\nleqq"],kind:"infix",associativity:"any",precedence:L},{name:"LessOverEqual",latexTrigger:["\\leqq"],kind:"infix",associativity:"any",precedence:L+5},{name:"GreaterOverEqual",latexTrigger:["\\geqq"],kind:"infix",associativity:"any",precedence:L+5,parse:"GreaterEqual"},{name:"Equal",latexTrigger:["="],kind:"infix",associativity:"right",precedence:L},{latexTrigger:["*","="],kind:"infix",associativity:"right",precedence:L,parse:"StarEqual"},{name:"StarEqual",latexTrigger:["\\star","="],kind:"infix",associativity:"right",precedence:L},{name:"PlusEqual",latexTrigger:["+","="],kind:"infix",associativity:"right",precedence:L},{name:"MinusEqual",latexTrigger:["-","="],kind:"infix",associativity:"right",precedence:L},{name:"SlashEqual",latexTrigger:["/","="],kind:"infix",associativity:"right",precedence:L},{name:"EqualEqual",latexTrigger:["=","="],kind:"infix",associativity:"right",precedence:L},{name:"EqualEqualEqual",latexTrigger:["=","=","="],kind:"infix",associativity:"right",precedence:L+5},{name:"TildeFullEqual",latexTrigger:["\\cong"],kind:"infix",associativity:"right",precedence:L},{name:"NotTildeFullEqual",latexTrigger:["\\ncong"],kind:"infix",associativity:"right",precedence:L},{name:"Approx",latexTrigger:["\\approx"],kind:"infix",associativity:"right",precedence:247},{name:"NotApprox",latexTrigger:["\\not","\\approx"],kind:"infix",associativity:"right",precedence:247},{name:"ApproxEqual",latexTrigger:["\\approxeq"],kind:"infix",associativity:"right",precedence:L},{name:"NotApproxEqual",latexTrigger:["\\not","\\approxeq"],kind:"infix",associativity:"right",precedence:250},{name:"NotEqual",latexTrigger:["\\ne"],kind:"infix",associativity:"right",precedence:255},{name:"Unequal",latexTrigger:["!","="],kind:"infix",associativity:"right",precedence:L},{name:"GreaterEqual",latexTrigger:["\\ge"],kind:"infix",associativity:"right",precedence:242},{latexTrigger:["\\geq"],kind:"infix",associativity:"right",precedence:242,parse:"GreaterEqual"},{latexTrigger:[">","="],kind:"infix",associativity:"right",precedence:243,parse:"GreaterEqual"},{latexTrigger:["\\geqslant"],kind:"infix",associativity:"right",precedence:L+5,parse:"GreaterEqual"},{name:"GreaterNotEqual",latexTrigger:["\\gneqq"],kind:"infix",associativity:"right",precedence:L},{name:"NotGreaterNotEqual",latexTrigger:["\\ngeqq"],kind:"infix",associativity:"right",precedence:L},{latexTrigger:[">"],kind:"infix",associativity:"right",precedence:245,parse:"Greater"},{name:"Greater",latexTrigger:["\\gt"],kind:"infix",associativity:"right",precedence:245},{name:"NotGreater",latexTrigger:["\\ngtr"],kind:"infix",associativity:"right",precedence:244},{latexTrigger:["\\not",">"],kind:"infix",associativity:"right",precedence:244,parse:"NotGreater"},{name:"RingEqual",latexTrigger:["\\circeq"],kind:"infix",associativity:"right",precedence:L},{name:"TriangleEqual",latexTrigger:["\\triangleq"],kind:"infix",associativity:"right",precedence:L},{name:"DotEqual",latexTrigger:["\\doteq"],kind:"infix",associativity:"right",precedence:L+5},{name:"DotEqualDot",latexTrigger:["\\doteqdot"],kind:"infix",associativity:"right",precedence:L+5},{name:"FallingDotEqual",latexTrigger:["\\fallingdotseq"],kind:"infix",associativity:"right",precedence:L+5},{name:"RisingDotEqual",latexTrigger:["\\fallingdotseq"],kind:"infix",associativity:"right",precedence:L+5},{name:"QuestionEqual",latexTrigger:["\\questeq"],kind:"infix",associativity:"right",precedence:L},{name:"MuchLess",latexTrigger:["\\ll"],kind:"infix",associativity:"right",precedence:L},{name:"MuchGreater",latexTrigger:["\\gg"],kind:"infix",associativity:"right",precedence:L},{name:"Precedes",latexTrigger:["\\prec"],kind:"infix",associativity:"right",precedence:L},{name:"Succeeds",latexTrigger:["\\succ"],kind:"infix",associativity:"right",precedence:L},{name:"PrecedesEqual",latexTrigger:["\\preccurlyeq"],kind:"infix",associativity:"right",precedence:L},{name:"SucceedsEqual",latexTrigger:["\\curlyeqprec"],kind:"infix",associativity:"right",precedence:L},{name:"NotPrecedes",latexTrigger:["\\nprec"],kind:"infix",associativity:"right",precedence:L},{name:"NotSucceeds",latexTrigger:["\\nsucc"],kind:"infix",associativity:"right",precedence:L},{name:"Between",latexTrigger:["\\between"],kind:"infix",associativity:"right",precedence:L+5}];function zi(n){return typeof n=="string"?n.startsWith("$")&&n.endsWith("$"):!1}function ut(n){if(typeof n=="number")return n.toString();if(typeof n=="string"){let e=n.trim();if(e.startsWith("$$")&&e.endsWith("$$"))return e.slice(2,-2);if(e.startsWith("$")&&e.endsWith("$"))return e.slice(1,-1)}return Array.isArray(n)?ut(v(n)):null}function Je(n){return typeof n!="string"?!1:_t.some(e=>e.name===n)}function vn(n){return typeof n!="string"?!1:["Less","LessEqual","Greater","GreaterEqual"].includes(n)}function ti(n){return typeof n!="string"?!1:["Equal","NotEqual"].includes(n)}function ys(n,e,t,i,r){if(e&&e.minPrec>=i)return null;let o=t?[t]:["Nothing"],s=!1;for(;!s;){for(s=!0,n.skipSpace();n.match(r);)o.push("Nothing"),n.skipSpace();if(n.atTerminator(e))o.push("Nothing");else{let a=n.parseExpression({...e,minPrec:i});o.push(a??"Nothing"),s=a===null}s||(n.skipSpace(),s=!n.match(r))}return o}function Cn(n=""){return(e,t)=>{if(!t)return"";let i=N(t);if(i.length===0)return"";if(i.length===1)return e.serialize(i[0]);n={"&":"\\&",":":"\\colon","|":"\\mvert","-":"-","\xB7":"\\cdot","\u2012":"-","\u2013":"--","\u2014":"---","\u2015":"-","\u2022":"\\bullet","\u2026":"\\ldots"}[n]??n;let r=i.reduce((o,s)=>(o.push(e.serialize(s),n),o),[]);return r.pop(),v(r)}}var Uu=[{latexTrigger:["\\placeholder"],kind:"symbol",parse:n=>{for(;n.match("<space>"););if(n.match("["))for(;!n.match("]")&&!n.atBoundary;)n.nextToken();for(;n.match("<space>"););if(n.match("<{>"))for(;!n.match("<}>")&&!n.atBoundary;)n.nextToken();return"Nothing"}},{name:"ContinuationPlaceholder",latexTrigger:["\\dots"]},{latexTrigger:["\\ldots"],parse:"ContinuationPlaceholder"},{latexTrigger:[".",".","."],parse:"ContinuationPlaceholder"},{name:"Function",latexTrigger:["\\mapsto"],kind:"infix",precedence:Gn,parse:(n,e)=>{let t=[];if(h(e)==="Delimiter"&&(e=m(e,1)??"Nothing"),h(e)==="Sequence")for(let r of N(e)){if(!T(r))return null;t.push(T(r))}else{if(!T(e))return null;t=[T(e)]}let i=n.parseExpression({minPrec:Gn})??"Nothing";return h(i)==="Delimiter"&&(i=m(i,1)??"Nothing"),h(i)==="Sequence"&&(i=["Block",...N(i)]),["Function",i,...t]},serialize:(n,e)=>{let t=N(e);return t.length<1?"()\\mapsto()":t.length===1?v(["()","\\mapsto",n.serialize(m(e,1))]):t.length===2?v([n.serialize(m(e,2)),"\\mapsto",n.serialize(m(e,1))]):v([n.wrapString(N(e)?.slice(1).map(i=>n.serialize(i)).join(", "),"normal"),"\\mapsto",n.serialize(m(e,1))])}},{name:"Apply",kind:"function",symbolTrigger:"apply",serialize:(n,e)=>{let t=m(e,1),i=h(t);if(i==="InverseFunction"||i==="Derivative"){let s=n.options.applyFunctionStyle(e,n.level),a=N(e).slice(1);return n.serializeFunction(t,n.dictionary.ids.get(i))+n.wrapString(a.map(u=>n.serialize(u)).join(", "),s)}let r=m(e,2);if(typeof t=="string"||!r){let s=N(e).slice(1);return n.serialize(s)}if(J(e)===2)return v([n.wrap(t,20),"\\lhd",n.wrap(r,20)]);let o=n.options.applyFunctionStyle(e,n.level);return v(["\\operatorname{apply}",n.wrapString(n.serialize(i)+", "+n.serialize(["List",...N(e)]),o)])}},{latexTrigger:"\\lhd",kind:"infix",precedence:20,parse:"Apply"},{latexTrigger:"\\rhd",kind:"infix",precedence:20,parse:(n,e)=>["Apply",n.parseExpression({minPrec:21})??"Nothing",e]},{name:"EvaluateAt",openTrigger:".",closeTrigger:"|",kind:"matchfix",serialize:(n,e)=>{let t=m(e,1);if(!t)return"";let i=N(e).slice(1);if(h(t)==="Function"){let r=N(t).slice(1),o=m(t,1);if(h(o)==="Block"&&J(o)===1&&(o=m(o,1)),r.length>0)return`\\left.\\left(${n.serialize(o)}\\right)\\right|_{${r.map((s,a)=>`${n.serialize(s)}=${n.serialize(i[a])}`).join(", ")}}`}return`\\left.\\left(${n.serialize(t)}\\right)\\right|_{${i.map(r=>n.serialize(r)).join(", ")}}`}},{name:"Assign",latexTrigger:"\\coloneq",kind:"infix",associativity:"right",precedence:$i,serialize:(n,e)=>{let t=as(m(e,1));if(h(m(e,2))==="Function"){let i=m(e,2),r=as(m(i,1)),o=N(i).slice(1);return v([n.serialize(t),n.wrapString(o.map(s=>n.serialize(s)).join(", "),n.options.applyFunctionStyle(e,n.level)),"\\coloneq",n.serialize(r)])}return v([n.serialize(t),"\\coloneq",n.serialize(m(e,2))])},parse:Qr},{latexTrigger:"\\coloneqq",kind:"infix",associativity:"right",precedence:$i,parse:Qr},{latexTrigger:"\\colonequals",kind:"infix",associativity:"right",precedence:$i,parse:Qr},{latexTrigger:[":","="],kind:"infix",associativity:"right",precedence:$i,parse:Qr},{name:"BaseForm",serialize:(n,e)=>{let t=R(m(e,2))??NaN;if(isFinite(t)&&t>=2&&t<=36){let i=R(m(e,1))??NaN;if(isFinite(i)&&Number.isInteger(i)){let r=Number(i).toString(t),o=0;if(t===2||t===10?o=4:t===16?o=2:t>16&&(o=4),o>0){let s=r;r="";for(let a=0;a<s.length;a++)a>0&&a%o===0&&(r="\\, "+r),r=s[s.length-a-1]+r}return`(\\text{${r}}_{${t}}`}}return"\\operatorname{BaseForm}("+n.serialize(m(e,1))+", "+n.serialize(m(e,2))+")"}},{name:"Sequence",serialize:Cn(" ")},{name:"InvisibleOperator",serialize:Cn("")},{name:"Delimiter",serialize:(n,e)=>{let t=n.options.groupStyle(e,n.level+1),i=m(e,1),r={Set:"{,}",List:"[,]",Tuple:"(,)",Single:"(,)",Pair:"(,)",Triple:"(,)",Sequence:"(,)",String:'""'}[h(i)],o=r?i:["Sequence",i];if(r??="(,)",J(e)>1){let c=F(m(e,2));typeof c=="string"&&c.length<=3&&(r=c)}let[s,a,u]=["","",""];r.length===3?[s,a,u]=r:r.length===2?[s,u]=r:r.length===1&&(a=r);let l=i?o?Cn(a)(n,o):n.serialize(i):"";return n.wrapString(l,t,s+u)}},{name:"Tuple",serialize:(n,e)=>v(["(",Cn(",")(n,e),")"])},{name:"Pair",serialize:(n,e)=>v(["(",Cn(",")(n,e),")"])},{name:"Triple",serialize:(n,e)=>v(["(",Cn(",")(n,e),")"])},{name:"Single",serialize:(n,e)=>v(["(",Cn(",")(n,e),")"])},{name:"Domain",serialize:(n,e)=>h(e)==="Error"?n.serialize(e):`\\mathbf{${n.serialize(m(e,1))}}`},{latexTrigger:["\\mathtip"],parse:n=>{let e=n.parseGroup();return n.parseGroup(),e}},{latexTrigger:["\\texttip"],parse:n=>{let e=n.parseGroup();return n.parseGroup(),e}},{latexTrigger:["\\error"],parse:n=>["Error",n.parseGroup()]},{name:"Error",serialize:(n,e)=>{let t=m(e,1);if(F(t)==="missing")return`\\error{${n.options.missingSymbol??"\\placeholder{}"}}`;let i=xp(n,e)||"\\blacksquare",r=h(t)==="ErrorCode"?F(m(t,1)):F(t);return r==="incompatible-type"?T(m(t,3))==="Undefined"?`\\mathtip{\\error{${i}}}{\\notin ${n.serialize(m(t,2))}}`:`\\mathtip{\\error{${i}}}{\\in ${n.serialize(m(t,3))}\\notin ${n.serialize(m(t,2))}}`:typeof r=="string"?`\\error{${i}}`:`\\error{${i}}`}},{name:"ErrorCode",serialize:(n,e)=>{let t=F(m(e,1));return t==="missing"?n.options.missingSymbol??"\\placeholder{}":t==="unexpected-command"||t==="unexpected-operator"||t==="unexpected-token"||t==="invalid-symbol"||t==="unknown-environment"||t==="unexpected-base"||t==="incompatible-type"?"":`\\texttip{\\error{\\blacksquare}}{\\mathtt{${t}}}`}},{name:"FromLatex",serialize:(n,e)=>`\\texttt{${yp(F(m(e,1)))}}`},{name:"Latex",serialize:(n,e)=>e===null?"":v(Zr(e,t=>F(t)??n.serialize(t)))},{name:"LatexString",serialize:(n,e)=>e===null?"":v(Zr(e,t=>n.serialize(t)))},{name:"LatexTokens",serialize:hp},{name:"At",kind:"postfix",precedence:810,latexTrigger:["["],parse:bs("]"),serialize:(n,e)=>v(["\\lbrack",Cn(", ")(n,e),"\\rbrack"])},{kind:"postfix",precedence:810,latexTrigger:["\\lbrack"],parse:bs("\\rbrack")},{kind:"postfix",precedence:810,latexTrigger:["\\left","\\lbrack"],parse:bs("\\right","\\rbrack")},{kind:"postfix",latexTrigger:["_"],parse:(n,e,t)=>{let i=n.parseGroup()??n.parseToken();return["Subscript",e,i]}},{name:"List",kind:"matchfix",openTrigger:"[",closeTrigger:"]",parse:ju,serialize:Ep},{kind:"matchfix",openTrigger:"(",closeTrigger:")",parse:bp},{latexTrigger:[","],kind:"infix",precedence:20,parse:(n,e,t)=>{let i=ys(n,t,e,20,",");return i===null?null:["Delimiter",["Sequence",...i],{str:","}]}},{latexTrigger:[","],kind:"prefix",precedence:20,parse:(n,e)=>{let t=ys(n,e,null,20,",");return t===null?null:["Delimiter",["Sequence",...t],{str:","}]}},{name:"Range",latexTrigger:[".","."],kind:"infix",precedence:800,parse:vp,serialize:(n,e)=>{let t=N(e);if(t.length===0)return"";if(t.length===1)return"1.."+n.serialize(m(e,1));if(t.length===2)return n.wrap(m(e,1),10)+".."+n.wrap(m(e,2),10);if(t.length===3){let i=R(m(e,3)),r=R(m(e,1));return i!==null&&r!==null?n.wrap(m(e,1),10)+".."+n.wrap(r+i,10)+".."+n.wrap(m(e,2),10):n.wrap(m(e,1),10)+"..("+(n.wrap(m(e,1),de)+"+"+n.wrap(m(e,3),de))+").."+n.wrap(m(e,2),10)}return""}},{latexTrigger:[";"],kind:"infix",precedence:19,parse:(n,e,t)=>{let i=ys(n,t,e,19,";");return i===null?null:["Delimiter",["Sequence",...i],"';'"]}},{name:"String",latexTrigger:["\\text"],parse:n=>Zn(n),serialize:(n,e)=>{let t=N(e);return t.length===0?"\\text{}":v(["\\text{",t.map(i=>n.serialize(i)).join(""),"}"])}},{name:"Subscript",latexTrigger:["_"],kind:"infix",serialize:(n,e)=>J(e)===2?n.serialize(m(e,1))+"_{"+n.serialize(m(e,2))+"}":"_{"+n.serialize(m(e,1))+"}"},{name:"Superplus",latexTrigger:["^","+"],kind:"postfix"},{name:"Subplus",latexTrigger:["_","+"],kind:"postfix"},{name:"Superminus",latexTrigger:["^","-"],kind:"postfix"},{name:"Subminus",latexTrigger:["_","-"],kind:"postfix"},{latexTrigger:["^","*"],kind:"postfix",parse:(n,e)=>["Superstar",e]},{latexTrigger:["_","*"],kind:"postfix",parse:(n,e)=>["Substar",e]},{name:"Substar",latexTrigger:["_","\\star"],kind:"postfix"},{name:"Superdagger",latexTrigger:["^","\\dagger"],kind:"postfix"},{latexTrigger:["^","\\dag"],kind:"postfix",parse:(n,e)=>["Superdagger",e]},{name:"Prime",latexTrigger:["^","\\prime"],kind:"postfix",parse:(n,e)=>jn(n,e,1),serialize:(n,e)=>{let t=R(m(e,2))??1,i=n.serialize(m(e,1));return t===1?i+"^\\prime":t===2?i+"^\\doubleprime":t===3?i+"^\\tripleprime":i+"^{("+n.serialize(m(e,2))+")}"}},{latexTrigger:"^{\\prime\\prime}",kind:"postfix",parse:(n,e)=>jn(n,e,2)},{latexTrigger:"^{\\prime\\prime\\prime}",kind:"postfix",parse:(n,e)=>jn(n,e,3)},{latexTrigger:["^","\\doubleprime"],kind:"postfix",parse:(n,e)=>jn(n,e,2)},{latexTrigger:["^","\\tripleprime"],kind:"postfix",parse:(n,e)=>jn(n,e,3)},{latexTrigger:"'",kind:"postfix",precedence:810,parse:(n,e)=>jn(n,e,1)},{latexTrigger:"\\prime",kind:"postfix",precedence:810,parse:(n,e)=>jn(n,e,1)},{latexTrigger:"\\doubleprime",kind:"postfix",precedence:810,parse:(n,e)=>jn(n,e,2)},{latexTrigger:"\\tripleprime",kind:"postfix",precedence:810,parse:(n,e)=>jn(n,e,3)},{latexTrigger:["^","<{>","("],kind:"postfix",parse:(n,e,t)=>{let i=T(e);if(!i||!n.getSymbolType(i).matches("function"))return null;n.addBoundary([")"]);let r=n.parseExpression(t);return!n.matchBoundary()||!n.match("<}>")?null:["Derivative",e,r]}},{name:"InverseFunction",latexTrigger:"^{-1",kind:"postfix",parse:(n,e)=>{let t=T(e);if(!t||!n.getSymbolType(t).matches("function"))return null;let i=0;for(;!n.atEnd&&!n.match("<}>");)if(n.match("'"))i++;else if(n.match("\\prime"))i++;else if(n.match("\\doubleprime"))i+=2;else if(n.match("\\tripleprime"))i+=3;else return null;return i===1?["Derivative",["InverseFunction",e]]:i>0?["Derivative",["InverseFunction",e],i]:["InverseFunction",e]},serialize:(n,e)=>n.serialize(m(e,1))+"^{-1}"},{name:"Derivative",serialize:(n,e)=>{let t=R(m(e,2))??1,i=n.serialize(m(e,1));return t===1?i+"^{\\prime}":t===2?i+"^{\\doubleprime}":t===3?i+"^{\\tripleprime}":i+"^{("+n.serialize(m(e,2))+")}"}},{kind:"environment",name:"Which",symbolTrigger:"cases",parse:xs,serialize:(n,e)=>{let t=[],i=N(e);if(i.length>0)for(let r=0;r<=i.length-2;r+=2){let o=[];o.push(n.serialize(i[r+1])),o.push(n.serialize(i[r])),t.push(o.join("&"))}return v(["\\begin{cases}",t.join("\\\\"),"\\end{cases}"])}},{kind:"environment",symbolTrigger:"dcases",parse:xs},{kind:"environment",symbolTrigger:"rcases",parse:xs}];function Zn(n,e){if(!n.match("<{>"))return"''";let t=[],i="",r=null,o=()=>{r!==null&&i?t.push(["Annotated",`'${i}'`,ls(r)]):i&&t.push(`'${i}'`),i="",r=null};for(;!n.atEnd&&!n.match("<}>");)if(n.peek==="<{>")o(),t.push(Zn(n));else if(n.match("\\textbf"))o(),t.push(Zn(n,{fontWeight:"bold"}));else if(n.match("\\textmd"))o(),t.push(Zn(n,{fontStyle:"normal"}));else if(n.match("\\textup"))o(),t.push(Zn(n,{fontStyle:"normal"}));else if(n.match("\\textsl"))o(),t.push(Zn(n,{fontStyle:"italic"}));else if(n.match("\\textit"))o(),t.push(Zn(n,{fontStyle:"italic"}));else if(n.match("\\texttt"))o(),t.push(Zn(n,{fontFamily:"monospace"}));else if(n.match("\\textsf"))o(),t.push(Zn(n,{fontFamily:"sans-serif"}));else if(n.match("\\textcolor")){let a=n.index,u=n.parseStringGroup(),l=n.parseExpression();u!==null&&l!==null?t.push(["Annotated",l,{dict:{color:u}}]):(n.index=a,i+="\\textcolor")}else if(n.match("\\color")){let a=n.parseStringGroup();a!==null&&(o(),r={color:a})}else if(n.match("<space>"))i+=" ";else if(n.match("<$>")){let a=n.index,u=n.parseExpression()??"Nothing";n.skipSpace(),n.match("<$>")?t.push(u):(i+="$",n.index=a)}else if(n.match("<$$>")){let a=n.index,u=n.parseExpression()??"Nothing";n.skipSpace(),n.match("<$$>")?t.push(u):(i+="$$",n.index=a)}else{let a=n.parseChar()??n.nextToken();i+={"\\enskip":"\u2002","\\enspace":"\u2002","\\quad":"\u2003","\\qquad":"\u2003\u2003","\\space":"\u2003","\\ ":"\u2003","\\;":"\u2004","\\,":"\u2009","\\:":"\u205F","\\!":"","\\{":"{","\\}":"}","\\$":"$","\\&":"&","\\#":"#","\\%":"%","\\_":"_","\\textbackslash":"\\","\\textasciitilde":"~","\\textasciicircum":"^","\\textless":"<","\\textgreater":">","\\textbar":"|","\\textunderscore":"_","\\textbraceleft":"{","\\textbraceright":"}","\\textasciigrave":"`","\\textquotesingle":"'","\\textquotedblleft":"\u201C","\\textquotedblright":"\u201D","\\textquotedbl":'"',"\\textquoteleft":"\u2018","\\textquoteright":"\u2019","\\textbullet":"\u2022","\\textdagger":"\u2020","\\textdaggerdbl":"\u2021","\\textsection":"\xA7","\\textparagraph":"\xB6","\\textperiodcentered":"\xB7","\\textellipsis":"\u2026","\\textemdash":"\u2014","\\textendash":"\u2013","\\textregistered":"\xAE","\\texttrademark":"\u2122","\\textdegree":"\xB0"}[a]??a}o();let s;return t.length===1?s=t[0]:t.every(a=>F(a)!==null)?s="'"+t.map(a=>F(a)).join()+"'":s=["Text",...t],e?["Annotated",s,ls(e)]:s}function hp(n,e){return e===null?"":v(Zr(e,t=>{let i=F(t);return i===null?n.serialize(t):i==="<{>"?"{":i==="<}>"?"}":i==="<$>"?"$":i==="<$$>"?"$$":i==="<space>"?" ":i}))}function yp(n){return n===null?"":n.replace(/[{}\[\]\\:\-\$%]/g,e=>({"{":"\\lbrace ","}":"\\rbrace ","[":"\\lbrack ","]":"\\rbrack ",":":"\\colon ","\\":"\\backslash "})[e]??"\\"+e)}function xp(n,e){let t=m(e,2);return t?h(t)==="LatexString"?F(m(t,1))??"":h(t)==="Hold"?n.serialize(m(t,1)):n.serialize(t):""}function jn(n,e,t){let i=h(e);if(i==="Derivative"||i==="Prime"){let o=R(m(e,2))??1;return[i,V(m(e,1)),o+t]}let r=T(e);return r&&n.getSymbolType(r).matches("function")||h(e)?t===1?["Derivative",e]:["Derivative",e,t]:t===1?["Prime",V(e)]:["Prime",V(e),t]}function bp(n,e){if(Y(e))return["Delimiter"];let t=h(e);if(t==="Delimiter"&&m(e,2)!==null){let i=F(m(e,2));if(i?.length===1)return["Delimiter",m(e,1)??"Nothing",{str:`(${i})`}]}return t==="Matrix"&&(F(m(e,2))??"..")===".."?["Matrix",m(e,1)]:["Delimiter",e]}function ju(n,e){if(Y(e))return["List"];let t=h(e);if(t==="Range"||t==="Linspace")return e;if(t==="Sequence")return["List",...N(e)];if(t==="Delimiter"){let i=F(m(e,2))??"...";if(i===";"||i===".;.")return["List",...(N(m(e,1))??[]).map(r=>ju(n,r))];if(i===","||i===".,.")return e=m(e,1),h(e)==="Sequence"?["List",...N(e)]:["List",e??"Nothing"]}return["List",e]}function Ep(n,e){return J(e)>1&&N(e).every(t=>{let i=h(t);return ti(i)||vn(i)})?v(["\\begin{cases}",Cn("\\\\")(n,e),"\\end{cases}"]):v(["\\bigl\\lbrack",Cn(", ")(n,e),"\\bigr\\rbrack"])}function vp(n,e){if(e===null)return null;let t=n.parseExpression({minPrec:270});if(t===null)return null;if(h(t)==="Range"){let i=m(t,1),r=m(t,2);return i&&r?["Range",e,r,["Subtract",i,e]]:null}return["Range",e,t]}var ii={"(":"(",")":")","[":"\\lbrack","]":"\\rbrack","\u27E6":"\\llbrack","\u27E7":"\\rrbrack","{":"\\lbrace","}":"\\rbrace","<":"\\langle",">":"\\rangle","\u2016":"\\Vert","\\":"\\backslash","\u2308":"\\lceil","\u2309":"\\rceil","\u230A":"\\lfloor","\u230B":"\\rfloor","\u231C":"\\ulcorner","\u231D":"\\urcorner","\u231E":"\\llcorner","\u231F":"\\lrcorner","\u23B0":"\\lmoustache","\u23B1":"\\rmoustache"};function Qr(n,e){if(h(e)==="InvisibleOperator"&&J(e)===2&&h(m(e,2))==="Delimiter"){let r=T(m(e,1));if(!r)return null;let o=n.parseExpression({minPrec:0});if(o===null)return null;let s=m(m(e,2),1),a=[];return h(s)==="Sequence"?a=[...N(s)]:s&&(a=[s]),["Assign",r,["Function",o,...a??[]]]}if(h(e)==="Subscript"&&T(m(e,1))){let r=T(m(e,1));if(!r)return null;let o=n.parseExpression({minPrec:0});if(o===null)return null;let s=m(e,2);return F(s)!==null?["Assign",e,o]:T(s)?["Assign",r,["Function",o,s]]:["Assign",e,o]}let t=h(e);if(t){let r=N(e),o=n.parseExpression({minPrec:0});return o===null?null:["Assign",t,["Function",o,...r]]}if(!T(e))return null;let i=n.parseExpression({minPrec:0});return i===null?null:["Assign",e,i]}function xs(n){let e=n.parseTabular();if(!e)return["List"];if(e.every(i=>{if(i.length!==1)return!1;let r=h(i[0]);return vn(r)||ti(r)}))return["List",...e.map(i=>i[0])];let t=[];for(let i of e)if(i.length===1)t.push("True"),t.push(i[0]);else if(i.length===2){let r=F(i[1]);t.push(r?"True":ss(i[1])??"True"),t.push(i[0])}return["Which",...t]}function bs(...n){return(e,t)=>{if(!T(t)&&h(t)!=="List")return null;let i=null;return n.length===0&&(i=e.parseGroup()),i??=e.parseExpression({minPrec:0}),i===null||n.length>0&&!e.matchAll(n)||F(i)!==null?null:(h(i)==="Delimiter"&&(i=m(i,1)??"Nothing"),h(i)==="Sequence"?["At",t,...N(i)]:["At",t,i])}}var Hu=[{name:"Matrix",serialize:(n,e)=>{let t=N(m(e,1));return Zu(n,t,F(m(e,2)),F(m(e,3)))}},{name:"Vector",serialize:(n,e)=>{let t=N(e);return Zu(n,t.map(i=>["List",i]),F(m(e,2)),F(m(e,3)))}},{kind:"environment",symbolTrigger:"pmatrix",parse:n=>{let e=Wn(n),[t,i]=Hn(n);return e?[t,i,{str:"()"},{str:e}]:[t,i]}},{kind:"environment",symbolTrigger:"bmatrix",parse:n=>{let e=Wn(n),[t,i]=Hn(n);return e?[t,i,{str:"[]"},{str:e}]:[t,i,{str:"[]"}]}},{kind:"environment",symbolTrigger:"Bmatrix",parse:n=>{let e=Wn(n),[t,i]=Hn(n);return e?[t,i,{str:"{}"},{str:e}]:[t,i,{str:"{}"}]}},{kind:"environment",symbolTrigger:"vmatrix",parse:n=>{let e=Wn(n),[t,i]=Hn(n);return e?[t,i,{str:"||"},{str:e}]:[t,i,{str:"||"}]}},{kind:"environment",symbolTrigger:"Vmatrix",parse:n=>{let e=Wn(n),[t,i]=Hn(n);return e?[t,i,{str:"\u2016\u2016"},{str:e}]:[t,i,{str:"\u2016\u2016"}]}},{kind:"environment",symbolTrigger:"smallmatrix",parse:n=>{let e=Wn(n),[t,i]=Hn(n);return e?[t,i,{str:"()"},{str:e}]:[t,i]}},{kind:"environment",symbolTrigger:"array",parse:n=>{let e=Wn(n,!1),[t,i]=Hn(n);return e?[t,i,{str:".."},{str:e}]:[t,i,{str:".."}]}},{kind:"environment",symbolTrigger:"matrix",parse:n=>{let e=Wn(n),[t,i]=Hn(n);return e?[t,i,{str:".."},{str:e}]:[t,i,{str:".."}]}},{kind:"environment",symbolTrigger:"matrix*",parse:n=>{let e=Wn(n),[t,i]=Hn(n);return e?[t,i,{str:".."},{str:e}]:[t,i,{str:".."}]}},{name:"ConjugateTranspose",kind:"postfix",latexTrigger:["^","\\star"]},{kind:"postfix",latexTrigger:["^","\\H"],parse:"ConjugateTranspose"},{kind:"postfix",latexTrigger:["^","\\dagger"],parse:(n,e)=>["ConjugateTranspose",e]},{kind:"postfix",latexTrigger:["^","\\ast"],parse:(n,e)=>["ConjugateTranspose",e]},{kind:"postfix",latexTrigger:["^","\\top"],parse:(n,e)=>["Transpose",e]},{kind:"postfix",latexTrigger:["^","\\intercal"],parse:(n,e)=>["Transpose",e]},{name:"Transpose",kind:"postfix",latexTrigger:["^","T"]},{name:"PseudoInverse",kind:"postfix",latexTrigger:["^","+"]},{name:"Trace",kind:"function",symbolTrigger:"tr"},{name:"Determinant",kind:"function",symbolTrigger:"det"}];function Hn(n){let e=n.parseTabular();return e?["Matrix",["List",...e.map(t=>["List",...t])]]:["",null]}function Wn(n,e=!0){let t=n.parseStringGroup(e)?.trim();if(!t)return"";let i="";for(let r of t)r==="c"&&(i+="="),r==="l"&&(i+="<"),r==="r"&&(i+=">"),r==="|"&&(i+="|"),r===":"&&(i+=":");return i}function Zu(n,e,t,i){t??="()";let[r,o]=["",""];typeof t=="string"&&t.length===2&&([r,o]=t);let s="";if(i)for(let c of i)c==="<"?s+="l":c===">"?s+="r":c==="="?s+="c":c==="|"?s+="|":c===":"&&(s+=":");let a=[];for(let c of e??[]){let f=[];for(let d of N(c))f.push(n.serialize(d));a.push(f.join(" & "))}let u=a.join(`\\\\
`),l=s.length>0?`[${s}]`:"";return r==="("&&o===")"?v(["\\begin{pmatrix}",l,u,"\\end{pmatrix}"]):r==="["&&o==="]"?v(["\\begin{bmatrix}",l,u,"\\end{bmatrix}"]):r==="{"&&o==="}"?v(["\\begin{Bmatrix}",l,u,"\\end{Bmatrix}"]):r==="|"&&o==="|"?v(["\\begin{vmatrix}",l,u,"\\end{vmatrix}"]):r==="\u2016"&&o==="\u2016"?v(["\\begin{Vmatrix}",l,u,"\\end{Vmatrix}"]):r==="{"&&o==="."?v(["\\begin{dcases}",l,u,"\\end{dcases}"]):r==="."&&o==="}"?v(["\\begin{rcases}",l,u,"\\end{rcases}"]):s||r!=="."||o!=="."?v(["\\left",ii[r]??r,"\\begin{array}",`{${s}}`,u,"\\end{array}","\\right",ii[o]??o]):v(["\\begin{matrix}",u,"\\end{matrix}"])}var Wu=[{name:"True",kind:"symbol",latexTrigger:["\\top"]},{kind:"symbol",latexTrigger:"\\mathrm{True}",parse:"True"},{kind:"symbol",latexTrigger:"\\operatorname{True}",parse:"True"},{kind:"symbol",latexTrigger:"\\mathsf{T}",parse:"True"},{name:"False",kind:"symbol",latexTrigger:["\\bot"]},{kind:"symbol",latexTrigger:"\\operatorname{False}",parse:"False"},{kind:"symbol",latexTrigger:"\\mathsf{F}",parse:"False"},{name:"And",kind:"infix",latexTrigger:["\\land"],precedence:317},{kind:"infix",latexTrigger:["\\wedge"],parse:"And",precedence:317},{kind:"infix",latexTrigger:"\\&",parse:"And",precedence:317},{kind:"infix",latexTrigger:"\\operatorname{and}",parse:"And",precedence:317},{name:"Or",kind:"infix",latexTrigger:["\\lor"],precedence:310},{kind:"infix",latexTrigger:["\\vee"],parse:"Or",precedence:310},{kind:"infix",latexTrigger:"\\parallel",parse:"Or",precedence:310},{kind:"infix",latexTrigger:"\\operatorname{or}",parse:"Or",precedence:310},{name:"Xor",kind:"infix",latexTrigger:["\\veebar"],precedence:315},{name:"Not",kind:"prefix",latexTrigger:["\\lnot"],precedence:880},{kind:"prefix",latexTrigger:["\\neg"],parse:"Not",precedence:880},{name:"Nand",kind:"infix",latexTrigger:["\\barwedge"],precedence:315},{name:"Nor",kind:"infix",latexTrigger:["\u22BD"],precedence:315},{kind:"function",symbolTrigger:"and",parse:"And"},{kind:"function",symbolTrigger:"or",parse:"Or"},{kind:"function",symbolTrigger:"not",parse:"Not"},{name:"Implies",kind:"infix",precedence:220,associativity:"right",latexTrigger:["\\implies"],serialize:"\\implies"},{latexTrigger:["\\Rightarrow"],kind:"infix",precedence:220,associativity:"right",parse:"Implies"},{name:"Equivalent",latexTrigger:["\\iff"],kind:"infix",associativity:"right",precedence:219},{latexTrigger:["\\Leftrightarrow"],kind:"infix",associativity:"right",precedence:219,parse:"Equivalent"},{latexTrigger:["\\equiv"],kind:"infix",associativity:"right",precedence:219,parse:(n,e,t)=>{let i=n.parseExpression({...t,minPrec:219}),r=n.index,o=n.parseExpression({...t,minPrec:219});return o!==null&&h(o)==="Mod"?["Congruent",e,i,V(m(o,1))]:(n.index=r,["Equivalent",e,V(i)])}},{name:"Proves",kind:"infix",latexTrigger:["\\vdash"],precedence:220,associativity:"right",serialize:"\\vdash"},{name:"Entails",kind:"infix",latexTrigger:["\\vDash"],precedence:220,associativity:"right",serialize:"\\vDash"},{name:"Satisfies",kind:"infix",latexTrigger:["\\models"],precedence:220,associativity:"right",serialize:"\\models"},{name:"ForAll",kind:"prefix",latexTrigger:["\\forall"],precedence:200,serialize:"\\forall",parse:Gi("ForAll")},{name:"Exists",kind:"prefix",latexTrigger:["\\exists"],precedence:200,serialize:"\\exists",parse:Gi("Exists")},{name:"ExistsUnique",kind:"prefix",latexTrigger:["\\exists","!"],precedence:200,serialize:"\\exists!",parse:Gi("ExistsUnique")},{name:"NotForAll",kind:"prefix",latexTrigger:["\\lnot","\\forall"],precedence:200,serialize:"\\lnot\\forall",parse:Gi("NotForAll")},{name:"NotExists",kind:"prefix",latexTrigger:["\\lnot","\\exists"],precedence:200,serialize:"\\lnot\\exists",parse:Gi("NotExists")},{name:"KroneckerDelta",kind:"prefix",latexTrigger:["\\delta","_"],precedence:200,serialize:(n,e)=>{let t=N(e);return t.length===0?"\\delta":t.every(i=>T(i))?`\\delta_{${t.map(i=>n.serialize(i)).join("")}}`:`\\delta_{${t.map(i=>n.serialize(i)).join(", ")}}`},parse:n=>{let e=n.parseGroup();if(e===null){let i=n.parseToken();return i?["KroneckerDelta",i]:null}let t=zn(e);return t&&t.length<=2?["KroneckerDelta",...t]:h(e)==="InvisibleOperator"?["KroneckerDelta",...N(e)]:e!==null?["KroneckerDelta",e]:null}},{name:"Boole",kind:"matchfix",openTrigger:"[",closeTrigger:"]",parse:(n,e)=>{let t=h(e);return!t||!_t.some(i=>i.name===t)?null:["Boole",e]}},{kind:"matchfix",openTrigger:"\\llbracket",closeTrigger:"\\rrbracket",parse:(n,e)=>{let t=h(e);return!t||!_t.some(i=>i.name===t)?null:["Boole",e]}}];function Gi(n){return(e,t)=>{let i=e.index,r=e.parseSymbol(t);if(r){if(e.skipSpace(),e.match(",")||e.match("\\mid")||e.match(".")||e.match(":")||e.match("\\colon")){let a=e.parseExpression(t);return[n,r,V(a)]}let s=e.parseEnclosure();if(s)return[n,r,V(s)]}e.index=i;let o=e.parseExpression(t);if(o===null)return null;if(e.skipSpace(),e.matchAny([",","\\mid",":","\\colon"])){let s=e.parseExpression(t);return[n,o,V(s)]}if(e.match("(")){let s=e.parseExpression(t);return e.match(")")?[n,o,V(s)]:null}return null}}function je(n){return e=>{let t=e.parseGroup();return t===null?[n]:[n,t]}}var Ju=[{name:"Overscript",latexTrigger:["\\overset"],kind:"infix",precedence:700},{name:"Underscript",latexTrigger:["\\underset"],kind:"infix",precedence:700},{name:"Increment",latexTrigger:["+","+"],kind:"postfix",precedence:880,parse:(n,e)=>T(e)===null?null:["Decrement",e]},{name:"Decrement",latexTrigger:["-","-"],kind:"postfix",precedence:880,parse:(n,e)=>T(e)===null?null:["Decrement",e]},{name:"PreIncrement",latexTrigger:["+","+"],kind:"prefix",precedence:880,parse:(n,e)=>{let t=n.parseExpression(e);return T(t)===null?null:["PreIncrement",t]}},{name:"PreDecrement",latexTrigger:["-","-"],kind:"prefix",precedence:880,parse:(n,e)=>{let t=n.parseExpression(e);return T(t)===null?null:["PreDecrement",t]}},{name:"Ring",latexTrigger:["\\circ"],kind:"infix",precedence:265},{name:"StringJoin",latexTrigger:["\\lt","\\gt"],kind:"infix",precedence:780},{name:"Starstar",latexTrigger:["\\star","\\star"],kind:"infix",precedence:780},{name:"PartialDerivative",latexTrigger:["\\partial"],kind:"prefix",parse:n=>{let e=!1,t="Nothing",i="Nothing";for(;!e;)n.skipSpace(),n.match("_")?i=n.parseGroup()??n.parseToken():n.match("^")?t=n.parseGroup()??n.parseToken():e=!0;let r=zn(i);if(r&&(i=["List",...r]),i===null||t===null)return null;let o=n.parseGroup()??"Nothing";if(!Y(o)){let s=n.parseArguments()??["Nothing"];o=[o,...s]}return["PartialDerivative",o,i,t]},serialize:(n,e)=>{let t="\\partial",i=m(e,1),r=m(e,2),o=m(e,3);return r!==null&&r!=="Nothing"&&(h(r)==="List"?t+="_{"+n.serialize(["Sequence",...N(r)])+"}":t+="_{"+n.serialize(r)+"}"),o!==null&&o!=="Nothing"&&(t+="^{"+n.serialize(o)+"}"),i!==null&&i!=="Nothing"&&(t+=n.serialize(i)),t},precedence:740},{name:"OverBar",latexTrigger:["\\overline"],parse:je("OverBar")},{name:"UnderBar",latexTrigger:["\\underline"],parse:je("UnderBar")},{name:"OverVector",latexTrigger:["\\vec"],parse:je("OverVector")},{name:"OverTilde",latexTrigger:["\\tilde"],parse:je("OverTilde")},{name:"OverHat",latexTrigger:["\\hat"],parse:je("OverHat")},{name:"OverRightArrow",latexTrigger:["\\overrightarrow"],parse:je("OverRightArrow")},{name:"OverLeftArrow",latexTrigger:["\\overleftarrow"],parse:je("OverLeftArrow")},{name:"OverRightDoubleArrow",latexTrigger:["\\Overrightarrow"],parse:je("OverRightDoubleArrow")},{name:"OverLeftHarpoon",latexTrigger:["\\overleftharpoon"],parse:je("OverLeftHarpoon")},{name:"OverRightHarpoon",latexTrigger:["\\overrightharpoon"],parse:je("OverRightHarpoon")},{name:"OverLeftRightArrow",latexTrigger:["\\overleftrightarrow"],parse:je("OverLeftRightArrow")},{name:"OverBrace",latexTrigger:["\\overbrace"],parse:je("OverBrace")},{name:"OverLineSegment",latexTrigger:["\\overlinesegment"],parse:je("OverLineSegment")},{name:"OverGroup",latexTrigger:["\\overgroup"],parse:je("OverGroup")},{latexTrigger:["\\textcolor"],parse:n=>{let e=n.index,t=n.parseStringGroup(),i=n.parseGroup();return t!==null?i!==null?["Annotated",i,{dict:{color:t}}]:"Nothing":(n.index=e,"Nothing")}},{latexTrigger:["\\displaystyle"],parse:()=>"Nothing"},{latexTrigger:["\\textstyle"],parse:()=>"Nothing"},{latexTrigger:["\\scriptstyle"],parse:()=>"Nothing"},{latexTrigger:["\\scriptscriptstyle"],parse:()=>"Nothing"},{latexTrigger:["\\tiny"],parse:()=>"Nothing"},{latexTrigger:["\\scriptsize"],parse:()=>"Nothing"},{latexTrigger:["\\footnotesize"],parse:()=>"Nothing"},{latexTrigger:["\\small"],parse:()=>"Nothing"},{latexTrigger:["\\normalsize"],parse:()=>"Nothing"},{latexTrigger:["\\large"],parse:()=>"Nothing"},{latexTrigger:["\\Large"],parse:()=>"Nothing"},{latexTrigger:["\\LARGE"],parse:()=>"Nothing"},{latexTrigger:["\\huge"],parse:()=>"Nothing"},{latexTrigger:["\\Huge"],parse:()=>"Nothing"},{name:"Annotated",serialize:(n,e)=>{let t=n.serialize(m(e,1)),i=us(m(e,2));if(i===null)return t;F(i.dict.mathStyle)==="normal"?t=v(["{\\displaystyle",t,"}"]):F(i.dict.mathStyle)==="compact"&&(t=v(["{\\textstyle",t,"}"]));let r=R(i.dict.size);return r!==null&&r>=1&&r<=10&&(t=v(["{",{1:"\\tiny",2:"\\scriptsize",3:"\\footnotesize",4:"\\small",5:"\\normalsize",6:"\\large",7:"\\Large",8:"\\LARGE",9:"\\huge",10:"\\Huge"}[r],t,"}"])),t}},{latexTrigger:["\\!"],parse:()=>["HorizontalSpacing",-3]},{latexTrigger:["\\ "],parse:()=>["HorizontalSpacing",6]},{latexTrigger:["\\:"],parse:()=>["HorizontalSpacing",4]},{latexTrigger:["\\enskip"],parse:()=>["HorizontalSpacing",9]},{latexTrigger:["\\quad"],parse:()=>["HorizontalSpacing",18]},{latexTrigger:["\\qquad"],parse:()=>["HorizontalSpacing",36]},{latexTrigger:["\\,"],parse:()=>["HorizontalSpacing",3]},{latexTrigger:["\\;"],parse:()=>["HorizontalSpacing",5]},{latexTrigger:["\\enspace"],parse:()=>["HorizontalSpacing",9]},{latexTrigger:["\\phantom"],parse:n=>(n.parseGroup(),"Nothing")},{latexTrigger:["\\vphantom"],parse:n=>(n.parseGroup(),"Nothing")},{latexTrigger:["\\hphantom"],parse:n=>(n.parseGroup(),"Nothing")},{latexTrigger:["\\placeholder"],parse:n=>(n.parseOptionalGroup(),n.parseGroup()??"Nothing")},{latexTrigger:["\\smash"],parse:n=>(n.parseGroup(),"Nothing")},{latexTrigger:["\\strut"],parse:n=>"Nothing"},{latexTrigger:["\\mathstrut"],parse:n=>"Nothing"},{name:"HorizontalSpacing",serialize:(n,e)=>{if(m(e,2)!==null)return n.serialize(m(e,1));let t=R(m(e,1));return t===null?"":{"-3":"\\!",6:"\\ ",3:"\\,",4:"\\:",5:"\\;",9:"\\enspace",18:"\\quad",36:"\\qquad"}[t]??""}}];function B(n){return(e,t)=>{let i={"\\arcsin":"Arcsin","\\arccos":"Arccos","\\arctan":"Arctan","\\arctg":"Arctan","\\arcctg":"Arccot","\\arcsec":"Arcsec","\\arccsc":"Arccsc","\\arsinh":"Arsinh","\\arcosh":"Arccosh","\\arccosh":"Arccosh","\\artanh":"Arctanh","\\arctanh":"Arctanh","\\arsech":"Arcsech","\\arcsech":"Arcsech","\\arcsch":"Arccsch","\\arccsch":"Arccsch","\\ch":"Cosh","\\cos":"Cos","\\cosh":"Csch","\\cosec":"Csc","\\cot":"Cot","\\cotg":"Cot","\\ctg":"Cot","\\csc":"Csc","\\csch":"Csch","\\coth":"Coth","\\cth":"Coth","\\sec":"Sec","\\sech":"Sech","\\sin":"Sin","\\sinh":"Sinh","\\sh":"Sinh","\\tan":"Tan","\\tg":"Tan","\\tanh":"Tanh","\\th":"Tanh"},r=i[n??""]??n??"";if(e.atTerminator(t))return r;let o=r;do{let l=e.parsePostfixOperator(o,t);if(l===null)break;o=l}while(!0);e.skipSpace();let s=null;e.match("^")&&(s=e.parseGroup()??e.parseToken()),e.skipSpace();let a=e.parseArguments("implicit",{minPrec:Ue,condition:l=>i[l.peek]||(t?.condition?.(l)??!1)}),u=a===null?o:typeof o=="string"?[o,...a]:["Apply",o,...a];return s===null?u:["Power",u,s]}}var Yu=[{name:"Arcsin",latexTrigger:["\\arcsin"],parse:B("Arcsin")},{name:"Arccos",latexTrigger:["\\arccos"],parse:B("Arccos")},{name:"Arctan",latexTrigger:["\\arctan"],parse:B("Arctan")},{latexTrigger:["\\arctg"],parse:B("Arctan")},{symbolTrigger:"arctg",parse:B("Arctan")},{name:"Arccot",symbolTrigger:"arcctg",parse:B("Arccot")},{latexTrigger:["\\arcctg"],parse:B("Arccot")},{name:"Arccoth",symbolTrigger:"arccoth",parse:B("Arccoth")},{symbolTrigger:"arcoth",parse:B("Arccoth")},{symbolTrigger:"arccoth",parse:B("Arccoth")},{latexTrigger:["\\arccoth"],parse:B("Arccoth")},{name:"Arcsec",symbolTrigger:"arcsec",parse:B("Arcsec")},{latexTrigger:["\\arcsec"],parse:B("Arcsec")},{name:"Arccsc",symbolTrigger:"arccsc",parse:B("Arccsc")},{latexTrigger:["\\arccsc"],parse:B("Arccsc")},{name:"Arcsinh",symbolTrigger:"arcsinh",parse:B("Arcsinh")},{latexTrigger:["\\arsinh"],parse:B("Arcsinh")},{latexTrigger:["\\arcsinh"],parse:B("Arcsinh")},{name:"Arccosh",symbolTrigger:"arccosh",parse:B("Arccosh")},{latexTrigger:"\\arccosh",parse:B("Arccosh")},{latexTrigger:"\\arcosh",parse:B("Arccosh")},{symbolTrigger:"arcosh",parse:B("Arccosh")},{name:"Arctanh",symbolTrigger:"arctanh",parse:B("Arctanh")},{symbolTrigger:"artanh",parse:B("Arctanh")},{latexTrigger:"\\artanh",parse:B("Arctanh")},{latexTrigger:["\\arctanh"],parse:B("Arctanh")},{symbolTrigger:"artanh",parse:B("Arctanh")},{name:"Arcsech",symbolTrigger:"arcsech",parse:B("Arcsech")},{latexTrigger:["\\arcsech"],parse:B("Arcsech")},{latexTrigger:["\\arsech"],parse:B("Arcsech")},{name:"Arccsch",symbolTrigger:"arccsch",parse:B("Arccsch")},{latexTrigger:["\\arccsch"],parse:B("Arccsch")},{latexTrigger:["\\arcsch"],parse:B("Arccsch")},{name:"Cosec",symbolTrigger:"cosec",parse:B("Cosec")},{latexTrigger:["\\cosec"],parse:B("Cosec")},{name:"Cosh",latexTrigger:["\\cosh"],parse:B("Cosh")},{latexTrigger:["\\ch"],parse:B("Cosh")},{name:"Cot",latexTrigger:["\\cot"],parse:B("Cot")},{latexTrigger:["\\cotg"],parse:B("Cot")},{latexTrigger:["\\ctg"],parse:B("Cot")},{name:"Csc",latexTrigger:["\\csc"],parse:B("Csc")},{name:"Csch",latexTrigger:["\\csch"],parse:B("Csch")},{name:"Coth",latexTrigger:["\\coth"],parse:B("Coth")},{latexTrigger:["\\cth"],parse:B("Coth")},{symbolTrigger:"cth",parse:B("Coth")},{latexTrigger:["\\coth"],parse:B("Coth")},{name:"Sec",latexTrigger:["\\sec"],parse:B("Sec")},{name:"Sech",symbolTrigger:"sech",parse:B("Sech")},{latexTrigger:["\\sech"],parse:B("Sech")},{name:"Sinh",latexTrigger:["\\sinh"],parse:B("Sinh")},{latexTrigger:["\\sh"],parse:B("Sinh")},{name:"Tan",latexTrigger:["\\tan"],parse:B("Tan")},{latexTrigger:["\\tg"],parse:B("Tan")},{name:"Tanh",latexTrigger:["\\tanh"],parse:B("Tanh")},{latexTrigger:["\\th"],parse:B("Tanh")},{name:"Cos",latexTrigger:["\\cos"],parse:B("Cos")},{name:"Sin",latexTrigger:["\\sin"],parse:B("Sin")}];var Xu=[{name:"AlgebraicNumbers",latexTrigger:"\\overline\\Q"},{latexTrigger:"\\bar\\Q",parse:"AlgebraicNumbers"},{name:"ComplexNumbers",latexTrigger:["\\C"]},{latexTrigger:"\\mathbb{C}",parse:"ComplexNumbers"},{name:"ImaginaryNumbers",latexTrigger:["\\imaginaryI","\\R"]},{name:"EmptySet",latexTrigger:["\\emptyset"]},{latexTrigger:["\\varnothing"],parse:"EmptySet"},{name:"Integers",latexTrigger:["\\Z"]},{latexTrigger:"\\mathbb{Z}",parse:"Integers"},{name:"RationalNumbers",latexTrigger:["\\Q"]},{latexTrigger:"\\mathbb{Q}",parse:"RationalNumbers"},{name:"RealNumbers",latexTrigger:["\\R"]},{latexTrigger:"\\mathbb{R}",parse:"RealNumbers"},{name:"TranscendentalNumbers",latexTrigger:"\\R-\\bar\\Q"},{latexTrigger:"\\R\\backslash\\bar\\Q",parse:"TranscendentalNumbers"},{name:"NegativeNumbers",latexTrigger:"\\R_{<0}"},{latexTrigger:"\\R^-",parse:"NegativeNumbers"},{latexTrigger:"\\R^{-}",parse:"NegativeNumbers"},{latexTrigger:"\\R^-",parse:"NegativeNumbers"},{latexTrigger:"\\R_-",parse:"NegativeNumbers"},{latexTrigger:"\\R_{-}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{\\lt}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{<}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{\\lt0}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{<0}",parse:"NegativeNumbers"},{name:"NonPositiveNumbers",latexTrigger:"\\R_{\\le0}"},{latexTrigger:"\\R^{\\leq0}",parse:"NonPositiveNumbers"},{latexTrigger:"\\R^{-0}",parse:"NonPositiveNumbers"},{latexTrigger:"\\R^{\\leq}",parse:"NonPositiveNumbers"},{latexTrigger:"\\R^{0-}",parse:"NonPositiveNumbers"},{name:"PositiveNumbers",latexTrigger:"\\R_{>0}"},{latexTrigger:"\\R^+",parse:"PositiveNumbers"},{latexTrigger:"\\R^{+}",parse:"PositiveNumbers"},{latexTrigger:"\\R_+",parse:"PositiveNumbers"},{latexTrigger:"\\R_{+}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{\\gt}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{\\gt 0}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{>}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{>0}",parse:"PositiveNumbers"},{name:"NonNegativeNumbers",latexTrigger:"\\R_{\\geq0}"},{latexTrigger:"\\R^{0+}",parse:"NonNegativeNumbers"},{latexTrigger:"\\R^{\\geq}",parse:"NonNegativeNumbers"},{name:"ExtendedRealNumbers",latexTrigger:"\\overline\\R"},{latexTrigger:"\\bar\\R",parse:"ExtendedRealNumbers"},{name:"NegativeIntegers",latexTrigger:"\\Z_{<0}"},{latexTrigger:"\\Z_{\\lt0}",parse:"NegativeIntegers"},{latexTrigger:"\\Z^-",parse:"NegativeIntegers"},{latexTrigger:"\\Z^{-}",parse:"NegativeIntegers"},{latexTrigger:"\\Z_-",parse:"NegativeIntegers"},{latexTrigger:"\\Z_{-}",parse:"NegativeIntegers"},{latexTrigger:"\\Z^{\\lt}",parse:"NegativeIntegers"},{name:"NonPositiveIntegers",latexTrigger:"\\Z_{\\le0}"},{latexTrigger:"\\Z_{\\leq0}",parse:"NonPositiveIntegers"},{latexTrigger:"\\Z_{<0}",parse:"NonPositiveIntegers"},{name:"PositiveIntegers",latexTrigger:"\\N^*"},{latexTrigger:"\\Z_{>0}",parse:"PositiveIntegers"},{latexTrigger:"\\Z_{\\gt0}",parse:"PositiveIntegers"},{latexTrigger:"\\Z^{+}",parse:"PositiveIntegers"},{latexTrigger:"\\Z_+",parse:"PositiveIntegers"},{latexTrigger:"\\Z_{+}",parse:"PositiveIntegers"},{latexTrigger:"\\Z^{\\gt}",parse:"PositiveIntegers"},{latexTrigger:"\\Z^{\\gt0}",parse:"PositiveIntegers"},{latexTrigger:"\\N^+",parse:"PositiveIntegers"},{latexTrigger:"\\N^{+}",parse:"PositiveIntegers"},{latexTrigger:"\\N^*",parse:"PositiveIntegers"},{latexTrigger:"\\N^{*}",parse:"PositiveIntegers"},{latexTrigger:"\\N^\\star",parse:"PositiveIntegers"},{latexTrigger:"\\N^{\\star}",parse:"PositiveIntegers"},{latexTrigger:"\\N_1",parse:"PositiveIntegers"},{latexTrigger:"\\N_{1}",parse:"PositiveIntegers"},{name:"NonNegativeIntegers",latexTrigger:["\\N"]},{latexTrigger:"\\Z^{+0}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{\\geq}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{\\geq0}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{0+}",parse:"NonNegativeIntegers"},{latexTrigger:"\\mathbb{N}",parse:"NonNegativeIntegers"},{latexTrigger:"\\N_0",parse:"NonNegativeIntegers"},{latexTrigger:"\\N_{0}",parse:"NonNegativeIntegers"},{name:"ExtendedIntegers",latexTrigger:"\\overline\\Z"},{latexTrigger:"\\bar\\Z",parse:"ExtendedIntegers"},{name:"ExtendedRationalNumbers",latexTrigger:"\\overline\\Q"},{latexTrigger:"\\bar\\Q",parse:"ExtendedRationalNumbers"},{name:"ExtendedComplexNumbers",latexTrigger:"\\overline\\C"},{latexTrigger:"\\bar\\C",parse:"ExtendedComplexNumbers"},{latexTrigger:["^","\\complement"],kind:"postfix",parse:(n,e)=>["Complement",e]},{name:"Complement",latexTrigger:["^","<{>","\\complement","<}>"],kind:"postfix"},{name:"Intersection",latexTrigger:["\\cap"],kind:"infix",precedence:350},{name:"Interval",serialize:Qu},{name:"Multiple",serialize:Qu},{name:"Union",latexTrigger:["\\cup"],kind:"infix",precedence:350},{name:"Set",kind:"matchfix",openTrigger:"{",closeTrigger:"}",parse:(n,e)=>Y(e)?"EmptySet":(h(e)=="Delimiter"&&F(m(e,2))===","&&(e=m(e,1)),h(e)!=="Sequence"?["Set",e]:["Set",...N(e)]),serialize:(n,e)=>v(["\\lbrace",N(e).map(t=>n.serialize(t)).join(", "),"\\rbrace"])},{name:"SetMinus",latexTrigger:["\\setminus"],kind:"infix",precedence:650},{name:"SymmetricDifference",latexTrigger:["\\triangle"],kind:"infix",precedence:L},{latexTrigger:["\\ni"],kind:"infix",associativity:"none",precedence:160,parse:(n,e,t)=>{let i=n.parseExpression(t);return i===null?null:["Element",i,e]}},{name:"Element",latexTrigger:["\\in"],kind:"infix",precedence:240},{name:"NotElement",latexTrigger:["\\notin"],kind:"infix",precedence:240},{name:"NotSubset",latexTrigger:["\\nsubset"],kind:"infix",associativity:"none",precedence:240},{name:"NotSuperset",latexTrigger:["\\nsupset"],kind:"infix",associativity:"none",precedence:240},{name:"NotSubsetNotEqual",latexTrigger:["\\nsubseteq"],kind:"infix",associativity:"none",precedence:240},{name:"NotSupersetNotEqual",latexTrigger:["\\nsupseteq"],kind:"infix",associativity:"none",precedence:240},{name:"SquareSubset",latexTrigger:["\\sqsubset"],kind:"infix",associativity:"none",precedence:265},{name:"SquareSubsetEqual",latexTrigger:["\\sqsubseteq"],kind:"infix",associativity:"none",precedence:265},{name:"SquareSuperset",latexTrigger:["\\sqsupset"],kind:"infix",associativity:"none",precedence:265},{name:"SquareSupersetEqual",latexTrigger:["\\sqsupseteq"],kind:"infix",associativity:"none",precedence:265},{name:"Subset",latexTrigger:["\\subset"],kind:"infix",associativity:"none",precedence:240},{latexTrigger:["\\subsetneq"],kind:"infix",associativity:"none",precedence:240,parse:"Subset"},{latexTrigger:["\\varsubsetneqq"],kind:"infix",associativity:"none",precedence:240,parse:"Subset"},{name:"SubsetEqual",latexTrigger:["\\subseteq"],kind:"infix",associativity:"none",precedence:240},{name:"Superset",latexTrigger:["\\supset"],kind:"infix",associativity:"none",precedence:240},{latexTrigger:["\\supsetneq"],kind:"infix",associativity:"none",precedence:240,parse:"Superset"},{latexTrigger:["\\varsupsetneq"],kind:"infix",associativity:"none",precedence:240,parse:"Superset"},{name:"SupersetEqual",latexTrigger:["\\supseteq"],kind:"infix",associativity:"none",precedence:240}];function Qu(n,e){if(e===null)return"";let t=h(e);if(!t)return"";if(t==="Set")return J(e)===0?"\\emptyset":J(e)===2&&h(m(e,2))==="Condition"?v(["\\left\\lbrace",n.serialize(m(e,1)),"\\middle\\mid",n.serialize(m(e,2)),"\\right\\rbrace"]):v(["\\left\\lbrace",...N(e).map(r=>n.serialize(r)+" ,"),"\\right\\rbrace"]);if(t==="Range")return v(["\\mathopen\\lbrack",n.serialize(m(e,1)),", ",n.serialize(m(e,2)),"\\mathclose\\rbrack"]);if(t==="Interval"){let r=m(e,1),o=m(e,2),s=!1,a=!1;return h(r)==="Open"&&(r=m(r,1),s=!0),h(o)==="Open"&&(o=m(o,1),a=!0),v([`\\mathopen${s?"\\rbrack":"\\lbrack"}`,n.serialize(r),", ",n.serialize(o),`\\mathclose${a?"\\lbrack":"\\rbrack"}`])}let i=n.numericSetStyle(e,n.level);return""}function ri(n){return e=>{let t=!1,i=[],r=[];for(;!t;){e.skipVisualSpace(),e.match("\\limits"),e.skipSpace();let a=null,u=null;for(;!(u!==null&&a!==null)&&(e.peek==="_"||e.peek==="^");)e.match("_")?u=e.parseGroup()??e.parseToken():e.match("^")&&(a=e.parseGroup()??e.parseToken()),e.skipSpace();Y(u)&&(u=null),Y(a)&&(a=null),i.push(u??"Nothing"),r.push(a??"Nothing"),e.skipVisualSpace(),t=!e.match(n)}let[o,s]=Np(e);if(o&&s.length===0){if(h(o)==="Add"||h(o)==="Subtract"){let a=[],u=[];for(let l of N(o))if(s)u.push(l);else{let c;[c,s]=Jn(l),a.push(c??l)}if(s!==null&&u.length>0)return["Add",Ku(n,["Add",...a],{indexes:s,subs:i,sups:r})??"Nothing",...u]}else if(h(o)==="Divide"){let a;[a,s]=Jn(m(o,1)),a!==null&&s!==null&&(o=["Divide",a,m(o,2)])}}return Ku(n,o,{indexes:s,subs:i,sups:r})}}function Ku(n,e,t){if(!e)return null;if(t.sups.length===0&&t.subs.length===0)return[n,e,...t.indexes];let i=t.indexes.length===0?h(e)==="Function"?N(e).slice(1):[]:t.indexes,r=Math.max(t.sups.length,t.subs.length,i.length);if(i.length===0)for(let s=0;s<r;s++)i.push("Nothing");else if(i.length!==r)for(let s=i.length;s<r;s++)i.push(["Error","'missing'"]);if(t.subs.length!==r)for(let s=t.subs.length;s<r;s++)t.subs.push("Nothing");if(t.sups.length!==r)for(let s=t.sups.length;s<r;s++)t.sups.push("Nothing");let o=i.map((s,a)=>{let u=t.sups[a],l=t.subs[a];return l==="Nothing"&&u==="Nothing"?s:["Tuple",s,l,u]});return[n,e,...o]}function Np(n){let e=!1,t=n.parseExpression({minPrec:266,condition:()=>{let i=n.index;return e=tl(n),n.index=i,e}});return t!==null&&!e?Jn(t):[t,_p(n)]}function _p(n){let e=[];for(;tl(n);){n.skipVisualSpace();let t=T(n.parseSymbol());if(t===null)return e;e.push(t)}return e}function Jn(n){let e=h(n),t=m(n,1);if(!t)return[n,[]];if(e==="Sequence"&&J(n)===1)return Jn(t);if(e==="Multiply"||e==="InvisibleOperator"){let i=N(n);if(i){let[r,o]=Sp(i);return r.length>0?[[e,...r],o]:[null,o]}}else if(e==="Delimiter"){let[i,r]=Jn(t);if(r)return i?[["Delimiter",["Sequence",i],...N(n).slice(1)],r]:[null,r]}else if(e==="Add"){let i=N(n);if(i.length>0){let[r,o]=Jn(i[i.length-1]);if(o.length>0){if(r)return[["Add",...i.slice(0,-1),r],o];if(i.length>2)return[["Add",...i.slice(0,-1)],o];if(i.length>2)return[i[0],o]}}}else if(e==="Negate"){let[i,r]=Jn(t);if(r.length>0)return[i?["Negate",i]:null,r]}else if(e==="Divide"){let[i,r]=Jn(t);if(r.length>0)return[["Divide",i??1,m(n,2)],r]}else{let i=N(n);if(i.length===1){let[r,o]=Jn(i[0]);if(o.length>0)return[[h(n),r],o]}}return[n,[]]}function el(n){return(e,t)=>{if(!m(t,1))return n;let i=m(t,1),r=[];h(i)==="BuiltInFunction"?(r=["x"],i=[m(i,1),"x"]):h(i)==="Function"?(r=N(i).slice(1),i=m(i,1)):T(i)?r=[]:r=[];let o=N(t).slice(1),s=[],a=o.map((l,c)=>{if(T(l)==="Nothing")return s.push(T(r[c])??"Nothing"),"";if(T(l))return s.push(T(l)??"Nothing"),"";let f=h(l);if(f==="Tuple"||f==="Pair"||f==="Limits"||f==="Range"){if(J(l)===3){let d=m(l,1);s.push(T(d)??"Nothing");let p=m(l,2),x=m(l,3);return T(p)==="Nothing"&&(p=null),T(x)==="Nothing"&&(x=null),p!==null&&x!==null?`_{${e.serialize(p)}}^{${e.serialize(x)}}`:p!==null?`_{${e.serialize(p)}}`:x!==null?`^{${e.serialize(x)}}`:""}return`_{${e.serialize(l)}}`}if(J(l)===2){if(T(m(l,1))){s.push(T(m(l,1))??"Nothing");let x=m(l,2);return T(x)==="Nothing"?"":`_{${e.serialize(x)}}`}s.push(T(r[c])??"Nothing");let d=m(l,1),p=m(l,2);if(T(d)==="Nothing"&&(d=null),T(p)==="Nothing"&&(p=null),d!==null&&p!==null)return`_{${e.serialize(d)}}^{${e.serialize(p)}}`;if(d!==null)return`_{${e.serialize(d)}}`;if(p!==null)return`^{${e.serialize(p)}}`}else s.push(T(r[c])??"Nothing")}),u=s.filter(l=>T(l)!=="Nothing").map(l=>`\\mathrm{d}${e.serialize(T(l)??"x")}`);return u.length>0&&(u=["\\,",...u]),a.length===0?`${n}\\,${e.serialize(i)}\\!${u.join(" ")}`:a.reverse().map(l=>`${n}${l}`).join("")+"\\!"+e.serialize(i)+u.join(" ")}}var nl=[{kind:"expression",name:"Integrate",latexTrigger:["\\int"],parse:ri("Integrate"),serialize:el("\\int")},{kind:"expression",latexTrigger:["\\iint"],parse:ri("Integrate")},{kind:"expression",latexTrigger:["\\iiint"],parse:ri("Integrate")},{kind:"expression",name:"CircularIntegrate",latexTrigger:["\\oint"],parse:ri("CircularIntegrate"),serialize:el("\\oint")},{kind:"expression",latexTrigger:["\\oiint"],parse:ri("CircularIntegrate")},{kind:"expression",latexTrigger:["\\oiiint"],parse:ri("CircularIntegrate")}];function tl(n){let e=n.index;for(;n.match("\\cdot")||n.skipVisualSpace(););return n.matchAll(["\\mathrm","<{>","d","<}>"])||n.matchAll(["\\operatorname","<{>","d","<}>"])||n.match("d")||n.match("\\differentialD")?!0:(n.index=e,!1)}function Sp(n){let e=[...n],t=[];for(;e.length>0;){let i;if([e,i]=Tp(e),!i)break;t.push(i)}return[e,t]}function Tp(n){if(n.length<2)return[n,""];let e=n[n.length-2];if(e==="d"||e==="d_upright"){let t=T(n[n.length-1]);if(t)return[n.slice(0,-2),t]}return[n,""]}var Nn=[["alpha","\\alpha",945],["beta","\\beta",946],["gamma","\\gamma",947],["delta","\\delta",948],["epsilon","\\epsilon",949],["epsilonSymbol","\\varepsilon",1013],["zeta","\\zeta",950],["eta","\\eta",951],["theta","\\theta",952],["thetaSymbol","\\vartheta",977],["iota","\\iota",953],["kappa","\\kappa",954],["kappaSymbol","\\varkappa",1008],["lambda","\\lambda",955],["mu","\\mu",956],["nu","\\nu",957],["xi","\\xi",958],["omicron","\\omicron",959],["pi","\\pi",960],["piSymbol","\\varpi",982],["rho","\\rho",961],["rhoSymbol","\\varrho",1009],["sigma","\\sigma",963],["finalSigma","\\varsigma",962],["tau","\\tau",964],["phi","\\phi",981],["phiLetter","\\varphi",966],["upsilon","\\upsilon",965],["chi","\\chi",967],["psi","\\psi",968],["omega","\\omega",969],["Alpha","\\Alpha",913],["Beta","\\Beta",914],["Gamma","\\Gamma",915],["Delta","\\Delta",916],["Epsilon","\\Epsilon",917],["Zeta","\\Zeta",918],["Eta","\\Eta",919],["Theta","\\Theta",920],["Iota","\\Iota",921],["Kappa","\\Kappa",922],["Lambda","\\Lambda",923],["Mu","\\Mu",924],["Nu","\\Nu",925],["Xi","\\Xi",926],["Omicron","\\Omicron",927],["Rho","\\Rho",929],["Sigma","\\Sigma",931],["Tau","\\Tau",932],["Phi","\\Phi",934],["Upsilon","\\Upsilon",933],["Chi","\\Chi",935],["Psi","\\Psi",936],["Omega","\\Omega",937],["digamma","\\digamma",989],["aleph","\\aleph",8501],["bet","\\beth",8502],["gimel","\\gimel",8503],["dalet","\\daleth",8504],["ell","\\ell",8499],["turnedCapitalF","\\Finv",8498],["turnedCapitalG","\\Game",8513],["weierstrass","\\wp",8472],["eth","\\eth",240],["invertedOhm","\\mho",8487],["hBar","\\hbar",295],["hSlash","\\hslash",8463],["blackClubSuit","\\clubsuit",9827],["whiteHeartSuit","\\heartsuit",9825],["blackSpadeSuit","\\spadesuit",9824],["whiteDiamondSuit","\\diamondsuit",9826],["sharp","\\sharp",9839],["flat","\\flat",9837],["natural","\\natural",9838]],il=[...Nn.map(([n,e,t])=>({kind:"symbol",name:n,latexTrigger:[e],parse:n})),...Nn.map(([n,e,t])=>({kind:"symbol",latexTrigger:[String.fromCodePoint(t)],parse:n}))];var rl=[{name:"Real",kind:"function",latexTrigger:["\\Re"]},{name:"Imaginary",kind:"function",latexTrigger:["\\Im"]},{name:"Argument",kind:"function",latexTrigger:["\\arg"]},{name:"Conjugate",latexTrigger:["^","\\star"],kind:"postfix"}];var ol=[{name:"Mean",kind:"function",symbolTrigger:"mean"},{name:"Median",kind:"function",symbolTrigger:"median"},{name:"StandarDeviation",kind:"function",symbolTrigger:"stddev"},{latexTrigger:["\\bar"],kind:"expression",parse:(n,e)=>{let t=n.parseGroup()??n.parseToken();return!t||!T(t)?null:["Mean",t]}}];var sl={"(":"(",")":")","[":"\\lbrack","]":"\\rbrack","{":"\\lbrace","}":"\\rbrace","<":"\\langle",">":"\\rangle","|":"\\vert","||":"\\Vert","\\lceil":"\\lceil","\\lfloor":"\\lfloor","\\rceil":"\\rceil","\\rfloor":"\\rfloor"};function al(n,e,t){let i=Bp(e,t);if(i===null)return;let r="kind"in e?e.kind:"expression",o=i.latexTrigger;typeof o=="string"&&(n.lookahead=Math.max(n.lookahead,Jr(o)));let s=Ee(o??"");if(s.length===2&&/[_^]/.test(s[0])&&s[1]!=="<{>"&&r!=="function"&&r!=="environment"&&r!=="matchfix"){let a=e.parse;!a&&e.name&&(r==="postfix"||r==="prefix"?a=(u,l)=>[e.name,l]:a=e.name),al(n,{...e,kind:r,name:void 0,serialize:void 0,parse:a,latexTrigger:[s[0],"<{>",s[1],"<}>"]},t)}n.defs.push(i),i.name!==void 0&&(n.ids.has(i.name)&&t({severity:"warning",message:["invalid-dictionary-entry",i.name,"Duplicate definition. The name (MathJSON symbol) must be unique, but triggers can be shared by multiple definitions."]}),n.ids.set(i.name,i))}function Es(n,e){let t={lookahead:1,ids:new Map,defs:[]};for(let i of n)al(t,i,e);return t}function Bp(n,e){if(!kp(n,e))return null;let t={kind:"kind"in n?n.kind:"expression"},i=null;"latexTrigger"in n&&(typeof n.latexTrigger=="string"?i=Ee(n.latexTrigger):i=n.latexTrigger);let r=null;"symbolTrigger"in n&&(r=n.symbolTrigger),i!==null&&(t.latexTrigger=En(i)),r!==null&&(t.symbolTrigger=r),n.name&&(t.name=n.name,t.serialize=Ip(n,i,r)),t.kind==="matchfix"&&Fi(n)&&(t.openTrigger=n.openTrigger,t.closeTrigger=n.closeTrigger),t.kind==="symbol"&&wu(n)&&(t.precedence=n.precedence??1e4),t.kind==="expression"&&Iu(n)&&(t.precedence=n.precedence??1e4),(t.kind==="prefix"||t.kind==="postfix")&&(Yr(n)||gs(n))&&(i&&(i[0]==="^"||i[0]==="_")?(t.precedence=720,n.precedence):t.precedence=n.precedence??1e4),t.kind==="infix"&&ms(n)&&(!i||i[0]!=="^"&&i[0]!=="_"||!n.associativity||n.associativity,t.associativity=n.associativity??"none",t.precedence=n.precedence??1e4);let o=wp(n,i,r);return o&&(t.parse=o),t}function Ip(n,e,t){if(typeof n.serialize=="function")return n.serialize;let i=n.kind??"expression";if(i==="environment"){let s=n.symbolTrigger??n.name??"unknown";return(a,u)=>v([`\\begin{${s}}`,a.serialize(m(u,1)),`\\end{${s}}`])}if(Fi(n)){let s=typeof n.openTrigger=="string"?sl[n.openTrigger]:En(n.openTrigger),a=typeof n.closeTrigger=="string"?sl[n.closeTrigger]:En(n.closeTrigger);return(u,l)=>v([s,u.serialize(m(l,1)),a])}let r=n.serialize;if(r===void 0&&e&&(r=En(e)),r)return i==="postfix"?(s,a)=>v([s.serialize(m(a,1)),r]):i==="prefix"?(s,a)=>v([r,s.serialize(m(a,1))]):i==="infix"?(s,a)=>{let u=J(a);if(u===0)return"";let l=n.precedence??1e4;return v(N(a).flatMap((c,f)=>{let d=s.wrap(c,l+1);return f<u-1?[d,r]:[d]}))}:(s,a)=>h(a)?v([r,s.wrapArguments(a)]):r;let o=t??n.name??"unknown";return i==="postfix"?(s,a)=>v([s.serialize(m(a,1)),s.serializeSymbol(o)]):i==="prefix"?(s,a)=>v([s.serializeSymbol(o),s.serialize(m(a,1))]):i==="infix"?(s,a)=>v([s.serialize(m(a,1)),s.serializeSymbol(o),s.serialize(m(a,2))]):(s,a)=>h(a)?v([s.serializeSymbol(o),s.wrapArguments(a)]):s.serializeSymbol(o)}function wp(n,e,t){if("parse"in n&&typeof n.parse=="function")return n.parse;let i=("kind"in n?n.kind:"expression")??"expression";if(i==="environment"){let r=n.parse??n.name??t;if(r)return(o,s)=>{let a=o.parseTabular();return a===null?null:[r,["List",a.map(u=>["List",...u])]]}}if(i==="function"){let r=n.parse??n.name??t;if(r)return(o,s)=>{let a=o.parseArguments("enclosure",s);return a===null?r:[r,...a]}}if(i==="symbol"){let r=n.parse??n.name??t;if(r)return(o,s)=>r}if(i==="prefix"){let r=n.parse??n.name??t;if(r){let o=n.precedence??1e4;return(s,a)=>{let u=s.parseExpression({...a??[],minPrec:o});return u===null?null:[r,u]}}}if(i==="postfix"){let r=n.parse??n.name;if(r)return(o,s)=>s===null?null:[r,s]}if(i==="infix"){if(/[_^]/.test(e?.[0]??"")){let o=n.name??n.parse;return(s,a)=>[o,V(m(a,1)),V(m(a,2))]}let r=n.parse??n.name??t;if(r){let o=n.precedence??1e4,s=n.associativity??"none";return s==="none"?(a,u,l)=>{if(u===null)return null;let c=V(a.parseExpression({...l,minPrec:o}));return[r,u,c]}:s==="left"?(a,u,l)=>{if(u===null)return null;let c=V(a.parseExpression({...l,minPrec:o+1}));return typeof r!="string"?[r,u,c]:[r,u,c]}:s==="right"?(a,u,l)=>{if(u===null)return null;let c=V(a.parseExpression({...l,minPrec:o}));return typeof r!="string"?[r,u,c]:[r,u,c]}:(a,u,l)=>{if(u===null)return null;let c=V(a.parseExpression({...l,minPrec:o}));return typeof r!="string"?[r,u,c]:Kt(r,u,c)}}}if(i==="matchfix"){let r=n.parse??n.name;if(r)return(o,s)=>Y(s)?null:[r,s]}if(i==="expression"){let r=n.parse??n.name??t;if(r)return()=>r}if("parse"in n){let r=n.parse;return()=>r}}function kp(n,e){let t=n.name??n.latexTrigger??n.symbolTrigger??n.openTrigger;if(!t)try{t=JSON.stringify(n)}catch{t="???"}if(Array.isArray(t)&&(t=En(t)),"trigger"in n&&e({severity:"warning",message:["invalid-dictionary-entry",t,"The 'trigger' property is deprecated. Use 'latexTrigger' or 'symbolTrigger' instead"]}),"kind"in n&&!["expression","symbol","function","infix","postfix","prefix","matchfix","environment"].includes(n.kind)&&e({severity:"warning",message:["invalid-dictionary-entry",t,"The 'kind' property must be one of 'expression', 'symbol', 'function', 'infix', 'postfix', 'prefix', 'matchfix', 'environment'"]}),n.serialize!==void 0&&!n.name)return e({severity:"warning",message:["invalid-dictionary-entry",t,"A 'name' property must be provided if a 'serialize' handler is provided"]}),!1;if("symbolTrigger"in n&&(!("kind"in n)||n.kind!=="environment")&&(typeof n.symbolTrigger!="string"||!Te(n.symbolTrigger))&&e({severity:"warning",message:["invalid-dictionary-entry",t,"The 'symbolTrigger' property must be a valid symbol"]}),"name"in n&&(typeof n.name!="string"?n.name!==void 0&&e({severity:"warning",message:["invalid-dictionary-entry",t,"The 'name' property must be a string"]}):Te(n.name)||e({severity:"warning",message:["invalid-dictionary-entry",n.name,"The 'name' property must be a valid symbol"]})),Fi(n)){if("latexTrigger"in n||"symbolTrigger"in Yr)return e({severity:"warning",message:["invalid-dictionary-entry",t,"'matchfix' operators use a 'openTrigger' and 'closeTrigger' instead of a 'latexTrigger' or 'symbolTrigger'. "]}),!1;if(!n.openTrigger||!n.closeTrigger)return e({severity:"warning",message:["invalid-dictionary-entry",t,"Expected `openTrigger` and a `closeTrigger` for matchfix operator"]}),!1;if(typeof n.openTrigger!=typeof n.closeTrigger)return e({severity:"warning",message:["invalid-dictionary-entry",t,"Expected `openTrigger` and `closeTrigger` to both be strings or array of LatexToken"]}),!1}if(ms(n)||gs(n)||Yr(n)){if(Array.isArray(n.latexTrigger)&&(n.latexTrigger[0]==="_"||n.latexTrigger[0]==="^")||typeof n.latexTrigger=="string"&&(n.latexTrigger.startsWith("^")||n.latexTrigger.startsWith("_"))){if(n.precedence!==void 0||n.associativity!==void 0)return e({severity:"warning",message:["invalid-dictionary-entry",t,'Unexpected "precedence" or "associativity" for superscript/subscript operator']}),!1}else if(n.precedence===void 0)return e({severity:"warning",message:["invalid-dictionary-entry",t,`Expected a "precedence" for ${n.kind} operator`]}),!1}else if(n.associativity!==void 0)return e({severity:"warning",message:["invalid-dictionary-entry",t,'Unexpected "associativity" operator']}),!1;return!Fi(n)&&!ku(n)&&!n.latexTrigger&&!n.symbolTrigger&&!n.name?(e({severity:"warning",message:["invalid-dictionary-entry",t,"Expected a 'name', a 'latexTrigger' or a 'symbolTrigger'"]}),!1):n.parse===void 0&&n.name===void 0?(e({severity:"warning",message:["invalid-dictionary-entry",t,"Expected a 'parse' or 'name'"]}),!1):!0}var Ui={symbols:il,algebra:Cu,arithmetic:Gu,calculus:nl,complex:rl,core:Uu,"linear-algebra":Hu,logic:Wu,relop:_t,other:Ju,physics:[{name:"mu0",kind:"symbol",latexTrigger:"\\mu_0"}],sets:Xu,statistics:ol,trigonometry:Yu};function ul(n="all"){if(n==="all"){let e=[];for(let t of Object.keys(Ui))Ui[t]&&e.push(...Ui[t]);return e}return Ui[n]?Object.freeze([...Ui[n]]):[]}var Cp={"\\mathord":"","\\mathop":"","\\mathbin":"","\\mathrel":"","\\mathopen":"","\\mathclose":"","\\mathpunct":"","\\mathinner":"","\\operatorname":"","\\mathrm":"_upright","\\mathit":"_italic","\\mathbf":"_bold","\\mathscr":"_script","\\mathcal":"_calligraphic","\\mathfrak":"_fraktur","\\mathsf":"_sansserif","\\mathtt":"_monospace","\\mathbb":"_doublestruck"},Ap={"\\mathring":"_ring","\\hat":"_hat","\\tilde":"_tilde","\\vec":"_vec","\\overline":"_bar","\\underline":"_underbar","\\dot":"_dot","\\ddot":"_ddot","\\dddot":"_dddot","\\ddddot":"_ddddot","\\acute":"_acute","\\grave":"_grave","\\breve":"_breve","\\check":"_check"};function ll(n,e){if(n.atEnd)return null;let t=n.peek,i={"\\_":"_","\\#":"hash"}[t];if(!i&&!e.toplevel&&(i={"+":"plus","-":"minus","\\plusmn":"pm","\\pm":"pm","\\ast":"ast","\\dag":"dag","\\ddag":"ddag","\\bot":"bottom","\\top":"top","\\bullet":"bullet","\\cir":"circle","\\diamond":"diamond","\\times":"times","\\square":"square","\\star":"star"}[t]),i)return n.nextToken(),i;let r=Nn.findIndex(o=>o[1]===t);return r>=0?(n.nextToken(),Nn[r][0]):n.parseChar()??n.nextToken()}function Xr(n){let e=vs(n),t=Ap[n.peek]??null;if(t){if(n.nextToken(),!n.match("<{>"))return null;let o=Xr(n);if(o===null||!n.match("<}>"))return null;e=`${o}${t}`}if(e===null){for(e="";!n.atEnd;){let o=n.peek;if(o==="<}>"||o==="_"||o==="^")break;let s=ll(n,{toplevel:!1});if(s===null)return null;e+=s}for(;!n.atEnd&&/\d/.test(n.peek);)e+=n.nextToken()}for(;!n.atEnd;)if(n.match("\\degree"))e+="_deg";else if(n.matchAll(["^","\\circ"]))e+="_deg";else if(n.matchAll(["^","\\prime"]))e+="_prime";else if(n.matchAll(["^","<{>","\\prime","<}>"]))e+="_prime";else if(n.matchAll(["^","<{>","\\doubleprime","<}>"]))e+="_dprime";else if(n.matchAll(["^","<{>","\\prime","\\prime","<}>"]))e+="_dprime";else break;let i=[],r=[];for(;!n.atEnd;)if(n.match("_")){let o=n.match("<{>"),s=Xr(n);if(o&&!n.match("<}>")||s===null)return null;r.push(s)}else if(n.match("^")){let o=n.match("<{>"),s=Xr(n);if(o&&!n.match("<}>")||s===null)return null;i.push(s)}else break;return i.length>0&&(e+="__"+i.join("")),r.length>0&&(e+="_"+r.join("")),e}function vs(n){let e=Cp[n.peek]??null;if(e===null)return null;if(n.nextToken(),n.match("<{>")){let t="",i={0:"zero",1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"}[n.peek]??"";return i&&(t=i,n.nextToken()),t+=Xr(n),t===null||!n.match("<}>")?null:e==="_upright"&&t.length>1?t:t+e}return null}function Ns(n){let e=n.index,t=vs(n);return t===null||Te(t)?null:n.error(["invalid-symbol",{str:nn(t)}],e)}function ji(n){if(/^[a-zA-Z]$/.test(n.peek)||/^\p{XIDS}$/u.test(n.peek))return n.nextToken();let e=vs(n);if(!e){for(e="";!n.atEnd&&Wt.test(e+n.peek);)e+=n.nextToken();e||(e=null)}let t=n.index;return e??=ll(n,{toplevel:!0}),e&&(e=e.normalize(),Te(e))?e:(n.index=t,null)}var Dp={"(":["\\lparen","("],")":["\\rparen",")"],"[":["\\lbrack","\\[","["],"]":["\\rbrack","\\]","]"],"<":["<","\\langle"],">":[">","\\rangle"],"{":["\\{","\\lbrace"],"}":["\\}","\\rbrace"],":":[":","\\colon"],"|":["|","\\|","\\lvert","\\rvert"],"||":["||","\\Vert","\\lVert","\\rVert"]},Ss={"\\left":"\\right","\\bigl":"\\bigr","\\Bigl":"\\Bigr","\\biggl":"\\biggr","\\Biggl":"\\Biggr","\\big":"\\big","\\Big":"\\Big","\\bigg":"\\bigg","\\Bigg":"\\Bigg"},Ts={"(":")","[":"]","|":"|","\\{":"\\}","\\[":"\\]","\\lbrace":"\\rbrace","\\lparen":"\\rparen","\\langle":"\\rangle","\\lfloor":"\\rfloor","\\lceil":"\\rceil","\\vert":"\\vert","\\lvert":"\\rvert","\\Vert":"\\Vert","\\lVert":"\\rVert","\\lbrack":"\\rbrack","\\ulcorner":"\\urcorner","\\llcorner":"\\lrcorner","\\lgroup":"\\rgroup","\\lmoustache":"\\rmoustache","\\llbracket":"\\rrbracket"},Bs=class{options;_index=0;symbolTable={parent:null,ids:{}};pushSymbolTable(){this.symbolTable={parent:this.symbolTable,ids:{}}}popSymbolTable(){this.symbolTable=this.symbolTable.parent??this.symbolTable}addSymbol(e,t){if(typeof t=="string"&&(t=new S(t)),e in this.symbolTable.ids&&this.symbolTable.ids[e].is(t.type))throw new Error(`Symbol ${e} already declared as a different type`);this.symbolTable.ids[e]=t}get index(){return this._index}set index(e){this._index=e,this._lastPeek="",this._peekCounter=0}_tokens;_positiveInfinityTokens;_negativeInfinityTokens;_notANumberTokens;_decimalSeparatorTokens;_wholeDigitGroupSeparatorTokens;_fractionalDigitGroupSeparatorTokens;_exponentProductTokens;_beginExponentMarkerTokens;_endExponentMarkerTokens;_truncationMarkerTokens;_imaginaryUnitTokens;_dictionary;_boundaries=[];_lastPeek="";_peekCounter=0;constructor(e,t,i){this._tokens=e,this.options=i,this._dictionary=t,this._positiveInfinityTokens=Ee(this.options.positiveInfinity),this._negativeInfinityTokens=Ee(this.options.negativeInfinity),this._notANumberTokens=Ee(this.options.notANumber),this._decimalSeparatorTokens=Ee(this.options.decimalSeparator),this._wholeDigitGroupSeparatorTokens=[],this._fractionalDigitGroupSeparatorTokens=[],this.options.digitGroupSeparator&&(typeof this.options.digitGroupSeparator=="string"?(this._wholeDigitGroupSeparatorTokens=Ee(this.options.digitGroupSeparator),this._fractionalDigitGroupSeparatorTokens=this._wholeDigitGroupSeparatorTokens):Array.isArray(this.options.digitGroupSeparator)&&(this._wholeDigitGroupSeparatorTokens=Ee(this.options.digitGroupSeparator[0]),this._fractionalDigitGroupSeparatorTokens=Ee(this.options.digitGroupSeparator[1]))),this._exponentProductTokens=Ee(this.options.exponentProduct),this._beginExponentMarkerTokens=Ee(this.options.beginExponentMarker),this._endExponentMarkerTokens=Ee(this.options.endExponentMarker),this._truncationMarkerTokens=Ee(this.options.truncationMarker),this._imaginaryUnitTokens=Ee(this.options.imaginaryUnit)}getSymbolType(e){let t=this.symbolTable;for(;t;){if(e in t.ids)return t.ids[e];t=t.parent}return this.options.getSymbolType?this.options.getSymbolType(e):S.unknown}get peek(){let e=this._tokens[this.index];if(e===this._lastPeek?this._peekCounter+=1:this._peekCounter=0,this._peekCounter>=1024){let t=`Infinite loop detected while parsing "${this.latex(0)}" at "${this._lastPeek}" (index ${this.index})`;throw console.error(t),new Error(t)}return this._lastPeek=e,e}nextToken(){return this._tokens[this.index++]}get atEnd(){return this.index>=this._tokens.length}atTerminator(e){return this.atBoundary||((e?.condition&&e.condition(this))??!1)}get atBoundary(){if(this.atEnd)return!0;let e=this.index;for(let t of this._boundaries)if(this.matchAll(t.tokens))return this.index=e,!0;return!1}addBoundary(e){this._boundaries.push({index:this.index,tokens:e})}removeBoundary(){this._boundaries.pop()}matchBoundary(){let e=this._boundaries[this._boundaries.length-1],t=e&&this.matchAll(e.tokens);return t&&this._boundaries.pop(),t}boundaryError(e){let t=this._boundaries[this._boundaries.length-1];return this._boundaries.pop(),this.error(e,t.index)}latex(e,t){return En(this._tokens.slice(e,t))}latexAhead(e){return this.latex(this.index,this.index+e)}lookAhead(){let e=Math.min(this._dictionary.lookahead,this._tokens.length-this.index);if(e<=0)return[];let t=[];for(;e>0;)t.push([e,this.latexAhead(e--)]);return t}peekDefinitions(e){if(this.atEnd)return[];let t=[],i=[...this.getDefs(e)];for(let r of i)r.latexTrigger===""&&t.push([r,0]);for(let[r,o]of this.lookAhead())for(let s of i)s.latexTrigger===o&&t.push([s,r]);for(let r of i)if(r.symbolTrigger){let o=Mp(this,r.symbolTrigger);o>0&&t.push([r,o])}return t}skipSpaceTokens(){for(;this.match("<space>"););}skipSpace(){if(!this.atEnd&&this.peek==="<{>"){let t=this.index;for(this.nextToken();this.match("<space>"););if(this.nextToken()==="<}>")return this.skipSpace(),!0;this.index=t}if(!this.options.skipSpace)return!1;let e=!1;for(;this.match("<space>");)e=!0;return e&&this.skipSpace(),e}skipVisualSpace(){this.options.skipSpace&&(this.skipSpace(),["\\!","\\,","\\:","\\;","\\enskip","\\enspace","\\space","\\quad","\\qquad"].includes(this.peek)&&(this.nextToken(),this.skipVisualSpace()),this.skipSpace())}match(e){return this._tokens[this.index]!==e?!1:(this.index++,!0)}matchAll(e){if(e.length===0)return!1;let t,i=0;do t=this._tokens[this.index+i]===e[i++];while(t&&i<e.length);return t&&(this.index+=i),t}matchAny(e){return e.includes(this._tokens[this.index])?this._tokens[this.index++]:""}parseLatexNumber(e=!0){let t=!1,i=this.peek;for(;i==="<space>"||i==="+"||i==="-";)i==="-"&&(t=!t),this.nextToken(),i=this.peek;let r=10,o=["0","1","2","3","4","5","6","7","8","9"];if(this.match("'"))r=8,o=["0","1","2","3","4","5","6","7"],e=!0;else if(this.match('"')||this.match("x"))r=16,o=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],e=!0;else if(this.match("`"))return i=this.nextToken(),i?i.startsWith("\\")&&i.length===2?(t?-1:1)*(i.codePointAt(1)??0):(t?-1:1)*(i.codePointAt(0)??0):null;let s="";for(;o.includes(this.peek);)s+=this.nextToken();if(!e&&this.match("."))for(s+=".";o.includes(this.peek);)s+=this.nextToken();let a=e?Number.parseInt(s,r):Number.parseFloat(s);return Number.isNaN(a)?null:t?-a:a}parseChar(){let e=this.index,t=0;for(;this.match("^");)t+=1;if(t<2&&(this.index=e),t>=2){let i="",r=0;for(;r!=t;){let o=this.matchAny(["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"]);if(!o)break;i+=o,r+=1}if(i.length===t)return String.fromCodePoint(Number.parseInt(i,16))}else if(this.match("\\char")){let i=Math.floor(this.parseLatexNumber()??Number.NaN);return(!Number.isFinite(i)||i<0||i>1114111)&&(i=10067),String.fromCodePoint(i)}else if(this.match("\\unicode"))if(this.skipSpaceTokens(),this.match("<{>")){let i=this.parseLatexNumber();if(this.match("<}>")&&i!==null&&i>=0&&i<=1114111)return String.fromCodePoint(i)}else{let i=this.parseLatexNumber();if(i!==null&&i>=0&&i<=1114111)return String.fromCodePoint(i)}return this.index=e,null}matchDelimiter(e,t){if(Array.isArray(e))return Array.isArray(t),this.matchAll(e)?(this.addBoundary(t),!0):!1;Array.isArray(t);let i=this.index,r=Ss[this.peek];return r&&this.nextToken(),e==="||"&&this.matchAll(["|","|"])?(this.addBoundary(["|","|"]),!0):(Dp[e]??[e]).includes(this.peek)?(e=this.nextToken(),t=Ts[e]??t,this.addBoundary(r?[r,t]:[t]),!0):(this.index=i,!1)}parseGroup(){let e=this.index;if(this.skipSpaceTokens(),this.match("<{>")){this.addBoundary(["<}>"]);let t=this.parseExpression();if(this.skipSpace(),this.matchBoundary())return t??"Nothing";for(;!this.matchBoundary()&&!this.atEnd;)this.nextToken();if(h(t)==="Error")return t;let i=this.error("expected-closing-delimiter",e);return t!==null?["InvisibleOperator",t,i]:i}return this.index=e,null}parseOptionalGroup(){let e=this.index;if(this.skipSpaceTokens(),this.match("[")){this.addBoundary(["]"]);let t=this.parseExpression();return this.skipSpace(),this.matchBoundary()?t:this.boundaryError("expected-closing-delimiter")}return this.index=e,null}parseToken(){return this.skipSpace(),[...'!"#$%&(),/;:?@[]\\`|~'.split(""),"\\left","\\bigl"].includes(this.peek)?null:/^[0-9]$/.test(this.peek)?parseInt(this.nextToken(),10):this.parseGenericExpression()??this.parseSymbol()}parseTabular(){let e=[],t=[],i=null;for(;!this.atBoundary;)if(this.skipSpace(),this.match("&"))t.push(i??"Nothing"),i=null;else if(this.match("\\\\")||this.match("\\cr"))this.skipSpace(),this.parseOptionalGroup(),i!==null&&t.push(i),e.push(t),t=[],i=null;else{let r=[],o=this.peek;for(;o!=="&"&&o!=="\\\\"&&o!=="\\cr"&&!this.atBoundary;)i=this.parseExpression({minPrec:0,condition:s=>{let a=s.peek;return a==="&"||a==="\\\\"||a==="\\cr"}}),i!==null?r.push(i):(r.push(["Error","'unexpected-token'",{str:En(o)}]),this.nextToken()),this.skipSpace(),o=this.peek;r.length>1?i=["Sequence",...r]:i=r[0]??"Nothing"}return i!==null&&t.push(i),t.length>0&&e.push(t),e}parseStringGroupContent(){let e=this.index,t="",i=0;for(;!this.atBoundary||i>0;){let r=this.nextToken();if(r==="<$>"||r==="<$$>")return this.index=e,"";r==="<{>"?(i+=1,t+="\\{"):r==="<}>"?(i-=1,t+="\\}"):r==="<space>"?t+=" ":(r[0],t+=r)}return t}parseStringGroup(e){e===void 0&&(e=!1);let t=this.index;for(;this.match("<space>"););if(this.match(e?"[":"<{>")){this.addBoundary([e?"]":"<}>"]);let i=this.parseStringGroupContent();if(this.matchBoundary())return i;this.removeBoundary()}return this.index=t,null}parseEnvironment(e){let t=this.index;if(!this.match("\\begin"))return null;let i=this.parseStringGroup()?.trim();if(!i)return this.error("expected-environment-name",t);this.addBoundary(["\\end","<{>",...i.split(""),"<}>"]);for(let r of this.getDefs("environment"))if(r.symbolTrigger===i){let o=r.parse(this,e);return this.skipSpace(),this.matchBoundary()?o!==null?this.decorate(o,t):(this.index=t,null):this.boundaryError("unbalanced-environment")}return this.parseTabular(),this.skipSpace(),this.matchBoundary()?this.error(["unknown-environment",{str:i}],t):this.boundaryError("unbalanced-environment")}parseOptionalSign(){let e=!!this.matchAny(["-","\u2212"]);for(;this.matchAny(["+","\uFE62"])||this.skipSpace();)this.matchAny(["-","\u2212"])&&(e=!e);return e?"-":"+"}parseDecimalDigits(e="whole"){let t=[],i=!1;for(;!i;){for(;/^[0-9]$/.test(this.peek);)t.push(this.nextToken()),this.skipVisualSpace();i=!0;let r=e==="whole"?this._wholeDigitGroupSeparatorTokens:this._fractionalDigitGroupSeparatorTokens;if(e!=="none"&&r.length>0){let o=this.index;this.skipVisualSpace(),this.matchAll(r)&&(this.skipVisualSpace(),/^[0-9]$/.test(this.peek)?i=!1:this.index=o)}}return t.join("")}parseSignedInteger(e){let t=this.index,i=this.parseOptionalSign(),r=this.parseDecimalDigits(e);return r?i==="-"?"-"+r:r:(this.index=t,"")}parseExponent(){let e=this.index;if(this.skipVisualSpace(),this.matchAny(["e","E"])){let t=this.parseSignedInteger("none");if(t)return t}if(this.index=e,this.match("\\times")&&(this.skipVisualSpace(),this.matchAll(["1","0"])&&(this.skipVisualSpace(),this.match("^")))){if(this.skipVisualSpace(),/^[0-9]$/.test(this.peek))return this.nextToken();if(this.match("<{>")){this.skipVisualSpace();let t=this.parseSignedInteger("whole");if(this.skipVisualSpace(),t&&this.match("<}>"))return t}}if(this.index=e,this.skipVisualSpace(),this.match("\\%"))return"-2";if(this.index=e,this.matchAll(this._exponentProductTokens)&&(this.skipVisualSpace(),this.matchAll(this._beginExponentMarkerTokens))){this.skipVisualSpace();let t=this.parseSignedInteger("none");if(this.skipVisualSpace(),t&&this.matchAll(this._endExponentMarkerTokens))return t}return this.index=e,""}parseRepeatingDecimal(){let e=this.index,t=this.options.repeatingDecimal,i="";if((t==="auto"||t==="parentheses")&&this.match("("))return i=this.parseDecimalDigits("fraction"),i&&this.match(")")?`(${i})`:(this.index=e,"");if(this.index=e,(t==="auto"||t==="parentheses")&&this.matchAll(["\\left","("]))return i=this.parseDecimalDigits("fraction"),i&&this.matchAll(["\\right",")"])?`(${i})`:(this.index=e,"");if(this.index=e,(t==="auto"||t==="vinculum")&&this.matchAll(["\\overline","<{>"]))return i=this.parseDecimalDigits("fraction"),i&&this.match("<}>")?`(${i})`:(this.index=e,"");if(this.index=e,(t==="auto"||t==="arc")&&(this.matchAll(["\\wideparen","<{>"])||this.matchAll(["\\overarc","<{>"])))return i=this.parseDecimalDigits("fraction"),i&&this.match("<}>")?`(${i})`:(this.index=e,"");if(this.index=e,t==="auto"||t==="dots"){let r=cl(this);if(r!==null){if(i=this.parseDecimalDigits("fraction"),!i)return`(${r})`;let o=cl(this);if(o!==null)return`(${r}${i}${o})`}}return this.index=e,""}parseNumber(){if(this.options.parseNumbers===!1||this.options.parseNumbers==="never")return null;let e=this.index;this.skipVisualSpace();let t=1;for(;this.peek==="-"||this.peek==="+";)this.match("-")?t=-t:this.match("+"),this.skipVisualSpace();let i="",r="",o=!1;if(this.match(".")||this.matchAll(this._decimalSeparatorTokens)){let c=this.peek;(/^[\d]$/.test(c)||Pp(this))&&(o=!0,i="0")}else i=this.parseDecimalDigits("whole");if(!i)return this.index=e,null;let s=this.index,a=!1;(o||this.match(".")||this.matchAll(this._decimalSeparatorTokens))&&(r=this.parseDecimalDigits("fraction"),a=!0);let u=!1;if(a){let c=this.parseRepeatingDecimal();c&&(r+=c,u=!0),this.match("\\ldots")||this.matchAll(this._truncationMarkerTokens)}if(a&&!r)return this.index=s,i.length<10?_s(t*parseInt(i,10)):{num:t<0?"-"+i:i};let l=this.parseExponent();if(!a&&!l&&i.length<10)return _s(t*parseInt(i,10));if(!u&&this.options.parseNumbers==="rational"){let c=parseInt(i,10);if(!r)return l?["Multiply",t*c,["Power",10,l]]:_s(t*c);let f=parseInt(r,10),d=r.length,p=c*10**d+f,x=10**d;return l?["Multiply",["Rational",t*p,x],["Power",10,l]]:["Rational",t*p,x]}return{num:(t<0?"-":"")+i+(a?"."+r:"")+(l?"e"+l:"")}}parsePrefixOperator(e){e||(e={minPrec:0}),e.minPrec||(e={...e,minPrec:0});let t=this.index;for(let[i,r]of this.peekDefinitions("prefix")){this.index=t+r;let o=i.parse(this,{...e,minPrec:i.precedence+1});if(o!==null)return o}return this.index=t,null}parseInfixOperator(e,t){t??={minPrec:0},t.minPrec,t.minPrec===void 0&&(t={...t,minPrec:0});let i=this.index;for(let[r,o]of this.peekDefinitions("infix"))if(r.precedence>=t.minPrec){this.index=i+o;let s=r.parse(this,e,t);if(s!==null)return s}return this.index=i,null}parseArguments(e="enclosure",t){if(this.atTerminator(t))return null;let i=this.index,r=this.parseEnclosure();if(e==="enclosure")return r===null?null:zn(r)??[];if(e==="implicit"){if(h(r)==="Delimiter"){let s=m(r,1);return h(s)==="Sequence"?N(s):s===null?[]:[s]}if(r!==null)return[r];let o=this.parseExpression({...t,minPrec:Ue});return o===null?null:[o]}return this.index=i,null}parseEnclosure(){let e=this.getDefs("matchfix"),t=this.index;for(let i of e){if(this.index=t,!this.matchDelimiter(i.openTrigger,i.closeTrigger))continue;let r=this.index;this.skipSpace();let o=this.parseExpression();if(this.skipSpace(),!this.matchBoundary()){let a=this._boundaries[this._boundaries.length-1].tokens;if(this.removeBoundary(),this.index=r,this.skipSpace(),o=this.parseExpression(),this.skipSpace(),!this.matchAll(a)){if(this.index=t,!this.atEnd)continue;return null}}let s=i.parse(this,o??"Nothing");if(s!==null)return s}return this.index=t,null}parseGenericExpression(e){if(this.atTerminator(e))return null;let t=this.index,i=null,r=this.peekDefinitions("expression")??[];for(let[o,s]of r)if(this.index=t+s,typeof o.parse=="function"){if(i=o.parse(this,e),i!==null)return i}else return o.name;return this.index=t,null}parseFunction(e){if(this.atTerminator(e))return null;let t=this.index,i=null;for(let[o,s]of this.peekDefinitions("function"))if(this.index=t+s,typeof o.parse=="function"){if(i=o.parse(this,e),i!==null)return i}else{i=o.name;break}if(i===null&&(this.index=t,i=ji(this),!this.isFunctionOperator(i)))return this.index=t,null;do{let o=this.parsePostfixOperator(i,e);if(o===null)break;i=o}while(!0);let r=this.parseArguments("enclosure",e);return r===null?i:typeof i=="string"?[i,...r]:["Apply",i,...r]}parseSymbol(e){if(this.atTerminator(e))return null;let t=this.index;for(let[r,o]of this.peekDefinitions("symbol"))if(this.index=t+o,typeof r.parse=="function"){let s=r.parse(this,e);if(s!==null)return s}else return r.name;this.index=t;let i=ji(this);return i!==null&&!this.getSymbolType(i).matches("error")?i:(this.index=t,null)}parseSupsub(e){if(this.atEnd)return e;let t=this.index;this.skipSpace();let i=[],r=[],o=t;for(;this.peek==="_"||this.peek==="^";){if(this.match("_"))if(o=this.index,this.match("_")||this.match("^"))r.push(this.error("syntax-error",o));else{let a=this.parseGroup()??this.parseToken()??this.parseStringGroup();if(a===null)return this.error("missing",t);r.push(a)}else if(this.match("^"))if(o=this.index,this.match("_")||this.match("^"))i.push(this.error("syntax-error",o));else{let a=this.parseGroup()??this.parseToken();if(a===null)return this.error("missing",t);i.push(a)}o=this.index,this.skipSpace()}if(i.length===0&&r.length===0)return this.index=t,e;let s=e;if(r.length>0){let a=[...this.getDefs("infix")].filter(u=>u.latexTrigger==="_");if(a){let u=["Subscript",s,r.length===1?r[0]:["List",...r]];for(let l of a)if(typeof l.parse=="function"?s=l.parse(this,u,{minPrec:0}):s=u,s!==null)break}}if(i.length>0){let a=[...this.getDefs("infix")].filter(u=>u.latexTrigger==="^");if(a){let u=i.filter(l=>!Y(l));if(u.length!==0){let l=u.length===1?u[0]:["List",...u],c=["Superscript",s,l];for(let f of a)if(typeof f.parse=="function"?s=f.parse(this,c,{minPrec:0}):s=c,s!==null)break}}}return s===null&&(this.index=t),s}parsePostfixOperator(e,t){if(e===null||this.atEnd)return null;let i=this.index;for(let[r,o]of this.peekDefinitions("postfix")){this.index=i+o;let s=r.parse(this,e,t);if(s!==null)return s}return this.index=i,null}parseSyntaxError(){let e=this.index;if(this.peek==="^")return this.index+=1,["Superscript",this.error("missing",e),V(this.parseGroup())];let t=this.peekDefinitions("operator");if(t.length>0){if(t=this.peekDefinitions("postfix"),t.length>0){let[a,u]=t[0];if(this.index+=u,typeof a.parse=="function"){let l=a.parse(this,this.error("missing",e));if(l!==null)return l}return this.error("unexpected-operator",e)}if(t=this.peekDefinitions("prefix"),t.length>0){let[a,u]=t[0];if(this.index+=u,typeof a.parse=="function"){let l=a.parse(this,{minPrec:0});if(l!==null)return l}return a.name?[a.name,this.parseExpression()??this.error("missing",e)]:this.error("unexpected-operator",e)}if(t=this.peekDefinitions("infix"),t.length>0){let[a,u]=t[0];this.index+=u;let l=a.parse(this,this.error("missing",e),{minPrec:0});return l!==null?l:this.error("unexpected-operator",e)}}let i=this.index,r=Ns(this);if(r!==null)return r;if(r=ji(this),r!==null)return this.error(["unexpected-symbol",{str:r}],i);let o=this.peek;if(!o)return this.error("syntax-error",e);if(Rp(this))return this.error("unexpected-delimiter",e);if(o[0]!=="\\")return this.error(["unexpected-token",{str:En(o)}],e);let s=this.nextToken();if(this.skipSpaceTokens(),s==="\\end"){let a=this.parseStringGroup();return a===null?this.error("expected-environment-name",e):this.error(["unbalanced-environment",{str:a}],e)}for(;this.match("[");){let a=0;for(;!this.atEnd&&a===0&&this.peek!=="]";)this.peek==="["&&(a+=1),this.peek==="]"&&(a-=1),this.nextToken();this.match("]")}for(;this.match("<{>");){let a=0;for(;!this.atEnd&&a===0&&this.peek!=="<}>";)this.peek==="<{>"&&(a+=1),this.peek==="<}>"&&(a-=1),this.nextToken();this.match("<}>")}return this.error(["unexpected-command",{str:En(s)}],e)}parsePrimary(e){if(this.atBoundary||this.atTerminator(e))return null;let t=null,i=this.index;if(this.match("<}>"))return this.error("unexpected-closing-delimiter",i);if(t??=this.parseGroup(),t??=this.parseNumber(),t??=this.parseEnclosure(),t??=this.parseEnvironment(e),t===null&&this.matchAll(this._positiveInfinityTokens)&&(t="PositiveInfinity"),t===null&&this.matchAll(this._negativeInfinityTokens)&&(t="NegativeInfinity"),t===null&&this.matchAll(this._notANumberTokens)&&(t="NaN"),t===null&&this.matchAll(this._imaginaryUnitTokens)&&(t="ImaginaryUnit"),t??=this.parseGenericExpression(e)??this.parseFunction(e)??this.parseSymbol(e)??Ns(this),t!==null&&Y(t))return this.parsePrimary(e);if(t!==null){t=this.decorate(t,i);let r=null,o=this.index;do{if(r=this.parsePostfixOperator(t,e),t=r??t,this.index===o&&r!==null){this.index;break}o=this.index}while(r!==null)}return t!==null&&(t=this.parseSupsub(t)),t===null&&(t=this.options.parseUnexpectedToken?.(null,this)??null,t===null&&this.peek.startsWith("\\")&&(this.nextToken(),t=this.error("unexpected-command",i))),this.decorate(t,i)}parseExpression(e){this.skipSpace();let t=this.index;if(this.atBoundary)return this.index=t,null;e??={minPrec:0},e.minPrec,e.minPrec===void 0&&(e={...e,minPrec:0});let i=this.parsePrefixOperator({...e,minPrec:0});if(i??=this.parsePrimary(e),i!==null){let r=!1;for(;!r&&!this.atTerminator(e);){this.skipSpace();let o=this.parseInfixOperator(i,e);if(o===null&&e.minPrec<=fs&&this.peekDefinitions("operator").length===0){let s=this.parseExpression({...e,minPrec:fs+1});s!==null?h(i)==="InvisibleOperator"?h(s)==="InvisibleOperator"?o=["InvisibleOperator",...N(i),...N(s)]:o=["InvisibleOperator",...N(i),s]:h(s)==="InvisibleOperator"?o=["InvisibleOperator",i,...N(s)]:o=["InvisibleOperator",i,s]:o===null&&(o=this.options.parseUnexpectedToken?.(i,this)??null)}o!==null?i=o:r=!0}}return this.decorate(i,t)}decorate(e,t){if(e===null)return null;if(!this.options.preserveLatex)return e;let i=this.latex(t,this.index);return Array.isArray(e)?e={latex:i,fn:e}:typeof e=="number"?e={latex:i,num:Number(e).toString()}:typeof e=="string"?e={latex:i,sym:e}:typeof e=="object"&&e!==null&&(e.latex=i),e}error(e,t){let i;typeof e=="string"?(e.startsWith("'"),i={str:e}):(e[0].startsWith("'"),i=["ErrorCode",{str:e[0]},...e.slice(1)]);let r=this.latex(t,this.index);return r?["Error",i,["LatexString",{str:r}]]:["Error",i]}isFunctionOperator(e){return e===null?!1:!!this.getSymbolType(e).matches("function")}*getDefs(e){if(e==="operator")for(let t=this._dictionary.defs.length-1;t>=0;t--){let i=this._dictionary.defs[t];/^prefix|infix|postfix/.test(i.kind)&&(yield i)}else for(let t=this._dictionary.defs.length-1;t>=0;t--){let i=this._dictionary.defs[t];i.kind===e&&(yield i)}}};function Mp(n,e){let t=n.index,i=ji(n)?.trim();if(i===null)return 0;let r=i!==e?0:n.index-t;return n.index=t,r}function Rp(n){let e=n.peek;return Object.values(Ts).includes(e)||Ts[e]?(n.nextToken(),!0):Ss[e]||Object.values(Ss).includes(e)?(n.nextToken(),n.nextToken(),!0):!1}function cl(n){let e=n.index;if(n.matchAll(["\\overset","<{>"])&&(n.match(".")||n.match("\\cdots"))&&n.matchAll(["<}>","<{>"])){let t=n.nextToken();if(t&&/^\d$/.test(t)&&n.match("<}>"))return t}return n.index=e,null}function Pp(n){let e=n.peek;return e==="\\overline"||e==="\\overset"||e==="\\wideparent"||e==="\\overarc"||e==="("||e==="\\left"}function fl(n,e,t){let i=new Bs(Ee(n),e,t),r=i.parseExpression();if(!i.atEnd){let o=i.parseSyntaxError();r=r!==null?["Sequence",r,o]:o}if(r??="Nothing",t.preserveLatex){if(Array.isArray(r))return{latex:n,fn:r};if(typeof r=="number")return{latex:n,num:Number(r).toString()};if(typeof r=="string"){if(Hr(r))return{latex:n,str:F(r)};if(Ge(r))return{latex:n,sym:r};if(tn(r))return{latex:n,num:r}}typeof r=="object"&&r!==null&&(r.latex=n)}return r}function _s(n){return n===0?{num:"0"}:Number.isInteger(n)&&Math.abs(n)<$?n:{num:n.toString()}}var dl=100;function pe(n){return(n.isFiniteCollection??!1)&&n.isIndexedCollection}function Lp(n,e){return typeof e=="number"?(e<0&&(e=0),{next(){return e===0?{done:!0,value:void 0}:(e--,{done:!1,value:n})}}):{next(){return{done:!1,value:n}}}}function Is(n){if(n.length===0)return{next(){return{done:!0,value:void 0}}};if(n.length===1){let r=n[0],o=r.each();if(!o){let s=!1;return{next(){return s?{done:s,value:void 0}:(s=!0,{done:!1,value:[r]})}}}return{next(){let s=o.next();return s.done?{done:!0,value:void 0}:{done:!1,value:[s.value]}}}}let e=Math.min(...n.map(r=>r.isCollection?r.xsize??1:1/0));if(e===0)return{next(){return{done:!0,value:void 0}}};let t=n.map(r=>r.isCollection?r.each():Lp(r)),i=0;return{next(){if(i>=e)return{done:!0,value:void 0};let r=t.map(o=>o.next());return i+=1,{done:!1,value:r.map(o=>o.value)}}}}function pl(n,e,t){if(!(n.isFiniteCollection!==!0||e.isFiniteCollection!==!0)){for(let i of n.each())if(e.xcontains(i)!==!0)return!1;if(t){let i=n.xsize;if(i===void 0)return!1;let r=e.xsize;if(r===void 0||i===r)return!1}return!0}}function Op(n,e){for(let t=0;t!==n.nops;t+=1)if(e(n.ops[t]))return t+1}function $p(n,e){if(n.isIndexedCollection!==!0)return;let t=1,i=n.at(t);for(;i!==void 0;){if(e(i))return t;t+=1,i=n.at(t)}}function Fp(n,e){if(n.isFiniteCollection===!0){if(n.isIndexedCollection)return n.indexWhere(t=>t.isSame(e))!==void 0;for(let t of n.each())if(t.isSame(e))return!0;return!1}}function Kr(){return{isLazy:n=>!1,count:n=>n.nops,isEmpty:n=>n.nops===0,isFinite:n=>!0,contains:(n,e)=>n.ops.some(t=>t.isSame(e)),iterator:n=>{let e=1,t=n.nops;return{next:()=>e===t+1?{value:void 0,done:!0}:(e+=1,{value:n.ops[e-1-1],done:!1})}},subsetOf:pl,at:(n,e)=>{if(typeof e=="number"&&(e<0&&(e=n.nops+e+1),!(e<1||e>n.nops)))return n.ops[e-1]},indexWhere:Op,eltsgn:n=>{},elttype:n=>n.nops===0?"unknown":n.nops===1?n.ops[0].type.type:oe(...n.ops.map(e=>e.type.type))}}function eo(n){if(!n)return;if(!n.count||!n.iterator)throw new Error('A collection must have at least an "iterator" and a "count" handler');if(n.indexWhere&&n.at===void 0)throw new Error('A collection with an "indexWhere" handler must also have an "at" handler');let e={iterator:n.iterator,count:n.count,contains:n.contains??Fp,isEmpty:n.isEmpty??(t=>{if(n.count(t)!==void 0)return n.count(t)===0}),isFinite:n.isFinite??(t=>{let i=n.count(t);if(i!==void 0)return Number.isFinite(i)}),subsetOf:n.subsetOf??pl};return n.isLazy&&(e.isLazy=n.isLazy),n.eltsgn&&(e.eltsgn=n.eltsgn),n.elttype&&(e.elttype=n.elttype),n.at&&(e.at=n.at,e.indexWhere=n.indexWhere??$p),e}function Q(n,e){let t=n.every(r=>r.isCanonical)?n:n.map(r=>r.canonical);if(e){let r=s=>s.symbol==="Nothing"||s.operator===e||s.operator==="Sequence";if(t.every(s=>!r(s)))return t;let o=[];for(let s of t)s.symbol!=="Nothing"&&(s.ops&&(s.operator===e||s.operator==="Sequence")?o.push(...Q(s.ops,e)):o.push(s));return o}if(t.every(r=>!(r.symbol==="Nothing"||r.operator==="Sequence")))return t;let i=[];for(let r of t)r.symbol!=="Nothing"&&(r.ops&&r.operator==="Sequence"?i.push(...Q(r.ops,e)):i.push(r));return i}function lt(n,e){if(!e||n.every(i=>!i.ops||i.operator!==e))return n;let t=[];for(let i of n)!i.ops||i.operator!==e?t.push(i):t.push(...lt(i.ops,e));return t.length,n.length,t.length===n.length?n:t}function ws(n){if(n.every(t=>t.operator!=="Sequence"&&t.operator!=="Delimiter"))return n;let e=[];for(let t of n)if(!t.isValid)e.push(t);else if(t.operator==="Delimiter")if(t.op1.operator==="Sequence"){let i=t.op1.ops??[];i.length===0?e.push(t.engine.box(["Tuple"])):e.push(...ws(i))}else e.push(t.op1);else t.operator==="Sequence"?t.ops&&e.push(...t.ops):e.push(t);return e}function oi(n,e){if(n===e)return!0;if(n.ops)return n.operator!==e.operator||n.nops!==e.nops?!1:n.ops.every((t,i)=>oi(t,e.ops[i]));if(n.isNumberLiteral){if(!e.isNumberLiteral)return!1;let t=n.numericValue,i=e.numericValue;return t===i?!0:typeof t=="number"?typeof i=="number"?t===i:i.eq(t):t.eq(i)}if(n.string||e.string)return n.string===e.string;if(n.symbol||e.symbol)return n.symbol===e.symbol;if(n.rank!==0){if(n.rank!==e.rank)return!1;for(let t=0;t<n.rank;t++)if(n.shape[t]!==e.shape[t])return!1;return n.tensor.equals(e.tensor)}return!1}function no(n,e){if(n.operatorDefinition?.eq){let r=n.operatorDefinition.eq(n,n.engine.box(e));if(r!==void 0)return r}if(typeof e!="number"&&e.operatorDefinition?.eq){let r=e.operatorDefinition.eq(e,n);if(r!==void 0)return r}n=n.N();let t=typeof e!="number"?e.N():n.engine.box(e);if(n.ops||t.ops){let r=n.operatorDefinition?.eq?.(n,t);return r!==void 0||(r=t.operatorDefinition?.eq?.(t,n),r!==void 0)?r:n.isSame(t)?!0:n.unknowns.length===0&&t.unknowns.length===0?n.isFinite&&t.isFinite?ml(n.sub(t).simplify().N()):n.isNaN||t.isNaN?!1:!!(n.isInfinity&&t.isInfinity&&n.sgn===t.sgn):(n=n.expand().simplify(),t=t.expand().simplify(),Vp(n,t)?oi(n,t):void 0)}if(n.symbol){let r=n.valueDefinition?.eq?.(t);if(r!==void 0)return r}if(t.symbol){let r=t.valueDefinition?.eq?.(n);if(r!==void 0)return r}if(n.symbol&&t.symbol)return n.symbol===t.symbol;let i=n.engine;if(n.isNumberLiteral&&t.isNumberLiteral)return n.isFinite&&t.isFinite?ml(n.sub(t)):n.isNaN||t.isNaN?!1:!!(n.isInfinity&&t.isInfinity&&n.sgn===t.sgn);if(i.ask(i.box(["Equal",n,t])).length>0)return!0;if(i.ask(i.box(["NotEqual",n,t])).length>0)return!1;if(!(n.unknowns.length>0||t.unknowns.length>0))return oi(n,t)}function si(n,e){if(n.isNumberLiteral){if(typeof e!="number"&&typeof e.numericValue=="number"&&(e=e.numericValue),typeof e=="number"){if(e===0){let r=n.sgn;return r===void 0?void 0:r==="zero"?"=":r==="positive"?">":r==="negative"?"<":r==="non-negative"?">=":r==="non-positive"?"<=":void 0}if(n.isNumberLiteral){let r=n.numericValue;return typeof r=="number"?Math.abs(r-e)<=n.engine.tolerance?"=":r<e?"<":">":r.eq(e)?"=":r.lt(e)?"<":">"}return}if(!e.isNumberLiteral)return;let t=n.numericValue,i=e.numericValue;return typeof t=="number"?i.eq(t)?"=":i.lt(t)?">":"<":t.eq(i)?"=":t.lt(i)?"<":">"}if(typeof e!="number"){if(n.ops||e.ops){if(n.operatorDefinition?.eq?.(n,e)!==void 0)return"=";let i=n.sub(e).N();if(!i.isNumberLiteral)return;if(typeof i.numericValue=="number")return i.numericValue===0?"=":i.numericValue<0?"<":">";let r=n.engine.tolerance;return i.numericValue.isZeroWithTolerance(r)?"=":i.numericValue.lt(0)?"<":">"}if(n.symbol){if(n.symbol===e.symbol)return"=";let t=n.valueDefinition?.cmp?.(e);return t||(n.valueDefinition?.eq?.(e)===!0?"=":void 0)}if(n.string)return e.string?n.string===e.string?"=":n.string<e.string?"<":">":void 0;if(n.tensor)return e.tensor&&n.tensor.equals(e.tensor)?"=":void 0}}function ml(n){if(!n.isNumberLiteral)return!1;let e=n.numericValue,t=n.engine;return typeof e=="number"?t.chop(e)===0:e.isZeroWithTolerance(t.tolerance)}function Vp(n,e){let t=n.unknowns,i=e.unknowns;if(t.length!==i.length)return!1;for(let r of t)if(!i.includes(r))return!1;return!0}function ve(n){if(n){if(n.operator==="Function"&&n.isCanonical||n.symbol)return n;if(n.operator==="BuiltinFunction")return n.op1;if(n.operator==="Delimiter"){if(n.op1.operator==="Sequence")if(n.op1.nops===1)n=n.op1;else return ve(n.engine._fn("Block",n.op1.ops,{canonical:!1}));return ve(n.op1)}if(n.operator==="Function")return ai(n.engine,n.ops);if(n.operator){n.operator;let e=n.engine,t=n.subs({_:"_1"}),i=1,r=[];for(;i<10;)t.has(`_${i}`)&&r.push(t.engine.symbol(`_${i}`,{canonical:!1})),i++;if(r.length===0){t.operator!=="Block"?t=e.function("Block",[t]):t=t.canonical;let o=t.unknowns;o.length>0&&(r=o.map(s=>e.symbol(s,{canonical:!1})))}return ai(e,[t,...r])}}}function ai(n,e){if(e.length===0)return;let t=e[0].operator==="Block"?e[0].canonical:n.function("Block",[e[0]]),i=e.slice(1).map(r=>r.symbol?r:n.error("expected-a-symbol",r.toString()));t.isScoped;for(let r of i)r.symbol&&!t.localScope.bindings.has(r.symbol)&&n.declare(r.symbol,{inferred:!0,type:"unknown"},t.localScope);return n._fn("Function",[t,...i])}function An(n,e){let t=ks(n)?.(e);return t||n.engine.function("Apply",[n,...e])}function ks(n){let e=n.engine;if(n.symbol)return o=>e.function(n.symbol,o).evaluate();let t=ve(n);if(!t)throw new Error("Invalid function literal");if(n=t,n.operator,n.isCanonical,n.ops,n.ops.length===1)return n.ops[0],()=>n.ops[0].evaluate();let[i,...r]=n.ops;return i.isScoped,o=>{if(o.length>r.length)throw new Error(`Too many arguments for function "${n.toString()}": expected ${r.length}, got ${o.length}`);if(e.strict&&!o.every(a=>a.isValid))return;if(o.length<r.length){let a=new Set([...i.symbols,...r.map(f=>f.symbol)]),u=r.slice(o.length).map((f,d)=>{let p=`_${d+1}`,x=0;for(;a.has(p);)p=`_${d+1}_${x++}`;return a.add(p),e.symbol(p,{canonical:!1})}),l=Object.fromEntries(r.slice(o.length).map((f,d)=>[f.symbol,u[d]])),c=i.evaluate({withArguments:Object.fromEntries(r.slice(0,o.length).map((f,d)=>[f.symbol,o[d]]))}).subs(l);return e.function("Function",[c,...u])}let s=i.evaluate({withArguments:Object.fromEntries(r.map((a,u)=>[a.symbol,o[u].evaluate()]))});return s.isValid?s:void 0}}function le(n){return ks(n)??(e=>n.engine.function("Apply",[n,...e]).evaluate())}function gl(n){let e=ks(n),t=n.engine;return e?i=>e([t.number(i)])?.re??NaN:i=>t.function("Apply",[n,t.number(i)]).evaluate().re}function to(n,e){typeof n=="string"&&n.length>0;let t=e;for(;t;){let i=t.bindings.get(n);if(i)return i;t=t.parent}}function St(n,e){for(;e!==BigInt(0);)[n,e]=[e,n%e];return n<0?-n:n}function hl(n,e){return n*e/St(n,e)}function*io(n){if(n<0)return BigInt(0);if(n<10)return BigInt([1,1,2,6,24,120,720,5040,40320,362880][Number(n)]);if(n%BigInt(2)===BigInt(1))return n*(yield*io(n-BigInt(1)));let e=n,t=n,i=n,r=0;for(;e>2;)e-=BigInt(2),t+=e,i*=t,r+=1,(r%5e4===0||r>1e4&&r%500===0)&&(yield i);return i}function Yn(n){return n!==null&&Array.isArray(n)}function se(n){return n!==null&&Array.isArray(n)&&typeof n[0]=="number"}function yl(n){return n!==null&&Array.isArray(n)&&typeof n[0]=="bigint"}function Dn(n){return n[0]==0}function Cs(n){return n[0]>0}function Ae(n){return n[0]==n[1]}function Zi(n){return n[0]===-n[1]}function Tt(n){return n[1]==1}function As(n){return Number(n[0])}function Ds(n){return Number(n[1])}function xl(n){return Number(n[0])/Number(n[1])}function Bt(n,e){if(typeof n[0]=="number"&&!Number.isFinite(n[0]))return n;let t=e;if(t===null)return n;if(yl(t))return n=[BigInt(n[0]),BigInt(n[1])],[t[1]*n[0]+t[0]*n[1],t[1]*n[1]];if(!Number.isFinite(t[0]))return t;if(yl(n)){let i=[BigInt(t[0]),BigInt(t[1])];return[i[1]*n[0]+i[0]*n[1],i[1]*n[1]]}return[t[1]*n[0]+t[0]*n[1],t[1]*n[1]]}function Mn(n,e){return se(n)&&se(e)?[n[0]*e[0],n[1]*e[1]]:se(n)?[BigInt(n[0])*e[0],BigInt(n[1])*e[1]]:se(e)?[BigInt(e[0])*n[0],BigInt(e[1])*n[1]]:[n[0]*e[0],n[1]*e[1]]}function It(n){return[-n[0],n[1]]}function bl(n){return n[0]<0?[-n[1],-n[0]]:[n[1],n[0]]}function El(n){return[Number(n[0]),Number(n[1])]}function ro(n,e){return se(n)&&se(e)?n[1]===1&&e[1]===1?[Pe(n[0],e[0]),1]:[Pe(n[0],e[0]),Nt(n[1],e[1])]:n[1]===1&&e[1]===1?[St(BigInt(n[0]),BigInt(e[0])),BigInt(1)]:[St(BigInt(n[0]),BigInt(e[0])),hl(BigInt(n[1]),BigInt(e[1]))]}function ui(n){if(se(n)){if(n[0]===1||n[1]===1)return n;if(n[1]<0&&(n=[-n[0],-n[1]]),!Number.isFinite(n[1]))return[0,1];let r=Pe(n[0],n[1]);return r<=1?n:[n[0]/r,n[1]/r]}n[1]<0&&(n=[-n[0],-n[1]]);let e=St(n[0],n[1]),[t,i]=e<=1?n:[n[0]/e,n[1]/e];return t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER&&i<=Number.MAX_SAFE_INTEGER?[Number(t),Number(i)]:[t,i]}function vl(n){if(!Number.isFinite(n)||n%1===0)return n;let t=1e-15,i=Math.floor(n),r=1,o=0,s=i,a=1;for(;n-i>t*a*a;){n=1/(n-i),i=Math.floor(n);let u=r;r=s;let l=o;o=a,s=u+i*r,a=l+i*o}return[s,a]}var j=class{get bignumRe(){}im;get bignumIm(){}isZeroWithTolerance(e){return this.isZero}valueOf(){return this.im===0?this.bignumRe?this.bignumRe.toNumber():this.re:this.toString()}[Symbol.toPrimitive](e){return e==="string"?this.toString():this.valueOf()}toJSON(){if(this.im===0){let e=this.re;if(Number.isFinite(e))return e}return this.N().toString()}print(){let e=console.log;e?.(this.toString())}};function qp(n){if(n==="N")return[0,""];let e={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3},t=0,i=0;n=n.toUpperCase();for(let r=n.length-1;r>=0;r--){let o=e[n[r]];if(o===void 0)return[t,n.slice(r)];o<i?t-=o:t+=o,i=o}return[t,""]}function Hi(n,e){if(n=n.trim(),n.length===0)return[NaN,""];if(n.startsWith("+"))return Hi(n.slice(1),e);if(n.startsWith("-")){let[r,o]=Hi(n.slice(1),e);return[-r,o]}let t=10;if(typeof e=="string"&&(e=e.toLowerCase()),n.startsWith("0x"))t=16,n=n.slice(2);else if(n.startsWith("0b"))t=2,n=n.slice(2);else{if(e==="roman")return qp(n);if(e==="base64"||e==="base-64")try{return[parseInt(btoa(n)),""]}catch{return[NaN,""]}else typeof e=="number"?t=e:typeof e=="string"&&(t=parseInt(e))}let i=0;for(let r=0;r<n.length;r++){let o={" ":-1,"\xA0":-1,"\u2000":-1,"\u2001":-1,"\u2002":-1,"\u2003":-1,"\u2004":-1,"\u2005":-1,"\u2006":-1,"\u2007":-1,"\u2008":-1,"\u2009":-1,"\u200A":-1,"\u200B":-1,"\u202F":-1,"\u205F":-1,_:-1,",":-1,0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35}[n[r]];if(o!==-1){if(o===void 0)return[i,n.substring(r)];if(o>=t)return[i,n.substring(r)];i=i*t+o}}return[i,""]}function Be(n,e){if(typeof e=="number"&&typeof n=="number")return n.toFixed(e);let t=n.toString();if(typeof n=="number"&&Number.isInteger(n)&&t.includes("e")){let i=BigInt(n).toString(),r=i.match(/0+$/);if((r?r[0].length:0)<=5)return i}else if(typeof n=="bigint"){let i=t.match(/0+$/),r=i?i[0].length:0;if(r>5)return`${t.slice(0,-r)}e+${r}`}return t}function Nl(n){if(typeof n=="number")return Number.isInteger(n)?BigInt(n):null;if(n==null||!qn(n))return null;let e=Qt(n)?n.num:n;if(typeof e=="number")return Number.isInteger(e)?BigInt(e):null;if(typeof e!="string")return null;let t=e.toLowerCase().replace(/[nd]$/,"").replace(/[\u0009-\u000d\u0020\u00a0]/g,"");return t==="nan"||/^(infinity|\+infinity|oo|\+oo|-infinity|-oo)$/.test(t)?null:ie(t)}function Le(n,e){if(typeof n=="number")return isNaN(n)?"NaN":Number.isFinite(n)?typeof e=="number"?{num:n.toFixed(e)}:n:n<0?"NegativeInfinity":"PositiveInfinity";if(n>=Number.MIN_SAFE_INTEGER&&n<=Number.MAX_SAFE_INTEGER)return Number(n);let t=Be(n);return Number(n).toString()===t?Number(n):{num:t}}var K=class n extends j{__brand;rational;radical;im=0;factory;bignum;constructor(e,t,i){if(super(),this.factory=t,this.bignum=i,typeof e=="number"){!Number.isFinite(e)||Number.isInteger(e),this.rational=[e,1],this.radical=1;return}if(typeof e=="bigint"){this.rational=[e,BigInt(1)],this.radical=1;return}typeof e!="object"||"im"in e;let r=1;if(typeof r!="number"||Number.isInteger(r),r==0){this.rational=[0,1],this.radical=1;return}let o=e.rational?[...e.rational]:[1,1];r!=1&&(typeof r=="bigint"?o=Mn(o,[r,BigInt(1)]):o=Mn(o,[r,1])),this.rational=o,this.radical=e.radical??1,this.radical<=$&&this.radical>=1,this.normalize()}get type(){return this.isNaN?"number":this.isPositiveInfinity||this.isNegativeInfinity?"non_finite_number":this.radical!==1?(Dn(this.rational),"finite_real"):Tt(this.rational)?"finite_integer":"finite_rational"}get isExact(){return!0}get asExact(){return this}toJSON(){if(this.isNaN)return"NaN";if(this.isPositiveInfinity)return"PositiveInfinity";if(this.isNegativeInfinity)return"NegativeInfinity";if(this.isZero)return 0;if(this.isOne)return 1;if(this.isNegativeOne)return-1;let e=t=>Tt(t)?Le(t[0]):["Rational",Le(t[0]),Le(t[1])];return this.radical===1?e(this.rational):Ae(this.rational)?["Sqrt",this.radical]:Zi(this.rational)?["Negate",["Sqrt",this.radical]]:this.rational[0]==1?["Divide",["Sqrt",this.radical],Le(this.rational[1])]:this.rational[0]==-1?["Negate",["Divide",["Sqrt",this.radical],Le(this.rational[1])]]:["Multiply",e(this.rational),["Sqrt",this.radical]]}clone(e){return new n(e,this.factory,this.bignum)}toString(){if(this.isZero)return"0";if(this.isOne)return"1";if(this.isNegativeOne)return"-1";let e=i=>Tt(i)?Be(i[0]):`${Be(i[0])}/${Be(i[1])}`;if(this.radical===1)return e(this.rational);let t=i=>`sqrt(${Be(i)})`;return Ae(this.rational)?t(this.radical):Zi(this.rational)?`-${t(this.radical)}`:this.rational[0]==1?`${t(this.radical)}/${Be(this.rational[1])}`:this.rational[0]==-1?`-${t(this.radical)}/${Be(this.rational[1])}`:`${e(this.rational)}${t(this.radical)}`}get sign(){return Dn(this.rational)?0:Cs(this.rational)?1:-1}get re(){return xl(this.rational)*Math.sqrt(this.radical)}get bignumRe(){let e,t=this.rational;return se(t)?e=this.bignum(t[0]).div(t[1]):e=this.bignum(t[0].toString()).div(this.bignum(t[1].toString())),this.radical===1?e:e.mul(this.bignum(this.radical).sqrt())}get numerator(){return this.rational[1]==1?this:this.clone({rational:se(this.rational)?[this.rational[0],1]:[this.rational[0],BigInt(1)],radical:this.radical})}get denominator(){return se(this.rational)?this.clone(this.rational[1]):this.clone({rational:[this.rational[1],BigInt(1)]})}normalize(){if(Number.isInteger(this.radical)&&this.radical>0&&Number.isFinite(this.radical),isNaN(this.radical)){this.rational=[NaN,1],this.radical=1;return}let[e,t]=this.rational;if(t==0){this.rational=[NaN,1],this.radical=1;return}if(this.radical===0||e===0){this.rational=[0,1],this.radical=1;return}if(this.radical>=4){let[i,r]=Yt(this.radical,2);typeof this.rational[0]=="number"?this.rational[0]*=i:this.rational=Mn(this.rational,[i,1]),this.radical=r}this.rational=ui(this.rational)}get isNaN(){return Number.isNaN(this.rational[0])}get isPositiveInfinity(){return this.rational[0]==1/0}get isNegativeInfinity(){return this.rational[0]==-1/0}get isComplexInfinity(){return!1}get isZero(){return Dn(this.rational)}get isOne(){return!(this.rational[0]!==this.rational[1]||this.radical!==1)}get isNegativeOne(){return!(this.rational[0]!==-this.rational[1]||this.radical!==1)}sgn(){if(!Number.isNaN(this.rational[0]))return Dn(this.rational)?0:Cs(this.rational)?1:-1}N(){return this.isZero||this.isOne||this.isNegativeOne?this:this.rational[1]==1&&this.radical===1?this:this.factory(this.bignumRe)}neg(){return this.isZero?this:this.clone({rational:It(this.rational),radical:this.radical})}inv(){return this.isOne?this:this.isNegativeOne?this:this.clone({rational:se(this.rational)?[this.rational[1],this.rational[0]*this.radical]:[this.rational[1],this.rational[0]*BigInt(this.radical)],radical:this.radical})}add(e){return typeof e=="number"?e===0?this:Number.isInteger(e)&&this.radical===1?this.clone({rational:se(this.rational)?[this.rational[0]+e*this.rational[1],this.rational[1]]:[this.rational[0]+BigInt(e)*this.rational[1],this.rational[1]]}):this.factory(this.bignumRe).add(e):e.isZero?this:this.isZero?e:e instanceof n?this.radical===e.radical?this.clone({rational:Bt(this.rational,e.rational),radical:this.radical}):this.factory(this.bignumRe).add(e):e.add(this)}sub(e){return this.add(e.neg())}mul(e){return e===0?this.clone(0):e===1?this:e===-1?this.neg():typeof e=="number"?Number.isInteger(e)?this.clone({rational:se(this.rational)?[this.rational[0]*e,this.rational[1]]:[this.rational[0]*BigInt(e),this.rational[1]],radical:this.radical}):this.factory(this.bignumRe).mul(e):e instanceof M?this.factory(e).mul(this):e.im!==0?e.mul(this):e.isZero?e:e.isOne?this:e.isNegativeOne?this.neg():e.isNaN?e:this.isZero?this:this.isOne?e:this.isNegativeOne?e.neg():e instanceof n?this.clone({rational:Mn(this.rational,e.rational),radical:this.radical*e.radical}):e.mul(this)}div(e){if(typeof e=="number")return e===1?this:e===-1?this.neg():e===0?this.clone(NaN):this.clone({rational:se(this.rational)?[this.rational[0],this.rational[1]*e]:[this.rational[0],this.rational[1]*BigInt(e)],radical:this.radical});if(e.isOne)return this;if(e.isNegativeOne)return this.neg();if(this.isZero)return e.isZero?this.clone(NaN):e.isNaN?e:this;if(e.isNaN)return e;if(e.isZero)return this.clone(this.sign*(1/0));if(!(e instanceof n))return this.factory(this.bignumRe).div(e);if(e.im!==0)return this.factory(this.bignumRe).div(e);let t;if(se(this.rational)&&se(e.rational)){let[i,r]=this.rational,[o,s]=e.rational;t=[i*s,r*o*e.radical]}else t=Mn(this.rational,[BigInt(e.rational[1]),BigInt(e.rational[0])*BigInt(e.radical)]);return this.clone({rational:t,radical:this.radical*e.radical})}pow(e){if(Array.isArray(e),this.isNaN)return this;if(typeof e=="number"&&isNaN(e))return this.clone(NaN);if(e instanceof j){if(e.isNaN)return this.clone(NaN);if(e.isZero)return this.clone(1);if(e.isOne)return this;if(e.im)e={re:e.re,im:e.im};else{if(e instanceof n&&e.radical===1&&e.rational[0]==1)return this.root(e.rational[0]);e=e.re}}if(e===.5)return this.sqrt();if(typeof e=="object"&&("re"in e||"im"in e))return this.factory(this.bignumRe).pow(e);if(this.isPositiveInfinity){if(e===-1)return this.clone(0);if(e===1/0)return this.clone(1/0);if(e===-1/0)return this.clone(0)}else if(this.isNegativeInfinity&&e===1/0)return this.clone(NaN);if((e===1/0||e===-1/0)&&(this.isOne||this.isNegativeOne))return this.clone(NaN);if(e===1)return this;if(e===-1)return this.inv();if(e===0)return this.clone(1);if(this.isZero){if(e>0)return this;if(e<0)return this.factory({im:1/0})}if(e<0)return this.pow(-e).inv();if(e%1===.5)return this.pow(Math.floor(e)).mul(this.sqrt());if(this.radical>$||this.rational[0]>$||this.rational[0]<-$||this.rational[1]>$)return this.factory(this.bignumRe).pow(e);if(this.sign<0){if(Number.isInteger(e)){let t=e%2===0?1:-1;return this.clone({rational:se(this.rational)?[t*(-this.rational[0])**e,this.rational[1]**e]:[BigInt(t)*(-this.rational[0])**BigInt(e),this.rational[1]**BigInt(e)],radical:this.radical**e})}return this.factory({im:(-this.re)**e})}else if(Number.isInteger(e))return this.clone({rational:se(this.rational)?[this.rational[0]**e,this.rational[1]**e]:[BigInt(this.rational[0])**BigInt(e),this.rational[1]**BigInt(e)],radical:this.radical**e});return this.factory(this.bignumRe).pow(e)}root(e){if(e===0)return this.clone(NaN);if(this.isNaN)return this;if(this.isZero)return this;if(e===1)return this;if(e===-1)return this.inv();if(e<0)return this.root(-e).inv();if(e%1===.5)return this.root(Math.floor(e)).sqrt();if(this.radical===1){if(this.sign>0){let t=this.re;if(Number.isInteger(t)){if(t>0){let i=Math.pow(t,1/e);if(Number.isInteger(i))return this.clone(i)}return this.factory(this.bignumRe).root(e)}}return this.factory(this.bignumRe).root(e)}if(this.sign<0)return this.factory({im:Math.pow(-this.re,1/e)});if(this.radical>$||this.rational[0]>$||this.rational[0]<-$||this.rational[1]>$)return this.factory(this.bignumRe).root(e);if(this.rational[1]==1){let t=Math.pow(this.rational[0],1/e);if(Number.isInteger(t))return this.clone(t)}return this.factory(this.bignumRe).root(e)}sqrt(){if(this.isZero||this.isOne)return this;if(this.radical===1)if(se(this.rational)){let[e,t]=this.rational;return e*t>$?this.factory(this.bignumRe).sqrt():e>0?this.clone({radical:e*t,rational:[1,t]}):this.factory({im:Math.sqrt(-e*t)/t})}else return this.factory(this.bignumRe).sqrt();if(this.sign>0){let e=Math.sqrt(this.re);if(Number.isInteger(e))return this.clone(e)}return this.factory(this.bignumRe).sqrt()}gcd(e){if(!(e instanceof n))return e.gcd(this);if(this.isOne||e.im!==0||e.isOne)return this.clone(1);let t=ro(this.rational,e.rational),i=Pe(this.radical,e.radical);return this.clone({rational:t,radical:i})}abs(){return this.sign===-1?this.neg():this}ln(e){return this.isZero?this.clone(NaN):this.isPositiveInfinity?this.clone(1/0):this.sign<0?this.clone(NaN):this.isOne?this.clone(0):this.isNegativeOne?this.factory({im:Math.PI}):this.factory(this.bignumRe).ln(e)}exp(){return this.isNaN?this.clone(NaN):this.isZero?this.clone(1):this.isNegativeInfinity?this.clone(0):this.isPositiveInfinity?this.clone(1/0):this.factory(this.bignumRe).exp()}floor(){return this.isNaN?this.clone(NaN):this.type==="integer"?this:this.clone(Math.floor(this.re))}ceil(){return this.isNaN?this.clone(NaN):this.type==="integer"?this:this.clone(Math.ceil(this.re))}round(){return this.isNaN?this.clone(NaN):this.type==="integer"?this:this.clone(Math.round(this.re))}eq(e){return typeof e=="number"?this.radical===1&&Tt(this.rational)&&this.rational[0]==e:e instanceof n?this.radical===e.radical&&this.rational[0]==e.rational[0]&&this.rational[1]==e.rational[1]:e.im===0&&e.re===this.re}lt(e){return this.im,typeof e=="number"?this.re<e:this.re<e.re}lte(e){return this.im,typeof e=="number"?this.re<=e:this.re<=e.re}gt(e){return this.im,typeof e=="number"?this.re>e:this.re>e.re}gte(e){return this.im,typeof e=="number"?this.re>=e:this.re>=e.re}static sum(e,t,i){if(e.length===1)return e;if(e.some(u=>!u.isExact)){if(e.length===2)return[e[0].add(e[1])];let u=t(0);for(let l of e)u=u.add(l);return[u]}let r=0,o=[0,1],s=[];for(let u of e){if(u.isNaN)return[new n(NaN,t,i)];if(!u.isZero)if(r+=u.im,u instanceof n){let l=u.rational;if(u.radical===1)o=Bt(o,l);else{let c=s.findIndex(f=>f.radical===u.radical);c===-1?s.push({multiple:l,radical:u.radical}):s[c].multiple=Bt(s[c].multiple,l)}}else E(u.type,"integer"),o=Bt(o,[u.re,1])}if(Dn(o)&&s.length===0)return r===0?[new n(0,t,i)]:[t({im:r})];let a=[];return r!==0&&a.push(t({im:r})),s.length===0?a.push(new n({rational:o},t,i)):(s.push({multiple:o,radical:1}),a.push(...s.map(u=>new n({rational:u.multiple,radical:u.radical},t,i)))),a}};function rn(n){let e=n.numericValue;if(e===null||typeof e=="number"&&!Number.isFinite(e)||e instanceof j&&(e.isNaN||e.isPositiveInfinity||e.isNegativeInfinity))return;if(typeof e=="number")return Number.isInteger(e)?[e,1]:void 0;let t=e.type;if(t!=="finite_integer"&&t!=="finite_rational"||e.im!==0)return;if(e instanceof K)return e.radical!==1?void 0:e.rational;let i=e.bignumRe;if(i!==void 0&&Number.isInteger(i))return[ie(i),BigInt(1)];let r=e.re;if(Number.isInteger(r))return[r,1]}function Qn(n){if(n==null)return null;if(typeof n=="bigint")return n;if(typeof n=="number"&&Number.isInteger(n))return BigInt(n);if(Xn(n)){let e=n.numericValue;if(e===null)return null;if(typeof e=="number")return Number.isInteger(e)?BigInt(e):null;if(e.im!==0)return null;let t=e.bignumRe;return t?.isInteger()?ie(t):Number.isInteger(e.re)?BigInt(e.re):null}return n instanceof M||typeof n=="string"?ie(n):n instanceof q?n.im===0?ie(n.re):null:Nl(n)}function Ms(n){if(n==null)return null;let e=typeof n=="number"?n:n.numericValue;if(e===null)return null;if(typeof e=="number")return n.engine.bignum(e);if(e.im!==0)return null;let t=e.bignumRe??e.re;return typeof t=="number"&&isNaN(t)?null:n.engine.bignum(t)}function ee(n){if(n==null)return null;if(typeof n=="number")return Number.isInteger(n)&&n>=-$&&n<=$?n:null;let e=n.numericValue;if(e===null)return null;if(typeof e=="number")return Number.isInteger(e)&&e>=-$&&e<=$?e:null;if(e.im!==0)return null;let t=e.re;return Number.isInteger(t)&&t>=-$&&t<=$?Number(t):null}function P(n){let e=n?.numericValue??void 0;return e===void 0?null:Math.round(typeof e=="number"?e:e.re)}function ye(n){if(n==null)return null;let e=n.numericValue;if(e===null)return null;if(typeof e=="number")return BigInt(Math.round(e));let t=e.bignumRe??e.re;return typeof t=="number"?BigInt(Math.round(t)):ie(t.round())}function Fe(n){if(n.symbol&&!n.isConstant)return 1;if(n.operator==="Power"&&n.op2.isNumberLiteral){if(Fe(n.op1)===0)return 0;let e=ee(n.op2);return e!==null&&e>0?e:0}if(n.operator==="Multiply"){let e=0;for(let t of n.ops){let i=Fe(t);e=e+i}return e}if(n.operator==="Add"||n.operator==="Subtract"){let e=0;for(let t of n.ops)e=Math.max(e,Fe(t));return e}return n.operator==="Negate"||n.operator==="Divide"?Fe(n.op1):0}function on(n){if(n.symbol&&!n.isConstant)return 1;if(n.operator==="Power"&&n.op2.isNumberLiteral){if(on(n.op1)===0)return 0;let e=ee(n.op2);return e!==null&&e>0?e:0}if(n.operator==="Multiply"||n.operator==="Add"||n.operator==="Subtract"){let e=0;for(let t of n.ops)e=Math.max(e,Fe(t));return e}return n.operator==="Negate"||n.operator==="Divide"?on(n.op1):0}function _l(n){return n.symbol&&!n.isConstant?n.symbol:n.ops?n.ops.map(e=>_l(e)).join(" ").trim():""}function Rs(n){return _l(n).split(" ").reverse().join(" ").trim()}function re(n,e,t,i){if((n?.numericValue??null)===null)return;let r=n.engine,o;if(n.im!==0)o=i?.(r.complex(n.re,n.im));else{let s=n.bignumRe;if(s!==void 0&&me(r)&&t)o=t(s);else{let a=n.re;me(r)&&t?o=t(r.bignum(a)):o=e(a)}}if(o!==void 0)return o instanceof q?r.number(r._numericValue({re:o.re,im:o.im})):r.number(o)}function Rn(n,e,t,i,r){if(n.numericValue===null||e.numericValue===null)return;let o=n.engine,s;if((n.im!==0||e.im!==0)&&(s=r?.(o.complex(n.re,n.im),o.complex(e.re,e.im))),s===void 0&&i){let a=n.bignumRe,u=e.bignumRe;(a!==void 0||u!==void 0)&&(a??=o.bignum(n.re),u??=o.bignum(e.re),s=i(a,u))}if(s===void 0){let a=n.re,u=e.re;!isNaN(a)&&!isNaN(u)&&(me(o)&&i?s=i(o.bignum(n.bignumRe??a),o.bignum(e.bignumRe??u)):s=t(a,u))}if(s!==void 0)return s instanceof q?o.number(o._numericValue({re:o.chop(s.re),im:o.chop(s.im)})):o.number(o.chop(s))}function Sl(n){return n.operator==="Sqrt"||n.operator==="Power"&&n.op2.im===0&&n.op2.re===.5||n.operator==="Root"&&n.op2.im===0&&n.op2.re===2}function oo(n){if(Sl(n))return rn(n.op1)??null;if(n.operator==="Divide"&&n.op1.is(1)&&Sl(n.op2)){let e=n.op2.re;return Number.isInteger(e)?[1,e]:null}return null}function Kn(n,e){let t=n.engine,i=n.isCanonical&&e.isCanonical,r=()=>t._fn("Power",[n,e],{canonical:i});if(n.operator==="Power"){let[a,u]=n.ops;return t._fn("Power",[a,t.box(["Multiply",u,e],{canonical:i||"Power"})])}if(e.isFunctionExpression||e.symbol!==null||!e.type.matches("number"))return r();if(n.isNumberLiteral&&n.is(0))return e.type.matches("imaginary")||e.isNaN||e.is(0)?t.NaN:e.isInfinity?e.isPositive?t.Zero:e.isNegative?t.ComplexInfinity:t.NaN:e.isGreater(0)?t.Zero:e.isLess(0)?t.ComplexInfinity:r();let o=n.type.matches("number")&&(n.isFunctionExpression===!1||n.operator==="Negate");if(e.is(0))return o&&n.isFinite!==void 0?n.isFinite?t.One:t.NaN:r();if(o&&n.is(1))return e.isFinite?t.One:t.NaN;if(e.is(1)&&n.type.matches("number"))return n;if(e.is(-1)){if(o){if(n.isInfinity&&(n.isNegative||n.isPositive))return t.Zero;if(n.is(-1))return t.NegativeOne;if(n.is(1))return t.One}return n.isCanonical?n.inv():t._fn("Power",[n,t.number(-1)],{canonical:!1})}if(e.isInfinity&&o)return e.isPositive?n.is(-1)?t.NaN:n.isInfinity?t.ComplexInfinity:n.isNaN?t.NaN:n.isReal?n.isGreater(1)?t.PositiveInfinity:n.isLess(-1)?t.ComplexInfinity:t.Zero:r():e.isNegative?n.is(-1)?t.NaN:n.isInfinity?t.Zero:n.isNaN?t.NaN:n.isReal?n.isGreater(0)?n.isLess(1)?t.PositiveInfinity:t.Zero:n.isGreater(-1)?t.ComplexInfinity:t.Zero:r():t.NaN;if(n.isNumberLiteral&&n.isInfinity){if(e.type.matches("imaginary"))return t.NaN;if(e.type.matches("complex")&&!isNaN(e.re)){if(e.re>0)return t.ComplexInfinity;if(e.re<0)return t.Zero}}if(e.is(.5))return n.isCanonical?wt(n,2):t._fn("Sqrt",[n],{canonical:!1});let s=rn(e);return s!==void 0&&s[0]===1&&s[1]!==1?n.isCanonical?wt(n,t.number(s[1])):t._fn("Root",[n,t.number(s[1])],{canonical:!1}):r()}function wt(n,e){let t=n.engine,i;if(typeof e=="number"?i=e:e.isNumberLiteral&&e.im===0&&(i=e.re),i===1)return n;if(i===2){if(n.isNumberLiteral&&n.type.matches("rational")&&n.re<$){let r=n.sqrt();if(typeof r.numericValue=="number"||r.numericValue.isExact)return r}return t._fn("Sqrt",[n],{canonical:n.isCanonical})}return t._fn("Root",[n,typeof e=="number"?t.number(e):e],{canonical:n.isCanonical&&(typeof e=="number"||e.isCanonical)})}function Ie(n,e,{numericApproximation:t}){if(!n.isCanonical||typeof e!="number"&&!e.isCanonical)return n.engine._fn("Power",[n,n.engine.box(e)],{canonical:!1});if(t&&n.isNumberLiteral){if(typeof e=="number")return re(n,s=>Math.pow(s,e),s=>s.pow(e),s=>s.pow(e))??Ie(n,e,{numericApproximation:!1});if(e.isNumberLiteral)return Rn(n,e,(s,a)=>Math.pow(s,a),(s,a)=>s.pow(a),(s,a)=>s.pow(a))??Ie(n,e,{numericApproximation:!1})}let i=n.engine;typeof e!="number"&&(e=e.canonical);let r=Kn(n,i.box(e));if(r.operator!=="Power")return r;let o=typeof e=="number"?e:e.im===0?e.re:void 0;if(n.symbol==="ComplexInfinity")return i.NaN;if(n.symbol==="ExponentialE"){let s=li(e);if(s!==void 0){if(s=ao(s),s!==void 0)return i.function("Cos",[s]).add(i.function("Sin",[s]).mul(i.I)).simplify()}else{if(typeof e=="number")return i.number(i._numericValue(i.E.N().numericValue).pow(e));if(e.isNumberLiteral)return i.number(i._numericValue(i.E.N().numericValue).pow(e.numericValue))}}if(n.operator==="Power"){let[s,a]=n.ops;return Ie(s,a.mul(e),{numericApproximation:t})}if(n.operator==="Divide"){let[s,a]=n.ops;return Ie(s,e,{numericApproximation:t}).div(Ie(a,e,{numericApproximation:t}))}if(n.operator==="Negate"&&o!==void 0)return o%2===0?Ie(n.op1,e,{numericApproximation:t}):Ie(n.op1,e,{numericApproximation:t}).neg();if(n.operator==="Sqrt")return o===2?n.op1:o!==void 0&&o%2===0?n.op1.pow(o/2):Ie(n.op1,e,{numericApproximation:t}).sqrt();if(n.operator==="Exp")return Ie(i.E,n.op1.mul(e),{numericApproximation:t});if(n.operator==="Multiply"){let s=n.ops.map(a=>Ie(a,e,{numericApproximation:t}));return i._fn("Multiply",s)}if(typeof e!="number"&&e.isNumberLiteral){let s=rn(e);if(s!==void 0&&s[0]===1)return so(n,i.number(s[1]),{numericApproximation:t})}if(n.operator==="Root"){let[s,a]=n.ops;return Ie(s,i.box(e).div(a),{numericApproximation:t})}if(n.isNumberLiteral&&Number.isInteger(o)){let s=n.numericValue;return typeof s=="number"?re(n,a=>Math.pow(a,o),a=>a.pow(o),a=>a.pow(o))??i._fn("Power",[n,i.box(e)]):i.number(s.pow(o))}return i._fn("Power",[n,i.box(e)])}function so(n,e,{numericApproximation:t}){if(!n.isCanonical||!e.isCanonical)return n.engine._fn("Root",[n,e],{canonical:!1});if(t&&n.isNumberLiteral&&e.isNumberLiteral){let i=n.isNegative,r=e.isEven;return i&&(n=n.neg()),Rn(n,e,(o,s)=>{let a=Math.pow(o,1/s);return i&&!r?-a:a},(o,s)=>{let a=o.pow(s.pow(-1));return i&&!r?a.neg():a},(o,s)=>{let a=o.pow(typeof s=="number"?1/s:s.inverse());return i&&!r?a.neg():a})??so(n,e,{numericApproximation:!1})}if(n.isNumberLiteral&&e.isNumberLiteral&&e.isInteger){let i=typeof e=="number"?e:e.im===0?e.re:void 0;if(i!==void 0)if(typeof n.numericValue=="number"){let r=n.engine._numericValue(n.numericValue)?.root(i);if(r?.isExact)return n.engine.number(r)}else{let r=n.numericValue.asExact?.root(i);if(r?.isExact)return n.engine.number(r)}}return n.engine._fn("Root",[n,e])}var ct=1e5,zp={Sin:!0,Cos:!0,Tan:!0,Cot:!0,Sec:!0,Csc:!0,Sinh:!0,Cosh:!0,Tanh:!0,Coth:!0,Sech:!0,Csch:!0,Arcsin:!0,Arccos:!0,Arctan:!0,Arccot:!0,Arcsec:!0,Arccsc:!0,Arcsinh:!0,Arccosh:!0,Arctanh:!0,Arccoth:!0,Arccsch:!0,Arcsech:!0};function Gp(n){return!n||typeof n!="string"?!1:n in zp}function Wi(n,e){let t=Fe(n),i=Fe(e);if(t!==i)return i-t;let r=on(n),o=on(e);if(r!==o)return o-r;let s=Rs(n),a=Rs(e);if(s||a){if(!s)return 1;if(!a||s<a)return-1;if(s>a)return 1}return xe(n,e)}var Tl=["integer","rational","radical","real","complex","constant","symbol","multiply","divide","add","trig","fn","power","string","other"];function Bl(n){if(typeof n.numericValue=="number")return Number.isInteger(n.numericValue)?"integer":"real";if(n.numericValue){let e=n.numericValue.type;return e==="integer"||e==="finite_integer"?"integer":e==="rational"||e==="finite_rational"?"rational":e==="real"||e==="finite_real"?"real":e==="complex"||e==="finite_complex"||e==="imaginary"||e==="finite_number"?"complex":e==="non_finite_number"?"constant":e==="number"?"real":"other"}return n.symbol==="ImaginaryUnit"?"complex":oo(n)?"radical":n.symbol&&n.isConstant?"constant":n.symbol?"symbol":Gp(n.operator)?"trig":n.operator==="Add"?"add":n.operator==="Power"||n.operator==="Root"?"power":n.operator==="Multiply"||n.operator==="Negate"?"multiply":n.operator==="Divide"?"divide":n.operator==="Rational"?"rational":n.operator==="Complex"?n.im!==0?"complex":"real":n.operator==="Sqrt"?n.op1.isNumberLiteral&&(n.op1.isInteger||n.op1.isRational)?"radical":"power":n.ops?"fn":n.string?"string":"other"}function xe(n,e){if(n===e)return 0;let t=Bl(n),i=Bl(e);if(t!==i)return Tl.indexOf(t)-Tl.indexOf(i);if(t==="complex"){let[r,o]=Il(n),[s,a]=Il(e);return o!==a?o-a:r-s}if(t==="integer"||t==="rational"||t==="real"){let r=n.numericValue,o=e.numericValue;r===null&&n.operator==="Rational"&&(r=n.op1.re/n.op2.re),o===null&&e.operator==="Rational"&&(o=e.op1.re/e.op2.re);let s=typeof r=="number"?r:r.re,a=typeof o=="number"?o:o.re;return s-a}if(t==="radical")return xe(n.op1,e.op1);if(t==="constant"||t==="symbol")return n.symbol===e.symbol?0:n.symbol>e.symbol?1:-1;if(t==="add"){let r=n.ops,o=e.ops;if(r.length!==o.length)return o.length-r.length;for(let s=0;s<r.length;s++){let a=xe(r[s],o[s]);if(a!==0)return a}return 0}if(t==="power"){let r=Fe(n),o=Fe(e);if(r!==o)return o-r;let s=on(n),a=on(e);return s!==a?s-a:xe(n.op1,e.op1)}if(t==="multiply"){let r=Fe(n),o=Fe(e);if(r!==o)return o-r;let s=on(n),a=on(e);if(s!==a)return s-a;let u=n.ops,l=e.ops;if(u.length!==l.length)return l.length-u.length;for(let c=0;c<u.length;c++){let f=xe(u[c],l[c]);if(f!==0)return f}return 0}if(t==="divide"){let r=Fe(n.op1),o=Fe(e.op1);if(r!==o)return o-r;let s=on(n.op1),a=on(e.op1);if(s!==a)return s-a;let u=xe(n.op1,e.op1);return u!==0?u:xe(n.op2,e.op2)}if(t==="fn"||t==="trig"){if(n.operator==e.operator&&n.nops===1&&e.nops===1)return xe(n.op1,e.op1);let r=n.operatorDefinition?.complexity??ct,o=e.operatorDefinition?.complexity??ct;return r===o?n.operator===e.operator?Ps(n)-Ps(e):n.operator<e.operator?1:-1:r-o}return t==="string"?n.string===e.string?0:e.string<n.string?-1:1:(n.complexity??ct)-(e.complexity??ct)}function Ls(n,{recursive:e=!1}){if(n.isCanonical||!n.ops)return n;let t=n.ops;return e&&(t=t.map(i=>Ls(i,{recursive:e}))),t=Ji(n.operator,t),n.engine._fn(n.operator,t,{canonical:!1})}function Ji(n,e){if(e.length===0)return e;let t=e[0].engine;if(n==="Add")return[...e].sort(Wi);if(n==="Multiply")return[...e].sort(xe);let i=t.lookupDefinition(n);return!i||!Z(i)||!i.operator.commutative?e:i.operator.commutativeOrder?[...e].sort(i.operator.commutativeOrder):[...e].sort(xe)}function Ps(n){return n.ops?1+[...n.ops].reduce((e,t)=>e+Ps(t),0):1}function Il(n){if(n.symbol==="ImaginaryUnit")return[0,1];if(n.numericValue){if(typeof n.numericValue=="number")return[n.numericValue,0];let e=n.numericValue;return[e.re,e.im]}if(n.operator==="Complex"){let e=n.op1.numericValue;if(e===null)return[0,0];let t=typeof e=="number"?e:e.re,i=n.op2.numericValue;if(i===null)return[0,0];let r=typeof i=="number"?i:i.re;return[t,r]}return[0,0]}var Up=new Set(["engine","name","description","examples","wikidata","url","lazy","scoped","broadcastable","associative","commutative","commutativeOrder","idempotent","involution","pure","inferredSignature","signature","type","sgn","even","complexity","canonical","evaluate","evaluateAsync","evalDimension","compile","eq","neq","cmp","collection"]),kt=class{engine;name;description;url;wikidata;broadcastable=!1;associative=!1;commutative=!1;commutativeOrder;idempotent=!1;involution=!1;pure=!0;complexity=ct;lazy=!1;scoped=!1;signature;inferredSignature=!0;type;sgn;eq;neq;even;canonical;evaluate;evaluateAsync;evalDimension;compile;collection;constructor(e,t,i){this.name=t,this.engine=e,i.signature?(this.inferredSignature=!1,this.signature=i.signature instanceof S?i.signature:new S(i.signature,e._typeResolver)):this.signature=new S("(any*) -> unknown"),this.update(i),e.listenToConfigurationChange(this)}toJSON(){let e={name:this.name};return this.wikidata&&(e.wikidata=this.wikidata),this.description&&(e.description=this.description),this.url&&(e.url=this.url),e.broadcastable=this.broadcastable,e.associative=this.associative,e.commutative=this.commutative,e.idempotent=this.idempotent,e.involution=this.involution,e.pure=this.pure,e.lazy=this.lazy,e.complexity=this.complexity,e.scoped=this.scoped,e.signature=this.signature.toString(),e.inferredSignature=this.inferredSignature,this.collection&&(e.collection=this.collection),e}infer(e){let t=new S(e,this.engine._typeResolver);if(!t.matches(this.signature))throw new Error(`Operator Definition "${this.name}": inferred signature "${t}" does not match current signature "${this.signature}"`);this.inferredSignature&&(this.signature=t)}update(e){if(this.engine.strict){for(let o in e)if(!Up.has(o))throw new Error(`Operator Definition "${this.name}": unexpected key "${o}"`)}if("name"in e&&e.name!==this.name)throw new Error(`Operator Definition "${this.name}": cannot change name to "${e.name}"`);if("engine"in e&&e.engine!==this.engine)throw new Error(`Operator Definition "${this.name}": cannot change engine`);this.lazy=e.lazy??this.lazy,this.scoped=e.scoped??this.scoped;let t=e.idempotent??this.idempotent,i=e.involution??this.involution;if(t&&i)throw new Error(`Operator Definition "${this.name}": the 'idempotent' and 'involution' flags are mutually exclusive`);if(this.idempotent=t,this.involution=i,this.description=e.description??this.description,this.collection=e.collection??this.collection,this.url=e.url??this.url,this.wikidata=e.wikidata??this.wikidata,this.broadcastable=e.broadcastable??this.broadcastable,this.associative=e.associative??this.associative,this.commutative=e.commutative??this.commutative,this.commutativeOrder=e.commutativeOrder??this.commutativeOrder,this.commutativeOrder&&!this.commutative)throw new Error(`Operator Definition "${this.name}": the 'commutativeOrder' handler requires the 'commutative' flag`);if(e.canonical&&(e.associative||e.commutative||e.idempotent||e.involution))throw new Error(`Operator Definition "${this.name}": the 'canonical' handler is incompatible with the 'associative', 'commutative', 'idempotent', and 'involution' flags`);if(this.pure=e.pure??this.pure,this.complexity=e.complexity??this.complexity,e.signature){let o=e.signature,s=e.signature instanceof S?e.signature:this.engine.type(e.signature);if(o&&!s.matches(this.engine.type(o)))throw s.matches(this.engine.type(o)),new Error(`Operator Definition "${this.name}": signature "${s}" does not match "${o}"`);this.signature=s,"inferredSignature"in e&&(this.inferredSignature=e.inferredSignature)}if(this.type=e.type??this.type,this.evaluateAsync=e.evaluateAsync??this.evaluateAsync,this.canonical=e.canonical??this.canonical,this.evalDimension=e.evalDimension??this.evalDimension,this.sgn=e.sgn??this.sgn,this.even=e.even??this.even,this.compile=e.xcompile??this.compile,this.eq=e.eq??this.eq,this.neq=e.neq??this.neq,this.scoped=e.scoped??this.scoped,this.lazy=e.lazy??this.lazy,e.collection&&(this.collection=eo(e.collection)),this.collection){let o=We(this.signature.type);if(!o)throw new Error(`Operator Definition "${this.name}": a collection handler is defined, but the signature "${this.signature}" does not have a result type`);if(!E(o,"collection"))throw new Error(`Operator Definition "${this.name}": a collection handler is defined, but the signature "${this.signature}" is not a collection type`);if(E(o,"indexed_collection")&&!this.collection.at)throw new Error(`Operator Definition "${this.name}" returns an indexed collection, but the 'at' handler is missing`)}let r;if(e.evaluate&&typeof e.evaluate!="function"){let o=this.scoped?{parent:this.engine.context.lexicalScope,bindings:new Map}:void 0,s=this.engine.box(e.evaluate,{canonical:!1,scope:o});if(!s.isValid)throw Error(`Invalid function ${s.toString()}`);let a=le(s);r=u=>a(u),Object.defineProperty(r,"toString",{value:()=>s.toString()})}else r=e.evaluate??this.evaluate;this.evaluate=r}onConfigurationChange(){}};function ft(n){if(n.operator==="Interval"){let e=n.op1,t=n.op2,i=!1,r=!1;e.operator==="Open"?(i=!0,e=e.op1):e.operator==="Closed"&&(e=e.op1),t.operator==="Open"?(r=!0,t=t.op1):t.operator==="Closed"&&(t=t.op1);let o=e.N(),s=t.N();return!o.isNumberLiteral||!s.isNumberLiteral?void 0:{start:o.re,openStart:i,end:s.re,openEnd:r}}if(n.symbol==="EmptySet")return{start:0,openStart:!0,end:0,openEnd:!0};if(n.symbol==="RealNumbers")return{start:-1/0,openStart:!1,end:1/0,openEnd:!1};if(n.symbol==="NegativeNumbers")return{start:-1/0,openStart:!1,end:0,openEnd:!0};if(n.symbol==="NonPositiveNumbers")return{start:-1/0,openStart:!1,end:0,openEnd:!1};if(n.symbol==="PositiveNumbers")return{start:0,openStart:!0,end:1/0,openEnd:!1};if(n.symbol==="NonNegativeNumbers")return{start:0,openStart:!1,end:1/0,openEnd:!1}}var Ye=class extends Error{cause;value;constructor({message:e,value:t,cause:i}={}){super(e??"Operation canceled"),t&&(this.value=t),this.cause=i,this.name="CancellationError"}};async function ci(n,e,t){let i=performance.now();for(;;){let r=performance.now(),o=16;for(;performance.now()-r<o;){let{done:s,value:a}=n.next();if(s)return a;if(t?.aborted)throw new Ye({value:a,cause:t.reason});if(performance.now()-i>=e)throw new Ye({value:a,cause:"timeout",message:`Timeout exceeded (${e}ms)`})}await new Promise(s=>setTimeout(s,0))}}function fi(n,e){let t=Date.now();for(;;){let{done:i,value:r}=n.next();if(i)return r;if(Date.now()-t>=e)throw new Ye({value:r,cause:"timeout",message:`Timeout exceeded (${e}ms)`})}}function Qe(n,e,t){return e.every(i=>i.isCanonical)?e:e.map(i=>n.box(i,{scope:t}))}var Yi=50,Dl={List:{complexity:8200,signature:"(any*) -> list",type:(n,{engine:e})=>A(`list<${S.widen(...n.map(t=>t.type))}>`),canonical:jp,lazy:!0,evaluate:(n,{engine:e,materialization:t})=>{if(t)return e._fn("List",$s(n).map(i=>i.evaluate({materialization:t})))},eq:kl,collection:Kr()},Set:{complexity:8200,signature:"(any*) -> set",type:(n,{engine:e})=>A(`set<${S.widen(...n.map(t=>t.type))}>`),canonical:Zp,eq:(n,e)=>{if(n.operator!==e.operator||n.nops!==e.nops)return!1;let t=i=>e.ops.some(r=>i.isSame(r));return n.ops.every(t)},collection:{...Kr(),at:void 0,indexWhere:void 0}},Tuple:{description:"A fixed number of heterogeneous elements",complexity:8200,signature:"(any*) -> tuple",type:n=>A(`tuple<${n.map(e=>e.type).join(", ")}>`),canonical:(n,{engine:e})=>e.tuple(...n),eq:kl,collection:{...Kr(),keys:n=>["first","second","last"]}},KeyValuePair:{description:"A key/value pair",complexity:8200,signature:"(key: string, value: any) -> tuple<string, unknown>",type:([n,e])=>A(`tuple<string, ${e.type}>`),canonical:(n,{engine:e})=>{let[t,i]=Qi(e,n,["string","any"]);return!t.isValid||!i.isValid?e._fn("KeyValuePair",[t,i]):e.tuple(t,i)}},Single:{description:"A tuple with a single element",complexity:8200,signature:"(value: any) -> tuple<any>",type:([n])=>A(`tuple<${n.type}>`),canonical:(n,{engine:e})=>e.tuple(...Xe(e,n,1))},Pair:{description:"A tuple of two elements",complexity:8200,signature:"(first: any, second: any) -> tuple<any, any>",type:([n,e])=>A(`tuple<${n.type}, ${e.type}>`),canonical:(n,{engine:e})=>e.tuple(...Xe(e,n,2))},Triple:{description:"A tuple of three elements",complexity:8200,signature:"(first: any, second: any, third: any) -> tuple<any, any, any>",type:([n,e,t])=>A(`tuple<${n.type}, ${e.type}, ${t.type}>`),canonical:(n,{engine:e})=>e.tuple(...Xe(e,n,3))},Range:{complexity:8200,signature:"(number, number?, step: number?) -> indexed_collection<integer>",canonical:(n,{engine:e})=>n.length===0?null:n.length===1?e._fn("Range",[e.One,n[0].canonical]):n.length===2?e._fn("Range",[n[0].canonical,n[1].canonical]):e._fn("Range",[n[0].canonical,n[1].canonical,n[2].canonical.evaluate()]),eq:(n,e)=>{if(n.operator!==e.operator)return!1;let[t,i,r]=sn(n),[o,s,a]=sn(e);return t===o&&i===s&&r===a},collection:{isLazy:n=>!0,count:n=>{let[e,t,i]=sn(n);return i===0?0:!isFinite(e)||!isFinite(t)?1/0:1+Math.max(0,Math.floor((t-e)/i))},contains:(n,e)=>{if(!e.type.matches("integer"))return!1;let t=e.re,[i,r,o]=sn(n);return o===0?!1:o>0?t>=i&&t<=r:t<=i&&t>=r},iterator:n=>{let[e,t,i]=sn(n),r=i===0?0:Math.floor((t-e)/i)+1,o=1;return{next:()=>o===r+1?{value:void 0,done:!0}:(o+=1,{value:n.engine.number(e+i*(o-1-1)),done:!1})}},at:(n,e)=>{if(typeof e!="number")return;let[t,i,r]=sn(n);if(!(e<1||e>1+(i-t)/r))return n.engine.number(t+r*(e-1))},indexWhere:void 0,subsetOf:(n,e)=>{if(e.operator==="Range"){let[i,r,o]=sn(n),[s,a,u]=sn(e);return i>=s&&r<=a&&o%u===0}if(!e.isCollection)return!1;let t=1;for(let i of e.each()){if(!n.xcontains(i)||!n.at(t)?.isSame(i))return!1;t++}return!0},eltsgn:n=>{let[e,t,i]=sn(n);return i===0?"zero":i>0?e<=t?"positive":"negative":e>=t?"positive":"negative"},elttype:n=>"finite_integer"}},Interval:{description:"A set of real numbers between two endpoints. The endpoints may or may not be included.",complexity:8200,lazy:!0,signature:"(number, number) -> set<real>",canonical:([n,e],{engine:t})=>{if(!n||!e)return null;let[i,r]=Qi(t,[n.canonical,e.canonical],["number","number"]);return!i.isValid||!r.isValid?null:t._fn("Interval",[i,r])},eq:(n,e)=>{let t=ft(n),i=ft(e);return!t||!i?!1:t.start===i.start&&t.end===i.end&&t.openStart===i.openStart&&t.openEnd===i.openEnd},collection:{count:n=>1/0,iterator:n=>{let e=ft(n);if(!e)return{next:()=>({value:void 0,done:!0})};if(e.start>=e.end)return{next:()=>({value:void 0,done:!0})};let t=n.engine,i=0,r=0;return{next:()=>{let o=Math.pow(2,i);r>=o&&(i++,r=0);let s=(2*r+1)/Math.pow(2,i+1),a=e.start+s*(e.end-e.start);return r++,{value:t.number(a),done:!1}}}},isEmpty:n=>{let e=ft(n);return e?e.openStart&&e.start===e.end||e.openEnd&&e.start===e.end?!0:e.openStart&&e.openEnd?!1:e.start>=e.end:!1},isFinite:n=>!1,contains:(n,e)=>{let t=ft(n);return!t||t.openStart&&e.isLessEqual(t.start)||t.openEnd&&e.isGreaterEqual(t.end)?!1:e.isGreaterEqual(t.start)&&e.isLessEqual(t.end)},eltsgn:n=>{let e=ft(n);if(!e||e.start===e.end)return"unsigned";if(e.start>=0&&!e.openStart)return"non-negative";if(e.end<=0&&!e.openEnd)return"non-positive";if(e.start>0&&e.end>0)return"positive";if(e.start<0&&e.end<0)return"negative"},elttype:n=>{let e=ft(n);return e?isFinite(e.start)&&isFinite(e.end)?"finite_real":"real":"never"}}},Linspace:{complexity:8200,signature:"(start: number, end: number?, count: number?) -> indexed_collection",collection:{isLazy:n=>!0,count:n=>{let e=n.op3.re;return isFinite(e)||(e=Yi),Math.max(0,Math.floor(e))},at:(n,e)=>{if(typeof e!="number")return;let t=n.op1.re,i=n.op2.re,r=n.op3.re;if(isFinite(r)||(r=Yi),!(!isFinite(t)||!isFinite(i))&&!(e<1||e>r))return n.engine.number(t+(i-t)*(e-1)/r)},iterator:n=>{let e=n.op1.re,t=n.op2.re,i;isFinite(t)?i=Math.max(0,isFinite(n.op3.re)?n.op3.re:Yi):(t=e,e=1,i=Yi);let r=1;return{next:()=>r===i+1?{value:void 0,done:!0}:(r+=1,{value:n.engine.number(e+(t-e)*(r-1-1)/i),done:!1})}},contains:(n,e)=>{if(!e.type.matches("finite_real"))return!1;let t=e.re,i=n.op1.re,r=n.op2.re;if(t<i||t>r)return!1;let o=n.op3.re;if(isFinite(o)||(o=Yi),o===0)return!1;let s=(r-i)/o;return(t-i)%s===0}}},Contains:{description:"Return True if the collection contains the given value, False otherwise.",complexity:8200,signature:"(collection, any) -> boolean",evaluate:([n,e],{engine:t})=>n.xcontains(e)?t.True:t.False},Length:{complexity:8200,signature:"(collection) -> integer",evaluate:([n],{engine:e})=>n.isEmptyCollection?e.Zero:e.number(n.xsize),sgn:([n])=>n.isEmptyCollection?"zero":"positive"},IsEmpty:{complexity:8200,signature:"(collection) -> boolean",evaluate:([n],{engine:e})=>n.isEmptyCollection?e.True:e.False},Map:{description:["Return the collection where each element has been transformed by the mapping function.","Equivalent to `[f(x) for x in xs]`."],complexity:8200,lazy:!0,signature:"(collection, function) -> collection",type:n=>n[0].type,canonical:(n,{engine:e})=>{let t=ge(e,n[0]?.canonical,"collection"),i=ve(n[1]);return!t.isValid||!i?null:e._fn("Map",[t,i])},collection:{isLazy:n=>!0,count:n=>n.op1.xsize,isEmpty:n=>n.op1.isEmptyCollection,isFinite:n=>n.op1.isFiniteCollection,iterator:n=>{let e=le(n.op2);if(!e)return{next:()=>({value:void 0,done:!0})};let t=n.op1.each();return{next:()=>{for(;;){let{value:i,done:r}=t.next();return r?{value:void 0,done:!0}:{value:e([i])??n.engine.Nothing,done:!1}}}}},at:(n,e)=>{if(!n.isIndexedCollection||typeof e!="number"||!Number.isFinite(e)||e===0)return;let t=n.op1.at(e);if(t)return le(n.op2)?.([t])}}},Filter:{description:["Return the elements of the collection for which the predicate function returns True.","Equivalent to `[x for x in xs if p(x)]`."],complexity:8200,lazy:!0,signature:"(collection, predicate: function) -> collection",type:n=>n[0].type,canonical:(n,{engine:e})=>{let t=ge(e,n[0]?.canonical,"collection"),i=ve(n[1]);return!t.isValid||!i?null:e._fn("Filter",[t,i])},collection:{isLazy:n=>!0,count:n=>1/0,contains:(n,e)=>n.xcontains(e)?le(n.op2)([e])?.symbol==="True":!1,iterator:n=>{let e=le(n.op2);if(!e)return{next:()=>({value:void 0,done:!0})};let t=n.op1.each(),i=0,r=n.engine.iterationLimit;return{next:()=>{for(;;){let{value:o,done:s}=t.next();if(i+=1,i>r)throw new Ye({cause:"iteration-limit-exceeded",message:`Iteration limit of ${r} exceeded while evaluating Filter()`});if(s)return{value:void 0,done:!0};let a=e([o]);if(!a)throw new Error(`Invalid filter predicate. ${an(n.op2)}`);if(a.symbol==="True")return{value:o,done:!1};if(a.symbol!=="False")throw new Error(`Filter predicate must return "True" or "False". ${an(n.op2)}`)}}}},at:(n,e)=>{if(typeof e!="number"||!Number.isFinite(e)||e===0)return;let t=le(n.op2);if(!t)return;if(e<0){if(!n.op1.isFiniteCollection)return;let r=Array.from(n.each()),o=r.length+e+1;return o<1||o>r.length?void 0:r[o-1]}let i=0;for(let r of n.op1.each()){let o=t([r])?.symbol;if(o==="True"){if(i+=1,i===e)return r}else if(o!=="False")throw new Error(`Filter predicate must return "True" or "False". ${an(n.op2)}`)}}}},Reduce:{complexity:8200,lazy:!0,signature:"(collection, function, initial:value?) -> value",canonical:(n,{engine:e})=>{let t=ge(e,n[0],"collection"),i=ve(n[1]);if(!t.isValid||!i)return null;let r=n[2]?.canonical;return r?.isValid?e._fn("Reduce",[t,i,r]):e._fn("Reduce",[t,i])},type:n=>A(We(n[1].type.type)??"unknown"),evaluate:([n,e,t],{engine:i})=>{if(!n.isFiniteCollection)return;if(t??=i.Nothing,t.type.matches("real")&&n.type.matches(i.type("collection<real>"))){let a=e.compile();if(!a)return;let u=t.re,l=!0;for(let c of n.each())l?u=c.re:u=a(u,c.re),l=!1;return i.box(u)}let r=le(e),o=t,s=!0;for(let a of n.each())s?o=a:o=r([o,a])??i.Nothing,s=!1;return o}},Join:{description:["Join the elements of some collections into a flat collection."],complexity:8200,signature:"(collection*) -> collection",type:Hp,collection:{isLazy:n=>!0,count:n=>{let e=0;for(let t of n.ops){let i=t.xsize;if(i===void 0)return;if(!Number.isFinite(i))return 1/0;e+=i}return e},contains:(n,e)=>n.ops.some(t=>t.xcontains(e)),iterator:n=>{let e=n.ops.map(i=>i.each()),t=0;return{next:()=>{for(;;){let{value:i,done:r}=e[t].next();if(!r)return{value:i,done:!1};if(t+=1,t>=e.length)return{value:void 0,done:!0}}}}}}},At:{description:["Access an element of an indexed collection.","If the index is negative, it is counted from the end."],complexity:8200,signature:"(value: list|tuple|string, index: number | string) -> unknown",type:([n])=>n.operatorDefinition?.collection?.elttype?.(n)??"any",evaluate:(n,{engine:e})=>{let t=n[0],i=1;for(;n[i];){let o=t.baseDefinition?.collection?.at;if(!o)return;let s=n[i].string;if(s!==null)t=o(t,s)??e.Nothing;else{let a=n[i].re;if(!Number.isInteger(a))return;t=o(t,a)??e.Nothing}i+=1}return t}},Take:{description:["Return `n` elements from a collection."],complexity:8200,signature:"(xs: indexed_collection, count: number) -> indexed_collection",type:([n])=>`list<${bn(n.type.type)}>`,evaluate:(n,{engine:e,materialization:t})=>{if(!t)return;let i=e._fn("Take",n),r=Array.from(i.each());return e._fn("List",r)},collection:{isLazy:n=>!0,count:Al,isEmpty:n=>{let[e,t]=n.ops;if(e.isEmptyCollection)return!0;if(e.isFiniteCollection===!1)return!1;let i=Math.max(0,P(t)??0),r=e.xsize;if(r!==void 0)return Number.isFinite(i)?Math.min(r,i)===0:!1},isFinite:n=>n.op1.isFiniteCollection,iterator:Wp,at:(n,e)=>{if(typeof e!="number"||e===0)return;let t=Math.max(0,P(n.op2)??0);if(t===0)return;if(e>0)return e>t?void 0:n.op1.at(e);let i=Al(n);if(!(i===void 0||i===0)&&!(e<-i))return n.op1.at(i+e)}}},Drop:{description:["Return the collection without the first n elements."],complexity:8200,signature:"(xs: indexed_collection, count: number) -> indexed_collection",type:([n])=>`list<${bn(n.type.type)}>`,collection:{isLazy:n=>!0,count:n=>{let[e,t]=n.ops,i=e.xsize;if(i===void 0)return;if(!Number.isFinite(i))return 1/0;if(e.isEmptyCollection)return 0;let r=P(t)??0;return r>=i?0:Math.max(0,i-r)},isFinite:n=>n.op1.isFiniteCollection,iterator:n=>{let[e,t]=n.ops,i=P(t)??0;if(i<=0)return e.each();let r=i+1;return{next:()=>{let o=n.op1.at(r++);return o===void 0?{value:void 0,done:!0}:{value:o,done:!1}}}},at:(n,e)=>{if(typeof e!="number")return;let[t,i]=n.ops,r=P(i)??0;if(!(r<=0))return t.at(e+r)}}},First:{complexity:8200,signature:"(collection) -> any",type:([n])=>n.operatorDefinition?.collection?.elttype?.(n)??"any",evaluate:([n],{engine:e})=>n.at(1)??e.Nothing},Second:{complexity:8200,signature:"(collection) -> any",type:([n])=>n.operatorDefinition?.collection?.elttype?.(n)??"any",evaluate:([n],{engine:e})=>n.at(2)??e.Nothing},Last:{complexity:8200,signature:"(collection) -> any",type:([n])=>n.operatorDefinition?.collection?.elttype?.(n)??"any",evaluate:([n],{engine:e})=>n.at(-1)??e.Nothing},Rest:{description:["Return the collection without the first element.","If the collection has only one element, return an empty collection."],complexity:8200,signature:"(indexed_collection) -> indexed_collection",collection:{isLazy:n=>!0,count:n=>{let e=n.op1.xsize;if(e!==void 0)return Math.max(0,e-1)},isEmpty:n=>{if(n.op1.isEmptyCollection)return!0;let e=n.op1.xsize;if(e!==void 0)return e<=1},isFinite:n=>n.op1.isFiniteCollection,iterator:n=>({next:()=>{let e=1,t=n.op1.at(e>0?e+1:e);return t?(e+=1,{value:t,done:!1}):{value:void 0,done:!0}}}),at:(n,e)=>{if(typeof e=="number")return n.op1.at(e>0?e+1:e)}}},Most:{complexity:8200,description:["Return the collection without the last element.","If the collection has only one element, return an empty collection."],signature:"(indexed_collection) -> indexed_collection",collection:{isLazy:n=>!0,count:n=>{let e=n.op1.xsize;if(e!==void 0)return Math.max(0,e-1)},isFinite:n=>n.op1.isFiniteCollection,isEmpty:n=>{let e=n.op1.xsize;if(e!==void 0)return e<=1},iterator:n=>{let e=n.op1.xsize;if(e===void 0||e<=1)return{next:()=>({value:void 0,done:!0})};let t=1,i=e-1;return{next:()=>t>i?{value:void 0,done:!0}:{value:n.op1.at(t++),done:!1}}},at:(n,e)=>{if(typeof e!="number")return;let t=n.op1.xsize;if(t!==void 0&&(e<1&&(e=t+1+e),!(e<1||e>t-1)))return n.op1.at(e)}}},Slice:{description:["Return a range of elements from an indexed collection.","If the index is negative, it is counted from the end."],complexity:8200,signature:"(value: indexed_collection, start: number, end: number) -> list",type:([n])=>A(`list<${bn(n.type.type)}>`),collection:{isLazy:n=>!0,count:n=>{let e=P(n.op2)??1,t=n.op1.xsize;if(t===void 0)return;let i=P(n.op3)??t;return e<1?Math.max(0,i+e-1):Math.max(0,Math.min(i,t)-e+1)},isFinite:n=>!0,at:(n,e)=>{if(typeof e!="number")return;let t=n.op1.xsize;if(t===void 0)return;let i=P(n.op2)??1;if(i<1&&(i=t+1+i),i<1&&(i=1),i>t)return;let r=P(n.op3)??t;r<1&&(r=t+1+r),r<1&&(r=1),r>t&&(r=t)},iterator:n=>{let e=P(n.op2)??1,t=n.op1.xsize;if(t===void 0)return{next:()=>({value:void 0,done:!0})};if(e<1&&(e=t+1+e),e<1&&(e=1),e>t)return{next:()=>({value:void 0,done:!0})};let i=P(n.op3)??t;i<1&&(i=t+1+i),i<1&&(i=1),i>t&&(i=t);let r=e,o=i;return{next:()=>{if(r>o)return{value:void 0,done:!0};let s=n.op1.at(r);return r+=1,{value:s,done:!1}}}}}},Reverse:{complexity:8200,signature:"(indexed_collection) -> indexed_collection",type:([n])=>n.type,collection:{isLazy:n=>!0,count:n=>n.op1.xsize,isEmpty:n=>n.op1.isEmptyCollection,isFinite:n=>n.op1.isFiniteCollection,contains:(n,e)=>n.op1.xcontains(e)??!1,iterator:n=>{let e=-1;return{next:()=>{if(e===0)return{value:void 0,done:!0};let t=n.op1.at(e);return e-=1,{value:t,done:!1}}}},at:(n,e)=>{if(typeof e=="number")return n.op1.at(-e)}}},RotateLeft:{description:"Rotate the elements of the collection to the left by n positions.",complexity:8200,signature:"(indexed_collection, integer?) -> indexed_collection",collection:{isLazy:n=>!0,count:n=>n.op1.xsize,isEmpty:n=>n.op1.isEmptyCollection,isFinite:n=>n.op1.isFiniteCollection,contains:(n,e)=>n.op1.xcontains(e)??!1,iterator:n=>{let e=n.op1.xsize;if(e===void 0||e<=0)return{next:()=>({value:void 0,done:!0})};let t=P(n.op2)??1;t=(t%e+e)%e;let i=1,r=e;return{next:()=>{if(i===r+1)return{value:void 0,done:!0};i+=1;let o=n.op1.at((i-1-1+t)%e+1);return o===void 0?{value:void 0,done:!0}:{value:o,done:!1}}}},at:(n,e)=>{if(typeof e!="number")return;let t=n.op1.xsize;if(t===void 0||t<=0||(e<1&&(e=t+1+e),e<1||e>t))return;let i=P(n.op2)??1;return i=(i%t+t)%t,n.op1.at((e-1+i)%t+1)}}},RotateRight:{description:"Rotate the elements of the collection to the right by n positions.",complexity:8200,signature:"(indexed_collection, integer?) -> indexed_collection",collection:{isLazy:n=>!0,count:n=>n.op1.xsize,contains:(n,e)=>n.op1.xcontains(e)??!1,iterator:n=>{let e=n.op1.xsize;if(e===void 0||e<=0)return{next:()=>({value:void 0,done:!0})};let t=P(n.op2)??1;t=(t%e+e)%e;let i=1;return{next:()=>{if(i===e+1)return{value:void 0,done:!0};i+=1;let r=(i-1-1+(e-t))%e+1,o=n.op1.at(r);return o===void 0?{value:void 0,done:!0}:{value:o,done:!1}}}},at:(n,e)=>{if(typeof e!="number")return;let t=n.op1.xsize;if(t===void 0||t<=0||(e<1&&(e=t+1+e),e<1||e>t))return;let i=P(n.op2)??1;i=(i%t+t)%t;let r=(e-1+(t-i))%t+1;return n.op1.at(r)}}},IndexOf:{description:"Return the 1-based index of the first occurrence of value in collection, or 0 if not found.",complexity:8200,signature:"(collection, any) -> integer",evaluate:([n,e],{engine:t})=>{let i=n.indexWhere(r=>r.isSame(e))??void 0;return t.number(i??0)}},IndexWhere:{description:"Return the 1-based index of the first element satisfying the predicate, or 0 if not found.",complexity:8200,signature:"(collection, function) -> integer",evaluate:([n,e],{engine:t})=>{let i=le(e);if(!i)return t.Zero;let r=n.indexWhere(o=>{let s=i([o])?.symbol;if(s==="True")return!0;if(s==="False")return!1;throw new Error(`Filter predicate must return "True" or "False". ${an(e)}`)})??void 0;return t.number(r??0)}},Find:{description:"Return the first element of the collection satisfying the predicate, or Nothing if none found.",complexity:8200,signature:"(collection, function) -> any",type:n=>n[0].type,evaluate:([n,e],{engine:t})=>{let i=le(e);if(!i)return t.Nothing;for(let r of n.each()){let o=i([r])?.symbol;if(o!=="False"){if(o==="True")return r;throw new Error(`Filter predicate must return "True" or "False". ${an(e)}`)}}return t.Nothing}},CountIf:{description:"Return the number of elements in the collection satisfying the predicate.",complexity:8200,signature:"(collection, function) -> integer",evaluate:([n,e],{engine:t})=>{let i=le(e);if(!i)return t.Zero;let r=0;for(let o of n.each()){let s=i([o])?.symbol;if(s!=="False")if(s==="True")r++;else throw new Error(`Filter predicate must return "True" or "False". ${an(e)}`)}return t.number(r)}},Position:{description:"Return a list of indexes of elements in the collection satisfying the predicate.",complexity:8200,signature:"(collection, function) -> list<integer>",type:()=>"list<integer>",evaluate:([n,e],{engine:t})=>{let i=le(e);if(!i)return t.function("List",[]);let r=[],o=1;for(let s of n.each()){let a=i([s])?.symbol;if(a==="True"&&r.push(t.number(o)),a!=="False")throw new Error(`Filter predicate must return "True" or "False". ${an(e)}`);o++}return t.function("List",r)}},Ordering:{description:"Return the indexes that would sort the collection.",complexity:8200,signature:"(indexed_collection, function?) -> list<integer>",evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return t.function("List",[]);let i=Cl(n,e);return i?t.function("List",i):t.function("List",[])}},Sort:{description:"Return the elements of the collection sorted according to the given comparison function.",complexity:8200,signature:"(indexed_collection, function?) -> indexed_collection",type:n=>n[0].type,evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return t.function(n.operator,[]);let i=Cl(n,e);if(i)return t.function(n.operator,i.map(r=>n.at(r)))}},Shuffle:{description:"Randomize the order of the elements in the collection.",complexity:8200,signature:"(indexed_collection) -> indexed_collection",type:n=>n[0].type,evaluate:([n],{engine:e})=>{if(!n.isFiniteCollection)return;let t=Array.from(n.each());for(let i=t.length-1;i>0;i--){let r=Math.floor(Math.random()*(i+1));[t[i],t[r]]=[t[r],t[i]]}return e.function(n.operator,t)}},Tabulate:{description:"Create a collection by applying a function to each index in the specified dimensions.",complexity:8200,lazy:!0,signature:"(function, integer, integer?) -> collection",canonical:(n,{engine:e})=>{let t=ve(n[0]);return t?n[2]?e._fn("Tabulate",[t,ge(e,n[1]?.canonical,"integer"),ge(e,n[2]?.canonical,"integer")]):e._fn("Tabulate",[t,ge(e,n[1]?.canonical,"integer")]):null},evaluate:(n,{engine:e})=>{let t=le(n[0]);if(!t)return;if(n.length===1)return e._fn("List",[]);let i=n.slice(1).map(o=>P(o));if(i.some(o=>o===null||o<=0))return;if(i.length===1)return e._fn("List",Array.from({length:i[0]??0},(o,s)=>t([e.number(s+1)])??e.Nothing));let r=(o,s,a=0)=>{if(a===o.length){let l=s.map(c=>e.number(c));return t(l)}let u=["List"];for(let l=1;l<=o[a];l++)s[a]=l,u.push(r(o,s,a+1));return u};return e.box(r(i,Array(i.length).fill(0)))}},Tally:{description:"Return a tuple with the unique elements of the collection and their respective counts.",complexity:8200,signature:"(collection) -> tuple<list, list<integer>>",type:([n],{engine:e})=>{let t=n.type.type;return t==="string"?A("tuple<list<string>, list<integer>>"):A(`tuple<list<${bn(t)}>, list<integer>>`)},evaluate:(n,{engine:e})=>{if(!n[0].isFiniteCollection)return;let[t,i]=wl(n[0]);return e.tuple(e.function("List",t),e.function("List",i))}},Unique:{description:"Return a list of the unique elements of the collection.",complexity:8200,signature:"(collection) -> list",type:([n])=>`list<${bn(n.type.type)}>`,evaluate:(n,{engine:e})=>{if(!n[0].isFiniteCollection)return;let[t,i]=wl(n[0]);return e.function("List",t)}},Partition:{wikidata:"Q381060",complexity:8200,signature:"(collection, integer | function) -> list",type:([n])=>`list<${bn(n.type.type)}>`,evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=P(e);if(i!==null&&i>0){let a=Array.from(n.each()),u=[],l=Math.ceil(a.length/i);for(let c=0;c<i;c++){let f=a.slice(c*l,(c+1)*l);u.push(t.function("List",f))}return t.function("List",u)}let r=le(e);if(!r)return;let o=[],s=[];for(let a of n.each()){let u=r([a])?.symbol;if(u==="True")o.push(a);else if(u==="False")s.push(a);else throw new Error(`Partition predicate must return "True" or "False". ${an(e)}`)}return t.function("List",[t.function("List",o),t.function("List",s)])}},Chunk:{description:"Split the collection into `k` nearly equal-sized chunks.",complexity:8200,signature:"(collection, integer) -> list<list>",evaluate:([n,e],{engine:t})=>{let i=P(e);if(!n.isFiniteCollection||i===null||i<=0)return;let r=Array.from(n.each()),o=[],s=Math.ceil(r.length/i);for(let a=0;a<i;a++){let u=r.slice(a*s,(a+1)*s);o.push(t.function("List",u))}return t.function("List",o)}},GroupBy:{description:["Partition the collection into a dictionary of lists based on the key returned by the function."],complexity:8200,signature:"(collection, function) -> dictionary<list>",evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=le(e);if(!i)return;let r={};for(let o of n.each()){let s=i([o])??t.Nothing,a=s.symbol??s.string??s.toString();a in r||(r[a]=[]),r[a].push(o)}return t.function("Dictionary",Object.entries(r).map(([o,s])=>t._fn("Tuple",[t.string(o),t.function("List",s)])))}},Zip:{description:"Combine multiple collections element-wise into a list of tuples. The result has the length of the shortest input.",complexity:8200,signature:"(indexed_collection+) -> list",collection:{isLazy:n=>!0,count:Os,isFinite:n=>n.ops.every(e=>e.isFiniteCollection),isEmpty:n=>n.nops===0||n.ops.every(e=>e.isEmptyCollection),iterator:n=>{let e=Os(n);if(e===void 0||e<=0)return{next:()=>({value:void 0,done:!0})};let t=1;return{next:()=>{if(t===e+1)return{value:void 0,done:!0};t+=1;let i=n.ops.map(r=>r.at(t-1));return i.some(r=>r===void 0)?{value:void 0,done:!0}:{value:n.engine.tuple(...i),done:!1}}}},at:(n,e)=>{if(typeof e!="number"||e<1)return;let t=Os(n);if(t===void 0||e<1||e>t)return;let i=n.ops.map(r=>r.at(e));if(!i.some(r=>r===void 0))return n.engine.tuple(...i)}}},Iterate:{description:"Produce an infinite sequence by repeatedly applying a function to the previous value, starting with an initial value.",complexity:8200,signature:"((index: integer, acc:any) -> any, initial: any?) -> list",canonical:([n,e],{engine:t})=>{let i=ve(n);if(!i)return null;let r=e?.canonical;return r?t._fn("Iterate",[i,r]):t._fn("Iterate",[i])},collection:{isLazy:n=>!0,count:()=>1/0,iterator:n=>{let e=le(n.op1);if(!e)return{next:()=>({value:void 0,done:!0})};let t=n.op2??n.engine.Nothing,i=0;return{next:()=>(i+=1,t=e([n.engine.number(i),t])??n.engine.Nothing,{value:t,done:!1})}},at:(n,e)=>{if(typeof e!="number"||e<1)return;let t=le(n.op1);if(!t)return;let i=n.op2??n.engine.Nothing;for(let r=1;r<e;r++)i=t([n.engine.number(r),i])??n.engine.Nothing;return i}}},Repeat:{description:"Produce an infinite sequence by repeating a single value.",complexity:8200,signature:"(value: any) -> list",collection:{isLazy:n=>!0,count:()=>1/0,isEmpty:n=>!1,isFinite:()=>!1,contains:(n,e)=>n.op1.isSame(e),iterator:n=>({next:()=>({value:n.op1,done:!1})}),at:(n,e)=>n.op1}},Cycle:{description:"Produce an infinite sequence by cycling through the elements of a finite collection.",complexity:8200,signature:"(list) -> list",collection:{isLazy:n=>!0,count:()=>1/0,isEmpty:n=>n.isEmptyCollection,isFinite:n=>!n.isEmptyCollection,contains:(n,e)=>n.op1.xcontains(e)??!1,iterator:n=>{let e=1,t=n.op1.xsize;return t===void 0||t===0?{next:()=>({value:void 0,done:!0})}:{next:()=>{let i=(e-1-1)%t+1,r=n.op1.at(i);return r===void 0?{value:void 0,done:!0}:(e+=1,{value:r,done:!1})}}},at:(n,e)=>{if(typeof e!="number"||e<1)return;let t=n.op1.xsize;if(t===void 0||t===0)return;let i=(e-1)%t+1;return n.op1.at(i)}}},Fill:{description:"Produce a 2D list (matrix) by applying a function to each pair of row and column indexes.",complexity:8200,signature:"(function, tuple) -> list",collection:{isLazy:n=>!0,count:n=>n.op2.ops.map(t=>P(t)??0)[0]??0,iterator:n=>{let e=le(n.op1);if(!e)return{next:()=>({value:void 0,done:!0})};let t=n.op2.ops.map(a=>P(a)??0),i=t[0]??0,r=t[1]??0,o=i,s=1;return{next:()=>{if(s===o+1)return{value:void 0,done:!0};s+=1;let a=[];for(let u=1;u<=r;u++)a.push(e([n.engine.number(s-1),n.engine.number(u)])??n.engine.Nothing);return{value:n.engine.function("List",a),done:!1}}}},at:(n,e)=>{if(typeof e!="number"||e<1)return;let t=le(n.op1);if(!t)return;let i=n.op2.ops.map(u=>P(u)??0),r=i[0]??0,o=i[1]??0;if(e>r*o)return;let s=Math.ceil(e/o),a=(e-1)%o+1;return t([n.engine.number(s),n.engine.number(a)])??n.engine.Nothing}}},ListFrom:{description:"Create a list from the elements of a collection.",complexity:8200,signature:"(value*) -> list",type:n=>{if(n.length===0)return"list";let e="unknown";for(let t of n){if(t.isCollection&&!t.isFiniteCollection)return"list";e=oe(e,bn(t.type.type)??e)}return A(`list<${U(e)}>`)},evaluate:(n,{engine:e})=>{let t=[];for(let i of n)if(!i.isCollection)t.push(i);else{if(!i.isFiniteCollection)return;t.push(...Array.from(i.each()))}return e.function("List",t)}},SetFrom:{description:"Create a set from the elements of a collection.",complexity:8200,signature:"(value*) -> set",type:n=>{if(n.length===0)return"set";let e="unknown";for(let t of n){if(t.isCollection&&!t.isFiniteCollection)return"set";e=oe(e,bn(t.type.type)??e)}return A(`set<${U(e)}>`)},evaluate:(n,{engine:e})=>{let t=[];for(let i of n)if(i.isCollection)t.push(i);else{if(!i.isFiniteCollection)return;t.push(...Array.from(i.each()))}return e.function("Set",t)}},TupleFrom:{description:"Create a tuple from the elements of a collection.",complexity:8200,signature:"(value*) -> tuple",evaluate:(n,{engine:e})=>{let t=[];for(let i of n)if(i.isCollection)t.push(i);else{if(!i.isFiniteCollection)return;t.push(...Array.from(i.each()))}return e.tuple(...t)}},DictionaryFrom:{description:"Create a dictionary from the elements of a collection of (key, value) pairs.",complexity:8200,signature:"(collection) -> dictionary",evaluate:([n],{engine:e})=>{if(!n.isCollection)return;if(n.operator==="Record")return e.function("Dictionary",n.ops);let t=[];for(let i of n.each()){if(i.nops!==2)throw new Error(`Expected a collection of pairs, got ${i.type}`);let r=i.op1,o=i.op2;if(!r.string)throw new Error(`Expected a string key, got ${r.type}`);t.push(e.tuple(r,o))}return e.function("Dictionary",t)}},RecordFrom:{description:"Create a record from the elements of a collection of (key, value) pairs.",complexity:8200,signature:"(collection) -> record",evaluate:([n],{engine:e})=>{if(!n.isCollection)return;if(n.operator==="Dictionary")return e.function("Record",n.ops);let t=[];for(let i of n.each()){if(i.nops!==2)throw new Error(`Expected a collection of pairs, got ${i.type}`);let r=i.op1,o=i.op2;if(!r.string)throw new Error(`Expected a string key, got ${r.type}`);t.push(e.tuple(r,o))}return e.function("Record",t)}}};function sn(n){if(n.nops===0)return[1,0,0];let e=n.op1.re;if(isFinite(e)?e=Math.round(e):e=1,n.nops===1)return[1,e,1];let t=n.op2.re;if(!isFinite(t)&&!t?t=1:isFinite(t)&&(t=Math.round(t)),n.nops===2)return[e,t,t>e?1:-1];let i=n.op3.re;return isFinite(i)?i=Math.abs(Math.round(i)):i=1,[e,t,e<t?i:-i]}function Ml(n){let[e,t,i]=n;return Number.isFinite(t)?i>0?t-(t-e)%i:t+(e-t)%i:i>0?1/0:-1/0}function jp(n,{engine:e}){let t=n[0];if(n.length===1&&t.operator==="Matrix"){let[i,r,o]=t.ops;if(!r||r.string==="..")return o?e._fn("Matrix",[i,e.string("[]"),o]):e._fn("Matrix",[i,r])}return n=n.map(i=>i.operator==="Delimiter"?i.op1.operator==="Sequence"?e._fn("List",Qe(e,i.op1.ops)):e._fn("List",[i.op1?.canonical??e.Nothing]):i.canonical),e._fn("List",n)}function Zp(n,{engine:e}){let t=[],i=r=>t.some(o=>o.isSame(r));for(let r of n)i(r)||t.push(r);return e._fn("Set",t)}function wl(n){let e=[],t=[],i=r=>{for(let o=0;o<e.length;o++)if(e[o].isSame(r))return o;return-1};for(let r of n.each()){let o=i(r);o>=0?t[o]++:(e.push(r),t.push(1))}return[e,t]}function*Rl(n,e,t){let i=t,r=0;for(let o of n.each()){let s=e(i,o);if(s===null)return;r+=1,r%1e3===0&&(yield i),i=s}return i}function Hp(n){return n.some(e=>e.type.matches("record"))?"record":n.some(e=>e.type.matches("dictionary"))?"dictionary":n.some(e=>e.type.matches("set"))?"set":"list"}function kl(n,e){return n.operator!==e.operator||n.nops!==e.nops?!1:n.ops.every((t,i)=>t.isSame(e.ops[i]))}function Fs(n,e){return Array.from({length:e-n+1},(t,i)=>n+i)}function Cl(n,e=void 0){let t=e?le(e):void 0,i=t?(s,a)=>{let u=t([s,a]);return u?.isNegative?-1:u?.is(0)?0:1}:(s,a)=>s.isLess(a)?-1:s.isEqual(a)?0:1,r=n.xsize;if(r===void 0||!Number.isFinite(r)||r<1)return;let o=Array.from({length:r},(s,a)=>a+1);return o.sort((s,a)=>{let u=n.at(s),l=n.at(a);return i(u,l)}),o}function $s(n){if(n.length===0)return[];let e=[];for(let t of n)t.symbol!=="Nothing"&&(t.operator==="Sequence"?e.push(...$s(t.ops)):t.string?e.push(t):t.isCollection?e.push(...$s([...t.each()])):e.push(t));return e}function Wp(n){let e=Math.max(0,P(n.op2)??0);if(e===0)return{next:()=>({value:void 0,done:!0})};let t=1,i=0;return{next:()=>{if(i>=Math.abs(e))return{value:void 0,done:!0};let r=n.op1.at(t);return r?(t+=1,i+=1,{value:r,done:!1}):{value:void 0,done:!0}}}}function Al(n){let[e,t]=n.ops,i=e.xsize;if(i===void 0)return;let r=Math.max(0,P(t)??0);return Number.isFinite(r)?Math.min(i,r):1/0}function Os(n){let e=n.ops.map(t=>t.xsize);if(!e.some(t=>t===void 0))return e.some(t=>!Number.isFinite(t))?1/0:e.length===0?0:Math.min(...e)}function uo(n){n?.operator;let e=1,t=e+Ri,i,r=!0;return i=n.op1.symbol,e=Math.floor(n.op2.re),isNaN(e)&&(e=1),Number.isFinite(e)||(r=!1),n.op3.symbol==="Nothing"||n.op3.isInfinity?r=!1:(isNaN(n.op3.re)||(t=Math.floor(n.op3.re??t)),Number.isFinite(t)||(r=!1)),!r&&Number.isFinite(e)&&(t=e+Ri),{index:i,lower:e,upper:t,isFinite:r}}function Jp(n){return n.map(e=>uo(e))}function Yp(n){n.length>0;let{index:e,lower:t,upper:i,isFinite:r}=n[0];r||(i=t+Ri);let o=Fs(t,i).map(s=>[s]);if(n.length===1)return o;for(let s=1;s<n.length;s++){let{index:a,lower:u,upper:l,isFinite:c}=n[s];c||(l=u+Ri),o=Qp(o.map(f=>f[0]),Fs(u,l))}return o}function Qp(n,e){return n.flatMap(t=>e.map(i=>[t,i]))}function Pl(n,e){let t=e.engine,i=[];for(let r=0;r<n.length;r++){let o=n[r];o.operator==="Range"?i.push(dt([t.Nothing,o.op1,o.op2],e)??t.error("missing")):o.operator&&["Limits","Tuple","Triple","Pair","Single","Hold"].includes(o.operator)?i.push(dt(o.ops,e)??t.error("missing")):o.symbol&&(n[r+1]?.isNumberLiteral?n[r+2]?.isNumberLiteral?(i.push(dt([o,n[r+1],n[r+2]],e)??t.error("missing")),r+=2):(i.push(dt([o,n[r+1]],e)??t.error("missing")),r+=1):i.push(dt([o],e)??t.error("missing")))}return i}function dt(n,{engine:e}){if(n.length===1){let t=n[0];return t.symbol?e._fn("Limits",[t,e.Nothing,e.Nothing]):t.operator==="Hold"?dt(t.ops,{engine:e}):e._fn("Limits",[e.typeError("symbol",void 0,t)])}else if(n.length>1){let t=e.Nothing,i=e.Nothing,r=n[1].canonical;return n.length===2?n[0].operator==="Hold"?(t=n[0].op1,r=n[1].canonical):n[0].symbol?(t=n[0],r=n[1].canonical):(t=e.Nothing,i=n[0].canonical,r=n[1].canonical):n.length===3&&(t=n[0]??e.Nothing,i=n[1]?.canonical??e.Nothing,r=n[2]?.canonical??e.Nothing),t.operator==="Hold"&&(t=t.op1),t.symbol||(t=e.typeError("symbol",t.type,t)),i.symbol!=="Nothing"&&(i=ge(e,i,"number")),r.symbol!=="Nothing"&&(r=ge(e,r,"number")),e._fn("Limits",[t,i,r])}return null}function Xp(n){let e=n.engine,t,i=null,r=null;if(n.operator==="Tuple"||n.operator==="Triple"||n.operator==="Pair"||n.operator==="Single"?(t=n.op1,r=n.ops[1]?.canonical??null,i=n.ops[2]?.canonical??null):t=n,t.operator==="Hold"&&(t=t.op1),!!t.symbol)return t.symbol&&t.symbol!=="Nothing"&&e.declare(t.symbol,"integer"),i&&r?e.function("Limits",[t,r,i]):i?e.function("Limits",[t,e.One,i]):r?e.function("Limits",[t,r]):e.function("Limits",[t])}function Vs(n,e,t,i){let r=e.engine;r.pushScope(i);let o=t.map(s=>Xp(s)).filter(s=>s??r.error("missing"));return e=e?.canonical??r.error("missing"),r.popScope(),e.isCollection?n==="Sum"?r.box(["Reduce",e,"Add",0]):r.box(["Reduce",e,"Multiply",1]):r._fn(n,[e,...o],{scope:i})}function*Xi(n,e,t,i){if(n.isCollection)return yield*Rl(n.evaluate(),t,i);if(e.length===0)return t(i,n)??void 0;let r=n.engine,o=Jp(e),s=Yp(o),a=i,u=0;for(let l of s)if(o.forEach((c,f)=>r.assign(c.index,l[f])),a=t(a,n)??void 0,u+=1,u%1e3===0&&(yield a),a===void 0)break;return a??void 0}function Kp(n,e){if(e===0)return{estimate:n,error:e};let t=Math.abs(e),i=Math.floor(Math.log10(t)),r=2,o=Math.pow(10,i-(r-1)),s=Math.round(e/o)*o,a=Math.max(0,-(i-(r-1)));return{estimate:Number(n.toFixed(a)),error:s}}function di(n,e,t,i=1e5){let r=0,o=0;if(e===-1/0&&t===1/0)for(let p=0;p<i;p++){let x=Math.random(),g=Math.tan(Math.PI*(x-.5)),b=Math.PI*(1+g*g),_=n(g)/b;r+=_,o+=_*_}else if(e===-1/0)for(let p=0;p<i;p++){let x=Math.random(),g=t-Math.log(1-x),b=1/(1-x),_=n(g)/b;r+=_,o+=_*_}else if(t===1/0)for(let p=0;p<i;p++){let x=Math.random(),g=e+Math.log(x),b=1/x,_=n(g)/b;r+=_,o+=_*_}else for(let p=0;p<i;p++){let x=n(e+Math.random()*(t-e));r+=x,o+=x*x}let s=r/i,a=(o-i*s*s)/(i-1),u=Math.sqrt(a/i),l=t-e,c=s*l,f=u*l;return Kp(c,f)}var Ll=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function pi(n){if(n<0)return NaN;let e=Math.PI,t=n*n*n;return n*Math.log(n)-n-.5*Math.log(n)+.5*Math.log(2*e)+1/(12*n)-1/(360*t)+1/(1260*t*n*n)}function pt(n){if(n<.5)return Math.PI/(Math.sin(Math.PI*n)*pt(1-n));if(n>100)return Math.exp(pi(n));n-=1;let e=Ll[0];for(let i=1;i<9;i++)e+=Ll[i]/(n+i);let t=n+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(t,n+.5)*Math.exp(-t)*e}function Ol(n){let e=Math.PI,t=e*e,i=t*e,r=n*n,o=n*r,s=o*r,a=s*r;return Math.sqrt(e)/2*(n+e/12*o+7*t/480*s+127*i/40320*a+4369*t*t/5806080*a*r+34807*i*t/182476800*a*r*r)}function qs(n){let e=.254829592,t=-.284496736,i=1.421413741,r=-1.453152027,o=1.061405429,s=.3275911,a=n<0?-1:1;n=Math.abs(n);let u=1/(1+s*n),l=((((o*u+r)*u+i)*u+t)*u+e)*u;return a*(1-l*Math.exp(-n*n))}function zs(n,e){if(e.isNegative())return n._BIGNUM_NAN;let t=n._cache("gamma-p-ln",()=>["0.99999999999999709182","57.156235665862923517","-59.597960355475491248","14.136097974741747174","-0.49191381609762019978","0.33994649984811888699e-4","0.46523628927048575665e-4","-0.98374475304879564677e-4","0.15808870322491248884e-3","-0.21026444172410488319e-3","0.2174396181152126432e-3","-0.16431810653676389022e-3","0.84418223983852743293e-4","-0.2619083840158140867e-4","0.36899182659531622704e-5"].map(s=>n.bignum(s))),i=t[0];for(let s=t.length-1;s>0;--s)i=i.add(t[s].div(e.add(s)));let r=n._cache("gamma-g-ln",()=>n.bignum(607).div(128)),o=e.add(r).add(n._BIGNUM_HALF);return n._BIGNUM_NEGATIVE_ONE.acos().mul(n._BIGNUM_TWO).log().mul(n._BIGNUM_HALF).add(o.log().mul(e.add(n._BIGNUM_HALF)).minus(o).add(i.log()).minus(e.log()))}function Gs(n,e){if(e.lessThan(n._BIGNUM_HALF)){let o=n._BIGNUM_NEGATIVE_ONE.acos();return o.div(o.mul(e).sin().mul(Gs(n,n._BIGNUM_ONE.sub(e))))}if(e.greaterThan(100))return zs(n,e).exp();e=e.sub(1);let t=n._cache("lanczos-7-c",()=>["0.99999999999980993227684700473478","676.520368121885098567009190444019","-1259.13921672240287047156078755283","771.3234287776530788486528258894","-176.61502916214059906584551354","12.507343278686904814458936853","-0.13857109526572011689554707","9.984369578019570859563e-6","1.50563273514931155834e-7"].map(o=>n.bignum(o))),i=t[0];for(let o=1;o<9;o++)i=i.add(t[o].div(e.add(o)));let r=e.add(7).add(n._BIGNUM_HALF);return n._BIGNUM_NEGATIVE_ONE.acos().times(n._BIGNUM_TWO).sqrt().mul(i.mul(r.neg().exp()).mul(r.pow(e.add(n._BIGNUM_HALF))))}function Ki(n){let e=0,t=0;for(let i of n)e+=i,t++;return t===0?NaN:e/t}function $l(n,e){let t=n(0),i=0;for(let r of e)t=t.add(r),i++;return i===0?n(NaN):t.div(i)}function Pn(n){let e=[...n].sort((i,r)=>i-r),t=Math.floor(e.length/2);return e.length%2===0?(e[t-1]+e[t])/2:e[t]}function Ct(n){let e=[...n].sort((i,r)=>i.cmp(r)),t=Math.floor(e.length/2);return e.length%2===0?e[t-1].add(e[t]).div(2):e[t]}function At(n){let e=0,t=0,i=0;for(let r of n)e+=r,t+=r*r,i++;return i===0?NaN:(t-e*e/i)/(i-1)}function Us(n,e){let t=n(0),i=n(0),r=0;for(let o of e)t=t.add(o),i=i.add(o.mul(o)),r++;return r===0?n(NaN):i.sub(t.mul(t).div(r)).div(r-1)}function Dt(n){let e=0,t=0,i=0;for(let r of n)e+=r,t+=r*r,i++;return i===0?NaN:(t-e*e/i)/i}function js(n,e){let t=n(0),i=n(0),r=0;for(let o of e)t=t.add(o),i=i.add(o.mul(o)),r++;return r===0?n(NaN):i.sub(t.mul(t).div(r)).div(r)}function Zs(n){return Math.sqrt(At(n))}function Hs(n){return Math.sqrt(Dt(n))}function er(n){let e=0,t=0,i=0,r=0;for(let s of n){let a=s;if(!Number.isFinite(a))return NaN;e+=a,t+=a*a,i+=a*a*a*a,r++}if(r===0)return NaN;let o=(t-e*e/r)/(r-1);return(i-4*e*t/r+6*e*e*e/r/r-3*e*e*e*e/r/r/r)/(o*o)}function Fl(n,e){let t=n(0),i=n(0),r=n(0),o=0;for(let a of e){let u=a;if(!u.isFinite())return n(NaN);t=t.add(u),i=i.add(u.mul(u)),r=r.add(u.mul(u).mul(u).mul(u)),o++}if(o===0)return n(NaN);let s=i.sub(t.mul(t).div(o)).div(o-1);return r.sub(t.mul(i).mul(4).div(o)).add(t.mul(t).mul(t).mul(6).div(o).div(o)).sub(t.mul(t).mul(t).mul(t).div(o).div(o).div(o)).div(s.mul(s))}function nr(n){let e=0,t=0,i=0,r=0;for(let a of n){let u=a;if(!Number.isFinite(u))return NaN;e+=u,t+=u*u,i+=u*u*u,r++}if(r===0)return NaN;let o=(t-e*e/r)/(r-1);return(i-t*e/r)/(r-1)/Math.pow(o,3/2)*Math.sqrt(r*1)}function Vl(n,e){let t=n(0),i=n(0),r=n(0),o=0;for(let u of e){let l=u;if(!l.isFinite())return n(NaN);t=t.add(l),i=i.add(l.mul(l)),r=r.add(l.mul(l).mul(l)),o++}if(o===0)return n(NaN);let s=i.sub(t.mul(t).div(o)).div(o-1);return r.sub(i.mul(t).div(o)).div(o-1).div(s.pow(3/2)).mul(o).sqrt()}function tr(n){let e={};for(let r of n)e[r]=(e[r]??0)+1;let t=0,i=NaN;for(let r in e){let o=e[r];o>t&&(t=o,i=+r)}return i}function ql(n,e){let t={};for(let o of e)t[o.toString()]=(t[o.toString()]??0)+1;let i=0,r=n(NaN);for(let o in t){let s=t[o];s>i&&(i=s,r=n(o))}return r}function ir(n){let e=[...n].sort((s,a)=>s-a),t=Math.floor(e.length/2),i=Pn(e.slice(0,t)),r=Pn(e),o=Pn(e.slice(t));return[i,r,o]}function zl(n){let e=[...n].sort((s,a)=>s.cmp(a)),t=Math.floor(e.length/2),i=Ct(e.slice(0,t)),r=Ct(e),o=Ct(e.slice(t));return[i,r,o]}function rr(n){let e=[...n].sort((o,s)=>o-s),t=Math.floor(e.length/2),i=e.slice(0,t),r=e.slice(t+1);return Pn(r)-Pn(i)}function Gl(n){let e=[...n].sort((o,s)=>o.cmp(s)),t=Math.floor(e.length/2),i=e.slice(0,t),r=e.slice(t+1);return Ct(r).sub(Ct(i))}var em={Add:["+",11],Negate:["-",14],Subtract:["-",11],Multiply:["*",12],Divide:["/",13],Equal:["===",8],NotEqual:["!==",8],LessEqual:["<=",9],GreaterEqual:[">=",9],Less:["<",9],Greater:[">",9],And:["&&",4],Or:["||",3],Not:["!",14]},nm={Abs:"Math.abs",Add:(n,e)=>n.length===1?e(n[0]):`(${n.map(t=>e(t)).join(" + ")})`,Arccos:"Math.acos",Arccosh:"Math.acosh",Arccot:([n],e)=>{if(n===null)throw new Error("Arccot: no argument");return`Math.atan(1 / (${e(n)}))`},Arccoth:([n],e)=>{if(n===null)throw new Error("Arccoth: no argument");return`Math.atanh(1 / (${e(n)}))`},Arccsc:([n],e)=>{if(n===null)throw new Error("Arccsc: no argument");return`Math.asin(1 / (${e(n)}))`},Arccsch:([n],e)=>{if(n===null)throw new Error("Arccsch: no argument");return`Math.asinh(1 / (${e(n)}))`},Arcsec:([n],e)=>{if(n===null)throw new Error("Arcsec: no argument");return`Math.acos(1 / (${e(n)}))`},Arcsech:([n],e)=>{if(n===null)throw new Error("Arcsech: no argument");return`Math.acosh(1 / (${e(n)}))`},Arcsin:"Math.asin",Arcsinh:"Math.asinh",Arctan:"Math.atan",Arctanh:"Math.atanh",Ceiling:"Math.ceil",Chop:"_SYS.chop",Cos:"Math.cos",Cosh:"Math.cosh",Cot:([n],e)=>{if(n===null)throw new Error("Cot: no argument");return Ul("Math.cos(${x}) / Math.sin(${x})",e(n))},Coth:([n],e)=>{if(n===null)throw new Error("Coth: no argument");return Ul("(Math.cosh(${x}) / Math.sinh(${x}))",e(n))},Csc:([n],e)=>{if(n===null)throw new Error("Csc: no argument");return`1 / Math.sin(${e(n)})`},Csch:([n],e)=>{if(n===null)throw new Error("Csch: no argument");return`1 / Math.sinh(${e(n)})`},Exp:"Math.exp",Floor:"Math.floor",Gamma:"_SYS.gamma",GCD:"_SYS.gcd",Integrate:(n,e,t)=>rm(n,e,t),LCM:"_SYS.lcm",Limit:(n,e)=>`_SYS.limit(${e(n[0])}, ${e(n[1])})`,Ln:"Math.log",List:(n,e)=>`[${n.map(t=>e(t)).join(", ")}]`,Log:(n,e)=>n.length===1?`Math.log10(${e(n[0])})`:`(Math.log(${e(n[0])}) / Math.log(${e(n[1])}))`,LogGamma:"_SYS.lngamma",Lb:"Math.log2",Max:"Math.max",Mean:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.mean(${e(n[0])})`:`_SYS.mean([${n.map(t=>e(t)).join(", ")}])`,Median:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.median(${e(n[0])})`:`_SYS.median([${n.map(t=>e(t)).join(", ")}])`,Variance:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.variance(${e(n[0])})`:`_SYS.variance([${n.map(t=>e(t)).join(", ")}])`,PopulationVariance:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.populationVariance(${e(n[0])})`:`_SYS.populationVariance([${n.map(t=>e(t)).join(", ")}])`,StandardDeviation:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.standardDeviation(${e(n[0])})`:`_SYS.standardDeviation([${n.map(t=>e(t)).join(", ")}])`,PopulationStandardDeviation:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.populationStandardDeviation(${e(n[0])})`:`_SYS.populationStandardDeviation([${n.map(t=>e(t)).join(", ")}])`,Kurtosis:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.kurtosis(${e(n[0])})`:`_SYS.kurtosis([${n.map(t=>e(t)).join(", ")}])`,Skewness:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.skewness(${e(n[0])})`:`_SYS.skewness([${n.map(t=>e(t)).join(", ")}])`,Mode:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.mode(${e(n[0])})`:`_SYS.mode([${n.map(t=>e(t)).join(", ")}])`,Quartiles:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.quartiles(${e(n[0])})`:`_SYS.quartiles([${n.map(t=>e(t)).join(", ")}])`,InterquartileRange:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.interquartileRange(${e(n[0])})`:`_SYS.interquartileRange([${n.map(t=>e(t)).join(", ")}])`,Min:"Math.min",Power:(n,e)=>{let t=n[0];if(t===null)throw new Error("Power: no argument");let i=n[1].re;return i===.5?`Math.sqrt(${e(t)})`:i===1/3?`Math.cbrt(${e(t)})`:i===1?e(t):i===-1?`(1 / (${e(t)}))`:i===-.5?`(1 / Math.sqrt(${e(t)}))`:`Math.pow(${e(t)}, ${e(n[1])})`},Range:(n,e)=>{if(n.length===0)return"[]";if(n.length===1)return`Array.from({length: ${e(n[0])}}, (_, i) => i)`;let t=e(n[0]),i=e(n[1]),r=n[2]?e(n[2]):"1";if(t===null)throw new Error("Range: no start");if(i===null&&(i=t,t="1"),r==="0")throw new Error("Range: step cannot be zero");if(parseFloat(r)===1){let o=parseFloat(i),s=parseFloat(t);return o!==null&&s!==null?o-s<50?`[${Array.from({length:o-s+1},(a,u)=>s+u).join(", ")}]`:`Array.from({length: ${o-s+1} 
        }, (_, i) => ${t} + i)`:`Array.from({length: ${i} - ${t} + 1
      }, (_, i) => ${t} + i)`}return`Array.from({length: Math.floor((${i} - ${t}) / ${r}) + 1}, (_, i) => ${t} + i * ${r})`},Root:([n,e],t)=>{if(n===null)throw new Error("Root: no argument");return e===null?`Math.sqrt(${t(n)})`:e?.re===2?`Math.sqrt(${t(n)})`:e?.re===3?`Math.cbrt(${t(n)})`:isNaN(e?.re)?`Math.pow(${t(n)}, 1 / (${t(e)}))`:`Math.pow(${t(n)},  ${1/e.re})`},Random:"Math.random",Round:"Math.round",Square:(n,e)=>{let t=n[0];if(t===null)throw new Error("Square: no argument");return`Math.pow(${e(t)}, 2)`},Sec:(n,e)=>{let t=n[0];if(t===null)throw new Error("Sec: no argument");return`1 / Math.cos(${e(t)})`},Sech:(n,e)=>{let t=n[0];if(t===null)throw new Error("Sech: no argument");return`1 / Math.cosh(${e(t)})`},Sgn:"Math.sign",Sin:"Math.sin",Sinh:"Math.sinh",Sqrt:"Math.sqrt",Tan:"Math.tan",Tanh:"Math.tanh"},Ws=class extends Function{SYS={chop:is,factorial:ts,gamma:pt,gcd:Pe,integrate:(e,t,i)=>di(e,t,i,1e7).estimate,lcm:Nt,lngamma:pi,limit:at,mean:Ki,median:Pn,variance:At,populationVariance:Dt,standardDeviation:Zs,populationStandardDeviation:Hs,kurtosis:er,skewness:nr,mode:tr,quartiles:ir,interquartileRange:rr};constructor(e,t=""){return super("_SYS","_",t?`${t};return ${e}`:`return ${e}`),new Proxy(this,{apply:(i,r,o)=>super.apply(r,[this.SYS,...o]),get:(i,r)=>r==="toString"?()=>e:r==="isCompiled"?!0:i[r]})}},lo=class extends Function{SYS={chop:is,factorial:ts,gamma:pt,gcd:Pe,integrate:(e,t,i)=>di(e,t,i,1e7).estimate,lcm:Nt,lngamma:pi,limit:at,mean:Ki,median:Pn,variance:At,populationVariance:Dt,standardDeviation:Zs,populationStandardDeviation:Hs,kurtosis:er,skewness:nr,mode:tr,quartiles:ir,interquartileRange:rr};constructor(e,t){return super("_SYS",...t,`return ${e}`),new Proxy(this,{apply:(i,r,o)=>super.apply(r,[this.SYS,...o]),get:(i,r)=>r==="toString"?()=>`(${t.join(", ")}) => ${e}`:r==="isCompiled"?!0:i[r]})}};function tm(n,e){if(n.operator==="Function"){let i=n.ops,r=i.slice(1).map(s=>s.symbol??"_"),o=Ne(i[0].canonical,{...e,var:s=>r.includes(s)?s:e.var(s)});return new lo(o,r)}if(n.symbol){let i=e.operators?.(n.symbol);if(i)return new lo(`a ${i[0]} b`,["a","b"])}let t=Ne(n,e);return new Ws(t,e.preamble)}function jl(n,e,t,i=[],r){let o=n.unknowns,s=i.map(u=>{if(typeof u=="function")return u.toString();throw new Error(`Unsupported import \`${u}\``)}).join(`
`),a=e?Object.fromEntries(Object.entries(e).filter((u,l)=>typeof l!="string")):{};if(e)for(let[u,l]of Object.entries(e))typeof l=="function"&&(om(l)?(s+=`${l.toString()};
`,a[u]=l.name):(s+=`const ${u} = ${l.toString()};
`,a[u]=u));return tm(n,{operators:u=>em[u],functions:u=>a?.[u]?a[u]:nm[u],var:u=>{if(t&&u in t)return JSON.stringify(t[u]);let l={Pi:"Math.PI",ExponentialE:"Math.E",NaN:"Number.NaN",ImaginaryUnit:"Number.NaN",Half:"0.5",MachineEpsilon:"Number.EPSILON",GoldenRatio:"((1 + Math.sqrt(5)) / 2)",CatalanConstant:"0.91596559417721901",EulerGamma:"0.57721566490153286"}[u];if(l!==void 0)return l;if(o.includes(u))return`_.${u}`},string:u=>JSON.stringify(u),number:u=>u.toString(),indent:0,ws:u=>u??"",preamble:(r??"")+s})}function Zl(n,e,t,i,r){if(e==="Error")throw new Error("Error");if(e==="Sequence")return t.length===0?"":`(${t.map(s=>Ne(s,r,i)).join(", ")})`;if(e==="Sum"||e==="Product")return im(e,t,r);if(t.every(s=>!s.isCollection)){let s=r.operators?.(e);if(Je(e)&&t.length>2&&s){let a=[];for(let u=0;u<t.length-1;u++)a.push(Zl(n,e,[t[u],t[u+1]],s[1],r));return`(${a.join(") && (")})`}if(s!==void 0){if(t===null)return"";let a;return t.length===1?a=`${s[0]}${Ne(t[0],r,s[1])}`:a=t.map(u=>Ne(u,r,s[1])).join(` ${s[0]} `),s[1]<i?`(${a})`:a}}if(e==="Function"){let s=t.slice(1).map(a=>a.symbol);return`((${s.join(", ")}) => ${Ne(t[0].canonical,{...r,var:a=>s.includes(a)?a:r.var(a)})})`}if(e==="Declare")return`let ${t[0].symbol}`;if(e==="Assign")return`${t[0].symbol} = ${Ne(t[1],r)}`;if(e==="Return")return`return ${Ne(t[0],r)}`;if(e==="If"){if(t.length!==3)throw new Error("If: wrong number of arguments");return`((${Ne(t[0],r)}) ? (${Ne(t[1],r)}) : (${Ne(t[2],r)}))`}if(e==="Block"){let s=[];for(let u of t)u.operator==="Declare"&&s.push(u.ops[0].symbol);if(t.length===1&&s.length===0)return Ne(t[0],r);let a=t.map(u=>Ne(u,{...r,var:l=>s.includes(l)?l:r.var(l)}));return a[a.length-1]=`return ${a[a.length-1]}`,`(() => {${r.ws(`
`)}${a.join(`;${r.ws(`
`)}`)}${r.ws(`
`)}})()`}let o=r.functions?.(e);if(!o)throw new Error(`Unknown operator \`${e}\``);if(typeof o=="function"){let s=n.lookupDefinition(e);if(Z(s)&&s.operator.broadcastable&&t.length===1&&pe(t[0])){let a=or();return`(${Ne(t[0],r)}).map((${a}) => ${o([t[0].engine.box(a)],u=>Ne(u,r),r)})`}return o(t,a=>Ne(a,r),r)}return t===null?`${o}()`:`${o}(${t.map(s=>Ne(s,r)).join(", ")})`}function Ne(n,e,t=0){if(n===void 0)return"";if(!n.isValid)throw new Error(`Cannot compile invalid expression: "${n.toString()}"`);let i=n.symbol;if(i!==null){let o=e.operators?.(i);return o!==void 0?`(a,b) => a ${o[0]} b`:e.var?.(i)??i}if(n.isNumberLiteral){if(n.im!==0)throw new Error("Complex numbers are not supported");return e.number(n.re)}return n.string!==null?e.string(i):Zl(n.engine,n.operator,n.ops,t,e)}function im(n,e,t){if(e===null)throw new Error("Sum/Product: no arguments");if(!e[0])throw new Error("Sum/Product: no body");let{index:i,lower:r,upper:o,isFinite:s}=uo(e[1]),a=n==="Sum"?"+":"*";if(!i){let c=or(),f=or();return`${Ne(e[0],t)}.reduce((${f}, ${c}) => ${f} ${a} ${c}, ${a==="+"?"0":"1"})`}let u=Ne(e[0],{...t,var:c=>c===i?i:t.var(c)}),l=or();return`(() => {
  let ${l} = ${a==="+"?"0":"1"};
  let ${i} = ${r};
  while (${i} <= ${o}) {
    ${l} ${a}= ${u};
    ${i}++;
  }
  return ${l};
})()`}function Ul(n,e){if(/^[\p{L}_][\p{L}\p{N}_]*$/u.test(e)||/^[0-9]+$/.test(e))return new Function("x",`return \`${n}\`;`)(e);{let i=or();return new Function("x",`return \`(() => { const ${i} = \${x}; return ${n.replace(/\\\${x}/g,i)}; })()\`;`)(e)}}function or(){return`_${Math.random().toString(36).substring(4)}`}function rm(n,e,t){let{index:i,lower:r,upper:o}=uo(n[1]),s=Ne(n[0],{...t,var:a=>a===i?a:t.var(a)});return`_SYS.integrate((${i}) => (${s}), ${r}, ${o})`}function om(n){let e=n.toString();return e.includes("=>")?!1:e.startsWith("function ")&&e.includes(n.name)}function Wl(n,e,t){if(t.repeatingDecimal&&t.repeatingDecimal!=="none"){let o=n.slice(0,-1);for(let s=0;s<n.length-16;s++){let a=o.substring(0,s);for(let u=0;u<17;u++){let l=o.substring(s,s+u+1),c=Math.floor((o.length-a.length)/l.length);if(c<=3)break;if((a+l.repeat(c+1)).startsWith(o)){if(l==="0")return Js(a,t);let f={vinculum:"\\overline{#}",parentheses:"(#)",dots:"\\overset{\\cdots}{#1}#2\\overset{\\cdots}{#3}",arc:"\\wideparen{#}"}[t.repeatingDecimal]??"\\overline{#}";return f=f.replace(/#1/g,l[0]).replace(/#2/g,l.slice(1)).replace(/#3/g,l.slice(-1)).replace(/#/,l),Js(a,t)+f}}}}let i=typeof t.fractionalDigits=="number"?t.fractionalDigits:1/0;i<0&&(i=i-e),i<0&&(i=0);let r=n.length>i;return r&&(n=n.substring(0,i)),n=Js(n,t),r&&(n+=t.truncationMarker),n}function Jl(n,e){return!n||n==="0"?"":e.beginExponentMarker?e.beginExponentMarker+n+(e.endExponentMarker??""):`10^{${n}}`}function Yl(n,e){if(n===null)return"";let t;if(typeof n=="number"||typeof n=="string")t=n;else if(typeof n=="object"&&"num"in n)t=n.num;else return"";if(typeof t=="number"){if(t===1/0)return e.positiveInfinity;if(t===-1/0)return e.negativeInfinity;if(Number.isNaN(t))return e.notANumber;let o;return e.notation==="engineering"?o=co(t.toExponential(),e,3):e.notation==="scientific"&&(o=co(t.toExponential(),e)),o??Ys(t.toString(),e)}if(t=t.toLowerCase().replace(/[\u0009-\u000d\u0020\u00a0]/g,""),t==="infinity"||t==="+infinity"||t==="oo"||t==="+oo")return e.positiveInfinity;if(t==="-infinity"||t==="-oo")return e.negativeInfinity;if(t==="nan")return e.notANumber;if(!/^[-+\.]?[0-9]/.test(t))return"";if(t=t.replace(/[nd]$/,""),/\([0-9]+\)/.test(t)){let[o,s,a,u]=t.match(/(.+)\(([0-9]+)\)(.*)$/)??[];t=s+a.repeat(6)+u}let i="";for(t[0]==="-"?(i="-",t=t.substring(1)):t[0]==="+"&&(t=t.substring(1));t[0]==="0";)t=t.substring(1);t.length===0?t="0":t[0]==="."&&(t="0"+t);let r;return e.notation==="engineering"?r=co(t,e,3):e.notation==="scientific"&&(r=co(t,e)),i+(r??Ys(t,e))}function co(n,e,t=1){let i=n.match(/^(.*)[e|E]([-+]?[0-9]+)$/);if(!i){let c="";if(n[0]==="-"?(c="-",n=n.substring(1)):n[0]==="+"&&(n=n.substring(1)),n.indexOf(".")<0)n.length===1?n=c+n+"e+0":n=c+n[0]+"."+n.slice(1)+"e+"+(n.length-1).toString();else{let[f,d,p]=n.match(/^(.*)\.(.*)$/);for(p||(p="");d.startsWith("0");)d=d.substring(1);d?n=c+d[0]+"."+d.slice(1)+p+"e+"+(d.length-1).toString():n=c+"0."+p+"e+0"}i=n.match(/^(.*)[e|E]([-+]?[0-9]+)$/)}if(!i)return Ys(n,e);let r=parseInt(i[2]),o=i[1];if(Math.abs(r)%t!==0){let c=r>0?r%t:-((t+r)%t);r=r>=0?r-c:r+c;let[f,d,p]=o.match(/^(.*)\.(.*)$/)??["",o,""];o=d+(p+"00000000000000000").slice(0,Math.abs(c))+"."+p.slice(Math.abs(c))}let s=e.avoidExponentsInRange;if(s&&r>=s[0]&&r<=s[1])return;let a="",u=o;i=u.match(/^(.*)\.(.*)$/),i&&(u=i[1],a=i[2]);let l=Jl(Number(r).toString(),e);if(a=Wl(a,u.length,e),a&&(a=e.decimalSeparator+a),u=Xl(u,e),!l)return u+a;if(!a){if(u==="1")return l;if(u==="-1")return"-"+l}return u+a+e.exponentProduct+l}function Ys(n,e){let t=n.match(/^(.*)[e|E]([-+]?[0-9]+)$/i),i=0;t?.[1]&&t[2]&&(i=parseInt(t[2]),n=t[1]);let r=t?.[1]??n,o="";t=n.match(/^(.*)\.(.*)$/),t?.[1]&&t[2]&&(r=t[1],o=t[2]),i!==0&&o&&(r+=o,i-=o.length,o="");let s=e.avoidExponentsInRange;i!==0&&s&&i>=s[0]&&i<=s[1]&&([r,o]=um(r,o,i),i=0);let a=Jl(i.toString(),e);if(o&&(o=e.decimalSeparator+Wl(o,r.length,e)),r=Xl(r,e),!a)return r+o;if(!o){if(r==="1")return a;if(r==="-1")return"-"+a}return r+o+e.exponentProduct+a}function Hl(n,e,t){let i=new RegExp(`(\\d{${e}})(?=\\d)`,"g");return n.replace(i,`$1${t}`)}function sm(n,e,t){let i=new RegExp(`(\\d{${e}})(?=\\d)`,"g"),r=t.split("").reverse().join("");return n.split("").reverse().join("").replace(i,`$1${r}`).split("").reverse().join("")}function am(n,e){let t=n.split("").reverse().join(""),i=e.split("").reverse().join(""),r=t.replace(/(\d{3})(?=\d)/,`$1${i}`);return r=r.replace(/(\d{2})(?=(\d{2})+,)/g,`$1${i}`),r.split("").reverse().join("")}function Ql(n,e,t){let i=e.digitGroup;typeof i!="string"&&Array.isArray(i)&&(i=i[t]);let r=typeof e.digitGroupSeparator=="string"?e.digitGroupSeparator:e.digitGroupSeparator[t];return r?i==="lakh"?t===0?am(n,r):Hl(n,3,r):i===!1||i<=0?n:t===1?Hl(n,i,r):sm(n,i,r):n}function Js(n,e){return Ql(n,e,1)}function Xl(n,e){return Ql(n,e,0)}function um(n,e,t){let i=n+e,o=n.length+t,s,a;return o>0?o>=i.length?(i=i+"0".repeat(o-i.length),s=i,a=""):(s=i.slice(0,o),a=i.slice(o)):(s="0",a="0".repeat(-o)+i),[s,a]}var Xs={deg:n=>`${n}\\degree`,prime:n=>`${n}^{\\prime}`,dprime:n=>`${n}^{\\doubleprime}`,ring:n=>`\\mathring{${n}}`,hat:n=>`\\hat{${n}}`,tilde:n=>`\\tilde{${n}}`,vec:n=>`\\vec{${n}}`,bar:n=>`\\overline{${n}}`,underbar:n=>`\\underline{${n}}`,dot:n=>`\\dot{${n}}`,ddot:n=>`\\ddot{${n}}`,tdot:n=>`\\dddot{${n}}`,qdot:n=>`\\ddddot{${n}}`,acute:n=>`\\acute{${n}}`,grave:n=>`\\grave{${n}}`,breve:n=>`\\breve{${n}}`,check:n=>`\\check{${n}}`},Ks={upright:n=>`\\mathrm{${n}}`,italic:n=>`\\mathit{${n}}`,bold:n=>`\\mathbf{${n}}`,script:n=>`\\mathscr{${n}}`,fraktur:n=>`\\mathfrak{${n}}`,doublestruck:n=>`\\mathbb{${n}}`,blackboard:n=>`\\mathbb{${n}}`,calligraphic:n=>`\\mathcal{${n}}`,gothic:n=>`\\mathfrak{${n}}`,sansserif:n=>`\\mathsf{${n}}`,monospace:n=>`\\mathtt{${n}}`},ea=class{options;dictionary;level=-1;constructor(e,t){this.dictionary=e,this.options=t}wrap(e,t){if(e==null)return"";if(t===void 0)return this.wrapString(this.serialize(e),this.options.groupStyle(e,this.level+1));if(typeof e=="number"||Qt(e)){let r=R(e);return r!==null&&r<0&&t>de?this.wrap(e):this.serialize(e)}let i=h(e);if(i&&i!=="Delimiter"&&i!=="Subscript"){let r=this.dictionary.ids.get(i);if(r&&(r.kind==="symbol"||r.kind==="expression"||r.kind==="prefix"||r.kind==="infix"||r.kind==="postfix")&&r.precedence<t)return this.wrapString(this.serialize(e),this.options.applyFunctionStyle(e,this.level))}return this.serialize(e)}wrapShort(e){if(e==null)return"";let t=this.serialize(e);if(T(e)!==null||qn(e)&&!/^(-|\.)/.test(t))return t;let r=h(e);return r==="Delimiter"&&J(e)===1||r!=="Add"&&r!=="Negate"&&r!=="Subtract"&&r!=="PlusMinus"&&r!=="Multiply"?t:this.wrapString(t,this.options.groupStyle(e,this.level+1))}wrapString(e,t,i){if(t==="none")return e;i??="()";let r=i?.[0]??".",o=i?.[1]??".";return r==='"'?r="``":r==="|"?r="\\lvert":r=ii[r]??r,o==='"'?o="''":o==="|"?o="\\rvert":o=ii[o]??o,r==="."&&o==="."?e:((r==="."||o===".")&&t==="normal"&&(t="scaled"),t==="scaled"?`\\left${r}${e}\\right${o}}`:t==="big"?`${`\\Bigl${r}`}${e}${`\\Bigr${o}`})`:r+e+o)}wrapArguments(e){return this.wrapString(N(e).map(t=>this.serialize(t)).join(", "),this.options.applyFunctionStyle(e,this.level))}serializeSymbol(e,t){return typeof e=="string"||jr(e),t?.kind==="function"?Qs(T(e)??"")??"":t?.serialize?.(this,e)??Qs(T(e))??""}serializeFunction(e,t){if(t?.serialize)return t.serialize(this,e);let i=h(e);return Qs(i,"auto")+this.wrapArguments(e)}serialize(e){if(e==null)return"";this.level+=1;try{let t=(()=>{let i=Yl(e,this.options);if(i)return i;let r=F(e);if(r!==null)return`\\text{${r}}`;let o=T(e);if(o!==null)return this.serializeSymbol(e,this.dictionary.ids.get(o));let s=h(e);if(s){let a=this.dictionary.ids.get(s);return this.serializeFunction(e,a)}throw Error(`Syntax error ${e?JSON.stringify(e,void 0,4):""}`)})();return this.level-=1,t??""}catch{}return this.level-=1,""}applyFunctionStyle(e,t){return this.options.applyFunctionStyle(e,t)}groupStyle(e,t){return this.options.groupStyle(e,t)}rootStyle(e,t){return this.options.rootStyle(e,t)}fractionStyle(e,t){return this.options.fractionStyle(e,t)}logicStyle(e,t){return this.options.logicStyle(e,t)}powerStyle(e,t){return this.options.powerStyle(e,t)}numericSetStyle(e,t){return this.options.numericSetStyle(e,t)}};function lm(n){let e=n.match(/^([^_]+)/)?.[1]??"",t=Nn.findIndex(s=>e===s[0]);if(t>=0)return[Nn[t][1],n.substring(Nn[t][0].length)];let i={zero:"0",one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10"};if(t=Object.keys(i).findIndex(s=>n.startsWith(s)),t>=0){let s=Object.keys(i)[t];return[i[s],n.substring(s.length)]}let r=n.codePointAt(0);if(t=Nn.findIndex(s=>s[2]===r),t>=0)return[Nn[t][1],n.substring(1)];let o={plus:"+",minus:"-",pm:"\\pm",ast:"\\ast",dag:"\\dag",ddag:"\\ddag",hash:"\\#",bottom:"\\bot",top:"\\top",bullet:"\\bullet",circle:"\\circ",diamond:"\\diamond",times:"\\times",square:"\\square",star:"\\star"};if(t=Object.keys(o).findIndex(s=>e===s),t>=0){let s=Object.keys(o)[t];return[o[s],n.substring(s.length)]}return[e,n.substring(e.length)]}function cm(n){let[e,t]=lm(n),i=[];for(;t.length>0;){let o=t.match(/^_([a-zA-Z]+)(.*)/);if(!o||!Xs[o[1]])break;i.push(o[1]),t=o[2]}let r=[];for(;t.length>0;){let o=t.match(/^_([a-zA-Z]+)(.*)/);if(!o||!Ks[o[1]])break;r.push(o[1]),t=o[2]}return[e,i,r,t]}function fo(n,e=!0,t="auto"){let[i,r,o,s]=cm(n);for(let a of r)Xs[a]&&(i=Xs[a](i));if(e){let a=[],u=[],l=i.match(/^([^\d].*?)(\d+)$/);for(l&&(u.push(l[2]),i=l[1]);s.length>0;)if(s.startsWith("__")){let[c,f]=fo(s.substring(2),!1,"none");a.push(c),s=f}else if(s.startsWith("_")){let[c,f]=fo(s.substring(1),!1,"none");u.push(c),s=f}else break;a.length>0&&(i=ei("^",i,a.join(","))),u.length>0&&(i=ei("_",i,u.join(",")))}for(let a of o)Ks[a]&&(i=Ks[a](i));if(o.length===0&&t!=="none")switch(t){case"auto":Jr(i)>1&&(i=`\\mathrm{${i}}`);break;case"operator":i=`\\operatorname{${i}}`;break;case"italic":i=`\\mathit{${i}}`;break;case"upright":i=`\\mathrm{${i}}`;break}return[i,s]}function Qs(n,e="auto"){if(n===null)return null;if(Wt.test(n))return n;let t=n.match(/^(_+)(.*)/);if(t){let[o,s]=fo(t[2],!0,"none");return`\\operatorname{${"\\_".repeat(t[1].length)+o+s}}`}let[i,r]=fo(n,!0,e);return r.length>0?`\\operatorname{${n}}`:i}function Kl(n,e,t){return new ea(e,t).serialize(n)}var ec={PositiveInfinity:"+oo",NegativeInfinity:"-oo",ComplexInfinity:"~oo",NaN:"NaN",Pi:"pi",ExponentialE:"e",ImaginaryUnit:"i",ContinuationPlaceholder:"...",alpha:"alpha",beta:"beta",gamma:"gamma",delta:"delta",epsilon:"epsilon",epsilonSymbol:"varepsilon",zeta:"zeta",eta:"eta",theta:"theta",thetaSymbol:"vartheta",iota:"iota",kappa:"kappa",lambda:"lambda",mu:"mu",nu:"nu",xi:"xi",omicron:"omicron",pi:"pi",rho:"rho",sigma:"sigma",tau:"tau",upsilon:"upsilon",phi:"phi",phiSymbol:"varphi",chi:"chi",psi:"psi",omega:"omega",Gamma:"Gamma",Delta:"Delta",Theta:"Theta",Lambda:"Lambda",Xi:"Xi",Sigma:"Sigma",Upsilon:"Upsilon",Phi:"Phi",Psi:"Psi",Omega:"Omega"},nc={Add:[(n,e)=>n.ops?.reduce((t,i)=>{if(i.operator==="Negate"){let r=e(i.op1,10);return t===""?`-${r}`:r.startsWith("+")?`${t} - ${r.substring(1)}`:r.startsWith("-")?`${t} + ${r.substring(1)}`:`${t} - ${r}`}return tc(t,e(i,10))},"")??"",11],Negate:[(n,e)=>{let t=e(n.op1,14);return t==="Power"?`-(${t})`:`-${t}`},14],Subtract:[(n,e)=>n.ops?.reduce((t,i)=>{let r=e(i,10);return t===""?r:r.startsWith("-")?`${t} - (${r})`:`${t} - ${r}`},"")??"",11],Multiply:[(n,e)=>{if(!n.ops)return"";if(n.nops===2){let t=n.op1.numericValue;if(t!==null){typeof t!="number"&&t.im!==0&&ta(e(n.op2,12),tc(t.re.toString(),`${t.im}i`));let i=n.op2;if((i.symbol||i.operator==="Power"||i.operator==="Square"||typeof mi[i.operator]=="string")&&Yn(t)&&t[0]===1){let r=t[1];return`${e(i,12)}/${r}`}return ta(e(n.op1,12),e(n.op2,12))}}return n.ops.reduce((t,i)=>ta(t,e(i,12)),"")},12],Divide:["/",13],Power:[(n,e)=>{let t=e(n.op2,14);if(t==="1")return e(n.op1);if(t==="(1/2)"||t==="1/2"||t==="0.5")return`sqrt(${e(n.op1)})`;if(t==="-0.5")return`(1/sqrt(${e(n.op1)}))`;let i=e(n.op1,14);return i.startsWith("-")&&(i=`(${i})`),t.length===1?`${i}^${t}`:`${i}^${Ve(t)}`},15],Equal:["===",8],NotEqual:["!==",8],LessEqual:["<=",9],GreaterEqual:[">=",9],Less:["<",9],Greater:[">",9],And:["&&",4],Or:["||",3],Not:["!",14]},mi={Abs:(n,e)=>`|${e(n.op1)}|`,Sin:"sin",Cos:"cos",Tan:"tan",Sec:"sec",Csc:"csc",Arcsin:"arcsin",Arccos:"arccos",Arctan:"arctan",Sinh:"sinh",Cosh:"cosh",Tanh:"tanh",Sech:"sech",Csch:"csch",Coth:"coth",Ceil:"ceil",Exp:"exp",Factorial:(n,e)=>`${e(n.op1,12)}!`,Floor:"floor",Log:"log",Ln:"ln",Log10:"log10",Sqrt:"sqrt",Root:(n,e)=>{let t=n.op1,i=n.op2;return i.is(2)?`sqrt${Ve(e(t))}`:`root${Ve(e(i))}${Ve(e(t))}`},Square:(n,e)=>`${e(n.op1,12)}^2`,Det:"det",Dim:"dim",Mod:"mod",GCD:"gcd",LCM:"lcm",Lub:"lub",Glb:"glb",Max:"max",Min:"min",PlusMinus:(n,e)=>{let[t,i]=n.ops??[];if(!i)return e(t);if(t&&i){let r=e(t),o=e(i);return`${r} \xB1 ${o}`}return t?`\xB1 ${e(t)}`:i?`\xB1 ${e(i)}`:"0"},Sum:(n,e)=>na(n,"sum",e),Product:(n,e)=>na(n,"prod",e),Integrate:(n,e)=>na(n,"int",e),Limit:(n,e)=>{let[t,i]=n.ops??[];if(t?.operator==="Function"){let r=t.ops?.slice(2)??[],o=t.op1??t,s=null;return r.length===1&&(s=r[0]),s?`lim_(${e(s)} -> ${e(i)}) ${e(o)}`:`lim_(${e(i)}) ${e(o)}`}else if(t?.symbol)return`lim_(x -> ${e(i)}) ${e(t)}(x)`;return"lim"},Delimiter:(n,e)=>fm(n.ops[0],n.ops[1]?.string,e),Sequence:(n,e)=>n.nops===0?"":n.ops.map(t=>e(t)).join(" "),List:(n,e)=>`[${n.ops?.map(t=>e(t))??""}]`,Single:(n,e)=>`(${n.ops.map(t=>e(t)).join(", ")})`,Pair:(n,e)=>`(${n.ops.map(t=>e(t)).join(", ")})`,Triple:(n,e)=>`(${n.ops.map(t=>e(t)).join(", ")})`,Tuple:(n,e)=>`(${n.ops.map(t=>e(t)).join(", ")})`,Block:(n,e)=>n.nops===0?"{}":n.nops===1?`{${e(n.op1)}}`:`{    ${n.ops.map(t=>e(t)).join(`;
     `)}
    }`,EvaluateAt:(n,e)=>{let t=n.op1,i=n.ops.slice(1);return i.length===0?e(t):i.length===1?`(${e(t)})|_(${e(i[0])})`:i.length===2?`(${e(t)})|_(${e(i[0])})^(${e(i[1])})`:`(${e(t)})|_(${i.map(r=>e(r)).join(", ")})`},Function:(n,e)=>{let t=n.ops.slice(1),i=()=>t.map(r=>e(r)).join(", ");return n.op1.operator==="Block"?n.op1.nops===0?`(${i()}) |-> {}`:n.op1.nops===1?t.length===1&&t[0].symbol==="_1"?`(_) |-> ${e(n.op1.op1.subs({_1:"_"}))}`:`(${i()}) |-> ${e(n.op1.op1)}`:`(${i()}) |-> {
    ${n.op1.ops.map(r=>e(r)).join(`;
     `)}
}`:`(${i()}) |-> ${e(n.op1)}`},Domain:n=>JSON.stringify(n.json),Error:(n,e)=>n.nops===1?`Error(${e(n.op1)})`:n.nops===2?n.op1.string?`Error("${n.op1.string}", ${e(n.op2)})`:`Error(${e(n.op1)}, ${e(n.op2)})`:`Error(${n.ops.map(t=>e(t)).join(", ")})`,LatexString:n=>`"${n.op1.string??""}"`};function na(n,e,t){let[i,...r]=n.ops??[],o=[],s,a=[];if(i?.operator==="Function"){a=i.ops.slice(1)??[];let l=i.op1??i;l.operator==="Block"?s=t(l.op1??l):s=t(l)}else if(i?.symbol)a=[],s=t(i);else return"int()";let u=e;for(let l of r)if(["Range","Tuple","Pair","Single","Limits"].includes(l.operator)&&l.nops!==0){if(l.nops===2)l.op1.symbol?(l.op1.symbol!=="Nothing"&&o.push(l.op1),l.op2.symbol!=="Nothing"&&(e==="int"?u+=`_${Ve(t(l.op2))}`:u+="_"+Ve(`${l.op1.symbol}=${t(l.op2)}`))):(l.op1.symbol!=="Nothing"&&(u+=`_${Ve(t(l.op1))}`),l.op2.symbol!=="Nothing"&&(u+=`^${Ve(t(l.op2))}`));else if(l.nops===3){let c="";l.op1.symbol!=="Nothing"&&(o.push(l.op1),c=l.op1.symbol??"");let f=l.op2.symbol!=="Nothing"?l.op2:null,d=l.op3.symbol!=="Nothing"?l.op3:null;f?e==="int"||!c?u+=`_${Ve(t(f))}`:u+="_"+Ve(`${c}=${t(f)}`):e!=="int"&&(u+=`_${Ve(t(l.op1))}`),d&&(u+=`^${Ve(t(d))}`)}}return e==="int"?u+=Ve(s+a.map(l=>` d${t(l)}`).join(" ")):u+=Ve(s),u}function fm(n,e,t){e||(e="(,)");let i="",r="",o="";if(e.length===1&&(i=e),e.length===2&&(r=e[0],o=e[1]),e.length===3&&(r=e[0],i=e[1],o=e[2]),!n)return`${r}${o}`;let s=[n];return n.operator==="Sequence"&&(s=n.ops),`${r}${s.map(a=>t(a)).join(i)}${o}`}function Ve(n,e=0,t=-1){return e>t&&!/^\(.+\)$/.test(n)?`(${n})`:n}function po(n,e={}){return e.symbols?.[n]?e.symbols[n]:ec[n]?ec[n]:n.startsWith("_")?n:mi[n]&&typeof mi[n]=="string"?mi[n]:n.length===1?n:`"${n}"`}function sr(n,e={},t=0){if(n===void 0)return"[undefined]";if(n===null)return"[null]";if(n.symbol)return po(n.symbol,e);let i=(o,s=0)=>sr(o,e,s);if(n.string)return`"${n.string.replace(/"/g,'\\"')}"`;let r=n.numericValue;if(r!==null)return n.isNaN?po("NaN",e):n.isFinite===!1?n.isNegative!==!0&&n.isPositive!==!0?po("ComplexInfinity",e):po(n.isNegative?"NegativeInfinity":"PositiveInfinity",e):r.toString();if(n.operator){let o=e.operators?{...nc,...e.operators}:nc,[s,a]=o[n.operator]??[];if(s){let c="";if(typeof s=="function")c=s(n,i);else{if(n.nops===1)return`${s}${i(n.op1,a+1)}`;c=n.ops?.map(f=>i(f,a+1)).join(` ${s} `)??""}return Ve(c,t,a)}let l=(e.functions?{...mi,...e.functions}:mi)[n.operator];return typeof l=="function"?l(n,i):typeof l=="string"?`${l}(${n.ops?.map(c=>i(c)).join(", ")??""})`:`${n.operator}(${n.ops?.map(c=>i(c)).join(", ")??""})`}return JSON.stringify(n.json)}function ta(n,e){return n?e?((e.startsWith("-")||e.startsWith("+"))&&(e=`(${e})`),n.match(/^[-+]?\d+$/)&&e.match(/^[a-zA-Z\(]/)?n+e:`${n} * ${e}`):n:e}function tc(n,e){return n?e?e.startsWith("-")?`${n} - ${e.substring(1)}`:e.startsWith("+")?`${n} + ${e.substring(1)}`:`${n} + ${e}`:n:e}function ia(n,e){for(n.isInteger()&&e.isInteger();!e.isZero();)[n,e]=[e,n.modulo(e)];return n.abs()}function ic(n,e){return n.mul(e).div(ia(n,e))}function rc(n,e){if(!e.isInteger()||e.isNegative())return n._BIGNUM_NAN;if(e.lessThan(1))return n._BIGNUM_ONE;let t=e;for(;e.greaterThan(2);)e=e.minus(2),t=t.mul(e);return t}function Mt(n){return n.isFinite()?n.d.length>3||n.d.length===3&&n.d[0]>=90?!1:(n.precision()<=16,n.e<308&&n.e>-306):!0}var Rt=class n extends j{__brand;decimal;bignum;constructor(e,t){if(super(),this.bignum=t,typeof e=="number")this.decimal=t(e),this.im=0;else if(e instanceof M)this.decimal=e,this.im=0;else{let i=t(e.re??0);this.decimal=i,this.im=e.im??0}this.decimal.isNaN()&&(this.im=NaN),this.decimal.isNaN(),isNaN(this.im)}get type(){return this.isNaN?"number":this.isComplexInfinity?"complex":this.im!==0?this.decimal.isZero()?"imaginary":"finite_complex":this.decimal.isFinite()?this.decimal.isInteger()?"finite_integer":"finite_real":"non_finite_number"}get isExact(){return this.im===0&&this.decimal.isInteger()}get asExact(){if(this.isExact)return this._makeExact(ie(this.decimal))}toJSON(){return this.isNaN?"NaN":this.isPositiveInfinity?"PositiveInfinity":this.isNegativeInfinity?"NegativeInfinity":this.isComplexInfinity?"ComplexInfinity":this.im===0?Mt(this.decimal)?this.decimal.toNumber():{num:mo(this.decimal)}:Mt(this.decimal)?["Complex",Le(this.decimal.toNumber()),Le(this.im)]:["Complex",{num:mo(this.decimal)},Le(this.im)]}toString(){if(this.isZero)return"0";if(this.isOne)return"1";if(this.isNegativeOne)return"-1";if(this.im===0)return mo(this.decimal);if(this.decimal.isZero())return this.im===1?"i":this.im===-1?"-i":`${Be(this.im)}i`;if(this.isComplexInfinity)return"~oo";let e="";return this.im===1?e="+ i":this.im===-1?e="- i":this.im>0?e=`+ ${this.im}i`:e=`- ${-this.im}i`,`(${mo(this.decimal)} ${e})`}clone(e){return new n(e,this.bignum)}_makeExact(e){return new K(e,t=>this.clone(t),this.bignum)}get re(){return this.decimal.toNumber()}get bignumRe(){return this.decimal}get numerator(){return this}get denominator(){return this._makeExact(1)}get isNaN(){return this.decimal.isNaN()}get isPositiveInfinity(){return this.im===0&&!this.decimal.isFinite()&&!this.decimal.isNaN()&&this.decimal.isPositive()}get isNegativeInfinity(){return this.im===0&&!this.decimal.isFinite()&&!this.decimal.isNaN()&&this.decimal.isNegative()}get isComplexInfinity(){return!Number.isFinite(this.im)&&!Number.isNaN(this.im)}get isZero(){return this.im===0&&this.decimal.isZero()}isZeroWithTolerance(e){if(this.im!==0)return!1;let t=typeof e=="number"?this.bignum(e):e;return this.decimal.abs().lte(t)}get isOne(){return this.im===0&&this.decimal.eq(1)}get isNegativeOne(){return this.im===0&&this.decimal.eq(-1)}sgn(){if(this.im===0){if(this.decimal.isZero())return 0;if(this.decimal.isPositive())return 1;if(this.decimal.isNegative())return-1}}N(){return this}neg(){return this.isZero?this:this.clone({re:this.decimal.neg(),im:-this.im})}inv(){if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.im===0)return this.clone(this.decimal.pow(-1));let e=Math.hypot(this.re,this.im),t=this.decimal.mul(this.decimal).add(this.im*this.im).sqrt();return this.clone({re:this.decimal.div(t),im:-this.im/e})}add(e){return typeof e=="number"?e===0?this:this.clone({re:this.decimal.add(e),im:this.im}):e.isZero?this:this.isZero?this.clone(e):this.clone({re:this.decimal.add(e.bignumRe??e.re),im:this.im+e.im})}sub(e){return this.add(e.neg())}mul(e){if(this.isZero)return this;if(e===1)return this;if(e===-1)return this.neg();if(e===0)return this.clone(0);if(this.isOne)return typeof e=="number"||e instanceof M?this.clone(e):this.clone({re:e.bignumRe??e.re,im:e.im});if(typeof e=="number")return this.im===0?this.clone(this.decimal.mul(e)):this.clone({re:this.decimal.mul(e),im:this.im*e});if(e instanceof M)return this.im===0?this.clone(this.decimal.mul(e)):this.clone({re:this.decimal.mul(e),im:this.im*e.toNumber()});if(this.isNegativeOne){let t=e.neg();return this.clone({re:t.bignumRe??t.re,im:t.im})}return e.isOne?this:e.isNegativeOne?this.neg():e.isZero?this.clone(0):this.im===0&&e.im===0?this.clone(this.decimal.mul(e.bignumRe??e.re)):this.clone({re:this.decimal.mul(e.bignumRe??e.re).sub(this.im*e.im),im:this.re*e.im+this.im*e.re})}div(e){if(typeof e=="number")return e===1?this:e===-1?this.neg():e===0?this.clone(NaN):this.clone({re:this.decimal.div(e),im:this.im/e});if(e.isOne)return this;if(e.isNegativeOne)return this.neg();if(e.isZero)return this.clone(this.isZero?NaN:1/0);if(this.im===0&&e.im===0)return this.clone(this.decimal.div(e.bignumRe??e.re));let[t,i]=[this.re,this.im],[r,o]=[e.re,e.im],s=r*r+o*o,a=e.bignumRe??this.bignum(e.re),u=a.mul(a).add(o*o);return this.clone({re:this.decimal.mul(a).add(i*o).div(u),im:(i*r-t*o)/s})}pow(e){if(Array.isArray(e),this.isNaN)return this;if(typeof e=="number"&&isNaN(e))return this.clone(NaN);if(e instanceof j){if(e.isNaN)return this.clone(NaN);if(e.isZero)return this.clone(1);if(e.isOne)return this;e.im?e={re:e.re,im:e.im}:e=e.re}if(typeof e=="object"&&("re"in e||"im"in e)){let[u,l]=[e?.re??0,e?.im??0];if(Number.isNaN(l)||Number.isNaN(u))return this.clone(NaN);if(l===0)e=u;else{if(this.im===1/0)return this.clone(NaN);if(this.isNegativeInfinity)return this.clone(0);if(this.isPositiveInfinity)return this.clone({im:1/0});let c=this.pow(u),f=this.decimal.ln().mul(l),d=this.clone({re:f.cos(),im:gi(f.sin().toNumber())});return c.mul(d)}}if(this.isPositiveInfinity){if(e===-1)return this.clone(0);if(e===1/0)return this.clone(1/0);if(e===-1/0)return this.clone(0)}else if(this.isNegativeInfinity&&e===1/0)return this.clone(NaN);if((e===1/0||e===-1/0)&&(this.isOne||this.isNegativeOne))return this.clone(NaN);if(e===1)return this;if(e===-1)return this.inv();if(e===0)return this.clone(1);if(this.isZero){if(e>0)return this;if(e<0)return this.clone({im:1/0})}if(e<0)return this.pow(-e).inv();if(this.im===0)return this.clone(this.decimal.pow(e));let t=this.decimal,i=this.im,r=t.mul(t).add(i*i).sqrt(),o=M.atan2(i,t),s=r.pow(e),a=o.mul(e);return this.clone({re:s.mul(a.cos()),im:gi(s.mul(a.sin()).toNumber())})}root(e){if(!Number.isInteger(e))return this._makeExact(NaN);if(e===0)return this._makeExact(NaN);if(e===1)return this;if(this.isZero)return this;if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.im===0)return this.decimal.isNegative()?this._makeExact(NaN):e===2?this.clone(this.decimal.sqrt()):e===3?this.clone(this.decimal.cbrt()):this.clone(this.decimal.pow(1/e));let t=this.decimal,i=this.im,r=t.mul(t).add(i*i).sqrt(),o=M.atan2(i,t),s=r.pow(1/e),a=o.div(e);return this.clone({re:s.mul(a.cos()),im:gi(s.mul(a.sin()).toNumber())})}sqrt(){if(this.isZero||this.isOne)return this;if(this.im!==0){let e=this.decimal,t=this.im,i=e.mul(e).add(t*t).sqrt(),r=e.add(i).div(2).sqrt(),o=gi(Math.sign(t)*i.sub(e).div(2).sqrt().toNumber());return this.clone({re:r,im:o})}return this.decimal.isPositive()?this.clone(this.decimal.sqrt()):this.clone({im:Math.sqrt(-this.re)})}gcd(e){if(this.isZero)return e;if(e.isZero)return this;if(this.im!==0||e.im!==0)return this._makeExact(NaN);if(!this.decimal.isInteger())return this._makeExact(1);let t=this.bignum(e.bignumRe??e.re);if(!t.isInteger())return this._makeExact(1);let i=this.decimal;for(;!t.isZero();){let r=t;t=i.mod(t),i=r}return this.clone(i.abs())}abs(){return this.im===0?this.decimal.isPositive()?this:this.clone(this.decimal.neg()):this.clone(this.decimal.pow(2).add(this.im**2).sqrt())}ln(e){if(this.isZero)return this._makeExact(NaN);if(this.isNegativeInfinity)return this._makeExact(NaN);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im===0)return this.decimal.isNegative()?this._makeExact(NaN):this.isOne?this._makeExact(0):this.isNegativeOne?this.clone({im:Math.PI}):e===void 0?this.clone(this.decimal.ln()):this.clone(this.decimal.log(e));let t=this.decimal,i=this.im,r=t.mul(t).add(i*i).sqrt(),o=M.atan2(i,t).toNumber();return e===void 0?this.clone({re:r.ln(),im:o}):this.clone({re:r.log(e),im:o})}exp(){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this._makeExact(1);if(this.isNegativeInfinity)return this._makeExact(0);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im!==0){let e=this.decimal.exp();return this.clone({re:e.mul(gi(Math.cos(this.im))),im:gi(e.mul(Math.sin(this.im)).toNumber())})}return this.clone(this.decimal.exp())}floor(){return this.isNaN||this.im!==0?this._makeExact(NaN):this.decimal.isInteger()?this:this._makeExact(ie(this.decimal.floor()))}ceil(){return this.isNaN||this.im!==0?this._makeExact(NaN):this.decimal.isInteger()?this:this._makeExact(ie(this.decimal.ceil()))}round(){return this.isNaN||this.im!==0?this._makeExact(NaN):this.decimal.isInteger()?this:this._makeExact(ie(this.decimal.round()))}eq(e){return this.isNaN?!1:typeof e=="number"?this.im===0&&this.decimal.eq(e):e.isNaN?!1:Number.isFinite(this.im)?this.decimal.eq(e.bignumRe??e.re)&&this.im-e.im===0:!Number.isFinite(e.im)}lt(e){return this.im,typeof e=="number"?this.decimal.lt(e):this.decimal.lt(e.bignumRe??e.re)}lte(e){return this.im,typeof e=="number"?this.decimal.lte(e):this.decimal.lte(e.bignumRe??e.re)}gt(e){return this.im,typeof e=="number"?this.decimal.gt(e):this.decimal.gt(e.bignumRe??e.re)}gte(e){return this.im,typeof e=="number"?this.decimal.gte(e):this.decimal.gte(e.bignumRe??e.re)}};function mo(n){let e=n.toString();if(n.isInteger()&&e.includes("e")){let t=n.toFixed(),i=t.match(/0+$/);if((i?i[0].length:0)<=5)return t}return e}function gi(n){return Math.abs(n)<=1e-14?0:n}var Pt=class n extends j{__brand;decimal;bignum;constructor(e,t){if(super(),this.bignum=t,typeof e=="number")this.decimal=e,this.im=0;else if(e instanceof M)this.decimal=e.toNumber(),this.im=0;else{let i=e.re===void 0?0:e.re instanceof M?e.re.toNumber():e.re;this.decimal=i,this.im=e.im??0,isFinite(this.im)||(this.decimal=this.im)}isNaN(this.im)}_makeExact(e){return new K(e,t=>this.clone(t),this.bignum)}get type(){return this.isNaN?"number":this.isComplexInfinity?"complex":this.im!==0?this.decimal===0?"imaginary":"finite_complex":Number.isFinite(this.decimal)?Number.isInteger(this.decimal)?"finite_integer":"finite_real":"non_finite_number"}get isExact(){return this.im===0&&Number.isInteger(this.decimal)}get asExact(){if(this.isExact)return this._makeExact(this.decimal)}toJSON(){return this.isNaN?"NaN":this.isPositiveInfinity?"PositiveInfinity":this.isNegativeInfinity?"NegativeInfinity":this.im===0?Le(this.decimal):["Complex",Le(this.decimal),Le(this.im)]}toString(){if(this.isZero)return"0";if(this.isOne)return"1";if(this.isNegativeOne)return"-1";if(this.im===0)return Be(this.decimal);if(this.decimal===0)return this.im===1?"i":this.im===-1?"-i":`${Be(this.im)}i`;if(this.isComplexInfinity)return"~oo";let e="";return this.im===1?e="+ i":this.im===-1?e="- i":this.im>0?e=`+ ${Be(this.im)}i`:e=`- ${Be(-this.im)}i`,`(${Be(this.decimal)} ${e})`}clone(e){return new n(e,this.bignum)}get re(){return this.decimal}get bignumRe(){}get numerator(){return this}get denominator(){return this._makeExact(1)}get isNaN(){return Number.isNaN(this.decimal)}get isPositiveInfinity(){return!Number.isFinite(this.decimal)&&this.decimal>0&&this.im===0}get isNegativeInfinity(){return!Number.isFinite(this.decimal)&&this.decimal<0&&this.im===0}get isComplexInfinity(){return!Number.isFinite(this.im)&&!Number.isNaN(this.im)}get isZero(){return this.im===0&&this.decimal===0}isZeroWithTolerance(e){if(this.im!==0)return!1;let t=e instanceof M?e.toNumber():e;return Math.abs(this.decimal)<t}get isOne(){return this.im===0&&this.decimal===1}get isNegativeOne(){return this.im===0&&this.decimal===-1}sgn(){if(!(this.im!==0||!Number.isFinite(this.decimal)))return Math.sign(this.decimal)}N(){return this}neg(){return this.isNaN?this._makeExact(NaN):this.isZero?this:this.clone({re:-this.decimal,im:-this.im})}inv(){if(this.isNaN)return this._makeExact(NaN);if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.im===0)return this.clone(1/this.decimal);let e=Math.hypot(this.re,this.im);return this.clone({re:this.decimal/e,im:-this.im/e})}add(e){return this.isNaN?this._makeExact(NaN):typeof e=="number"?e===0?this:this.clone({re:this.decimal+e,im:this.im}):e.isZero?this:this.isZero?this.clone({re:e.bignumRe??e.re,im:e.im}):this.clone({re:this.decimal+e.re,im:this.im+e.im})}sub(e){return this.add(e.neg())}mul(e){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this;if(e instanceof M&&(e=e.toNumber()),e===1)return this;if(e===-1)return this.neg();if(e===0)return this.clone(0);if(this.isOne)return typeof e=="number"||e instanceof M?this.clone(e):this.clone({re:e.bignumRe??e.re,im:e.im});if(typeof e=="number")return this.im===0?this.clone(this.decimal*e):this.clone({re:this.decimal*e,im:this.im*e});if(this.isNegativeOne){let t=e.neg();return this.clone({re:t.bignumRe??t.re,im:t.im})}return e.isOne?this:e.isNegativeOne?this.neg():e.isZero?this.clone(0):this.im===0&&e.im===0?this.clone(this.decimal*e.re):this.clone({re:this.decimal*e.re-this.im*e.im,im:this.re*e.im+this.im*e.re})}div(e){if(this.isNaN)return this._makeExact(NaN);if(typeof e=="number")return e===1?this:e===-1?this.neg():e===0?this.clone(NaN):this.clone({re:this.decimal/e,im:this.im/e});if(e.isOne)return this;if(e.isNegativeOne)return this.neg();if(e.isZero)return this.clone(this.isZero?NaN:1/0);if(this.im===0&&e.im===0)return this.clone(this.decimal/e.re);let[t,i]=[this.decimal,this.im],[r,o]=[e.re,e.im],s=r*r+o*o;return this.clone({re:(t*r+i*o)/s,im:(i*r-t*o)/s})}pow(e){if(Array.isArray(e),this.isNaN)return this._makeExact(NaN);if(typeof e=="number"&&isNaN(e))return this.clone(NaN);if(e instanceof j){if(e.isNaN)return this.clone(NaN);if(e.isZero)return this.clone(1);if(e.isOne)return this;e.im?e={re:e.re,im:e.im}:e=e.re}if(typeof e=="object"&&("re"in e||"im"in e)){let[u,l]=[e?.re??0,e?.im??0];if(Number.isNaN(l)||Number.isNaN(u))return this.clone(NaN);if(l===0)e=u;else{if(this.im===1/0)return this.clone(NaN);if(this.isNegativeInfinity)return this.clone(0);if(this.isPositiveInfinity)return this.clone({im:1/0});let c=this.pow(u).re,f=Math.log(this.decimal)*l;return this.clone({re:oc(c*Math.cos(f)),im:oc(c*Math.sin(f))})}}if(this.isPositiveInfinity){if(e===-1)return this.clone(0);if(e===1/0)return this.clone(1/0);if(e===-1/0)return this.clone(0)}else if(this.isNegativeInfinity&&e===1/0)return this.clone(NaN);if((e===1/0||e===-1/0)&&(this.isOne||this.isNegativeOne))return this.clone(NaN);if(e===1)return this;if(e===-1)return this.inv();if(e===0)return this.clone(1);if(this.isZero){if(e>0)return this;if(e<0)return this.clone({im:1/0})}if(e<0)return this.clone(1/this.decimal**-e);if(this.im===0)return this.clone(this.decimal**e);let t=this.decimal,i=this.im,r=Math.sqrt(t*t+i*i),o=Math.atan2(i,t),s=r**e,a=o**e;return this.clone({re:s*Math.cos(a),im:s*Math.sin(a)})}root(e){if(this.isNaN)return this._makeExact(NaN);if(e===0)return this.clone(NaN);if(this.isNaN)return this;if(this.isZero)return this;if(this.isOne)return this;if(this.isNegativeOne)return this;if(e===1)return this;if(e===2)return this.sqrt();if(e===3)return this.clone(Math.cbrt(this.decimal));if(this.im===0)return this.decimal<0?e%2===0?this.clone(NaN):this.clone(-Math.pow(-this.decimal,1/e)):this.clone(Math.pow(this.decimal,1/e));let t=this.decimal,i=this.im,r=Math.hypot(t,i),o=Math.atan2(i,t),s=Math.pow(r,1/e),a=o/e;return this.clone({re:s*Math.cos(a),im:s*Math.sin(a)})}sqrt(){if(this.isNaN)return this._makeExact(NaN);if(this.isZero||this.isOne)return this;if(this.im!==0){let e=this.decimal,t=this.im,i=Math.sqrt(e*e+t*t),r=Math.sqrt((e+i)/2),o=Math.sign(t)*Math.sqrt((i-e)/2);return this.clone({re:r,im:o})}return this.decimal>0?this.clone(Math.sqrt(this.decimal)):this.clone({im:Math.sqrt(-this.decimal)})}gcd(e){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return e;if(e.isZero)return this;if(this.im!==0||e.im!==0)return this._makeExact(NaN);if(!Number.isInteger(this.decimal))return this._makeExact(1);let t=e.re;if(!Number.isInteger(t))return this._makeExact(1);let i=this.decimal;for(;t!==0;){let r=t;t=i%t,i=r}return this.clone(Math.abs(i))}abs(){return this.isNaN?this._makeExact(NaN):this.im===0?this.decimal>0?this:this.clone(-this.decimal):this.clone(Math.sqrt(this.decimal**2+this.im**2))}ln(e){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this._makeExact(NaN);if(this.isNegativeInfinity)return this._makeExact(NaN);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im===0)return this.decimal<0?this._makeExact(NaN):this.isOne?this._makeExact(0):this.isNegativeOne?this.clone({im:Math.PI}):e===void 0?this.clone(Math.log(this.decimal)):this.clone(Math.log(this.decimal)/Math.log(e));let t=this.decimal,i=this.im,r=Math.hypot(t,i),o=Math.atan2(i,t),s=e===void 0?Math.log(r):Math.log(r)/Math.log(e);return this.clone({re:s,im:o})}exp(){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this._makeExact(1);if(this.isNegativeInfinity)return this._makeExact(0);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im!==0){let e=Math.exp(this.decimal);return this.clone({re:e*Math.cos(this.im),im:e*Math.sin(this.im)})}return this.clone(Math.exp(this.decimal))}floor(){return this.isNaN||this.im!==0?this._makeExact(NaN):Number.isInteger(this.decimal)?this:this._makeExact(Math.floor(this.decimal))}ceil(){return this.isNaN||this.im!==0?this._makeExact(NaN):Number.isInteger(this.decimal)?this:this._makeExact(Math.ceil(this.decimal))}round(){return this.isNaN||this.im!==0?this._makeExact(NaN):Number.isInteger(this.decimal)?this:this._makeExact(Math.round(this.decimal))}eq(e){return this.isNaN?!1:typeof e=="number"?this.im===0&&this.decimal-e===0:e.isNaN?!1:Number.isFinite(this.im)?this.decimal-e.re===0&&this.im-e.im===0:!Number.isFinite(e.im)}lt(e){return this.im,typeof e=="number"?this.decimal<e:this.decimal<e.re}lte(e){return this.im,typeof e=="number"?this.decimal<=e:this.decimal<=e.re}gt(e){return this.im,typeof e=="number"?this.decimal>e:this.decimal>e.re}gte(e){return this.im,typeof e=="number"?this.decimal>=e:this.decimal>=e.re}};function oc(n){return Math.abs(n)<=1e-14?0:n}var ar=class{engine;terms=[];constructor(e,t){this.engine=e;let i=0,r=0,o=[];for(let s of t){if(s.type.is("complex")&&s.isInfinity){this.terms=[{term:e.ComplexInfinity,coef:[]}];return}if(s.isNaN||s.symbol==="Undefined"){this.terms=[{term:e.NaN,coef:[]}];return}let[a,u]=s.toNumericValue();a.isPositiveInfinity?i+=1:a.isNegativeInfinity&&(r+=1),u.is(1)?a.isZero||o.push(a):this.add(a,u)}if(i>0&&r>0){this.terms=[{term:e.NaN,coef:[]}];return}if(i>0){this.terms=[{term:e.PositiveInfinity,coef:[]}];return}if(r>0){this.terms=[{term:e.NegativeInfinity,coef:[]}];return}o.length===1?this.add(o[0],e.One):o.length>0&&sc(e,o).forEach(s=>this.add(s,e.One))}add(e,t){if(t.is(0)||e.isZero)return;if(t.is(1)){let r=this.engine;this.terms.push({coef:[],term:r.number(e)});return}if(t.operator==="Add"){for(let r of t.ops){let[o,s]=r.toNumericValue();this.add(e.mul(o),s)}return}if(t.operator==="Negate"){this.add(e.neg(),t.op1);return}let i=this.find(t);if(i>=0){this.terms[i].coef.push(e);return}t.numericValue===null||t.is(1),this.terms.push({coef:[e],term:t})}find(e){return this.terms.findIndex(t=>t.term.isSame(e))}N(){let e=this.engine,t=this.terms;if(t.length===0)return e.Zero;let i=[],r=[];for(let{coef:s,term:a}of t)if(s.length===0)a.isNumberLiteral?typeof a.numericValue=="number"?r.push(e._numericValue(a.numericValue)):r.push(a.numericValue):i.push(a);else{let u=s.reduce((l,c)=>l.add(c)).N();if(u.isZero)continue;u.eq(1)?i.push(a.N()):u.eq(-1)?i.push(a.N().neg()):i.push(a.N().mul(e.box(u)))}let o=dm(e,r);if(!o.isZero){if(i.length===0)return e.box(o);i.push(e.box(o))}return Ke(e,i)}asExpression(){let e=this.engine,t=this.terms;return t.length===0?e.Zero:Ke(e,t.map(({coef:i,term:r})=>{if(i.length===0)return r;let o=sc(e,i);if(o.length===0)return r;if(o.length>1)return _e(e,[Ke(e,o.map(a=>e.box(a))),r]);let s=o[0];return s.isNaN?e.NaN:s.isZero?e.Zero:s.eq(1)?r:s.eq(-1)?r.neg():r.is(1)?e.box(s):r.mul(e.box(s))}))}};function sc(n,e){let t=o=>n.bignum(o),i=o=>new K(o,r,t),r=n.precision>kn?o=>new Rt(o,t):o=>new Pt(o,i);return K.sum(e,r,t)}function dm(n,e){let t=s=>n.bignum(s),i=s=>new K(s,r,t),r=n.precision>kn?s=>new Rt(s,t):s=>new Pt(s,i),o=K.sum(e,r,t);return o.length===0?i(0):o.length===1?o[0].N():o.reduce((s,a)=>s.add(a).N())}function Ke(n,e){if(e=Q(e,"Add"),e=e.filter(i=>i.numericValue===null||!i.is(0)),e.length===0)return n.Zero;if(e.length===1&&!e[0].isIndexedCollection)return e[0];let t=[];for(let i=0;i<e.length;i++){let r=e[i];if(r.isNumberLiteral){let o=r.numericValue;if(typeof o=="number"||E(o.type,"real")&&!o.isExact||E(o.type,"integer")){let s=e[i+1];if(s){let a=li(s)?.numericValue;if(a!==void 0){let u=typeof a=="number"?a:a?.re;if(u!==0){let l=typeof o=="number"?o:o.re;t.push(n.number(n._numericValue({re:l,im:u??0}))),i++;continue}}}}}t.push(r)}return t.length===1?t[0]:n._fn("Add",[...t].sort(Wi))}function ac(n){return n.length===0?"finite_integer":n.length===1?n[0].type:oe(...n.map(e=>e.type.type))}function H(...n){return n.length>0,n.every(e=>e.isValid)?new ar(n[0].engine,n).asExpression():n[0].engine._fn("Add",n)}function uc(...n){return n.length>0,n.every(e=>e.isValid)?(n=n.map(e=>e.isNumberLiteral?e.evaluate():e.N()),new ar(n[0].engine,n).N()):n[0].engine._fn("Add",n)}function Ln(n,e){if(n.operator==="Negate"&&e.operator==="Negate")return Ln(n.op1,e.op1);let t=n.engine;if(n.operator==="Negate")return Ln(n.op1,e).neg();if(e.operator==="Negate")return Ln(n,e.op1).neg();if(n.operator==="Divide"&&e.operator==="Divide"){let i=n.op2.mul(e.op2);return Ln(n.op1,e.op1).div(i)}return n.operator==="Divide"?Ln(n.op1,e).div(n.op2):e.operator==="Divide"?Ln(n,e.op1).div(e.op2):n.operator==="Add"?H(...n.ops.map(i=>Ln(i,e))):e.operator==="Add"?H(...e.ops.map(i=>Ln(n,i))):new Oe(t,[n,e]).asExpression()}function lr(n,e){if(e.length===0)return null;if(e.length===1)return e[0];if(e.length===2)return Ln(e[0],e[1]);let t=lr(n,e.slice(1));return t===null?null:Ln(e[0],t)}var ur=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]];function oa(n,e){for(;n>=ur.length;){let t=ur.length,i=[1],r=ur[t-1];for(let o=1;o<t;o++)i[o]=r[o-1]+r[o];i[t]=1,ur.push(i)}return ur[n][e]}function pm(n){let e=n.reduce((i,r)=>i+r,0),t=1;for(let i=0;i<n.length;i+=1)t*=oa(e,n[i]),e-=n[i];return t}function*lc(n,e){if(n===1){yield[e];return}for(let t=0;t<=e;t+=1)for(let i of lc(n-1,e-t))yield[t,...i]}function ra(n,e){let t=n.engine;if(e<0){let s=ra(n,-e);return s?s.inv():null}if(e===0)return t.One;if(e===1)return Ze(n);if(n.operator==="Negate"&&Number.isInteger(e)){let s=e%2===0?1:-1,a=ra(n.op1,e);return a===null?null:s>0?a:a.neg()}if(n.operator,n.operator!=="Add")return null;let i=n.ops,r=lc(i.length,e),o=[];for(let s of r){let a=[t.number(pm(s))];for(let u=0;u<s.length;u+=1)s[u]!==0&&(s[u]===1?a.push(i[u]):a.push(i[u].pow(s[u])));o.push(ae(...a))}return H(...o)}function mm(n,e,t){let i=null;if(e==="Divide"){let r=Ze(t[0]);return r===null?null:r.operator==="Add"?H(...r.ops.map(o=>o.div(t[1]))):n._fn("Divide",[r,t[1]])}if(e==="Multiply")return lr(n,t);if(e==="Negate")return Ze(t[0])?.neg()??null;if(e==="Add")return H(...t.map(r=>Ze(r)??r));if(e==="Power"){let r=ee(t[1]);i=r!==null?ra(t[0],r):null}return i}function Ze(n){return n=n?.canonical,!n||typeof n.operator!="string"?null:Je(n.operator)?n.engine._fn(n.operator,n.ops.map(e=>Ze(e)??e)):mm(n.engine,n.operator,n.ops??[])}function cr(n){if(!n.operator||!n.ops)return null;let e=n.ops.map(i=>cr(i)??i),t=n.engine.function(n.operator,e);return Ze(t)??t}function cc(n){let e=-1;for(;n.operator==="Negate";)n=n.op1,e=-e;return e===1?n:n.isNumberLiteral?n.neg():n.engine._fn("Negate",[n])}function Lt(n){let e=-1;for(;n.operator==="Negate";)n=n.op1,e=-e;if(e===1)return n;if(n.numericValue!==null)return n.neg();let t=n.engine;return n.operator==="Subtract"?n.op2.sub(n.op1):n.operator==="Add"?H(...n.ops.map(i=>Lt(i))):n.operator==="Multiply"?sa(t,n.ops):n.operator==="Divide"?Lt(n.op1).div(n.op2):t._fn("Negate",[n])}function sa(n,e){if(e.length===0)return n.NegativeOne;if(e.length===1)return Lt(e[0]);let t=[],i=!1;for(let r of e)!i&&r.operator==="Negate"?(i=!0,r.op1.is(1)||t.push(r.op1)):t.push(r);if(!i){t=[];for(let r of e)i||r.numericValue===null&&!r.isInteger?t.push(r):(i=!0,r.is(-1)||t.push(r.neg()))}if(i)return n._fn("Multiply",t.sort(xe));if(!i){t=[];for(let r of e)i||r.numericValue===null||!r.isNumber?t.push(r):(i=!0,r.is(-1)||t.push(r.neg()))}return i?n._fn("Multiply",t.sort(xe)):n._fn("Negate",[n._fn("Multiply",[...e].sort(xe))])}function un(n,e){let t=n.engine;if(!n.isValid||!e.isValid)return t._fn("Divide",[n,e]);if(n.isNaN||e.isNaN)return t.NaN;if(e.is(0))return n.is(0)?t.NaN:t.ComplexInfinity;if(n.is(0))return t.Zero;if(e.is(0)===!1&&(n.symbol!==null&&n.symbol===e.symbol&&n.isConstant||n.isSame(e)))return t.One;if(n.operator==="Negate"&&e.operator==="Negate"&&(n=n.op1,e=e.op1),n.operator==="Divide"&&e.operator==="Divide")return un(_e(t,[n.op1,e.op2]),_e(t,[n.op2,e.op1]));if(n.operator==="Divide")return un(n.op1,_e(t,[n.op2,e]));if(e.operator==="Divide")return un(_e(t,[n,e.op2]),e.op1);if(e.is(1))return n;if(e.is(-1))return n.neg();if(n.is(1))return e.inv();if(e.isInfinity)return n.isInfinity?t.NaN:t.Zero;if(n.operator==="Sqrt"&&e.operator==="Sqrt"){let c=ee(n.op1),f=ee(e.op1);if(c!==null&&f!==null)return t.number(t._numericValue({radical:c*f,rational:[1,f]}))}else if(n.operator==="Sqrt"){let c=ee(n.op1),f=ee(e);if(c!==null&&f!==null)return t.number(t._numericValue({radical:c,rational:[1,f]}))}else if(e.operator==="Sqrt"){let c=ee(n),f=ee(e.op1);if(c!==null&&f!==null)return t.number(t._numericValue({radical:f,rational:[c,f]}))}let i=n.numericValue,r=e.numericValue;if(i!==null&&r!==null){if(typeof i!="number"&&i.im!==0||typeof r!="number"&&r.im!==0)return t._fn("Divide",[n,e]);if(typeof i=="number"&&Number.isInteger(i)&&typeof r=="number"&&Number.isInteger(r))return t.number([i,r]);if(typeof i=="number"&&Number.isInteger(i)){if(i===0)return t.Zero;if(typeof r!="number"&&E(r.type,"integer")){let c=r.bignumRe;if(c!==void 0){if(c.isInteger())return t.number([ie(i),ie(c)])}else{let f=r.re;if(Number.isInteger(f))return t.number([i,f])}}}return t._fn("Divide",[n,e])}let[o,s]=n.toNumericValue();if(o.isZero)return t.Zero;let[a,u]=e.toNumericValue();if(a.isZero)return t.NaN;let l=o.div(a);return l.isOne?u.is(1)?s:t._fn("Divide",[s,u]):l.isNegativeOne?u.is(1)?s.neg():t._fn("Divide",[s.neg(),u]):l.isExact?s.is(1)&&u.is(1)?t.number(l):u.is(1)?_e(t,[t.number(l),s]):t._fn("Divide",[_e(t,[t.number(l.numerator),s]),_e(t,[t.number(l.denominator),u])]):t._fn("Divide",[n,e])}function hi(n,e){let t=n.engine;if(n=n.canonical,typeof e!="number"&&(e=e.canonical),n.isNaN)return t.NaN;if(typeof e=="number"){if(isNaN(e))return t.NaN;if(n.is(0))return e===0||!isFinite(e)?t.NaN:n;if(e===1)return n;if(e===-1)return n.neg();if(e===0)return t.NaN;if(n.isNumberLiteral){let r=n.numericValue;if(typeof r=="number"){if(Number.isInteger(r)&&Number.isInteger(e))return t.number(t._numericValue({rational:[r,e]}))}else if(r.isExact&&Number.isInteger(e))return t.number(r.asExact.div(e))}}else{if(e.isNaN)return t.NaN;if(n.is(0))return e.is(0)||e.isFinite===!1?t.NaN:t.Zero;if(e.is(1))return n;if(e.is(-1))return n.neg();if(e.is(0))return t.NaN;if(n.isNumberLiteral&&e.isNumberLiteral){let r=n.numericValue,o=e.numericValue;if(typeof r=="number"&&typeof o=="number"&&Number.isInteger(r)&&Number.isInteger(o))return t.number(t._numericValue({rational:[r,o]}));if(typeof r=="number"&&Number.isInteger(r)&&typeof o!="number"){if(o.isExact)return t.number(t._numericValue(r).div(o.asExact))}else if(typeof o=="number"&&Number.isInteger(o)&&typeof r!="number"){if(r.isExact)return t.number(r.asExact.div(o))}else if(typeof r!="number"&&typeof o!="number"&&r.isExact&&o.isExact)return t.number(r.asExact.div(o.asExact))}}let i=new Oe(t,[n]);return i.div(typeof e=="number"?t._numericValue(e):e),i.asRationalExpression()}function _e(n,e){let t=1,i=[];for(let o of e){let[s,a]=gm(o);t*=a,i.push(s)}i=i.filter(o=>!o.is(1));let r=[];for(let o=0;o<i.length;o++){let s=i[o];if(o+1>=i.length){r.push(s);continue}let a=i[o+1];if(s.isNumberLiteral){if(a.operator==="Sqrt"&&a.op1.isNumberLiteral&&a.op1.type.matches("finite_integer")){let u=a.op1.numericValue;if(typeof u!="number"&&(u=u.re),u>=$){r.push(s);continue}if(s.type.matches("finite_rational")){let l=s.numericValue,[c,f]=typeof l=="number"?[l,1]:[l.numerator.re,l.denominator.re];r.push(n.number(n._numericValue({rational:[c,f],radical:u}))),o++;continue}}else if(a.isNumberLiteral&&a.numericValue instanceof j){let u=a.numericValue;if(u instanceof K&&Ae(u.rational)&&u.radical!==1){let l=rn(s);if(l){r.push(n.number(n._numericValue({rational:l,radical:u.radical}))),o++;continue}}else if(u.im===1){let l=s.numericValue;if(typeof l=="number"){r.push(n.number(n.complex(0,l))),o++;continue}else if(l.im===0){if(Number.isInteger(l.re)){r.push(n.number(n.complex(0,l.re))),o++;continue}else if(!l.isExact){r.push(n.number(n.complex(0,l.re))),o++;continue}}}}}r.push(s)}return t<0?r.length===0?n.number(-1):r.length===1?r[0].neg():sa(n,r):r.length===0?n.number(1):r.length===1?r[0]:n._fn("Multiply",[...r].sort(xe))}function gm(n){let e=1;for(;n.operator==="Negate";)e=-e,n=n.op1;return n.isNumberLiteral&&n.isNegative&&(e=-e,n=n.neg()),[n,e]}function ae(...n){if(n.length>0,n.length===1)return n[0];let e=n[0].engine,t=lr(e,n);if(t){if(t.operator!=="Multiply")return t;n=t.ops}return new Oe(e,n).asRationalExpression()}function fc(...n){n.length>0;let e=n[0].engine;n=n.map(i=>i.N());let t=lr(e,n);if(t){if(t.operator!=="Multiply")return t;n=t.ops}return new Oe(e,n).asExpression({numericApproximation:!0})}var Oe=class n{constructor(e,t,i){this.options=i;if(i=i?{...i}:{},"canonical"in i||(i.canonical=!0),this._isCanonical=i.canonical,this.engine=e,this.coefficient=e._numericValue(1),t)for(let r of t)this.mul(r)}engine;coefficient;terms=[];_isCanonical=!0;static from(e){return new n(e.engine,[e])}mul(e,t){if(e.isCanonical||e.isStructural,this.coefficient.isNaN)return;if(e.isNaN){this.coefficient=this.engine._numericValue(NaN);return}if(e.operator==="Multiply"){for(let o of e.ops)this.mul(o,t);return}if(e.operator==="Negate"){this.mul(e.op1,t),this.coefficient=this.coefficient.neg();return}if(this._isCanonical){if(e.symbol==="Nothing")return;t??=[1,1];let o=e.numericValue;if(o!==null){if(e.is(1))return;if(e.is(0)){this.coefficient=this.engine._numericValue(Dn(t)?NaN:0);return}if(e.is(-1)){Ae(t)?this.coefficient=this.coefficient.neg():this.coefficient=this.coefficient.mul(this.engine._numericValue(-1).pow(this.engine._numericValue(t)));return}if(e.isInfinity){Ae(t)?this.coefficient=this.engine._numericValue(e.isNegative?-1/0:1/0):this.terms.push({term:e,exponent:t});return}Ae(t)?this.coefficient=this.coefficient.mul(o):this.coefficient=this.coefficient.mul(this.engine._numericValue(o).pow(this.engine._numericValue(t)));return}let s=oo(e);if(s!==null){this.coefficient=this.coefficient.mul(this.engine._numericValue({radical:s[0]*s[1],rational:[1,Number(s[1])]}).pow(this.engine._numericValue(t)));return}if(!e.symbol){let a;[a,e]=e.toNumericValue(),t&&!Ae(t)&&(a=a.pow(this.engine._numericValue(t))),this.coefficient=this.coefficient.mul(a)}}if(e.is(1)&&(!t||Ae(t))||e.is(0)===!1&&t&&Dn(t))return;if(e.is(0)){t&&Dn(t)?this.coefficient=this.engine._numericValue(NaN):this.coefficient=this.engine._numericValue(0);return}let i=t??[1,1];if(e.operator==="Power"){let o=rn(e.op2);if(o){this.mul(e.op1,Mn(i,o));return}}if(e.operator==="Sqrt"){this.mul(e.op1,Mn(i,[1,2]));return}if(e.operator==="Root"){let o=rn(e.op2);if(o){this.mul(e.op1,Mn(i,bl(o)));return}}if(e.operator==="Divide"){this.mul(e.op1,i),this.mul(e.op2,It(i));return}let r=!1;for(let o of this.terms)if(o.term.isSame(e)){o.exponent=Bt(o.exponent,i),r=!0;break}r||this.terms.push({term:e,exponent:i})}div(e){e instanceof j?this.coefficient=this.coefficient.div(e):this.mul(e,[-1,1])}groupedByDegrees(e){e??={},"mode"in e||(e.mode="expression");let t=e.mode;if(t==="numeric"&&(this.coefficient.isNegativeInfinity||this.coefficient.isPositiveInfinity))return[];if(this.coefficient.isZero)return[];let i=this.engine;if(this.terms.length===0)if(t==="numeric"){let o=this.coefficient.N();return[{exponent:[1,1],terms:[i.number(o)]}]}else return[{exponent:[1,1],terms:[i.number(this.coefficient)]}];let r=[];if(!this.coefficient.isOne)if(t==="rational"&&this.coefficient.type==="finite_rational"){let o=this.coefficient.numerator;o.isOne||r.push({exponent:[1,1],terms:[i.number(o)]});let s=this.coefficient.denominator;s.isOne||r.push({exponent:[-1,1],terms:[i.number(s)]})}else if(t==="numeric"){let o=this.coefficient.N();r.push({exponent:[1,1],terms:[i.number(o)]})}else r.push({exponent:[1,1],terms:[i.number(this.coefficient)]});for(let o of this.terms){let s=ui(o.exponent);if(s[0]===0)continue;let a=!1;for(let u of r)if(s[0]===u.exponent[0]&&s[1]===u.exponent[1]){u.terms.push(o.term),a=!0;break}a||r.push({exponent:s,terms:[o.term]})}return r}asExpression(e={numericApproximation:!1}){let t=this.engine,i=this.coefficient;if(i.isNaN)return t.NaN;if(i.isPositiveInfinity)return t.PositiveInfinity;if(i.isNegativeInfinity)return t.NegativeInfinity;if(i.isZero)return t.Zero;let r=i.isNegativeOne;r&&(this.coefficient=t._numericValue(1));let o=this.groupedByDegrees({mode:e.numericApproximation?"numeric":"expression"});if(o===null)return t.NaN;if(r){let s=go(t,o).neg();return this.coefficient=t._numericValue(-1),s}return go(t,o)}asNumeratorDenominator(){let e=this.engine,t=this.coefficient;if(t.isZero)return[e.Zero,e.One];if(t.isPositiveInfinity||t.isNegativeInfinity)return this.terms.length===0?[t.isPositiveInfinity?e.PositiveInfinity:e.NegativeInfinity,e.One]:[e.NaN,e.NaN];let i=t.isNegativeOne;i&&(this.coefficient=e._numericValue(1));let r=this.groupedByDegrees({mode:"rational"});if(this.coefficient=t,r===null)return[e.NaN,e.NaN];let o=r.filter(u=>u.exponent[0]>=0),s=r.filter(u=>u.exponent[0]<0).map(u=>({exponent:It(u.exponent),terms:u.terms})),a=go(e,o);return[i?a.neg():a,go(e,s)]}asRationalExpression(){let[e,t]=this.asNumeratorDenominator();return un(e,t)}};function dc(n,e){let t=n.engine,i=n.coefficient.gcd(e.coefficient);if(i.isOne)return[t._numericValue(1),t.One];let r=[];for(let o of n.terms){let s=e.terms.find(u=>o.term.isSame(u.term));if(!s)continue;let a=ro(o.exponent,s.exponent);if(Ae(a))r.push(o.term);else{let[u,l]=El(a);l===1?r.push(o.term.pow(u)):u===1?r.push(o.term.root(l)):r.push(o.term.pow(u).root(l))}}return[i,r.length===0?t.One:ae(...r)]}function go(n,e){let t=e.map(({terms:i,exponent:r})=>{let o=Q(i,"Multiply"),s=o.length<=1?o[0]:n._fn("Multiply",[...o].sort(xe));return Ae(r)?s:s.pow(n.number(r))});return t=Q(t,"Multiply"),t.length===0?n.One:t.length===1?t[0]:n._fn("Multiply",t.sort(xe))}function pc(n,e,t,i,r){if(e.numericValue!==null&&e.isNegative){let o=e.numericValue;if(typeof o=="number")return O(n,"Subtract",[t,n.number(-o)],i,r);if(e.type.matches("rational"))return O(n,"Subtract",[t,n.number(o.neg())],i,r)}return e.operator==="Negate"&&t.operator!=="Negate"?O(n,"Subtract",[t,e.op1],i,r):null}function hm(n,e,t,i,r){let o=i.exclude;if(e==="Add"&&t.length===2&&!o.includes("Subtract")){let s=pc(n,t[0],t[1],i,r)??pc(n,t[1],t[0],i,r);if(s)return s}if(e==="Divide"&&t.length===2&&o.includes("Divide"))return O(n,"Multiply",[t[0],n._fn("Power",[t[1],n.NegativeOne])],i,r);if(e==="Multiply"&&!o.includes("Negate")&&t[0].im===0&&t[0].re===-1)return t.length===2?O(n,"Negate",[t[1]],i):O(n,"Negate",[n._fn("Multiply",[...t.slice(1)].sort(xe))],i,r);if(e==="Multiply"&&!o.includes("Divide")){let s=new Oe(n,t,{canonical:!1}).asRationalExpression();if(s.operator==="Divide")return O(n,s.operator,s.ops,i,r)}if(e==="Power"){if(!o.includes("Exp")&&t[0]?.symbol==="ExponentialE")return O(n,"Exp",[t[1]],i,r);if(t[1]?.numericValue!==null){let s=ee(t[1]);if(s===2&&!o.includes("Square"))return O(n,"Square",[t[0]],i,r);if(s!==null&&s<0&&!o.includes("Divide"))return O(n,"Divide",[n.One,s===-1?t[0]:t[0].pow(-s)],i,r);let a=t[1].re;if(!o.includes("Sqrt")&&a===.5)return O(n,"Sqrt",[t[0]],i,r);if(!o.includes("Sqrt")&&a===-.5)return O(n,"Divide",[n.One,n._fn("Sqrt",[t[0]])],i,r);if(Yn(a)){let u=As(a),l=Ds(a);if(u===1){if(!o.includes("Sqrt")&&l===2)return O(n,"Sqrt",[t[0]],i,r);if(!o.includes("Root"))return O(n,"Root",[t[0],n.number(a[1])],i,r)}if(u===-1){if(!o.includes("Sqrt")&&l===2)return O(n,"Divide",[n.One,n._fn("Sqrt",[t[0]])],i,r);if(!o.includes("Root"))return O(n,"Divide",[n.One,n._fn("Root",[t[0],n.number(a[1])])],i,r)}}}}if(e==="Add"&&t.length===2&&!o.includes("Subtract")){if(t[1]?.numericValue!==null){let s=ee(t[1]);if(s!==null&&s<0)return O(n,"Subtract",[t[0],n.number(-s)],i,r)}if(t[1]?.operator==="Negate")return O(n,"Subtract",[t[0],t[1].op1],i,r)}if(e==="Tuple"){if(t.length===1&&!o.includes("Single"))return O(n,"Single",t,i,r);if(t.length===2&&!o.includes("Pair"))return O(n,"Pair",t,i,r);if(t.length===3&&!o.includes("Triple"))return O(n,"Triple",t,i,r)}if(e==="Function"&&t.length>0&&t[0].operator==="Block"){let s=t[0];if(s.nops===1){let a=t.slice(1);return a.every(u=>/_\d?/.test(u.symbol))?s.op1.ops?.every((u,l)=>u.symbol===a[l]?.symbol)?O(n,"Function",[n.symbol(s.op1.operator,{canonical:!1})],i,r):O(n,"Function",[s.op1],i,r):O(n,"Function",[s.op1,...t.slice(1)],i,r)}}return O(n,e,t,i,r)}function O(n,e,t,i,r){let o=i.exclude;if(e==="Negate"&&t.length===1){let l=t[0]?.numericValue;if(l!==null){if(typeof l=="number")return ln(n,-l,i);if(l instanceof M||l instanceof q)return ln(n,l.neg(),i);if(Yn(l))return ln(n,It(l),i)}}if(typeof e=="string"&&o.includes(e)){if(e==="Rational"&&t.length===2)return O(n,"Divide",t,i,r);if(e==="Complex"&&t.length===2)return O(n,"Add",[t[0],n._fn("Multiply",[t[1]??n.symbol("Undefined"),n.I])],i,r);if(e==="Sqrt"&&t.length===1)return O(n,"Power",[t[0],o.includes("Half")?n.number([1,2]):n.Half],i,r);if(e==="Root"&&t.length===2&&t[1]?.numericValue!==null){let l=ee(t[1]);if(l===2)return O(n,"Sqrt",[t[0]],i);if(l!==null)return l<0?O(n,"Divide",[n.One,n._fn("Power",[t[0]??n.symbol("Undefined"),n.number([1,-l])])],i,r):O(n,"Power",[t[0],n.number([1,-l])],i,r)}if(e==="Square"&&t.length===1)return O(n,"Power",[t[0],n.number(2)],i,r);if(e==="Exp"&&t.length===1)return O(n,"Power",[n.E,t[0]],i,r);if(e==="Pair"||e=="Single"||e==="Triple")return O(n,"Tuple",t,i,r);if(e==="Subtract"&&t.length===2)return O(n,"Add",[t[0],n._fn("Negate",[t[1]??n.symbol("Undefined")])],i,r);if(e==="Subtract"&&t.length===1)return O(n,"Negate",t,i,r)}let a=[e,...t.map(l=>l?aa(n,l,i):"Undefined")],u={...r??{}};return i.metadata.includes("latex")?u.latex=u.latex??n.box({fn:a}).latex:u.latex="",i.metadata.includes("wikidata")||(u.wikidata=""),!u.latex&&!u.wikidata&&i.shorthands.includes("function")?a:u.latex&&u.wikidata?{fn:a,latex:u.latex,wikidata:u.wikidata}:u.latex?{fn:a,latex:u.latex}:u.wikidata?{fn:a,wikidata:u.wikidata}:{fn:a}}function ym(n,e){return n=n,e.shorthands.includes("string")?tn(n)||Ge(n)?`'${n}'`:n:{str:n}}function mt(n,e,t,i){if(e==="Half"&&t.exclude.includes("Half"))return ln(n,[1,2],t,i);if(i={...i},t.metadata.includes("latex")?(i.latex=i.latex??n.box({sym:e}).latex,i.latex!==void 0&&(i.latex=i.latex)):i.latex=void 0,t.metadata.includes("wikidata")){if(i.wikidata===void 0){let r=n.lookupDefinition(e);if(r){let o=Z(r)?r.operator.wikidata:r.value.wikidata;o!==void 0&&(i.wikidata=o)}}}else i.wikidata=void 0;return e=e,i.latex===void 0&&i.wikidata===void 0&&t.shorthands.includes("symbol")?Ge(e)?e:`\`${e}\``:i.latex!==void 0&&i.wikidata!==void 0?{sym:e,latex:i.latex,wikidata:i.wikidata}:i.latex!==void 0?{sym:e,latex:i.latex}:i.wikidata!==void 0?{sym:e,wikidata:i.wikidata}:{sym:e}}function mc(n,e){if(!e.repeatingDecimal)return n;let[t,i,r,o]=n.match(/^(.*)\.([0-9]+)([e|E][-+]?[0-9]+)?$/)??[];if(!r)return n.toLowerCase();let s=r[r.length-1];r=r.slice(0,-1);let a=16,u="";for(let l=0;l<r.length-a;l++){u=r.substring(0,l);for(let c=0;c<=a;c++){let f=r.substring(l,l+c+1),d=Math.floor((r.length-u.length)/f.length);if(d<3)break;if((u+f.repeat(d+1)).startsWith(r))return f==="0"?s==="0"?i+"."+u+(o??""):n:i+"."+u+"("+f+")"+(o??"")}}for(r+=s;r.endsWith("0");)r=r.slice(0,-1);return typeof e.fractionalDigits=="number"&&(r=r.slice(0,e.fractionalDigits)),o?`${i}.${r}${o.toLowerCase()}`:`${i}.${r}`}function ln(n,e,t,i){i={...i},t.metadata.includes("latex")||(i.latex=void 0);let r=i.latex===void 0&&i.wikidata===void 0&&!t.metadata.includes("latex")&&t.shorthands.includes("number"),o=t.exclude;if(e instanceof j){if(e.isNaN)return mt(n,"NaN",t,i);if(e.isPositiveInfinity)return mt(n,"PositiveInfinity",t,i);if(e.isNegativeInfinity)return mt(n,"NegativeInfinity",t,i);if(e.isComplexInfinity)return mt(n,"ComplexInfinity",t,i);if(r){if(e.isZero)return 0;if(e.isOne)return 1;if(e.isNegativeOne)return-1}if(e instanceof K){e.im;let u=l=>Tt(l)?ln(n,e.rational[0],t):["Rational",ln(n,e.rational[0],t),ln(n,e.rational[1],t)];return e.radical===1?u(e.rational):Ae(e.rational)?["Sqrt",e.radical]:Zi(e.rational)?["Negate",["Sqrt",e.radical]]:e.rational[0]==1?["Divide",["Sqrt",e.radical],ln(n,e.rational[1],t)]:e.rational[0]==-1?["Negate",["Divide",["Sqrt",e.radical],ln(n,e.rational[1],t)]]:["Multiply",u(e.rational),["Sqrt",e.radical]]}if(e.im===0){let u=e.bignumRe??e.re;return ln(n,u,t,i)}return Number.isFinite(e.im)?O(n,"Complex",[n.number(e.bignumRe??e.re),n.number(e.im)],t,{...i,wikidata:"Q11567"}):mt(n,"ComplexInfinity",t,i)}let s="";if(e instanceof M){let u;if(e.isNaN())u="NaN";else if(!e.isFinite())u=e.isPositive()?"PositiveInfinity":"NegativeInfinity";else{if(r&&Mt(e))return e.toNumber();if(e.isInteger()&&e.e<e.precision()+4)s=e.toFixed(0);else{let l=t.fractionalDigits,c;if(l==="max"?c=e.toString():l==="auto"?c=e.toPrecision(n.precision):c=e.toDecimalPlaces(l).toString(),s=mc(c,t),r){let f=e.toNumber();if(f.toString()===s)return f}}}return t.metadata.includes("latex")&&(i.latex=i.latex??n.box(u??{num:s}).latex),u?i.latex!==void 0?{sym:u,latex:i.latex}:r?u:{sym:u}:i.latex!==void 0?{num:s,latex:i.latex}:r?s:{num:s}}if(e instanceof q)return e.isInfinite()?mt(n,"ComplexInfinity",t,i):e.isNaN()?(s="NaN",t.metadata.includes("latex")&&(i.latex=i.latex??n.box({num:s}).latex),i.latex!==void 0?{num:s,latex:i.latex}:{num:s}):O(n,"Complex",[n.number(e.re),n.number(e.im)],t,{...i,wikidata:"Q11567"});if(Yn(e)){let u=!o.includes("Rational");return r&&t.shorthands.includes("function")&&se(e)?e[0]===1&&e[1]===2&&!o.includes("Half")?mt(n,"Half",t,i):[u?"Rational":"Divide",e[0],e[1]]:O(n,u?"Rational":"Divide",[n.number(e[0]),n.number(e[1])],t,{...i})}if(typeof e=="bigint")if(e>=Number.MIN_SAFE_INTEGER&&e<=Number.MAX_SAFE_INTEGER)e=Number(e);else return t.metadata.includes("latex")&&(i.latex=i.latex??n.box({num:e.toString()}).latex),i.latex!==void 0?{num:e.toString(),latex:i.latex}:r?Le(e,t.fractionalDigits):{num:Be(e,t.fractionalDigits)};let a;return Number.isNaN(e)?a="NaN":Number.isFinite(e)?s=mc(e.toString(),t):a=e>0?"PositiveInfinity":"NegativeInfinity",t.metadata.includes("latex")&&(i.latex=i.latex??n.box({num:s}).latex),a?i.latex!==void 0?{sym:a,latex:i.latex}:r?a:{sym:a}:i.latex!==void 0?{num:s,latex:i.latex}:r&&s===e.toString()?e:{num:s}}function aa(n,e,t){let i=e.wikidata;return e.numericValue!==null?ln(n,e.numericValue,t,{latex:e.verbatimLatex}):e.rank>0?e.json:e.string!==null?ym(e.string,t):e.symbol!==null?mt(n,e.symbol,t,{latex:e.verbatimLatex,wikidata:i}):e.ops?e.isValid&&(e.isCanonical||e.isStructural)&&t.prettify?hm(n,e.operator,e.structural.ops,t,{latex:e.verbatimLatex,wikidata:i}):O(n,e.operator,e.structural.ops,t,{latex:e.verbatimLatex,wikidata:i}):e.json}var W=class{engine;verbatimLatex;constructor(e,t){this.engine=e,t?.latex!==void 0&&(this.verbatimLatex=t.latex)}valueOf(){try{return this.symbol==="True"?!0:this.symbol==="False"?!1:this.symbol==="NaN"?NaN:this.symbol==="PositiveInfinity"?1/0:this.symbol==="NegativeInfinity"?-1/0:this.symbol==="ComplexInfinity"?"~oo":this.isInfinity?this.isPositive?1/0:this.isNegative?-1/0:"~oo":typeof this.string=="string"?this.string:typeof this.symbol=="string"?this.value?.valueOf()??this.symbol:sr(this)}catch(e){if(e instanceof Ye){let t=e.message??"<canceled>";return e.cause?`${t}: ${e.cause}`:`${t}`}return e.message?e.message:"<error>"}}[Symbol.toPrimitive](e){if(e==="number"){let t=this.valueOf();return typeof t=="number"?t:null}return this.toString()}toString(){try{if(this.isLazyCollection){let e=this.evaluate({materialization:!0});if(!e.isLazyCollection)return sr(e)}return sr(this)}catch(e){if(e instanceof Ye){let t=e.message??"<canceled>";return e.cause?`${t}: ${e.cause}`:`${t}`}return e.message?e.message:"<error>"}}toLatex(e){if(this.isLazyCollection){let r=this.evaluate({materialization:e?.materialization??!0});if(!r.isLazyCollection)return r.toLatex(e)}let t=this.toMathJson({prettify:e?.prettify??!0}),i={imaginaryUnit:"\\imaginaryI",positiveInfinity:"\\infty",negativeInfinity:"-\\infty",notANumber:"\\operatorname{NaN}",decimalSeparator:this.engine.decimalSeparator,digitGroupSeparator:"\\,",exponentProduct:"\\cdot",beginExponentMarker:"10^{",endExponentMarker:"}",digitGroup:3,truncationMarker:"\\ldots",repeatingDecimal:"vinculum",fractionalDigits:"max",notation:"auto",avoidExponentsInRange:[-7,20],prettify:!0,materialization:!1,invisibleMultiply:"",invisiblePlus:"",multiply:"\\times",missingSymbol:"\\blacksquare",applyFunctionStyle:Au,groupStyle:Du,rootStyle:Mu,fractionStyle:Ru,logicStyle:Pu,powerStyle:Lu,numericSetStyle:Ou};return e?.fractionalDigits==="auto"?i.fractionalDigits=-this.engine.precision:i.fractionalDigits=e?.fractionalDigits??"max",typeof i.fractionalDigits=="number"&&i.fractionalDigits>this.engine.precision&&(i.fractionalDigits=this.engine.precision),i={...i,...e??{},fractionalDigits:i.fractionalDigits},!i.prettify&&this.verbatimLatex?this.verbatimLatex:Kl(t,this.engine._indexedLatexDictionary,i)}get latex(){return this.toLatex()}toJSON(){return this.json}toMathJson(e){let t={exclude:[],shorthands:["function","symbol","string","number"],metadata:[],fractionalDigits:"max",repeatingDecimal:!0,prettify:!0};e&&((typeof e.shorthands=="string"&&e.shorthands==="all"||e.shorthands?.includes("all"))&&(t.shorthands=["function","symbol","string","number"]),Array.isArray(e.shorthands)&&(t.shorthands=e.shorthands),(typeof e.metadata=="string"&&e.metadata==="all"||e.metadata?.includes("all"))&&(t.metadata=["latex","wikidata"]),e.fractionalDigits==="auto"&&(t.fractionalDigits=-this.engine.precision),typeof e.fractionalDigits=="number"&&(t.fractionalDigits=e.fractionalDigits));let i={...t,...e,fractionalDigits:t.fractionalDigits,shorthands:t.shorthands,metadata:t.metadata};return aa(this.engine,this,i)}print(){let e=console.info;e?.(this.toString())}get isStructural(){return!0}get canonical(){return this}get structural(){return this}get isValid(){return!0}get isPure(){return!1}get isConstant(){return!0}get isNumberLiteral(){return!1}get numericValue(){return null}toNumericValue(){return[this.engine._numericValue(1),this]}get isEven(){}get isOdd(){}get re(){return NaN}get im(){return NaN}get bignumRe(){}get bignumIm(){}get sgn(){}get isPositive(){}get isNonNegative(){}get isNegative(){}get isNonPositive(){}neg(){return this.engine.NaN}inv(){return this.engine.NaN}abs(){return this.engine.NaN}add(e){return this.engine.NaN}sub(e){return this.add(e.neg())}mul(e){return this.engine.NaN}div(e){return this.engine.NaN}pow(e){return this.engine.NaN}root(e){return this.engine.NaN}sqrt(){return this.engine.NaN}ln(e){return this.engine.NaN}get numerator(){return this}get denominator(){return this.engine.One}get numeratorDenominator(){return[this,this.engine.One]}is(e){return typeof e=="number"||typeof e=="bigint"||e==null?!1:typeof e=="boolean"?e===!0?this.value?.symbol==="True":e===!1?this.value?.symbol==="False":!1:typeof e=="string"?this.value?.string===e:oi(this,this.engine.box(e))}isSame(e){return oi(this,e)}isEqual(e){return no(this,e)}isLess(e){let t=si(this,e);if(t!==void 0)return t==="<"}isLessEqual(e){let t=si(this,e);if(t!==void 0)return t==="<="||t==="<"||t==="="}isGreater(e){let t=si(this,e);if(t!==void 0)return t===">"}isGreaterEqual(e){let t=si(this,e);if(t!==void 0)return t===">="||t===">"||t==="="}get symbol(){return null}get tensor(){return null}get string(){return null}getSubexpressions(e){return gc(this,e)}get subexpressions(){return this.getSubexpressions("")}get symbols(){let e=new Set;return hc(this,e),Array.from(e).sort()}get unknowns(){let e=new Set;return yc(this,e),Array.from(e).sort()}get errors(){return this.getSubexpressions("Error")}get isFunctionExpression(){return!1}get ops(){return null}get isScoped(){return!1}get localScope(){}get nops(){return 0}get op1(){return this.engine.Nothing}get op2(){return this.engine.Nothing}get op3(){return this.engine.Nothing}get isNaN(){}get isInfinity(){}get isFinite(){}get shape(){return[]}get rank(){return 0}subs(e,t){return t?.canonical===!0?this.canonical:this}map(e,t){if(!this.ops)return e(this);let i=t?.canonical??this.isCanonical,r=t?.recursive??!0,o=this.ops.map(s=>r?s.map(e,t):e(s));return e(this.engine.function(this.operator,o,{canonical:i}))}solve(e){return null}replace(e){return null}has(e){return!1}get description(){if(this.baseDefinition&&this.baseDefinition.description)return typeof this.baseDefinition.description=="string"?[this.baseDefinition.description]:this.baseDefinition.description}get url(){return this.baseDefinition?.url??void 0}get wikidata(){return this.baseDefinition?.wikidata??void 0}get complexity(){}get baseDefinition(){}get valueDefinition(){}get operatorDefinition(){}infer(e,t){return!1}bind(){}reset(){}get value(){}set value(e){throw new Error(`Can't change the value of \\(${this.toString()}\\)`)}get type(){return S.unknown}set type(e){throw new Error(`Can't change the type of \\(${this.toString()}\\)`)}get isNumber(){}get isInteger(){}get isRational(){}get isReal(){}simplify(e){return this}expand(){return Ze(this)??this}evaluate(e){return this.simplify()}evaluateAsync(e){return Promise.resolve(this.evaluate())}N(){return this.evaluate({numericApproximation:!0})}compile(e){try{if(e?.to&&e.to!=="javascript")throw new Error(`Unexpected compilation target "${e.to}"`);return e??={},jl(this,e.functions,e.vars,e.imports,e.preamble)}catch(t){if(e?.fallback??!0)return gl(this);throw t}}get isCollection(){return!1}get isIndexedCollection(){return!1}get isLazyCollection(){return!1}xcontains(e){}subsetOf(e,t){}get xsize(){}get isEmptyCollection(){if(!this.isCollection)return;let e=this.xsize;if(e!==void 0)return e===0}get isFiniteCollection(){if(!this.isCollection)return;let e=this.xsize;if(e!==void 0)return Number.isFinite(e)}each(){return function*(){}()}at(e){}get(e){}indexWhere(e){}};function gc(n,e){let t=!e||n.operator===e?[n]:[];if(n.ops)for(let i of n.ops)t.push(...gc(i,e));return t}function hc(n,e){if(n.symbol){e.add(n.symbol);return}if(n.ops)for(let t of n.ops)hc(t,e)}function yc(n,e){if(n.symbol){let t=n.symbol;if(t==="Unknown"||t==="Undefined"||t==="Nothing"||n.valueDefinition?.isConstant||n.operatorDefinition)return;n.engine._getSymbolValue(t)===void 0&&e.add(t);return}if(n.ops)for(let t of n.ops)yc(t,e)}var _n=class{name;wikidata;description;url;_engine;_defValue;_value;_type;inferredType;_isConstant=!1;holdUntil="evaluate";eq;neq;cmp;collection;constructor(e,t,i){if(this._engine=e,this.name=t,i.wikidata&&(this.wikidata=i.wikidata),i.description&&(this.description=i.description),i.url&&(this.url=i.url),i.holdUntil&&(this.holdUntil=i.holdUntil),i.isConstant&&(this._isConstant=i.isConstant,this._defValue=i.value),i.type){let r=i.type instanceof S?i.type:A(i.type);if(!st(r))throw new Error([`Symbol "${this.name}"`,`The type "${i.type}" is invalid `].join(`
|   `));this._type=new S(r,e._typeResolver),this.inferredType=i.inferred??!1,e.listenToConfigurationChange(this)}if(this._value=xc(this._engine,i.value),this._value){if(!this._type||this._type.isUnknown)this.isConstant?(this._type=this._value.type,this.inferredType=!1):(this._type=xm(e,this._value),this.inferredType=!0);else if(!this._value.type.matches(this._type))throw new Error([`Symbol "${this.name}"`,`The value "${this._value.toString()}" of type "${this._value.type}" is not compatible with the type "${this._type}"`].join(`
|   `))}if(i.eq&&(this.eq=i.eq),i.neq&&(this.neq=i.neq),i.cmp&&(this.cmp=i.cmp),i.collection&&(this.collection=eo(i.collection)),this.holdUntil==="never"&&!this.isConstant)throw new Error([`Symbol "${this.name}"`,'The "holdUntil" property cannot be "never" for a non-constant symbol'].join(`
|   `))}toJSON(){let e={name:this.name,isConstant:this._isConstant};return this.wikidata&&(e.wikidata=this.wikidata),this.description&&(e.description=this.description),this.url&&(e.url=this.url),this._type&&(e.type=this._type.toString()),e.inferredType=this.inferredType,e.holdUntil=this.holdUntil,this.collection&&(e.collection=this.collection),e}get isConstant(){return this._isConstant}get value(){return this._value===null&&(this._value=xc(this._engine,this._defValue)),this._value}get type(){return this._type??this._value?.type??S.unknown}set type(e){if(this._isConstant)throw new Error(`The type of the constant "${this.name}" cannot be changed`);this._type=e instanceof S?e:new S(e,this._engine._typeResolver),this._type.isUnknown&&(this._defValue=void 0,this._value=void 0)}onConfigurationChange(){this.isConstant&&(this._value=null)}};function xc(n,e){if(e!==void 0)return zi(e)?n.parse(e)??n.symbol("Undefined"):typeof e=="function"?n.box(e(n)??"Undefined"):e instanceof W?e:n.box(e)}function xm(n,e){return e?e.type.matches("integer")?n.type("integer"):e.type.matches("rational")||e.type.matches("real")?n.type("real"):e.type.matches("complex")?n.type("number"):e.type:n.type("unknown")}function bc(n){return n!=null&&n instanceof W&&n.type.matches("dictionary")}function Xn(n){return n instanceof W}function me(n){return n.precision>kn}function cn(n){let e=0;for(let t=0;t<n.length;t++)e=Math.imul(31,e)+n.charCodeAt(t)|0;return Math.abs(e)}function fr(n){return n==null?[]:typeof n=="string"?[n]:Xn(n)?fr(n.symbol):typeof n[Symbol.iterator]=="function"?Array.from(n).map(e=>typeof e=="string"?e:e.symbol):[]}function ho(n){return n.symbol==="Numbers"?"number":n.symbol==="ComplexNumbers"?"complex":n.symbol==="ImaginaryNumbers"?"imaginary":n.symbol==="RealNumbers"?"real":n.symbol==="RationalNumbers"?"rational":n.symbol==="Integers"?"integer":"unknown"}function bm(n){if(!n)return n;let e=n.engine,t=e.angularUnit;return t==="rad"||(t==="deg"&&(n=n.mul(e.Pi).div(180)),t==="grad"&&(n=n.mul(e.Pi).div(200)),t==="turn"&&(n=n.mul(e.Pi).mul(2))),n}function ao(n){if(!n)return n;let e=bm(n);if(!e)return;if(e.N().im!==0)return e;let t=e.engine,[i,r]=Ot(e);if(i.isZero)return t.number(r);let o=t._numericValue(i.bignumRe?i.bignumRe.mod(2):i.re%2);return t.number(r.add(t.Pi.mul(o).N().numericValue))}function li(n){if(typeof n=="number")return;let e=n.engine;if(n.symbol==="ImaginaryUnit")return e.One;if(n.re===0)return e.number(n.im);if(n.operator==="Negate")return li(n.op1)?.neg();if(n.operator==="Complex")return n.op1.is(0)&&!isNaN(n.op2.re)?e.number(n.op2.re):void 0;if(n.operator==="Multiply"&&n.nops===2){let[t,i]=n.ops;if(t.symbol==="ImaginaryUnit")return i;if(i.symbol==="ImaginaryUnit")return t;if(i.isNumberLiteral&&i.re===0&&i.im!==0)return t.mul(i.im);if(t.isNumberLiteral&&t.re===0&&t.im!==0)return i.mul(t.im)}if(n.operator==="Divide"){let t=n.op2;return t.is(0)?void 0:li(n.op1)?.div(t)}}function dr(n){let{engine:e}=n;return n===e.I?!0:n.isNumberLiteral?n.re===0&&n.im===1:n.symbol!==null?n.canonical.isSame(e.I):!1}function Ot(n){let e=n.engine;if(n.symbol==="Pi")return[e._numericValue(1),e._numericValue(0)];if(n.operator==="Negate"){let[t,i]=Ot(n.ops[0]);return[t.neg(),i.neg()]}if(n.operator==="Add"&&n.nops===2){let[t,i]=Ot(n.op1),[r,o]=Ot(n.op2);return[t.add(r),i.add(o)]}if(n.operator==="Multiply"&&n.nops===2){if(n.op1.isNumberLiteral){let[t,i]=Ot(n.op2),r=n.op1.numericValue;return[t.mul(r),i.mul(r)]}if(n.op2.isNumberLiteral){let[t,i]=Ot(n.op1),r=n.op2.numericValue;return[t.mul(r),i.mul(r)]}}if(n.operator==="Divide"&&n.op2.isNumberLiteral){let[t,i]=Ot(n.op1),r=n.op2.numericValue;return[t.div(r),i.div(r)]}return[e._numericValue(0),e._numericValue(n.N().numericValue??0)]}function pr(n){if(n==null||typeof n!="object"||Xn(n))return!1;if(("signature"in n||"complexity"in n)&&"constant"in n)throw new Error("Operator definition cannot have a `constant` field and value definition cannot have a `signature` field.");if(!("evaluate"in n)&&!("signature"in n)&&!("sgn"in n)&&!("complexity"in n)&&!("canonical"in n))return!1;if("type"in n&&n.type!==void 0&&typeof n.type!="function")throw new Error("The `type` field of an operator definition should be a function");if("sgn"in n&&n.sgn!==void 0&&typeof n.sgn!="function")throw new Error("The `sgn` field of an operator definition should be a function");return!0}function mr(n){if(n==null||typeof n!="object"||Xn(n))return!1;if("value"in n||"constant"in n||"inferred"in n){if("type"in n&&typeof n.type=="function")return!1;if("signature"in n)throw new Error("Value definition cannot have a `signature` field. Use a `type` field instead.");if("sgn"in n)throw new Error("Value definition cannot have a `sgn` field. Use a `flags.sgn` field instead.");return!0}if("type"in n&&n.type!==void 0&&typeof n.type!="function")return!0;if("description"in n)throw new Error("Definitions should have a `type` or `value` field.");return!1}function ne(n){return n!==void 0&&"value"in n}function Z(n){return n!==void 0&&"operator"in n}function gr(n,e,t,i){i instanceof _n?(delete t.operator,t.value=i.value):mr(i)?(delete t.operator,t.value=new _n(n,e,i)):i instanceof kt?(delete t.value,t.operator=i):pr(i)&&(delete t.value,t.operator=new kt(n,e,i))}function Xe(n,e,t){if(e=Q(e),!n.strict||e.length===t)return e;let i=[...e.slice(0,t)],r=Math.min(t,e.length);for(;r<t;)i.push(n.error("missing")),r+=1;for(;r<e.length;)i.push(n.error("unexpected-argument",e[r].toString())),r+=1;return i}function He(n,e,t){let i=typeof t=="number"?t:t?.count,r=typeof t=="number"?void 0:t?.flatten;if(e=Q(e,r),!n.strict){let a="real";for(let u of e)if(E("complex",u.type.type)){a="number";break}for(let u of e)pe(u)||u.infer(a);return e}let o=!0;i??=e.length;let s=[];for(let a=0;a<=Math.max(i-1,e.length-1);a++){let u=e[a];if(a>i-1)o=!1,s.push(n.error("unexpected-argument",u.toString()));else if(u===void 0)o=!1,s.push(n.error("missing"));else if(!u.isValid)o=!1,s.push(u);else if(u.isNumber)s.push(u);else if(u.symbol&&!n.lookupDefinition(u.symbol))s.push(u);else if(u.type.isUnknown)s.push(u);else if(pe(u)){for(let l of u.each())if(!l.isNumber){o=!1;break}o?s.push(u):s.push(n.typeError("number",u.type,u))}else u.valueDefinition?.inferredType&&E("number",u.type.type)||u.operatorDefinition?.inferredSignature&&E("number",u.type.type)||u.operator==="Hold"||u.valueDefinition?.value?.operator==="Hold"?s.push(u):(o=!1,s.push(n.typeError("number",u.type,u)))}if(o){let a="real";for(let u of s)if(E("complex",u.type.type)){a="number";break}for(let u of s)if(pe(u))for(let l of u.each())l.infer(a);else u.infer(a)}return s}function ge(n,e,t){return e==null?n.error("missing"):t===void 0?n.error("unexpected-argument",e.toString()):(e=e.canonical,!e.isValid||e.type.matches(t)?e:n.typeError(t,e.type,e))}function Qi(n,e,t){if(e.length===t.length&&e.every((r,o)=>r.type.matches(t[o])))return e;let i=[];for(let r=0;r<=t.length-1;r++)i.push(ge(n,e[r],t[r]));for(let r=t.length;r<=e.length-1;r++)i.push(n.error("unexpected-argument",e[r].toString()));return i}function yi(n,e,t,i,r){if(!n.strict||typeof t=="string"||t.kind!=="signature")return null;let o=[],s=!0,a=t.args?.map(d=>d.type)??[],u=t.optArgs?.map(d=>d.type)??[],l=t.variadicArg?.type,c=t.variadicMin??0,f=0;for(let d of a){let p=e[f++];if(!p){o.push(n.error("missing")),s=!1;continue}if(i){o.push(p);continue}if(!p.isValid){o.push(p),s=!1;continue}if(p.type.isUnknown){o.push(p);continue}if(r&&pe(p)){o.push(p);continue}if(p.valueDefinition?.inferredType&&p.type.matches(d)){o.push(p);continue}if(p.operatorDefinition?.inferredSignature&&p.type.matches(d)){o.push(p);continue}if(!p.type.matches(d)){o.push(n.typeError(d,p.type,p)),s=!1;continue}o.push(p)}for(let d of u){let p=e[f];if(!p)break;if(i){o.push(p),f+=1;continue}if(!p.isValid){o.push(p),s=!1,f+=1;continue}if(p.type.isUnknown){o.push(p),f+=1;continue}if(r&&pe(p)){o.push(p),f+=1;continue}if(p.valueDefinition?.inferredType&&p.type.matches(d)){o.push(p),f+=1;continue}if(!p.type.matches(d)){o.push(n.typeError(d,p.type,p)),s=!1,f+=1;continue}o.push(p),f+=1}if(l){let d=0;for(let p of e.slice(f)){if(f+=1,d+=1,i){o.push(p);continue}if(!p.isValid){o.push(p),s=!1;continue}if(p.type.isUnknown){o.push(p);continue}if(r&&pe(p)){o.push(p);continue}if(p.valueDefinition?.inferredType&&p.type.matches(l)){o.push(p);continue}if(!p.type.matches(l)){o.push(n.typeError(l,p.type,p)),s=!1;continue}o.push(p)}d<c&&(o.push(n.error("missing")),s=!1)}if(f<e.length)for(let d of e.slice(f))o.push(n.error("unexpected-argument",d.toString())),s=!1;if(!s)return o;f=0;for(let d of a)i||(!r||!pe(e[f]))&&e[f].infer(d),f+=1;for(let d of u){if(!e[f])break;(!r||!pe(e[f]))&&e[f]?.infer(d),f+=1}if(l)for(let d of e.slice(f))i||(!r||!pe(d))&&d.infer(l),f+=1;return null}function Ec(n){let e={},t=vm(n.engine),i=Em(n.engine);if(n.symbol&&!e[n.symbol]&&!n.symbol.startsWith("_")){if(!t.includes(n.symbol)){let r=Mi(n.symbol,t);r&&(e[n.symbol]=r)}}else if(n.ops&&!e[n.operator]&&!n.operator.startsWith("_")){let r=n.operator;if(!i.includes(r)){let o=Mi(r,i);o&&(e[r]=o)}for(let o of n.ops)e={...e,...Ec(o)}}return e}function Em(n){let e=[],t=n.context.lexicalScope;for(;t;){for(let i of t.bindings.keys()){let r=t.bindings.get(i);Z(r)&&e.push(i)}t=t.parent}return e}function vm(n){let e=[],t=n.context.lexicalScope;for(;t;){for(let i of t.bindings.keys()){let r=t.bindings.get(i);ne(r)&&e.push(i)}t=t.parent}return e}function an(n){let e=Ec(n);if(Object.keys(e).length===0)return"";if(Object.keys(e).length===1){let[i,r]=Object.entries(e)[0];return`Unknown symbol "${i}". Did you mean "${r}"?`}let t=[];for(let[i,r]of Object.entries(e))t.push(`- "${i}" -> "${r}"?`);return`Unknown symbols found:
${t.join(`
`)}`}function ua(n){if(n!==void 0)return isNaN(n)?"unsigned":n>0?"positive":n<0?"negative":"zero"}function la(n){return n==="positive"?"negative":n==="non-negative"?"non-positive":n==="negative"?"positive":n==="non-positive"?"non-negative":n}function xi(n){if(n.isGreater(1))return"positive";if(n.isGreaterEqual(1))return"non-negative";if(n.isLessEqual(1)&&n.isGreaterEqual(0))return"non-positive";if(n.isLess(1)&&n.isGreaterEqual(0))return"negative";if(n.is(1))return"zero";if(n.isNegative||n.isReal===!1)return"unsigned"}var Nc=[{Abs:{wikidata:"Q3317982",broadcastable:!0,idempotent:!0,complexity:1200,signature:"(number) -> number",type:([n])=>n.type,sgn:([n])=>n.is(0)?"zero":n.isNumberLiteral?"positive":"non-negative",evaluate:([n])=>Nm(n)},Add:{wikidata:"Q32043",associative:!0,commutative:!0,commutativeOrder:Wi,broadcastable:!0,idempotent:!0,complexity:1300,lazy:!0,signature:"(number+) -> number",type:ac,sgn:n=>{if(n.some(e=>e.isNaN))return"unsigned";if(n.every(e=>e.is(0)))return"zero";if(n.every(e=>e.isNonNegative))return n.some(e=>e.isPositive)?"positive":"non-negative";if(n.every(e=>e.isNonPositive))return n.some(e=>e.isNegative)?"negative":"non-positive"},evaluate:(n,{numericApproximation:e})=>e?uc(...n):H(...n.map(t=>t.evaluate()))},Ceil:{description:"Rounds a number up to the next largest integer",complexity:1250,broadcastable:!0,signature:"(real) -> integer",sgn:([n])=>{if(n.isLessEqual(-1))return"negative";if(n.isPositive)return"positive";if(n.isNonNegative)return"non-negative";if(n.isNonPositive&&n.isGreater(-1))return"zero";if(n.isNonPositive)return"non-positive";if(n.isReal==!1&&n.isNumberLiteral)return n.im>0||n.im<=-1?"unsigned":ua(n.re)},evaluate:([n])=>re(n,Math.ceil,e=>e.ceil(),e=>e.ceil(0))},Chop:{associative:!0,broadcastable:!0,idempotent:!0,complexity:1200,signature:"(number) -> number",type:([n])=>n.type,evaluate:n=>{let e=n[0],t=e.engine;return re(e,i=>t.chop(i),i=>t.chop(i),i=>t.complex(t.chop(i.re),t.chop(i.im)))}},Divide:{wikidata:"Q1226939",complexity:2500,broadcastable:!0,signature:"(number, number+) -> number",type:([n,e])=>e.is(1)?n.type:e.isNaN||n.isNaN?"number":e.isFinite===!1||n.isFinite===!1?"non_finite_number":e.isInteger&&n.isInteger?"finite_rational":e.isReal&&n.isReal?"finite_real":"finite_number",sgn:n=>{let[e,t]=[n[0],n[1]];if(t.is(0))return"unsigned";if(t.isPositive)return e.sgn;if(t.isNegative)return la(e.sgn);let i=t.sgn;if(e.is(0)&&i==="not-zero"||e.isFinite&&t.isInfinity)return"zero";if(e.sgn==="not-zero"&&i==="not-zero")return"not-zero"},canonical:(n,{engine:e})=>{let t=e;n=He(t,n);let i=n[0];if(i===void 0)return t.error("missing");if(n.length<2)return i;let r=n.slice(1);for(let o of r)i=un(i,o);return i},evaluate:([n,e])=>n.div(e)},Exp:{wikidata:"Q168698",broadcastable:!0,complexity:3500,signature:"(number) -> number",canonical:(n,{engine:e})=>(n=He(e,n,1),e.function("Power",[e.E,...n]))},Factorial:{description:"Factorial function: the product of all positive integers less than or equal to n",wikidata:"Q120976",broadcastable:!0,complexity:9e3,signature:"(integer) -> integer",sgn:([n])=>n.isNonNegative?"positive":n.isNegative||n.isReal===!1?"unsigned":void 0,canonical:(n,{engine:e})=>{let t=n[0];return t.isNumberLiteral&&t.isNegative?e._fn("Factorial",[t.neg()]).neg():e._fn("Factorial",[t])},evaluate:([n])=>{let e=n.engine;if(n.im!==0&&n.im!==void 0)return e.number(e.complex(n.re,n.im).add(1));if(n.isFinite){if(n.isNegative)return e.number(pt(1+n.re));try{return e.number(fi(io(BigInt((n.bignumRe??n.re).toFixed())),e._timeRemaining))}catch{return}}},evaluateAsync:async([n],{signal:e})=>{let t=n.engine;if(n.im!==0&&n.im!==void 0)return t.number(t.complex(n.re,n.im).add(1));if(n.isFinite){if(n.isNegative)return t.number(pt(1+n.re));try{return t.number(await ci(io(BigInt((n.bignumRe??n.re).toFixed())),(t._deadline??1/0)-Date.now(),e))}catch{return}}}},Factorial2:{description:"Double Factorial Function",complexity:9e3,broadcastable:!0,signature:"(integer) -> integer",sgn:([n])=>n.isNonNegative?"positive":n.isNegative||n.isReal===!1?"unsigned":void 0,evaluate:n=>{let e=n[0],t=P(e);if(t===null)return;let i=e.engine;return me(i)?i.number(rc(i,i.bignum(t))):i.number(xu(t))}},Floor:{wikidata:"Q56860783",complexity:1250,broadcastable:!0,signature:"(number) -> integer",sgn:([n])=>{if(n.isNegative)return"negative";if(n.isGreaterEqual(1))return"positive";if(n.isNonNegative&&n.isLess(1))return"zero";if(n.isNonNegative)return"non-negative";if(n.isReal==!1&&n.isNumberLiteral)return n.im<0||n.im>=1?"unsigned":ua(n.re)},evaluate:([n])=>re(n,Math.floor,e=>e.floor(),e=>e.floor(0))},Gamma:{wikidata:"Q190573",complexity:8e3,broadcastable:!0,signature:"(number) -> number",sgn:([n])=>n.isPositive?"positive":n.is(0)?"zero":void 0,evaluate:([n],{numericApproximation:e,engine:t})=>e?re(n,i=>pt(i),i=>Gs(t,i),i=>i):void 0},GammaLn:{complexity:8e3,broadcastable:!0,signature:"(number) -> number",evaluate:(n,{numericApproximation:e,engine:t})=>e?re(n[0],i=>pi(i),i=>zs(t,i),i=>i):void 0},Ln:{description:"Natural Logarithm",wikidata:"Q204037",complexity:4e3,broadcastable:!0,signature:"(number, base: number?) -> number",sgn:([n])=>xi(n),evaluate:([n],{numericApproximation:e,engine:t})=>e?re(n,i=>i===0?-1/0:i>=0?Math.log(i):t.complex(i).log(),i=>i.isZero()?-1/0:i.isNeg()?t.complex(i.toNumber()).log():i.ln(),i=>i.isZero()?NaN:i.log()):n.ln()},Log:{description:"Log(z, b = 10) = Logarithm of base b",wikidata:"Q11197",complexity:4100,broadcastable:!0,signature:"(number, base: number?) -> number",sgn:([n,e])=>{if(!e)return xi(n);if(e.is(1)||e.isReal==!1)return"unsigned";if(e.isGreater(1))return xi(n);if(e.isLess(1))return la(xi(n))},evaluate:(n,{numericApproximation:e,engine:t})=>{if(!e)return n[0]?.ln(n[1]??10)??void 0;let i=t;return n[1]===void 0?re(n[0],r=>r===0?-1/0:r>=0?Math.log10(r):i.complex(r).log().div(Math.LN10),r=>r.isZero()?-1/0:r.isNeg()?i.complex(r.toNumber()).log().div(Math.LN10):M.log10(r),r=>r.isZero()?NaN:r.log().div(Math.LN10)):Rn(n[0],n[1],(r,o)=>Math.log(r)/Math.log(o),(r,o)=>r.log(o),(r,o)=>r.log().div(typeof o=="number"?Math.log(o):o.log()))}},Lb:{description:"Base-2 Logarithm",wikidata:"Q581168",complexity:4100,broadcastable:!0,signature:"(number) -> number",sgn:([n])=>xi(n),canonical:([n],{engine:e})=>e._fn("Log",[n,e.number(2)])},Lg:{description:"Base-10 Logarithm",wikidata:"Q966582",complexity:4100,broadcastable:!0,signature:"(number) -> number",sgn:([n])=>xi(n),canonical:([n],{engine:e})=>e._fn("Log",[n])},Mod:{description:"Modulo",wikidata:"Q1799665",complexity:2500,broadcastable:!0,signature:"(number, number) -> number",sgn:n=>{let e=n[1];if(!(e===void 0||e.isReal==!1)){if(e.is(0))return"unsigned";if(n[0].isNumberLiteral&&e.isNumberLiteral)return Rn(n[0],e,(i,r)=>(i%r+r)%r,(i,r)=>i.modulo(r))?.sgn??void 0}},evaluate:([n,e])=>Rn(n,e,(t,i)=>(t%i+i)%i,(t,i)=>t.modulo(i))},Multiply:{wikidata:"Q40276",associative:!0,commutative:!0,idempotent:!0,complexity:2100,broadcastable:!0,lazy:!0,signature:"(number*) -> number",type:n=>n.length===0?"finite_integer":n.length===1?n[0].type:n.some(e=>e.isNaN)?"number":n.some(e=>e.isFinite===!1)?"non_finite_number":n.every(e=>e.isInteger)?"finite_integer":n.every(e=>e.isReal)?"finite_real":n.every(e=>e.isRational)?"finite_rational":"finite_number",sgn:n=>{if(!n.some(e=>e.sgn===void 0||e.isReal===!1)){if(n.some(e=>e.is(0)))return n.every(e=>e.isFinite)?"zero":n.some(e=>e.isFinite===!1)?"unsigned":void 0;if(!(n.some(e=>e.isFinite===!1||e.isFinite===void 0)&&n.some(e=>{let t=e.sgn}))){if(n.every(e=>e.isPositive||e.isNegative)){let e=0;return n.forEach(t=>{t.isNegative&&e++}),e%2===0?"positive":"negative"}if(n.every(e=>e.isNonPositive||e.isNonNegative)){let e=0;return n.forEach(t=>{t.isNonPositive&&e++}),e%2===0?"non-positive":"non-negative"}if(n.every(e=>e.sgn==="not-zero"||e.sgn==="positive"||e.sgn==="negative"))return"not-zero"}}},evaluate:(n,{numericApproximation:e})=>e?fc(...n):ae(...n.map(t=>t.evaluate()))},Negate:{description:"Additive Inverse",wikidata:"Q715358",complexity:2e3,broadcastable:!0,signature:"(number) -> number",type:([n])=>n.type,sgn:([n])=>la(n.sgn),canonical:(n,{engine:e})=>(n=He(e,n),n.length===0?e.error("missing"):n[0].neg()),evaluate:([n])=>n.neg()},PlusMinus:{description:"Plus or Minus",wikidata:"Q120812",complexity:1200,signature:"(value, value) -> tuple",canonical:(n,{engine:e})=>(n=He(e,n,2),n.length===0?e.error("missing"):e._fn("PlusMinus",[n[0],n[1].abs()])),type:([n,e])=>A(`tuple<${n.type}, ${e.type}>`),evaluate:([n,e],{engine:t})=>t.tuple(n.add(e.neg()),n.add(e))},Power:{wikidata:"Q33456",broadcastable:!0,complexity:3500,signature:"(number, number) -> number",type:([n,e])=>n.isNaN||e.isNaN?"number":e.isFinite?n.isInteger&&e.isInteger?"finite_integer":n.isRational&&e.isInteger?"finite_rational":n.isReal&&e.isReal?"finite_real":"finite_number":"non_finite_number",canonical:(n,{engine:e})=>{if(n=He(e,n,2),n.length!==2)return e._fn("Power",n);let[t,i]=n;return Kn(t,i)},sgn:([n,e])=>{let t=n.sgn,i=e.sgn;if(!(n.isReal===!1||e.isReal===!1||n.isNaN||e.isNaN||t===void 0||i===void 0)){if(n.is(0))return e.isNonPositive?"unsigned":e.isPositive?"zero":void 0;if(n.is(0)&&e.is(0))return"unsigned";if(n.isNonNegative||e.numerator.isOdd&&e.denominator.isOdd)return n.sgn;if(e.numerator.isEven&&e.denominator.isOdd){if(n.isReal){let r=n.sgn;return r==="positive"||r==="not-zero"||r==="negative"?"positive":"non-negative"}return n.type.matches("complex")?"negative":n.is(0)?void 0:"not-zero"}if(e.isRational===!1||e.numerator.isOdd&&e.denominator.isEven&&n.isNonPositive)return"unsigned"}},evaluate:([n,e],{numericApproximation:t})=>Ie(n,e,{numericApproximation:t??!1})},Rational:{complexity:2400,signature:"(number, integer?) -> rational",sgn:([n])=>n.sgn,canonical:(n,{engine:e})=>{let t=e;return n=Q(n),n.length===0?t._fn("Rational",[t.error("missing")]):n.length===1?t._fn("Rational",[ge(t,n[0],"real")]):(n=Qi(t,n,["integer","integer"]),n.length!==2||!n[0].isValid||!n[1].isValid?t._fn("Rational",n):n[0].div(n[1]))},evaluate:(n,{numericApproximation:e,engine:t})=>{let i=t;if(n.length===1){let s=n[0].N();return s.numericValue===null||s.im!==0?void 0:i.number(vl(s.re))}if(e)return Rn(n[0],n[1],(s,a)=>s/a,(s,a)=>s.div(a),(s,a)=>s.div(a));let[r,o]=[ee(n[0]),ee(n[1])];if(r!==null&&o!==null)return i.number([r,o])}},Root:{complexity:3200,broadcastable:!0,signature:"(number, number) -> number",type:([n,e])=>n.isNaN||e.isNaN?"number":n.isFinite===!1||e.isFinite===!1?"non_finite_number":e.is(0)?"finite_integer":e.is(1)?n.type:n.isReal&&e.isReal&&n.isPositive===!0?"finite_real":"finite_number",sgn:([n,e])=>{if(n.isReal===!1||e.isReal===!1)return"unsigned";if(n.is(0)){if(e.isNonPositive)return"unsigned";if(e.isPositive)return"zero"}if(n.isPositive===!0)return"positive";if(n.isNonNegative===!0)return"non-negative";if(e.isOdd===!0||e.numerator.isOdd&&e.denominator.isOdd)return n.sgn;if(n.isNegative&&e.isOdd===!1)return"unsigned"},canonical:(n,{engine:e})=>{n=He(e,n,2);let[t,i]=n;return wt(t,i)},evaluate:([n,e],{numericApproximation:t})=>so(n,e,{numericApproximation:t})},Round:{complexity:1250,broadcastable:!0,signature:"(number) -> integer",type:([n])=>n.isNaN?"number":n.isFinite===!1||n.isReal===!1?"non_finite_number":"finite_integer",sgn:([n])=>{if(n.isNaN)return"unsigned";if(n.isNumberLiteral)return n.im>=.5||n.im<=-.5?"unsigned":ua(Math.round(n.re));if(n.isGreaterEqual(.5))return"positive";if(n.isLessEqual(-.5))return"negative";if(n.isLess(.5)&&n.isGreater(-.5))return"zero";if(n.isNonNegative)return"non-negative";if(n.isNonPositive)return"non-positive"},evaluate:([n])=>re(n,Math.round,e=>e.round(),e=>e.round(0))},Sign:{complexity:1200,broadcastable:!0,signature:"(number) -> integer",sgn:([n])=>n.sgn,evaluate:([n],{engine:e})=>{if(n.is(0))return e.Zero;if(n.isPositive)return e.One;if(n.isNegative)return e.NegativeOne}},Sqrt:{description:"Square Root",wikidata:"Q134237",complexity:3e3,broadcastable:!0,signature:"(number) -> number",type:([n])=>n.isNaN?"number":n.isFinite===!1?"non_finite_number":n.isReal?n.isNegative?"complex":"finite_real":"finite_number",sgn:([n])=>{if(n.isPositive)return"positive";if(n.isNegative)return"unsigned";if(n.isNonNegative)return"non-negative";if(n.sgn==="not-zero")return"not-zero"},evaluate:([n],{numericApproximation:e,engine:t})=>{if(!e)return n.sqrt();let[i,r]=n.toNumericValue();return r.is(1)?t.number(i.sqrt().N()):t.number(i.sqrt().N()).mul(r)}},Square:{wikidata:"Q3075175",complexity:3100,broadcastable:!0,signature:"(number) -> number",sgn:([n])=>{if(n.is(0))return"zero";if(n.isReal){let e=n.sgn;return e==="not-zero"||e==="positive"||e==="negative"?"positive":"non-negative"}if(n.type.matches("complex"))return"negative";if(n.isReal==!1||n.isNaN)return"unsigned"},canonical:(n,{engine:e})=>{let t=e;return n=Q(n),n.length!==1?t._fn("Square",n):t._fn("Power",[n[0],t.number(2)]).canonical}},Subtract:{wikidata:"Q40754",complexity:1350,broadcastable:!0,signature:"(number+) -> number",canonical:(n,{engine:e})=>{if(n=He(e,n),n.length===0)return e.error("missing");let t=n[0],i=n.slice(1);return Ke(e,[t,...i.map(r=>r.neg())])}}},{ImaginaryUnit:{type:"imaginary",isConstant:!0,holdUntil:"never",wikidata:"Q193796",value:n=>n.I},i:{type:"imaginary",isConstant:!0,holdUntil:"never",value:n=>n.I},ExponentialE:{type:"finite_real",wikidata:"Q82435",isConstant:!0,holdUntil:"N",value:n=>n.number(me(n)?n._BIGNUM_ONE.exp():Math.exp(1))},e:{type:"finite_real",isConstant:!0,holdUntil:"never",value:"ExponentialE"},ComplexInfinity:{type:"complex",isConstant:!0,holdUntil:"never",value:n=>n.ComplexInfinity},PositiveInfinity:{type:"non_finite_number",isConstant:!0,holdUntil:"never",value:1/0},NegativeInfinity:{type:"non_finite_number",isConstant:!0,holdUntil:"never",value:-1/0},NaN:{type:"number",isConstant:!0,holdUntil:"never",value:n=>n.NaN},ContinuationPlaceholder:{description:"This symbol indicates that some elements in a collection have been omitted, for example in a long list of numbers, or in an infinite set",type:"unknown",isConstant:!0},MachineEpsilon:{type:"finite_real",holdUntil:"N",isConstant:!0,value:{num:Number.EPSILON.toString()}},Half:{type:"finite_rational",isConstant:!0,holdUntil:"never",value:["Rational",1,2]},GoldenRatio:{type:"finite_real",wikidata:"Q41690",isConstant:!0,holdUntil:"N",value:["Divide",["Add",1,["Sqrt",5]],2]},CatalanConstant:{type:"finite_real",wikidata:"Q855282",isConstant:!0,holdUntil:"N",value:{num:`0.91596559417721901505460351493238411077414937428167
                  21342664981196217630197762547694793565129261151062
                  48574422619196199579035898803325859059431594737481
                  15840699533202877331946051903872747816408786590902
                  47064841521630002287276409423882599577415088163974
                  70252482011560707644883807873370489900864775113225
                  99713434074854075532307685653357680958352602193823
                  23950800720680355761048235733942319149829836189977
                  06903640418086217941101917532743149978233976105512
                  24779530324875371878665828082360570225594194818097
                  53509711315712615804242723636439850017382875977976
                  53068370092980873887495610893659771940968726844441
                  66804621624339864838916280448281506273022742073884
                  31172218272190472255870531908685735423498539498309
                  91911596738846450861515249962423704374517773723517
                  75440708538464401321748392999947572446199754961975
                  87064007474870701490937678873045869979860644874974
                  64387206238513712392736304998503539223928787979063
                  36440323547845358519277777872709060830319943013323
                  16712476158709792455479119092126201854803963934243
                  `}},EulerGamma:{type:"finite_real",wikidata:"Q273023",holdUntil:"N",isConstant:!0,value:{num:`0.57721566490153286060651209008240243104215933593992359880576723488486772677766
          467093694706329174674951463144724980708248096050401448654283622417399764492353
          625350033374293733773767394279259525824709491600873520394816567085323315177661
          152862119950150798479374508570574002992135478614669402960432542151905877553526
          733139925401296742051375413954911168510280798423487758720503843109399736137255
          306088933126760017247953783675927135157722610273492913940798430103417771778088
          154957066107501016191663340152278935867965497252036212879226555953669628176388
          792726801324310104765059637039473949576389065729679296010090151251959509222435
          014093498712282479497471956469763185066761290638110518241974448678363808617494
          551698927923018773910729457815543160050021828440960537724342032854783670151773
          943987003023703395183286900015581939880427074115422278197165230110735658339673`}}},{PreIncrement:{signature:"(number) -> number"},PreDecrement:{signature:"(number) -> number"}},{IsPrime:{description:"`IsPrime(n)` returns `True` if `n` is a prime number",wikidata:"Q49008",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",evaluate:([n],{engine:e})=>{let t=xo(n);if(t!==void 0)return e.symbol(t?"True":"False")}},IsComposite:{description:"`IsComposite(n)` returns `True` if `n` is not a prime number",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",canonical:(n,{engine:e})=>e.box(["Not",["IsPrime",...n]])},IsOdd:{description:"`IsOdd(n)` returns `True` if `n` is an odd number",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",evaluate:(n,{engine:e})=>{let t=!1,i=n.every(r=>{if(r.im!==0)return!1;let o=Qn(r);if(o!==null)return o%BigInt(2)!==BigInt(0);let s=r.re;return Number.isInteger(s)?s%2!==0:(t=!0,!1)});if(!t)return e.symbol(i?"True":"False")}},IsEven:{description:"Even Number",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",canonical:(n,{engine:e})=>e.box(["Not",["IsOdd",...n]])}},{GCD:{description:"Greatest Common Divisor",complexity:1200,broadcastable:!1,signature:"(any*) -> integer",sgn:()=>"positive",evaluate:n=>vc(n,"GCD")},LCM:{description:"Least Common Multiple",complexity:1200,broadcastable:!1,signature:"(any*) -> integer",sgn:()=>"positive",evaluate:n=>vc(n,"LCM")},Numerator:{description:"Numerator of an expression",complexity:1200,broadcastable:!0,lazy:!0,signature:"(number) -> number | nothing",canonical:(n,{engine:e})=>{if(n.length===0)return e.Nothing;let t=n[0];return t.operator==="Rational"||t.operator==="Divide"?t.op1:e._fn("Numerator",Qe(e,n))},sgn:([n])=>n.sgn,evaluate:(n,{engine:e})=>{let t=e;if(n.length===0)return t.Nothing;let i=n[0];return i.operator==="Rational"||i.operator==="Divide"?i.op1.evaluate():i.numerator}},Denominator:{description:"Denominator of an expression",complexity:1200,broadcastable:!0,lazy:!0,signature:"(number) -> number | nothing",canonical:(n,{engine:e})=>{if(n.length===0)return e.Nothing;let t=n[0];if(t.operator==="Rational"||t.operator==="Divide")return t.op2;let i=rn(t);return i!==void 0?e.number(i[1]):e._fn("Denominator",Qe(e,n))},sgn:()=>"positive",evaluate:(n,{engine:e})=>{let t=e;if(n.length===0)return t.Nothing;let i=n[0];return i.operator==="Rational"||i.operator==="Divide"?i.op2.evaluate():i.denominator}},NumeratorDenominator:{description:"Sequence of Numerator and Denominator of an expression",complexity:1200,broadcastable:!0,lazy:!0,signature:"(number) -> tuple<number, number> | nothing",canonical:(n,{engine:e})=>{if(n.length===0)return e.Nothing;let t=n[0];if(t.operator==="Rational"||t.operator==="Divide")return e.tuple(...t.ops);let i=rn(t.evaluate());return i!==void 0?e.tuple(e.number(i[0]),e.number(i[1])):e._fn("NumeratorDenominator",n.map(r=>r.evaluate()))},evaluate:(n,{engine:e})=>{let t=e;if(n.length===0)return t.Nothing;let i=n[0];return i.operator==="Rational"||i.operator==="Divide"?t.tuple(...i.ops):t.tuple(...i.numeratorDenominator)}}},{Max:{description:"Maximum of two or more numbers",complexity:1200,broadcastable:!1,signature:"(value*) -> number | list",sgn:n=>{if(n.some(e=>e.isReal==!1||e.isNaN))return"unsigned";if(!n.some(e=>e.isReal==!1||e.isNaN!==!1)){if(n.some(e=>e.isPositive))return"positive";if(n.every(e=>e.isNonPositive))return n.some(e=>e.is(0))?"zero":"non-positive";if(n.some(e=>e.isNonNegative))return"non-negative";if(n.every(e=>e.isNegative))return"negative";if(n.some(e=>!e.is(0)))return"not-zero"}},evaluate:(n,{engine:e})=>yo(e,n,"Max")},Min:{description:"Minimum of two or more numbers",complexity:1200,broadcastable:!1,signature:"(value+) -> number | list",sgn:n=>{if(n.some(e=>e.isReal==!1||e.isNaN))return"unsigned";if(!n.some(e=>e.isReal==!1||e.isNaN!==!1)){if(n.some(e=>e.isNegative))return"negative";if(n.every(e=>e.isNonNegative))return n.some(e=>e.is(0))?"zero":"non-negative";if(n.some(e=>e.isNonPositive))return"non-positive";if(n.every(e=>e.isPositive))return"positive"}},evaluate:(n,{engine:e})=>yo(e,n,"Min")},Supremum:{description:"Like Max, but defined for open sets",complexity:1200,broadcastable:!1,signature:"(value*) -> number | list",evaluate:(n,{engine:e})=>yo(e,n,"Supremum")},Infimum:{description:"Like Min, but defined for open sets",complexity:1200,broadcastable:!1,signature:"(value*) -> number | list",evaluate:(n,{engine:e})=>yo(e,n,"Infimum")},Product:{description:"`Product(f, a, b)` computes the product of `f` from `a` to `b`",wikidata:"Q901718",complexity:1e3,broadcastable:!1,scoped:!0,lazy:!0,signature:"((number+) -> number, (tuple<integer>|tuple<integer, integer>)+) -> number",canonical:([n,...e],{scope:t})=>Vs("Product",n,e,t),evaluate:(n,e)=>{let t=(r,o)=>(o=o.evaluate(e),o.isNumberLiteral?r.mul(o.numericValue):null),i=fi(Xi(n[0],n.slice(1),t,e.engine._numericValue(1)),e.engine._timeRemaining);return e.engine.number(i??NaN)},evaluateAsync:async(n,e)=>{let t=(r,o)=>(o=o.evaluate(e),o.isNumberLiteral?r.mul(o.numericValue):null),i=await ci(Xi(n[0],n.slice(1),t,e.engine._numericValue(1)),e.engine._timeRemaining,e.signal);return e.engine.number(i??NaN)}},Sum:{description:"`Sum(f, [a, b])` computes the sum of `f` from `a` to `b`",wikidata:"Q218005",complexity:1e3,broadcastable:!1,scoped:!0,lazy:!0,signature:"((number) -> number, bounds:tuple+) -> number",canonical:([n,...e],{scope:t})=>Vs("Sum",n,e,t),evaluate:([n,...e],{engine:t})=>t.number(fi(Xi(n,e,(i,r)=>(r=r.evaluate(),r.isNumberLiteral?i.add(r.numericValue):null),t._numericValue(0)),t._timeRemaining)),evaluateAsync:async(n,{engine:e,signal:t})=>e.number(await ci(Xi(n[0],n.slice(1),(i,r)=>(r=r.evaluate(),r.isNumberLiteral?i.add(r.numericValue):null),e._numericValue(0)),e._timeRemaining,t))}}];function Nm(n){let e=n.engine,t=n.numericValue;if(t!==null)return typeof t=="number"?e.number(Math.abs(t)):e.number(t.abs());if(n.isNonNegative)return n;if(n.isNegative)return n.neg()}function _c(n,e){let t=n.engine,i=e==="Max"||e==="Supremum";if(n.operator==="Interval"){let r=i?n.op2:n.op1;return!r.isNumber||r.numericValue===null?[void 0,[n]]:[r,[]]}if(n.operator==="Range")if(i){let r=sn(n),o=Ml(r);return[t.number(Math.max(r[0],o)),[]]}else return[t.number(sn(n)[0]),[]];if(n.operator==="Linspace")return n.nops===1?n=i?n.op1:t.One:i?n=n.op2:n=n.op1,[n,[]];if(n.isCollection){let r,o=[];for(let s of n.each()){let[a,u]=_c(s,e);a&&(r?(i&&a.isGreater(r)||!i&&a.isLess(r))&&(r=a):r=a),o.push(...u)}return[r,o]}return!n.isNumber||n.numericValue===null?[void 0,[n]]:[n,[]]}function yo(n,e,t){let i=t==="Max"||t==="Supremum";if(e=Q(e),e.length===0)return i?n.NegativeInfinity:n.PositiveInfinity;let r,o=[];for(let s of e){let[a,u]=_c(s,t);a&&(r?(i&&a.isGreater(r)||!i&&a.isLess(r))&&(r=a):r=a),o.push(...u)}return o.length>0?n.box(r?[t,r,...o]:[t,...o]):r??(i?n.NegativeInfinity:n.PositiveInfinity)}function vc(n,e){let t=n[0].engine,i=e==="LCM"?Nt:Pe,r=e==="LCM"?ic:ia,o=[];if(me(t)){let a=null;for(let u of n)if(a===null)a=Ms(u),(a===null||!a.isInteger())&&o.push(u);else{let l=Ms(u);l&&l.isInteger()?a=r(a,l):o.push(u)}return o.length===0?a===null?t.One:t.number(a):a===null?t._fn(e,o):t._fn(e,[t.number(a),...o])}let s=null;for(let a of n)s===null?a.isInteger&&o.push(a):a.isInteger?s=i(s,a.re):o.push(a);return o.length===0?s===null?t.One:t.number(s):s===null?t._fn(e,o):t._fn(e,[t.number(s),...o])}function xo(n){if(!n.isInteger||n.isNegative||n.numericValue===null)return;let t=P(n);if(t!==null)return Ko(t);let i=Qn(n);if(i!==null)return hu(i)}var _m={Sin:["Cos","_"],Cos:["Negate",["Sin","_"]],Tan:["Power",["Sec","_"],2],Sec:["Multiply",["Tan","_"],["Sec","_"]],Csc:["Multiply",["Negate",["Cot","_"]],["Csc","_"]],Cot:["Negate",["Power",["Csc","_"],2]],Arcsin:["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],Arccos:["Negate",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]]],Arctan:["Power",["Add",1,["Power","_",2]],-1],Arcsec:["Multiply",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],["Negate",["Power","_",2]]],Arccsc:["Multiply",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],["Negate",["Power","_",2]]],Arccot:["Negate",["Power",["Add",1,["Power","_",2]],-1]],Sinh:["Cosh","_"],Cosh:["Sinh","_"],Tanh:["Power",["Sech","_"],2],Sech:["Multiply",["Tanh","_"],"Sech"],Csch:["Multiply",["Coth","_"],"Csch"],Coth:["Negate",["Power",["Csch","_"],2]],Arcsinh:["Power",["Add",["Power","_",2],1],["Negate","Half"]],Arccosh:["Power",["Subtract",["Power","_",2],1],["Negate","Half"]],Arctanh:["Power",["Subtract",1,["Power","_",2]],-1],Arcsech:["Negate",["Power",["Multiply","2","Subtract",["Power","_",2]],["Negate","Half"]]],Arccsch:["Negate",["Power",["Multiply","2","Add",["Power","_",2]],["Negate","Half"]]],Arccoth:["Negate",["Power",["Subtract",1,["Power","_",2]],-1]],Ln:["Divide",1,"_"],Log:["Power",["Multiply","_",["Ln","10"]],-1],Sqrt:["Multiply",["Power","_",["Negate","Half"]],"Half"],Abs:["Which",["Equal","_",0],NaN,["Less","_",0],-1,["Greater","_",0],1,"True",["D",["Abs","_"],"_"]],Erf:["Multiply",["Divide","2",["Sqrt","Pi"]],["Exp",["Negate",["Square","_"]]]],Gamma:["Multiply",["Gamma","_"],["Digamma","_"]],Digamma:["Add",["Multiply",["Digamma","_"],["Gamma","_"]],["Multiply",["Power","_",-1],["Gamma","_"]]],Zeta:["Multiply",["Multiply",-1,["Zeta","_"]],["Digamma","_"]],PolyGamma:["Add",["Multiply",["PolyGamma","_"],["Gamma","_"]],["Multiply",["Power","_",-1],["Gamma","_"]]],Beta:["Multiply",["Add",["Multiply",["Beta","_"],["Digamma","_"]],["Multiply",["Power","_",-1],["Beta","_"]]],["Beta","_"]],Erfc:["Multiply",["Negate",["Erfc","_"]],["Exp",["Negate",["Power","_",2]]],["Power","_",-1]],LambertW:["Multiply",["Power","_",-1],["Multiply",["Add","_",["LambertW","_"]],["Add",["LambertW","_"],1]]],AiryAi:["Multiply",["AiryAi","_"],["AiryBi","_"]],AiryBi:["Multiply",["AiryAi","_"],["AiryBi","_"]],BesselJ:["Multiply",["BesselJ","_"],["BesselY","_"]],BesselY:["Multiply",["BesselJ","_"],["BesselY","_"]],BesselI:["Multiply",["BesselI","_"],["BesselK","_"]],BesselK:["Multiply",["BesselI","_"],["BesselK","_"]],FresnelS:["Multiply",["FresnelS","_"],["FresnelC","_"]],FresnelC:["Multiply",["FresnelS","_"],["FresnelC","_"]],Erfi:["Multiply",["Erfi","_"],["Erf","_"]]};function Sc(n,e){if(e===0)return n;let t=n.engine,i="_";n.symbol&&n.operatorDefinition&&(n=An(t.symbol(n.symbol),[t.symbol("_")])),n.operator==="Function"&&(i=n.ops[1]?.symbol??"_",n=n.ops[0]);let r=n;for(;e-- >0&&r;)r=fn(r,i);return r}function fn(n,e){let t=n.engine;if(n.string)return;if(n.isNumberLiteral)return n.engine.Zero;if(n.symbol===e)return n.engine.One;if(n.symbol)return n.engine.Zero;if(!n.operator)return;if(n.operator==="Negate"){let s=fn(n.op1,e);return s?s.neg():t._fn("D",[n.op1,t.symbol(e)]).neg()}if(n.operator==="Add"){let s=n.ops.map(a=>fn(a,e));return s.some(a=>a===void 0)?void 0:H(...s).evaluate()}if(n.operator==="Multiply"){let s=n.ops.map((a,u)=>{let l=n.ops.slice();l.splice(u,1);let c=ae(...l);return(fn(a,e)??t._fn("D",[a,t.symbol(e)])).mul(c)});return s.some(a=>a===void 0)?void 0:H(...s).evaluate()}if(n.operator==="Power"){let[s,a]=n.ops;if(s.symbol===e)return a.mul(s.pow(a.add(t.NegativeOne))).evaluate();let u=s,l=a,c=fn(u,e)??t._fn("D",[u,t.symbol(e)]),d=(fn(l,e)??t._fn("D",[l,t.symbol(e)])).mul(u.ln()),p=l.mul(c).div(u);return n.mul(d.add(p)).evaluate()}if(n.operator==="Divide"){let[s,a]=n.ops,u=fn(s,e)??t._fn("D",[s,t.symbol(e)]),l=fn(a,e)??t._fn("D",[a,t.symbol(e)]);return u.mul(a).sub(l.mul(s)).div(a.pow(2)).evaluate()}let i=_m[n.operator];if(!i){if(n.nops>1)return;let s=t._fn("Derivative",[t.symbol(n.operator),t.One]);if(!s.isValid)return;let a=n.ops[0],u=fn(a,e)??t._fn("D",[a,t.symbol(e)]);return u.isValid?t._fn("Apply",[s,a]).mul(u):void 0}if(n.nops>1)return t._fn("D",[n,t.symbol(e)]);let r=n.ops[0],o=fn(r,e)??t._fn("D",[r,t.symbol(e)]);return An(t.box(i),[r]).mul(o)}var wc={boolean:n=>n.type.matches("boolean"),string:n=>n.string!==null,number:n=>n.isNumberLiteral,symbol:n=>n.symbol!==null,expression:n=>!0,numeric:n=>{let[e,t]=n.toNumericValue();return t.is(1)},integer:n=>n.isInteger,rational:n=>n.isRational,irrational:n=>n.isRational===!1,real:n=>n.isReal,notreal:n=>!n.isReal,complex:n=>n.type.matches("complex"),imaginary:n=>n.type.matches("imaginary"),positive:n=>n.isPositive,negative:n=>n.isNegative,nonnegative:n=>n.isNonNegative,nonpositive:n=>n.isNonPositive,even:n=>n.isEven,odd:n=>n.isOdd,prime:n=>xo(n)===!0,composite:n=>xo(n)===!1,notzero:n=>n.is(0)===!1,notone:n=>n.is(1)===!1,finite:n=>n.isFinite,infinite:n=>n.isFinite===!1,constant:n=>n.valueDefinition?.isConstant??!1,variable:n=>!(n.valueDefinition?.isConstant??!0),function:n=>n.operatorDefinition!==void 0,relation:n=>Je(n.operator),equation:n=>n.operator==="Equal",inequality:n=>vn(n.operator),collection:n=>n.isCollection,list:n=>n.operator==="List",set:n=>n.operator==="Set",tuple:n=>n.operator==="Tuple"||n.operator==="Single"||n.operator==="Pair"||n.operator==="Triple",single:n=>n.operator==="Single",pair:n=>n.operator==="Pair",triple:n=>n.operator==="Triple",scalar:n=>n.rank===0,tensor:n=>n.rank>0,vector:n=>n.rank===1,matrix:n=>n.rank===2,unit:n=>n.operator==="Unit",dimension:n=>n.operator==="Dimension",angle:n=>n.operator==="Angle",polynomial:n=>n.unknowns.length===1};function kc(n,e){for(let t of e)if(wc[t](n)!==!0)return!1;return!0}function Sm(n){let e=/\\[a-zA-Z]+|[{}]|[\d]+|[+\-*/^_=()><,.;]|[a-zA-Z]/g,t=n.match(e);return t?t.filter(i=>!/^[ \f\n\r\t\v\xA0\u2028\u2029]+$/.test(i)):[]}function Tm(n){let e=n.peek,t=null;if(e==="\\mathrm")n.nextToken(),t=n.parseStringGroup();else if(/^[a-z]$/.test(e))for(t=n.nextToken();/^[a-z]$/.test(n.peek);)t+=n.nextToken();else{let i={">0":"positive","\\gt0":"positive","<0":"negative","\\lt0":"negative",">=0":"nonnegative","\\geq0":"nonnegative","<=0":"nonpositive","\\leq0":"nonpositive","!=0":"notzero","\\neq0":"notzero","\\neq1":"notone","!=1":"notone","\\in\\R":"real","\\in\\mathbb{R}":"real","\\in\\C":"complex","\\in\\mathbb{C}":"complex","\\in\\Q":"rational","\\in\\mathbb{Q}":"rational","\\in\\Z^+":"integer,positive","\\in\\Z^-":"intger,negative","\\in\\Z^*":"nonzero","\\in\\R^+":"positive","\\in\\R^-":"negative","\\in\\R^*":"real,nonzero","\\in\\Z":"integer","\\in\\mathbb{Z}":"integer","\\in\\N":"integer,nonnegative","\\in\\mathbb{N}":"integer,nonnegative","\\in\\N^*":"integer,positive","\\in\\N_0":"integer,nonnegative","\\in\\R\\backslash\\Q":"irrational"};for(let r in i)if(n.matchAll(Sm(r))){t=i[r];break}}if(!t)return null;if(!Object.keys(wc).includes(t))throw new Error(`Unexpected condition "${t}" in a rule`);return t}function Tc(n){let e=[];do{let t=Tm(n);if(!t)break;e.push(t)}while(n.match(","));return e.join(",")}function ca(n){let e=null;if(n.match(":"))e=Tc(n);else if(n.matchAll(["_","<{>"])&&(e=Tc(n),!n.match("<}>")))return null;return e}function Bc(n,e,t){if(!(e===void 0||typeof e=="function")){if(typeof e=="string"){let i=n.parse(e,{canonical:t?.canonical??!1});return i=i.map(r=>r.symbol&&r.symbol.length===1?n.symbol("_"+r.symbol):r,{canonical:!1}),i}return n.box(e,{canonical:t?.canonical??!1})}}function Bm(n,e,t){let i=p=>({kind:"symbol",latexTrigger:p,parse:(x,g)=>{o[p]||(o[p]=`_${p}`);let b=ca(x);return b!==null&&(s[p]?s[p]+=","+b:s[p]=b),o[p]}}),r=n.latexDictionary,o={},s={};n.latexDictionary=[...r,{kind:"prefix",precedence:100,latexTrigger:"...",parse:(p,x)=>{let g=p.nextToken();if(!"abcfghjklmnopqrstuvwxyz".includes(g))return null;let b="__";if(p.match("?")&&(b="___"),o[g]&&o[g]!==`${b}${g}`)throw new Error(`Duplicate wildcard "${g}"`);o[g]||(o[g]=`${b}${g}`);let _=ca(p);return _===null?null:(s[g]?s[g]+=","+_:s[g]=_,`${b}${g}`)}},..."abcfghjklmnopqrstuvwxyz".split("").map(i),{kind:"infix",precedence:100,latexTrigger:"->",parse:(p,x,g)=>{let b=p.parseExpression({...g,minPrec:20});if(b===null)return null;let _=null;if(p.match(";")){let z=!1,be=p.index;do{p.skipSpace();let ke=p.nextToken();if(o[ke]){let hn=ca(p);if(hn===null||!hn){z=!0,p.index=be;break}s[ke]?s[ke]+=","+hn:s[ke]=hn}}while(!z&&!p.atEnd);_=p.parseExpression(g)}let k=[];for(let z in s){let be=s[z].split(",");be.length!==0&&(be.length===1?k.push(["Condition",o[z],be[0]]):k.push(["Condition",o[z],["And",...be]]))}let w;return _&&k.length>0?w=["And",_,...k]:_?w=_:k.length===1?w=k[0]:k.length>1&&(w=["And",...k]),w?["Rule",x,b,w]:["Rule",x,b]}}];let a=t?.canonical??!1,u=n.parse(e);if(n.latexDictionary=r,!u.isValid||u.operator!=="Rule")throw new Error(`Invalid rule "${e}"
|   ${bo(u).toString()}
|   A rule should be of the form:
|   <match> -> <replace>; <condition>`);let[l,c,f]=u.ops;if(a&&(l=l.canonical,c=c.canonical),!Ic(c,l))throw new Error(`Invalid rule "${e}"
|   The replace expression contains wildcards not present in the match expression`);if(l.isSame(c))throw new Error(`Invalid rule "${e}"
|   The match and replace expressions are the same.
|   This may be because the rule is not necessary due to canonical simplification`);let d;if(f!==void 0){if(!Ic(f,l))throw new Error(`Invalid rule "${e}"
|   The condition expression contains wildcards not present in the match expression`);d=p=>f.subs(p).canonical.evaluate()?.symbol==="True"}return Cc(n,{match:l,replace:c,condition:d,id:e},t)}function Cc(n,e,t){if(e==null)throw new Error("Expected a rule, not "+e);if(wm(e))return e;if(typeof e=="string")return Bm(n,e,t);if(typeof e=="function")return{_tag:"boxed-rule",match:void 0,replace:e,condition:void 0,id:e.toString().replace(/\n/g," ")};let{match:i,replace:r,condition:o,id:s,onMatch:a,onBeforeMatch:u}=e;if(r===void 0)throw new Error(`Invalid rule "${s??JSON.stringify(e,void 0,4)}"
|   A rule must include at least a replace property`);let l;if(typeof o=="string"){let d=ut(o);if(d){let p=n.parse(d,{canonical:t?.canonical??!1});l=(x,g)=>p.subs(x).evaluate()?.symbol==="True"}}else{if(o!==void 0&&typeof o!="function")throw new Error(`Invalid rule ${s??JSON.stringify(e,void 0,4)}
|   condition is not a valid function`);l=o}if(typeof i=="function")throw new Error(`Invalid rule ${s??JSON.stringify(e,void 0,4)}
|   match is not a valid expression.
|   Use a replace function instead to validate and replace the expression`);n.pushScope();let c=Bc(n,i,t),f=Bc(n,r,t);if(n.popScope(),s||(typeof i=="string"?s=i:s=JSON.stringify(i,void 0,4),r&&(s+=" -> ",typeof r=="string"?s+=r:typeof r=="function"?s+=r?.toString().replace(/\n/g," "):s=JSON.stringify(r,void 0,4)),typeof o=="string"?s+=`; ${o}`:typeof o=="function"&&(s+=`; ${o.toString().replace(/\n/g," ")}`)),c&&!c.isValid)throw new Error(`Invalid rule ${s}
|   the match expression is not valid: ${c.toString()}`);if(f&&!f.isValid)throw new Error(`Invalid rule ${s??JSON.stringify(e,void 0,4)}
|   The replace expression is not valid: ${f?.toString()}`);if(!f&&typeof r!="function")throw new Error(`Invalid rule ${s??JSON.stringify(e,void 0,4)}
|   The replace expression could not be parsed`);return{_tag:"boxed-rule",match:c,replace:f??r,condition:l,useVariations:e.useVariations,id:s,onMatch:a,onBeforeMatch:u}}function yr(n,e,t){if(!e)return{rules:[]};if(typeof e=="object"&&"rules"in e)return e;Array.isArray(e)||(e=[e]);let i=[];for(let r of e)try{i.push(Cc(n,r,t))}catch(o){throw new Error(`
${o.message}
|   Skipping rule ${JSON.stringify(r,void 0,4)}

`)}return{rules:i}}function fa(n,e,t,i){let r=i?.canonical??(e.isCanonical||e.isStructural),o=!1;if(e.ops&&i?.recursive){let b=e.ops.map(_=>{let k=fa(n,_,{},i);return k?(o=!0,k.value):_});o&&(e=e.engine.function(e.operator,b,{canonical:r}))}let{match:s,replace:a,condition:u,id:l,onMatch:c,onBeforeMatch:f}=n,d=l??"";if(r&&s){let b=hr(s),_=s;s=s.canonical;let k=hr(s);if(!b.every(w=>k.includes(w)))throw new Error(`
|   Invalid rule "${n.id}"
|   The canonical form of ${bo(_).toString()} is "${bo(s).toString()}" and it does not contain all the wildcards of the original match.
|   This could indicate that the match expression in canonical form is already simplified and this rule may not be necessary`)}let p=n.useVariations??i?.useVariations??!1;f?.(n,e);let x=s?e.match(s,{substitution:t,...i,useVariations:p}):{};if(x===null)return o?{value:e,because:d}:null;if(typeof u=="function"){let b={...Object.fromEntries(Object.entries(x).map(([_,k])=>[_.slice(1),k])),...x};try{if(!u(b,e.engine))return o?{value:e,because:d}:null}catch(_){return console.error(`
|   Rule "${n.id}"
|   Error while checking condition
|    ${_.message}`),null}}let g=typeof a=="function"?a(e,x):a.subs(x,{canonical:r});return g?(c?.(n,e,g),Im(g)?r?{...g,value:g.value.canonical}:g:{value:r?g.canonical:g,because:d}):null}function et(n,e,t){if(!e)throw new Error("replace(): Expected one or more rules");let i=t?.iterationLimit??1,r=0,o=t?.once??!1,s;typeof e=="object"&&"rules"in e?s=e.rules:s=n.engine.rules(Array.isArray(e)?e:[e]).rules;let a=!1,u=[];for(;!a&&r<i;){a=!0;for(let l of s)try{let c=fa(l,n,{},t);if(c!==null&&c.value!==n&&!c.value.isSame(n)){if(o)return[c];if(u.some(f=>f.value.isSame(c.value)))return u;u.push(c),a=!1,n=c.value}}catch(c){return console.error(`
${n.toString()}
${l.id}
${c.message}`),u}r+=1}return u}function $t(n,e,t,i){let r=[];for(let o of e.rules){let s=fa(o,n,t,i);s!==null&&!r.some(a=>a.isSame(s.value))&&r.push(s.value)}return r}function bo(n){let e=n.symbol;if(e&&e.startsWith("_"))return n.engine.symbol(e.slice(1));if(n.ops){let t=n.ops.map(i=>bo(i));return n.engine.function(n.operator,t,{canonical:!1})}return n}function hr(n){let e=[];return n.symbol&&n.symbol.startsWith("_")&&e.push(n.symbol),n.ops&&n.ops.forEach(t=>e.push(...hr(t))),e}function Ic(n,e){let t=hr(n),i=hr(e);return t.every(r=>i.includes(r))}function Im(n){return n&&typeof n=="object"&&"because"in n&&"value"in n}function wm(n){return n&&typeof n=="object"&&n._tag==="boxed-rule"}function G(n){for(let[e,t]of Object.entries(n))if(e!=="x"&&e!=="_x"&&t.has("_x"))return!1;return!0}var km=[{match:["Power",["Add",["Multiply","_a","_x"],"__b"],"_n"],replace:["Divide",["Power",["Add",["Multiply","_a","_x"],"__b"],["Add","_n",1]],["Multiply","_a",["Add","_n",1]]],condition:n=>G(n)&&!n._n.is(-1)},{match:["Power",["Add",["Multiply","_a","_x"],"__b"],1/2],replace:["Divide",["Multiply",2,["Power",["Add",["Multiply","_a","_x"],"__b"],3]],["Multiply",3,"_a"]],condition:n=>G(n)&&n._a.isNumberLiteral},{match:["Power",["Add",["Multiply","_a","_x"],"__b"],1/3],replace:["Divide",["Multiply",3,["Power",["Add",["Multiply","_a","_x"],"__b"],4]],["Multiply",4,"_a"]],condition:n=>G(n)&&n._a.isNumberLiteral},{match:["Power","__a","_x"],replace:["Divide",["Power","__a","_x"],["Ln",["Abs","__a"]]],condition:n=>G(n)&&n._x.isNumberLiteral},{match:["Power",["Add",["Multiply","_a","_x"],"__b"],-1],replace:["Divide",["Ln",["Abs",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:G},{match:["Divide",1,["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:G},{match:["Ln",["Add",["Multiply","_a","_x"],"__b"]],replace:["Subtract",["Multiply",["Add",["Multiply","_a","_x"],"__b"],["Ln","_x"]],["Subtract",["Multiply","_a","_x"],"__b"]],condition:G},{match:["Exp",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Exp",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:G},{match:["Power",["Sech",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Tanh",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:G},{match:["Power",["Sin",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Add","_x",["Divide",["Sin",["Multiply",2,"_a","_x"]],2]],2],condition:G},{match:["Power",["Cos",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Add","_x",["Divide",["Sin",["Multiply",2,"_a","_x"]],2]],2],condition:G},{match:["Sin",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Cos",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:G},{match:["Cos",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Sin",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:G},{match:["Tan",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Sec",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:G},{match:["Sec",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Add",["Sec",["Add",["Multiply","_a","_x"],"__b"]],["Tan",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:G},{match:["Csc",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Add",["Csc",["Add",["Multiply","_a","_x"],"__b"]],["Cot",["Add",["Multiply","_a","_x"],"__b"]]]]]],"_a"],condition:G},{match:["Cot",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Sin",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:G},{match:["Sinh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Cosh",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:G},{match:["Cosh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Sinh",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:G},{match:["Tanh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Sech",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:G},{match:["Sech",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Tanh",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:G},{match:["Csch",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Coth",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:G},{match:["Coth",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Csch",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:G},{match:["Arcsinh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Add",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]],"_a"],condition:G},{match:["Arccosh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]],"_a"],condition:G},{match:["Arctanh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Divide",["Add",1,["Add",["Multiply","_a","_x"],"__b"]],["Subtract",1,["Add",["Multiply","_a","_x"],"__b"]]]],["Multiply",2,"_a"]],condition:G},{match:["Arcsech",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:G},{match:["Arccsch",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Add",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:G},{match:["Arccoth",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Divide",["Add",["Add",["Multiply","_a","_x"],"__b"],1],["Subtract",["Add",["Multiply","_a","_x"],"__b"],1]]],["Multiply",2,"_a"]],condition:G},{match:["Arccsch",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Add",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:G},{match:["Arccoth",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:G},{match:["Arctan",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Sec",["Add",["Multiply","_a","_x"],"__b"]],["Tan",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:G},{match:["Arccos",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]],"_a"],condition:G},{match:["Arcsin",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",1,["Power",["Add",["Multiply","_a","_x"],"__b"],2]]]]],"_a"],condition:G}];function nt(n,e){if(n.operator==="Function"||n.operator==="Block"||n.operator==="Delimiter")return nt(n.op1,e);let t=n.engine;if(n.symbol===e)return t.box(["Divide",["Power",n,2],2]);if(!n.has(e))return t.box(["Multiply",n,t.symbol(e)]);if(n.operator==="Add"){let s=n.ops.map(a=>nt(a,e));return H(...s).evaluate()}if(n.operator==="Negate")return nt(n.op1,e).neg();if(n.operator==="Multiply"){let s=n.ops.map((a,u)=>{let l=n.ops.slice();l.splice(u,1);let c=ae(...l);return nt(a,e).mul(c)});return H(...s).evaluate()}if(n.operator==="Divide"){if(!n.op2.has(e)){let s=nt(n.op1,e);return n.engine.box(["Divide",s,n.op2])}return Ac(n,e)}let i=t.rules(km),r=(cr(n)??n).subs({[e]:"_x"},{canonical:!0}),o=$t(r,i,{_x:t.symbol("_x")},{useVariations:!0,canonical:!0});return o&&o[0]?o[0].subs({_x:e}):Ac(n,e)}function Ac(n,e){let t=n.engine;return t.function("Integrate",[n,t.symbol(e,{canonical:!1})])}var Dc=[{Derivative:{broadcastable:!1,lazy:!0,signature:"(function, order:number?) -> function",canonical:(n,{engine:e})=>{let t=ve(n[0].canonical);if(!t)return null;if(!n[1])return e._fn("Derivative",[t]);let i=ge(e,n[1]?.canonical,"number");return e._fn("Derivative",[t,i])},evaluate:n=>{let e=n[0].evaluate(),t=Math.floor(n[1]?.N().re);return Sc(e,isNaN(t)?1:t)}},D:{broadcastable:!1,scoped:!0,lazy:!0,signature:"(expression, variable:symbol, variables:symbol+) -> expression",canonical:(n,{engine:e,scope:t})=>{let i=ai(e,n);return i?e._fn("D",[i,...n.slice(1)],{scope:t}):null},evaluate:(n,{engine:e})=>{let t=n[0].canonical;t=t.evaluate();let i=n.slice(1);i.length===0&&(t=void 0);for(let r of i){if(!r.symbol){t=void 0;break}if(t&&t.operator==="Function"&&(t=t.op1),t=fn(t,r.symbol),t===void 0)break}return t=t?.canonical,t?.operator==="D"?t:t?.evaluate()}},ND:{broadcastable:!1,lazy:!0,signature:"(function, at:number) -> number",canonical:(n,{engine:e})=>{let t=ve(n[0]);if(!t)return null;let i=ge(e,n[1]?.canonical,"number");return e._fn("ND",[t,i])},evaluate:([n,e],{engine:t})=>{let i=e.N().re;if(!isNaN(i))return t.number(bu(n.compile(),i))}},Integrate:{wikidata:"Q80091",broadcastable:!1,lazy:!0,signature:"(function, limits+) -> number",canonical:(n,{engine:e})=>{if(!n[0])return null;let t=ve(n[0]);if(!t)return null;let i=Pl(n.slice(1),{engine:e});return e._fn("Integrate",[t,...i])},evaluate:(n,{engine:e,numericApproximation:t})=>{if(t){let s=n[0],a=n[1],[u,l]=[a.op2.N().re,a.op3.N().re];if(isNaN(u)||isNaN(l))return;let c=s.compile(),f=di(c,u,l,c.isCompiled?1e7:1e4);return e.box(["PlusMinus",e.number(f.estimate),e.number(f.error)])}let i=n[0],r=i.ops?.slice(1)?.map(s=>s.symbol)??[],o=n.slice(1);if(o.length!==0){for(let s=o.length-1;s>=0;s--){let[a,u,l]=o[s].ops,c=a.symbol;(!c||c==="Nothing")&&s<r.length&&(c=r[s]),c||(c="x");let f=nt(i,c);if(f.operator!=="Integrate"){let d=f;if(u.symbol==="Nothing"&&l.symbol==="Nothing")i=d;else{let p=e.box(["Function",f,c]);i=e.box(["EvaluateAt",p,u,l])}}else if(u.symbol==="Nothing"&&l.symbol==="Nothing")i=f;else{let d=e.box(["Function",f,c]);i=e.box(["EvaluateAt",d,u,l])}}return i.operator!=="Integrate"?i.evaluate({numericApproximation:t}):i}}},NIntegrate:{broadcastable:!1,lazy:!0,signature:"(function, limits:(tuple|symbol)?) -> number",canonical:(n,{engine:e})=>{let[t,i,r]=n,o=ve(t);return!o||!i||!r?null:e._fn("NIntegrate",[o,i.canonical,r.canonical])},evaluate:([n,e,t],{engine:i})=>{let[r,o]=[e.N().re,t.N().re];if(isNaN(r)||isNaN(o))return;let s=n.compile();return i.number(di(s,r,o,s.isCompiled?1e7:1e4).estimate)}},Limits:{description:"Limits of a function",complexity:5e3,broadcastable:!1,lazy:!0,signature:"(index:symbol, lower:number, upper:number) -> tuple",canonical:(n,{engine:e})=>dt(n,{engine:e})??null}},{Limit:{description:"Limit of a function",complexity:5e3,broadcastable:!1,lazy:!0,signature:"(function, point:number, direction:number?) -> number",canonical:([n,e,t],{engine:i})=>{let r=ve(n);return!r||!e?null:t===void 0?i._fn("Limit",[r,e.canonical]):i._fn("Limit",[r,e.canonical,t.canonical])},evaluate:([n,e,t],{engine:i,numericApproximation:r})=>{if(r){let o=e.N().re;if(Number.isNaN(o))return;let s=n.compile();return i.number(at(s,o,t?t.re:1))}}},NLimit:{description:"Numerical approximation of the limit of a function",complexity:5e3,broadcastable:!1,lazy:!0,signature:"(function, point:number, direction:number?) -> number",canonical:([n,e,t],{engine:i})=>{let r=ve(n);return!r||!e?null:t===void 0?i._fn("NLimit",[r,e.canonical]):i._fn("NLimit",[r,e.canonical,t.canonical])},evaluate:([n,e,t],{engine:i})=>{let r=e.N().re;if(Number.isNaN(r))return;let o=n.compile();return i.number(at(o,r,t?t.re:1))}}}];var Rc=[{Block:{lazy:!0,scoped:!0,signature:"(unknown*) -> unknown",type:n=>n.length===0?"nothing":n[n.length-1].type,canonical:Dm,evaluate:Am},Condition:{lazy:!0,signature:"(value, symbol) -> boolean",evaluate:([n,e],{engine:t})=>{let i=[];return e.symbol?i=[e.symbol]:e.operator==="And"&&(i=e.ops.map(r=>r.symbol??"")),kc(n,i)?t.True:t.False}},If:{lazy:!0,signature:"(expression, expression, expression) -> any",type:([n,e,t])=>oe(e.type.type,t.type.type),canonical:([n,e,t],{engine:i})=>i._fn("If",[n.canonical,e.canonical,t.canonical]),evaluate:([n,e,t],{engine:i})=>{let r=n.evaluate().symbol;if(r==="True")return e?.evaluate()??i.Nothing;if(r==="False")return t?.evaluate()??i.Nothing;throw new Error(`Condition must evaluate to "True" or "False". ${an(n)}`)}},Loop:{lazy:!0,signature:"(body:expression, collection:expression) -> any",type:([n])=>n.type,evaluate:([n,e],{engine:t})=>fi(Mc(n,e,t),t._timeRemaining),evaluateAsync:async([n,e],{engine:t,signal:i})=>ci(Mc(n,e,t),t._timeRemaining,i)},Which:{lazy:!0,signature:"(expression+) -> unknown",type:n=>n.length%2!==0?"nothing":oe(...n.filter((e,t)=>t%2===1).map(e=>e.type.type)),canonical:(n,e)=>n.length%2!==0?e.engine.Nothing:e.engine._fn("Which",n.map(t=>t.canonical)),evaluate:(n,e)=>Cm(n,e)},FixedPoint:{lazy:!0,signature:"(any) -> unknown"}}];function Cm(n,e){let t=0;for(;t<n.length-1;){let i=n[t].evaluate().symbol;if(i==="True")return n[t+1]?n[t+1].evaluate(e):e.engine.symbol("Undefined");if(i!=="False")throw new Error(`Condition must evaluate to "True" or "False". ${an(n[t])}`);t+=2}return e.engine.symbol("Undefined")}function Am(n,{engine:e}){if(n.length===0)return e.Nothing;let t;for(let i of n){let r=i.operator;if(r==="Return"){t=i.op1.evaluate();break}if(r==="Break"||r==="Continue"){t=e.box([r,i.op1.evaluate()]);break}t=i.evaluate()}return t??e.Nothing}function Dm(n,e){let{engine:t,scope:i}=e;return n.length===0?null:t._fn("Block",t._inScope(i,()=>n.map(o=>o.canonical)),{scope:i})}function*Mc(n,e,t){if(n??=t.Nothing,n.symbol==="Nothing")return n;if(e?.isCollection){let r,o=le(n),s=0;for(let a of e.each()){if(r=o([a])??t.Nothing,r.operator==="Break")return r.op1;if(r.operator==="Return")return r;if(s+=1,s%1e3===0&&(yield r),s>t.iterationLimit)throw new Ye({cause:"iteration-limit-exceeded"})}return r}let i=0;for(;;){let r=n.evaluate();if(r.operator==="Break")return r.op1;if(r.operator==="Return")return r;if(i+=1,i%1e3===0&&(yield r),i>t.iterationLimit)throw new Ye({cause:"iteration-limit-exceeded"})}}var Pc=[{Choose:{complexity:1200,signature:"(n:number, m:number) -> number",evaluate:(n,{engine:e})=>{let t=n[0].re,i=n[1].re;if(!(!Number.isFinite(t)||!Number.isFinite(i)))return t<0||i<0||i>t?e.NaN:e.number(oa(t,i))}}},{Fibonacci:{description:"Compute the nth Fibonacci number.",wikidata:"Q47577",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null)return;if(t<0n)return e.function("Negate",["Fibonacci",e.number(-t)]);if(t===0n)return e.Zero;if(t===1n)return e.One;let i=0n,r=1n;for(let o=2n;o<=t;o++){let s=i+r;i=r,r=s}return e.number(r)}},Binomial:{description:"Compute the binomial coefficient C(n, k) = n! / (k! (n-k)!).",wikidata:"Q209875",signature:"(integer, integer) -> integer",evaluate:([n,e],{engine:t})=>{let i=ye(n),r=ye(e);if(i===null||r===null)return;if(r<0n||r>i)return t.number(0);if(r===0n||r===i)return t.number(1);let o=1n;for(let s=1n;s<=r;s++)o*=i-(r-s),o/=s;return t.number(o)}},CartesianProduct:{description:"Return the Cartesian product of input sets.",wikidata:"Q173740",signature:"(set+) -> set",collection:{contains:(n,e)=>{let t=n.ops;return!e.isCollection||e.ops.length!==t.length?!1:t.every((i,r)=>i.xcontains(e.ops[r])??!1)},count:n=>{let e=n.ops.map(t=>t.xsize);return e.includes(1/0)?1/0:e.reduce((t,i)=>t*i,1)},iterator:Mm}},PowerSet:{description:"Return the power set of a set (set of all subsets).",wikidata:"Q205170",signature:"(set) -> set",collection:{contains:(n,e)=>{let t=n.ops[0];return e.isCollection?e.ops.every(i=>t.xcontains(i)??!1):!1},count:n=>{let e=n.ops[0];return e.isEmptyCollection?1:e.isFiniteCollection===!1?1/0:2**e.xsize},iterator:Rm}},Permutations:{description:"Return all permutations of length k (default full length) of a collection.",signature:"(collection, integer?) -> list<list>",evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=Array.from(n.each()),r=e?P(e):i.length;if(r===null||r<0||r>i.length)return;function*o(s,a){if(s.length===r){yield s;return}for(let u=0;u<a.length;u++){let l=a.slice(),[c]=l.splice(u,1);yield*o([...s,c],l)}}return t.function("List",[...o([],i)].map(s=>t.function("List",s)))}},Combinations:{description:"Return all k-element combinations of a collection.",wikidata:"Q193606",signature:"(collection, integer) -> list<list>",evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=Array.from(n.each()),r=P(e);if(r===null||r<0||r>i.length)return;function*o(s,a){if(a.length===r){yield a;return}for(let u=s;u<i.length;u++)yield*o(u+1,[...a,i[u]])}return t.function("List",[...o(0,[])].map(s=>t.function("List",s)))}},Multinomial:{description:"Compute the multinomial coefficient for multiple integers.",wikidata:"Q20820114",signature:"(integer+) -> integer",evaluate:(n,{engine:e})=>{let t=n.map(P);if(t.some(o=>o===null||o<0))return;let i=t.reduce((o,s)=>o+(s??0),0),r=1;for(let o=1;o<=i;o++)r*=o;for(let o of t)for(let s=1;s<=o;s++)r/=s;return e.number(r)}},Subfactorial:{description:"Compute the number of derangements (subfactorial) of n items.",wikidata:"Q2361661",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=P(n);if(t===null||t<0)return;let i=1;for(let r=1;r<=t;r++)i=Math.round(i*r*(1-1/r));return e.number(i)}},BellNumber:{description:"Compute the Bell number B(n), the number of partitions of a set of n elements.",wikidata:"Q816063",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=P(n);if(t===null||t<0)return;let i=[1];for(let r=1;r<=t;r++){let o=0;for(let s=0;s<r;s++)o+=Pm(r-1,s)*i[s];i[r]=o}return e.number(i[t])}}}];function*Mm(n){let e=n.ops,t=e.map(o=>[...o.each()]),i=t.map(o=>o.length);if(i.some(o=>o===0))return;let r=Array(e.length).fill(0);for(;;){let o=r.map((a,u)=>t[u][a]);yield n.engine._fn("Tuple",o);let s=r.length-1;for(;s>=0&&(r[s]++,!(r[s]<i[s]));)r[s]=0,s--;if(s<0)break}}function*Rm(n){let e=[...n.ops[0].each()],t=e.length,i=n.engine,r=1<<t;for(let o=0;o<r;o++){let s=[];for(let a=0;a<t;a++)(o&1<<a)!==0&&s.push(e[a]);yield s.length===0?i.symbol("EmptySet"):i._fn("Set",s)}}function Pm(n,e){if(e<0||e>n)return 0;if(e===0||e===n)return 1;let t=1;for(let i=1;i<=e;i++)t*=n-(e-i),t/=i;return t}var Lc=[{Real:{broadcastable:!0,complexity:1200,signature:"(number) -> real",sgn:([n])=>{let e=n.re;if(!isNaN(e))return e===0?"zero":e>0?"positive":"negative"},evaluate:(n,{engine:e})=>{let t=n[0].numericValue;if(t!==null)return typeof t=="number"?n[0]:e.number(t.bignumRe??t.re)}},Imaginary:{broadcastable:!0,complexity:1200,signature:"(number) -> real",sgn:([n])=>{let e=n.im;if(!isNaN(e))return e===0?"zero":e>0?"positive":"negative"},evaluate:(n,{engine:e})=>{let t=n[0].numericValue;if(t!==null)return typeof t=="number"?e.Zero:e.number(t.im)}},Argument:{broadcastable:!0,complexity:1200,signature:"(number) -> real",evaluate:(n,{engine:e})=>{let t=n[0].numericValue;if(t!==null)return typeof t=="number"?t>=0?e.Zero:e.Pi:t.im===0?t.re>=0?e.Zero:e.Pi:e.function("ArcTan2",[t.im,t.re]).evaluate()}},AbsArg:{broadcastable:!0,complexity:1200,signature:"(number) -> tuple<real, real>",evaluate:(n,{engine:e})=>{if(n[0].numericValue!==null)return e.tuple(e.function("Abs",n).evaluate(),e.function("Argument",n).evaluate())}},Conjugate:{broadcastable:!0,complexity:1200,signature:"(number) -> number",type:([n])=>n.type,sgn:([n])=>n.sgn,evaluate:(n,{engine:e})=>{let t=n[0].numericValue;if(t!==null)return typeof t=="number"||t.im===0?n[0]:e.number(e.complex(t.re,-t.im))}},ComplexRoots:{broadcastable:!0,complexity:1200,signature:"(number, number) -> list<number>",evaluate:(n,{engine:e})=>{let t=n[0].re;if(isNaN(t))return;let i=n[1].re;if(!Number.isInteger(i)||i<=0)return;let r=[],o=n[0].im??0,s=Math.atan2(o,t),a=Math.sqrt(t*t+o*o);for(let u=0;u<i;u++){let l=(s+2*Math.PI*u)/i,c=Math.pow(a,1/i);r.push([c*Math.cos(l),c*Math.sin(l)])}return e.function("List",r.map(u=>e.number(u[1]!==0?e.complex(u[0],u[1]):u[0])))}}}];function Eo(n,{engine:e}){if(n.length===0)return null;let t=n[0];if(n.length===1)return t.canonical;if(n.length===2){let i=$c(t);if(!Number.isNaN(i)){let o=n[1];if(o.operator==="Divide"||o.operator==="Rational"){let[s,a]=[o.op1.canonical.re,o.op2.canonical.re];if(s>0&&s<=1e3&&a>1&&a<=1e3&&Number.isInteger(s)&&Number.isInteger(a)){let u=o.canonical;return i<0&&(u=u.neg()),e._fn("Add",[t.canonical,u])}}}let r=n[1];if(!Number.isNaN(i)&&dr(r))return e.number(e.complex(0,i));if(t.symbol&&r.operator==="Delimiter"){if(r.nops===0){let s=e.lookupDefinition(t.symbol);return s?Z(s)?e.box([t.symbol]):s.value.type.isUnknown?(t.infer("function"),e.box([t.symbol])):s.value.type.matches("function")?e.box([t.symbol]):e.typeError("function",s.value.type,t):(e.declare(t.symbol,"function"),e.box([t.symbol]))}let o=r.op1.operator==="Sequence"?r.op1.ops:[r.op1];if(o=Q(o),!e.lookupDefinition(t.symbol))return e.declare(t.symbol,"function"),e.function(t.symbol,o)}if(t.symbol&&r.operator==="Delimiter"&&(r.op2.string==="[,]"||r.op2.string==="[;]")){let o=r.op1.operator==="Sequence"?r.op1.ops:[r.op1];return e.function("At",[t,...o])}}return n=Oc(n),n=Q(n),n.every(i=>i.isValid&&(i.type.isUnknown||i.type.matches("number")||i.isIndexedCollection&&!i.string))?e._fn("Multiply",n):e._fn("Tuple",n)}function Oc(n){let e=[];for(let t of n)t.operator==="InvisibleOperator"?e.push(...Oc(t.ops)):e.push(t);return e}function $c(n){if(n.isNumberLiteral){let e=n.re;if(Number.isInteger(e))return e}if(n.operator==="Negate"){let e=$c(n.op1);if(!Number.isNaN(e))return-e}return Number.NaN}function Ft(n,e,t){if(e===!1)return n;if(e===!0)return n.engine._inScope(t,()=>n.canonical);typeof e=="string"&&(e=[e]),n=zc(n);for(let i of e)switch(i){case"InvisibleOperator":n=pa(n);break;case"Number":n=Fc(n);break;case"Multiply":n=Vc(n);break;case"Add":n=qc(n);break;case"Power":n=vo(n);break;case"Divide":n=Gc(n);break;case"Flatten":n=da(n);break;case"Order":n=Ls(n,{recursive:!0});break;default:throw Error("Invalid canonical form")}return n}function da(n){if(!n.operator||!n.ops||n.nops===0)return n;if(n.operator==="Delimiter")return da(n.op1);let e=n.engine,t=n.operator==="Add"||n.operator==="Multiply";if(!t){let i=e.lookupDefinition(n.operator);Z(i)&&i.operator.associative&&(t=!0)}return t?e.function(n.operator,lt(n.ops.map(da),n.operator)):n}function pa(n){return n.ops?n.operator==="InvisibleOperator"?Eo(n.ops.map(pa),{engine:n.engine})??n:n.engine._fn(n.operator,n.ops.map(pa)):n}function Fc(n){if(n.isNumberLiteral)return n.canonical;if(dr(n))return n.engine.I;if(!n.isFunctionExpression)return n;let{engine:e}=n,t=n.ops.map(Fc),{operator:i}=n;if((i==="Divide"||i==="Rational")&&t.length===2){let r=Qn(t[0]);if(r!==null){let o=Qn(t[1]);if(o!==null)return e.number([r,o])}return i="Divide",e._fn("Divide",t,{canonical:!1})}if(i==="Complex"){if(t.length===1){let r=t[0];return r.isNumberLiteral?e.number(e.complex(0,r.re)):e._fn("Multiply",[r,e.I],{canonical:!1})}if(t.length===2){let r=t[0].re,o=t[1].re;return o!==null&&r!==null&&!isNaN(o)&&!isNaN(r)?o===0&&r===0?e.Zero:o!==0?e.number(e._numericValue({re:r,im:o})):t[0]:e._fn("Add",[t[0],e._fn("Multiply",[t[1],e.I],{canonical:!1})],{canonical:!1})}throw new Error("Expected one or two arguments with `Complex` expression")}if(i==="Negate"&&t.length===1){let r=t[0],{numericValue:o}=r;if(o!==null)return e.number(typeof o=="number"?-o:o.neg());if(dr(r))return e.number(e.complex(0,-1))}return t.every((r,o)=>r===n.ops[o])?n:e._fn(i,t,{canonical:!1})}function Vc(n){if(!n.ops)return n;let e=n.ops.map(Vc);return n.operator==="Multiply"?_e(n.engine,e.map(t=>t.canonical)):n.operator==="Negate"?_e(n.engine,[e[0],n.engine.NegativeOne]):n}function qc(n){if(!n.ops)return n;let e=n.ops.map(qc);return n.operator==="Add"?Ke(n.engine,e):n.operator==="Subtract"?Ke(n.engine,[e[0],e[1].neg()]):n.engine._fn(n.operator,e)}function vo(n){if(!n.ops)return n;let e=n.ops.map(t=>vo(t));return n.operator==="Power"?Kn(e[0],e[1]):n.engine._fn(n.operator,e,{canonical:!1})}function zc(n){return n.symbol!==null?n.canonical:n.isFunctionExpression?n.engine._fn(n.operator,n.ops.map(zc),{canonical:!1}):n}function Gc(n){return n.operator==="Divide"?un(vo(n.op1),vo(n.op2)):n.ops?n.engine._fn(n.operator,n.ops.map(Gc)):n}function xr(n){return n[Math.floor(Math.random()*n.length)]}function Uc(n,e){if(n==="Add"||n==="Multiply"){let t=[],i=1+Math.floor(Math.random()*12);for(;i>0;)t.push(On(e+1)),i-=1;return[n,...t]}return n==="Divide"||n==="Power"?[n,On(e+1),On(e+1)]:n==="Root"?[n,On(e+1),On(10)]:n==="trig"?Lm():[n,On(e+1)]}function Lm(){return[xr(["Cos","Sin","Tan","Sinh","Arccos","Arcsinh"]),xr(["Pi","-1","0","1",["Divide","Pi",-5],["Multiply",-2,["Divide","Pi",11]],["Multiply","Half","Pi"],["Multiply",5,"Pi"],["Multiply",12,"Pi"],["Divide","Pi",5],["Divide","Pi",9],["Multiply",5,["Divide","Pi",9]],["Multiply",2,["Divide","Pi",11]],["Multiply",2,["Divide","Pi",3]]])]}function On(n){if(n??=1,n===1){let e=xr([["Sqrt",["Multiply",6,["Sum",["Divide",1,["Power","n",2]],["Triple",["Hold","n"],1,"PositiveInfinity"]]]],"Add","Add","Add","Add","Add","Multiply","Multiply","Multiply","Multiply","Divide","Divide","Divide","Root","Sqrt","Subtract","Negate","trig"]);return typeof e=="string"?Uc(e,1):e}if(n===2){let e=Math.random();if(e>.75)return On(1);if(e>.5)return On(3);let t=xr(["Multiply","Multiply","Add","Power","trig","Ln","Exp"]);return Uc(t,2)}return xr([-12345e-9,-2,-2,-2,-3,-5,-6,-12,-1654e-60,0,0,12345e-8,1654e-60,1,2,2,2,2,3,3,5,5,6,6,1234.5678,5678.1234,10,15,18,30,60,1234e54,"123456789.12345678912345e200","987654321.12345678912345",["Rational",-6,10],["Rational",-12,15],["Rational",-15,12],["Rational",3,5],["Rational",12,15],["Rational",15,12],"ExponentialE",["Sqrt",3],["Sqrt",5],["Sqrt",15],["Sqrt",25],["Complex",-1.1,1.1],["Complex",4,5],"x","x","x","x",["Add","x",1],["Divide","x",3],["Square","x"],["Power","x",3],["Power","x",4],["Subtract","x",1],["Add","x",1],"Pi"])}var jc=[{Nothing:{type:"nothing"}},{InvisibleOperator:{complexity:9e3,lazy:!0,signature:"function",canonical:(n,{engine:e})=>{let t=Eo(n,{engine:e});return t?t.operator==="Multiply"?_e(e,t.ops):t:e.Nothing}},Sequence:{lazy:!0,signature:"function",type:n=>n.length===0?"nothing":n.length===1?n[0].type:"any",canonical:(n,{engine:e})=>{let t=Q(n);return t.length===0?e.Nothing:t.length===1?t[0]:e._fn("Sequence",t)}},Delimiter:{complexity:9e3,lazy:!0,signature:"(any, string?) -> any",type:n=>n.length===0?"nothing":n[0].type,canonical:(n,{engine:e})=>{if(n.length===0)return e._fn("Tuple",[]);if(n.length>2)return e._fn("Delimiter",Xe(e,n,2));let t=n[0];if(t.operator==="Sequence")return e._fn("Tuple",Qe(e,t.ops));t=t.canonical;let i=n[1]?.string;return!i||i.startsWith("(")&&i.endsWith(")")?t:(i?.length??0)>3?e._fn("Delimiter",[t,e.error("invalid-delimiter",n[1].toString())]):e._fn("Delimiter",[n[0],ge(e,n[1],"string")])},evaluate:(n,e)=>{let t=e.engine;if(n.length===0)return t.Nothing;let i=n[0];return(i.operator==="Sequence"||i.operator==="Delimiter")&&(n=ws(n[0].ops)),n.length===1?n[0].evaluate(e):t._fn("Tuple",n.map(r=>r.evaluate(e)))}},Error:{lazy:!0,complexity:500,signature:"((string|expression<ErrorCode>), expression?) -> nothing",canonical:(n,{engine:e})=>e._fn("Error",n)},ErrorCode:{complexity:500,lazy:!0,signature:"(string, any*) -> error",canonical:(n,{engine:e})=>{let t=ge(e,n[0],"string").string;return t==="incompatible-type"?e._fn("ErrorCode",[e.string(t),n[1],n[2]]):e._fn("ErrorCode",n)}},Unevaluated:{description:"Prevent an expression from being evaluated",lazy:!0,signature:"(any) -> unknown",type:([n])=>n.type,canonical:(n,{engine:e,scope:t})=>e._fn("Unevaluated",Qe(e,n,t)),evaluate:([n],e)=>n.evaluate(e)},Hold:{description:"Hold an expression, preventing it from being canonicalized or evaluated until `ReleaseHold` is applied to it",lazy:!0,signature:"(any) -> unknown",type:([n])=>n.symbol?"symbol":n.string?"string":n.isNumberLiteral?n.type:n.ops?We(n.type.type)??"unknown":"unknown",eq:(n,e)=>(e.operator==="Hold"&&(e=e.ops[0]),n.ops[0].isSame(e)),evaluate:([n],{engine:e})=>e.hold(n)},ReleaseHold:{description:"Release an expression held by `Hold`",lazy:!0,signature:"(any) -> unknown",type:([n])=>n.operator==="Hold"?n.op1.type:n.type,evaluate:([n],e)=>(n.operator==="Hold"&&(n=n.op1),n.canonical.evaluate(e))},HorizontalSpacing:{signature:"(number) -> nothing",canonical:(n,{engine:e})=>n.length===2?n[0].canonical:e.Nothing},Annotated:{signature:"(expression, dictionary) -> expression",type:([n])=>n.type,complexity:9e3,lazy:!0,canonical:([n,e],{engine:t})=>(n=n.canonical,e=e.canonical,!bc(e)||e.keys.length===0?n:t._fn("Annotated",[n,e])),evaluate:([n,e],t)=>n.evaluate(t)},Text:{description:"A sequence of strings, annotated expressions and other Text expressions",signature:"(any*) -> expression"}},{About:{description:"Return information about an expression",lazy:!0,signature:"(any) -> string",evaluate:([n],{engine:e})=>{let t=[n.toString()];if(t.push(""),n.string)t.push("string");else if(n.symbol)if(n.valueDefinition){let i=n.valueDefinition;i.isConstant&&t.push("constant"),typeof i.description=="string"?t.push(i.description):Array.isArray(i.description)&&t.push(i.description.join(`
`)),i.wikidata&&t.push(`WikiData: ${i.wikidata}`),i.url&&t.push(`Read More: ${i.url}`)}else t.push("symbol"),t.push(`value: ${n.evaluate().toString()}`);else n.isNumberLiteral?t.push(n.type.toString()):n.ops?(t.push(n.type.toString()),t.push(n.isCanonical?"canonical":"non-canonical")):t.push("Unknown expression's type");return e.string(t.join(`
`))}},Head:{description:"Return the head of an expression, the name of the operator",lazy:!0,signature:"(any) -> symbol",canonical:(n,{engine:e})=>{if(n.length!==1)return null;let t=n[0];return t.operator?e.box(t.operator):e._fn("Head",Qe(e,n))},evaluate:(n,{engine:e})=>e.symbol(n[0]?.operator??"Undefined")},Tail:{description:"Return the tail of an expression, the operands of the expression",lazy:!0,signature:"(any) -> collection",canonical:(n,{engine:e})=>{if(n.length!==1)return null;let t=n[0];return t.ops?e._fn("Sequence",t.ops):e._fn("Tail",Qe(e,n))},evaluate:([n],{engine:e})=>n?.ops?e._fn("Sequence",n.ops):e.Nothing},Identity:{description:"Return the argument unchanged",signature:"(any) -> unknown",type:([n])=>n.type,evaluate:([n])=>n}},{Apply:{description:"Apply a function to a list of arguments",signature:"(name:symbol, arguments:expression*) -> unknown",type:([n])=>We(n.type.type)??"unknown",canonical:(n,{engine:e})=>n[0].symbol?e.function(n[0].symbol,n.slice(1)):e._fn("Apply",n),evaluate:n=>An(n[0],n.slice(1))},Assign:{description:"Assign a value to a symbol",lazy:!0,pure:!1,signature:"(symbol, any) -> any",type:([n,e])=>e.type,canonical:(n,{engine:e})=>{if(n.length!==2)return null;let t=n[0];return t.symbol||(t=ge(e,n[0],"symbol")),e._fn("Assign",[t,n[1].canonical])},evaluate:([n,e],{engine:t})=>{let i=n.evaluate();if(!i.symbol)return;let r=e.evaluate();return t.assign(i.symbol,r),r}},Assume:{description:"Assume a type for a symbol",lazy:!0,pure:!1,signature:"(any) -> symbol",evaluate:(n,{engine:e})=>e.symbol(e.assume(n[0]))},Declare:{lazy:!0,pure:!1,signature:"(symbol, type: string | symbol) -> nothing",canonical:(n,{engine:e})=>{let t=n[0];return t.symbol||(t=ge(e,n[0],"symbol")),n.length===1?e._fn("Declare",[t]):n.length!==2?null:e._fn("Declare",[t,n[1]])},evaluate:(n,{engine:e})=>{let t=n[0].evaluate().symbol;if(!t)return;if(!n[1])return e.declare(t,{inferred:!0,type:"unknown"}),e.Nothing;let i=n[1].canonical.evaluate(),r=A(i.string??i.symbol??void 0);if(st(r))return e.declare(t,r),e.Nothing}},Type:{lazy:!0,signature:"(any) -> string",evaluate:([n],{engine:e})=>e.string(n.type.toString()??"unknown")},Evaluate:{lazy:!0,signature:"(any) -> unknown",type:([n])=>n.type,canonical:(n,{engine:e})=>e._fn("Evaluate",Xe(e,n,1)),evaluate:([n],e)=>n.evaluate(e)},EvaluateAt:{lazy:!0,signature:"(function, lower:number, upper:number) -> number",type:([n])=>We(n.type.type)??"number",canonical:(n,{engine:e})=>{if(n.length===0)return null;let t=ve(n[0]);return t?e._fn("EvaluateAt",[t,...n.slice(1).map(i=>ge(e,i,"value"))]):null},evaluate:([n,e,t],{engine:i})=>{if(t===void 0){let s=An(n,[e]);return s&&s.isNumberLiteral?s:i._fn("EvaluateAt",[n,e])}let r=An(n,[e]),o=An(n,[t]);return r&&o&&r.N().isNumberLiteral&&o.N().isNumberLiteral?o.sub(r):i._fn("EvaluateAt",[n,e,t])}},BuiltinFunction:{complexity:9876,lazy:!0,signature:"(symbol | string) -> symbol",canonical:([n],{engine:e})=>e.symbol(n.symbol??n.string??"Undefined")},Function:{description:"A function literal",complexity:9876,lazy:!0,signature:"(expression, symbol*) -> function",type:([n,...e])=>`(${e.map(t=>t.type.type)}) -> ${n.type.type}`,canonical:(n,{engine:e})=>ai(e,n)??null,evaluate:n=>{}},Rule:{lazy:!0,signature:"(match: expression, replace: expression, predicate: function?) -> expression",evaluate:([n,e,t],{engine:i})=>{}},Simplify:{lazy:!0,signature:"(any) -> expression",canonical:(n,{engine:e})=>e._fn("Simplify",Xe(e,n,1)),evaluate:([n])=>n.simplify()??void 0},CanonicalForm:{description:["Return the canonical form of an expression","Can be used to sort arguments of an expression.",'Sorting arguments of commutative functions is a weak form of canonicalization that can be useful in some cases, for example to accept "x+1" and "1+x" while rejecting "x+1" and "2x-x+1"'],complexity:8200,lazy:!0,signature:"(any, symbol*) -> any",canonical:n=>{if(n.length===1)return n[0].canonical;let e=n.slice(1).map(t=>t.symbol??t.string).filter(t=>t!=null);return Ft(n[0],e)}},N:{description:"Numerically evaluate an expression",lazy:!0,signature:"(any) -> unknown",type:([n])=>n.type,canonical:(n,{engine:e})=>{if(n.length!==1)return e._fn("N",Xe(e,n,1));let t=n[0].operator;return t==="N"||t==="Evaluate"?n[0].canonical:e._fn("N",n)},evaluate:([n])=>n.N()},Random:{description:["Random(): Return a random number between 0 and 1","Random(n): Return a random integer between 0 and n-1","Random(m, n): Return a random integer between m and n-1"],pure:!1,signature:"(lower:integer?, upper:integer?) -> finite_number",type:([n,e])=>n===void 0&&e===void 0?"finite_number":"finite_integer",sgn:()=>"non-negative",evaluate:(n,{engine:e})=>{if(n.length===0)return e.number(Math.random());let[t,i]=n,r,o;return i===void 0?(r=0,o=Math.floor(t.re-1),isNaN(o)&&(o=0)):(r=Math.floor(t.re),o=Math.floor(i.re),isNaN(r)&&(r=0),isNaN(o)&&(o=0)),e.number(r+Math.floor(Math.random()*(o-r)))}},Signature:{lazy:!0,signature:"(symbol) -> string | nothing",evaluate:([n],{engine:e})=>n.operatorDefinition?e.string(n.operatorDefinition.signature.toString()):e.Nothing},Subscript:{lazy:!0,signature:"(collection, any) -> any",type:([n,e],{engine:t})=>n.string&&ee(e)!==null?"integer":n.isIndexedCollection?bn(n.type.type)??"any":n.symbol?"symbol":"expression",canonical:([n,e],{engine:t})=>{if(n=n.canonical,n.string){let i=ee(e.canonical);if(i!==null&&i>1&&i<=36){let[r,o]=Hi(n.string,i);return o?t.error(["unexpected-digit",o[0]],n.toString()):t.number(r)}return t._fn("Baseform",[n,t.error(["invalid-base",e.toString()])])}if(n.isIndexedCollection)return t._fn("At",[n,e.canonical]);if(n.symbol){let i=e.string??e.symbol??ee(e)?.toString();if(i)return t.symbol(n.symbol+"_"+i)}return e.operator==="Sequence"&&t._fn("Subscript",[n,t._fn("List",e.ops)]),t._fn("Subscript",[n,e])}},Symbol:{complexity:500,description:"Construct a new symbol with a name formed by concatenating the arguments",broadcastable:!0,lazy:!0,signature:"function",type:n=>n.length===0?"nothing":"symbol",canonical:(n,{engine:e})=>n.length===0?e.Nothing:e._fn("Symbol",n.map(t=>t.symbol?t:t.canonical)),evaluate:(n,{engine:e})=>{n.length>0;let t=n.map(i=>i.symbol??i.string??ee(i)?.toString()??"").join("");return e.symbol(t)}},Timing:{description:"`Timing(expr)` evaluates `expr` and return a `Pair` of the number of second elapsed for the evaluation, and the value of the evaluation",signature:"(value, repeat: integer?) -> tuple<result:value, time:number>",evaluate:(n,{engine:e})=>{if(n[1].symbol==="Nothing"){let u=globalThis.performance.now(),l=n[0].evaluate(),c=1e3*(globalThis.performance.now()-u);return e.tuple(e.number(c),l)}let t=Math.max(3,P(n[1])??3),i=[],r;for(;t>0;){let u=globalThis.performance.now();r=n[0].evaluate(),i.push(1e3*(globalThis.performance.now()-u)),t-=1}let o=Math.max(...i),s=Math.min(...i);i=i.filter(u=>u>s&&u<o);let a=i.reduce((u,l)=>u+l,0);return a===0?e.tuple(e.number(o),r):e.tuple(e.number(a/i.length),r)}}},{Wildcard:{signature:"(symbol) -> symbol",canonical:(n,{engine:e})=>n.length!==1?e.symbol("_"):e.symbol("_"+n[0].symbol)},WildcardSequence:{signature:"(symbol) -> symbol",canonical:(n,{engine:e})=>n.length!==1?e.symbol("__"):e.symbol("__"+n[0].symbol)},WildcardOptionalSequence:{signature:"(symbol) -> symbol",canonical:(n,{engine:e})=>n.length!==1?e.symbol("___"):e.symbol("___"+n[0].symbol)}},{LatexString:{description:"Value preserving type conversion/tag indicating the string is a LaTeX string",signature:"(string) -> string",evaluate:([n])=>n},Latex:{description:"Serialize an expression to LaTeX",signature:"(any+) -> string",evaluate:(n,{engine:e})=>e.box(["LatexString",e.string(v(n.map(t=>t.latex)))])},Parse:{description:"Parse a LaTeX string and evaluate to a corresponding expression",signature:"(string) -> any",evaluate:([n],{engine:e})=>e.parse(n.string)??e.Nothing}},{String:{description:"A string created by joining its arguments. The arguments are converted to their default string representation.",broadcastable:!0,signature:"(any*) -> string",evaluate:(n,{engine:e})=>n.length===0?e.string(""):e.string(n.map(t=>t.toString()).join(""))},StringFrom:{description:"Create a string by converting its arguments to a string and joining them.",broadcastable:!0,signature:"(any, format:string?) -> string",evaluate:([n,e],{engine:t})=>{if(n===void 0)return t.string("");let i=e?.string??"default";return i==="default"?t.string(n.toString()):i==="utf-8"?n.isIndexedCollection?t.string(new TextDecoder("utf-8").decode(new Uint8Array([...n.each()].map(r=>P(r)??65533)))):t.typeError(A("indexed_collection<integer>"),n.type):i==="utf-16"?n.isIndexedCollection?t.string(new TextDecoder("utf-16").decode(new Uint16Array([...n.each()].map(r=>P(r)??65533)))):t.typeError(A("indexed_collection<integer>"),n.type):i==="unicode-scalars"?n.isIndexedCollection?t.string(String.fromCodePoint(...[...n.each()].map(r=>P(r)??65533))):t.typeError(A("indexed_collection<integer>"),n.type):t.string(n.toString())}},Utf8:{description:"A collection of utf-8 code units from a string.",signature:"(string) -> list<integer>",evaluate:([n],{engine:e})=>{if(!n.string)return;let t=n.buffer;return e.function("List",Array.from(t,i=>e.number(i)))}},Utf16:{description:"A collection of utf-16 code units from a string.",signature:"(string) -> list<integer>",evaluate:([n],{engine:e})=>{if(!n.string)return;let t=[];for(let i=0;i<n.string.length;i++){let r=n.string.charCodeAt(i);t.push(r)}return e.function("List",t.map(i=>e.number(i)))}},UnicodeScalars:{description:"A collection of Unicode scalars from a string, same as utf-32",signature:"(string) -> list<integer>",evaluate:([n],{engine:e})=>{if(!n.string)return;let t=n.unicodeScalars;return e.function("List",t.map(i=>e.number(i)))}},GraphemeClusters:{description:"A collection of grapheme clusters from a string.",signature:"(string) -> list<string>",evaluate:([n],{engine:e})=>{if(!n.string)return;let t=new Intl.Segmenter("en",{granularity:"grapheme"}),i=Array.from(t.segment(n.string),r=>e.string(r.segment));return e.function("List",i)}},BaseForm:{description:"`BaseForm(expr, base=10)`",complexity:9e3,signature:"(number, (string|integer)?) -> string | nothing",type:([n])=>n===void 0?"nothing":n.type,evaluate:([n])=>n},DigitsFrom:{description:"Return an integer representation of the string `s` in base `base`.",signature:"(string, (string|integer)?) -> integer",evaluate:(n,{engine:e})=>{let t=n[0]?.string,i=e;if(!t)return i.typeError("string",n[0]?.type,n[0]);if(t=t.trim(),t.startsWith("0x"))return i.number(parseInt(t.slice(2),16));if(t.startsWith("0b"))return i.number(parseInt(t.slice(2),2));let r=n[1]??i.Nothing;if(r.symbol==="Nothing")return i.number(Number.parseInt(t,10));let o=r.re;if(!r.isInteger||!Number.isFinite(o)||o<2||o>36)return i.error(["unexpected-base",o.toString()],r.toString());let[s,a]=Hi(t,r.string??r.symbol??10);return a?i.error(["unexpected-digit",a[0]],a):i.number(s)}},IntegerString:{description:"`IntegerString(n, base=10)`       return a string representation of the integer `n` in base `base`.",broadcastable:!0,signature:"(integer, integer?) -> string",evaluate:(n,{engine:e})=>{let t=e,i=n[0];if(!i.isInteger)return t.typeError("integer",i.type,i);let r=i.re;if(!Number.isFinite(r))return t.typeError("integer",i.type,i);let o=n[1]??t.Nothing;if(o.symbol==="Nothing")return i.bignumRe!==void 0?t.string(i.bignumRe.abs().toString()):t.string(Math.abs(r).toString());let s=ee(o);return s===null?t.typeError("integer",o.type,o):s<2||s>36?t.error(["out-of-range","2","36",s.toString()],o.toString()):t.string(Math.abs(r).toString(s))}}},{RandomExpression:{signature:"() -> expression",evaluate:(n,{engine:e})=>e.box(On())}}];function _o(n,e){switch(e){case"float64":case"float32":case"int32":case"uint8":return new No(n);case"complex128":case"complex64":return new ga(n);case"bool":case"expression":return new ma(n);case void 0:return new No(n)}throw new Error(`Unknown dtype ${e}`)}var No=class{constructor(e){this.ce=e}one=1;zero=0;nan=NaN;cast(e,t){let i=this.ce;switch(t){case"float64":case"float32":case"int32":case"uint8":return e;case"complex128":case"complex64":return Array.isArray(e)?e.map(r=>i.complex(r)):this.ce.complex(e);case"bool":return Array.isArray(e)?e.map(r=>r!==0):e!==0;case"expression":return Array.isArray(e)?e.map(r=>i.number(r)):i.number(e)}throw new Error(`Cannot cast ${e} to ${t}`)}expression(e){return this.ce.number(e)}isZero(e){return e===0}isOne(e){return e===1}equals(e,t){return e===t}add(e,t){return e+t}addn(...e){return e.reduce((t,i)=>t+i,0)}neg(e){return-e}sub(e,t){return e-t}mul(e,t){return e*t}muln(...e){return e.reduce((t,i)=>t*i,1)}div(e,t){return e/t}pow(e,t){return e**t}conjugate(e){return e}},ma=class{one;zero;nan;ce;constructor(e){this.zero=e.Zero,this.nan=e.NaN,this.ce=e}cast(e,t){if(Array.isArray(e))return e.map(i=>this.cast(i,t));switch(t){case"float64":case"float32":return e.im===0?e.re:void 0;case"int32":return typeof e.re=="number"?Math.round(e.re):void 0;case"uint8":if(typeof e.re!="number")return;let i=Math.round(e.re);return i>=0&&i<=255?i:void 0;case"complex128":case"complex64":let[r,o]=[e.re,e.im];return typeof r=="number"&&typeof o=="number"?this.ce.complex(r,o):typeof r=="number"?this.ce.complex(r):void 0;case"bool":let s=e.valueOf();return typeof s=="boolean"?s:void 0;case"expression":return e}throw new Error(`Cannot cast ${e} to ${t}`)}expression(e){return e}isZero(e){return e.is(0)}isOne(e){return e.is(1)}equals(e,t){return e.isSame(t)===!0}add(e,t){return e.add(t)}addn(...e){return H(...e)}neg(e){return e.neg()}sub(e,t){return e.sub(t)}mul(e,t){return e.mul(t)}muln(...e){return ae(...e)}div(e,t){return e.div(t)}pow(e,t){return e.pow(t)}conjugate(e){return this.ce.function("Conjugate",[e]).evaluate()}},ga=class{one;zero;nan;ce;constructor(e){this.ce=e,this.one=e.complex(1),this.zero=e.complex(0),this.nan=e.complex(NaN)}cast(e,t){if(Array.isArray(e))return e.map(i=>this.cast(i,t));switch(t){case"float64":return e.im===0?e.re:void 0;case"float32":return e.im===0?e.re:void 0;case"int32":return e.im===0?Math.round(e.re):void 0;case"uint8":if(e.im!==0)return;let i=Math.round(e.re);return i>=0&&i<=255?i:void 0;case"complex128":return e;case"complex64":return e;case"bool":return!(e.im===0&&e.re===0);case"expression":return this.ce.number(e)}throw new Error(`Cannot cast ${e} to ${t}`)}expression(e){return this.ce.number(e)}isZero(e){return e.isZero()}isOne(e){return e.re===1&&e.im===0}equals(e,t){return e.equals(t)}add(e,t){return e.add(t)}addn(...e){return e.reduce((t,i)=>t.add(i),this.zero)}neg(e){return e.neg()}sub(e,t){return e.sub(t)}mul(e,t){return e.mul(t)}muln(...e){return e.reduce((t,i)=>t.mul(i),this.one)}div(e,t){return e.div(t)}pow(e,t){return e.pow(t)}conjugate(e){return e.conjugate()}};function So(n,e){return n===void 0?e:n===e?n:n==="expression"||e==="expression"?"expression":n==="complex128"||e==="complex128"?"complex128":n==="complex64"||e==="complex64"?"complex64":n==="float64"||e==="float64"?"float64":n==="float32"||e==="float32"?"float32":n==="int32"||e==="int32"?"int32":n==="uint8"||e==="uint8"?"uint8":n==="bool"||e==="bool"?"bool":"expression"}function Zc(n){if(n.symbol==="True"||n.symbol==="False")return"bool";if(n.symbol==="NaN"||n.symbol==="PositiveInfinity"||n.symbol==="NegativeInfinity")return"float64";if(n.symbol==="ComplexInfinity"||n.symbol==="ImaginaryUnit")return"complex128";if(n.isNumberLiteral)switch(n.type.type){case"real":case"rational":case"finite_real":case"finite_rational":case"integer":return"float64";case"complex":case"finite_complex":case"imaginary":return"complex128";case"finite_integer":{let e=n.re;return e>=0&&e<=255?"uint8":"int32"}default:return"expression"}return"expression"}var bi=class n{constructor(e,t){this.ce=e;this.shape=t.shape,this.rank=this.shape.length,this._strides=Om(this.shape),this.field=_o(e,t.dtype)}static align(e,t){if(e.dtype===t.dtype)return[e,t];let i=So(e.dtype,t.dtype);return e.dtype===i?[e,t.upcast(i)]:[e.upcast(i),t]}static broadcast(e,t,i){if(!(i instanceof n))return t.map1(e,i);let[r,o]=n.align(t,i),s=r.data.map((a,u)=>e(a,o.data[u]));return dn(r.ce,{dtype:r.dtype,shape:r.shape,data:s})}field;shape;rank;_strides;get expression(){let e=this.shape,t=this.rank,i=this.data,r=this._index.bind(this),o=this.field.expression.bind(this.field),s=a=>{if(a.length===t-1){let u=r(a);return this.ce._fn("List",i.slice(u,u+e[t-1]).map(l=>o(l)))}else{let u=[];for(let l=1;l<=e[a.length];l++)u.push(s([...a,l]));return this.ce._fn("List",u)}};return s([])}get array(){let e=this.shape,t=this.rank,i=this.data;if(t===1)return i;if(t===2){let[s,a]=e,u=new Array(s);for(let l=0;l<s;l++)u[l]=i.slice(l*a,(l+1)*a);return u}let r=this._index.bind(this),o=s=>{if(s.length===t-1){let a=r(s);return i.slice(a,a+e[t-1])}else{let a=[];for(let u=0;u<e[s.length];u++)a.push(o([...s,u+1]));return a}};return o([])}_index(e){let t=this._strides;return e.reduce((i,r,o)=>i+(r-1)*t[o],0)}get isSquare(){let e=this.shape;return e.length===2&&e[0]===e[1]}get isSymmetric(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.equals.bind(this.field);for(let r=0;r<e;r++)for(let o=r+1;o<e;o++)if(!i(t[r*e+o],t[o*e+r]))return!1;return!0}get isSkewSymmetric(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.equals.bind(this.field),r=this.field.neg.bind(this.field);for(let o=0;o<e;o++)for(let s=o+1;s<e;s++)if(!i(t[o*e+s],r(t[s*e+o])))return!1;return!0}get isUpperTriangular(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.isZero.bind(this.field);for(let r=1;r<e;r++)for(let o=0;o<r;o++)if(i(t[r*e+o]))return!1;return!0}get isLowerTriangular(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.isZero.bind(this.field);for(let r=0;r<e-1;r++)for(let o=r+1;o<e;o++)if(!i(t[r*e+o]))return!1;return!0}get isTriangular(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.isZero.bind(this.field);for(let r=0;r<e;r++)for(let o=0;o<e;o++)if(r<o&&!i(t[r*e+o])||r>o&&!i(t[r*e+o]))return!1;return!0}get isDiagonal(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.isZero.bind(this.field);for(let r=0;r<e;r++)for(let o=0;o<e;o++)if(r===o&&!i(t[r*e+o])||r!==o&&!i(t[r*e+o]))return!1;return!0}get isIdentity(){if(!this.isSquare)return!1;let[e,t]=this.shape,i=this.data,r=this.field.isOne.bind(this.field),o=this.field.isZero.bind(this.field);for(let s=0;s<t;s++)for(let a=0;a<t;a++)if(s===a&&!r(i[s*t+a])||s!==a&&!o(i[s*t+a]))return!1;return!0}get isZero(){let e=this.field.isZero.bind(this.field);return this.data.every(t=>e(t))}at(...e){let t=this.data.length;return this.data[this._index(e)%t]}diagonal(e,t){if(e??=1,t??=2,e===t||e<=0||e>this.shape.length||this.shape[e-1]!==this.shape[t-1])return;let i=new Array(this.shape[e-1]),r=this.data,o=this.shape[e-1];for(let s=0;s<o;s++)i[s]=r[s*o+s];return i}trace(e,t){if(this.rank!==2)return;let[i,r]=this.shape;if(i!==r)return;let o=this.data,s=new Array(i);for(let a=0;a<i;a++)s[a]=o[a*i+a];return this.field.addn(...s)}reshape(...e){return dn(this.ce,{dtype:this.dtype,shape:e,data:this.data})}slice(e){if(e<0&&(e=this.shape[0]+e+1),this.rank===0)return this;if(this.rank===1){let s=this.data[e-1];return dn(this.ce,{dtype:this.dtype,shape:[],data:[s]})}let t=this.shape[1],i=this._strides[0],r=e*i,o=r+i;return dn(this.ce,{dtype:this.dtype,shape:this.shape.slice(1),data:this.data.slice(r,o)})}flatten(){return this.data}upcast(e){let t=this.field.cast(this.data,e);if(t===void 0)throw Error(`Cannot cast tensor to ${e}`);return dn(this.ce,{dtype:e,shape:this.shape,data:t})}transpose(e,t,i){if(this.rank!==2)return;if(e??=1,t??=2,e===t)return this;if(e<=0||e>2||t<=0||t>2)return;let[r,o]=this.shape,s=this.data;i&&(s=s.map(c=>i(c)));let a=0,u=new Array(r*o),l=o;for(let c=0;c<o;c++)for(let f=0;f<r;f++)u[a++]=s[f*l+c];return dn(this.ce,{dtype:this.dtype,shape:[o,r],data:u})}conjugateTranspose(e,t){let i=this.field.conjugate.bind(this.field);return this.transpose(e,t,i)}determinant(){if(this.rank!==2)return;let[e,t]=this.shape;if(e!==t)return;if(e===1)return this.data[0];let i=this.field.add.bind(this.field),r=this.field.mul.bind(this.field),o=this.field.neg.bind(this.field);if(e===2){let[g,b,_,k]=this.data;return i(r(g,k),o(r(b,_)))}let s=this.field.addn.bind(this.field),a=this.field.muln.bind(this.field);if(e===3){let[g,b,_,k,w,z,be,ke,hn]=this.data;return s([a(g,w,hn),a(b,z,be),a(_,k,ke),o(a(_,w,be)),o(a(b,k,hn)),o(a(g,z,ke))])}let u=this.shape[0],l=!1,c=this.field.div.bind(this.field),f=this.field.sub.bind(this.field),d=new Array(u).fill(0).map((g,b)=>b),p=[...this.data];for(let g=0;g<u;g++){let b=d[g-1];if(this.at(b,g)===0){let w;for(w=g+1;w<u;w++)if(this.at(d[w],g)!==0){b=d[w],d[w-1]=d[g-1],d[g-1]=b,l=!l;break}if(w===u)return this.at(b,g)}let _=this.at(b,g),k=g===0?1:this.at(d[g-2],g-2);for(let w=g+1;w<u;w++){let z=d[w-1];for(let be=g+1;be<u;be++)p[z][be]=c(f(r(p[z][be],_),r(p[z][g],p[b][be])),k)}}let x=p[d[u-1]][u-1];return l?this.field.neg(x):x}inverse(){if(this.rank!==2)return;let[e,t]=this.shape;if(e!==t)return;if(e===2){let[d,p,x,g]=this.data,b=this.determinant();if(b===void 0||this.field.isZero(b))return;let _=this.field.div.bind(this.field),k=this.field.neg.bind(this.field),w=[_(g,b),k(_(p,b)),k(_(x,b)),_(d,b)];return dn(this.ce,{dtype:this.dtype,shape:[t,t],data:w})}let i=this.shape[0],r=this.field.div.bind(this.field),o=this.field.sub.bind(this.field),s=this.field.mul.bind(this.field),a=this.array,u=new Array(i).fill(0).map((d,p)=>{let x=new Array(i).fill(0);return x[p]=1,x}),l=a.map((d,p)=>[...d,...u[p]]),c=new Array(i).fill(0).map((d,p)=>p);for(let d=0;d<i;d++){let p=c[d-1];if(this.at(p,d)===0){let b;for(b=d+1;b<i;b++)if(this.at(c[b],d)!==0){p=c[b],c[b-1]=c[d-1],c[d-1]=p;break}if(b===i)return}let x=this.at(p,d),g=d===0?1:this.at(c[d-2],d-2);for(let b=d+1;b<i;b++){let _=c[b-1];for(let k=d+1;k<i*2;k++)l[_][k]=o(l[_][k],s(r(s(l[_][d],l[p][k]),x),g))}}for(let d=i-1;d>=0;d--){let p=l[c[d],d];for(let x=0;x<d;x++){let g=c[x];for(let b=i;b<i*2;b++)l[g][b]=o(l[g][b],s(r(s(l[g][d],l[d][b]),p),p))}for(let x=i;x<i*2;x++)l[d][x]=r(l[d][x],p)}let f=l.map(d=>d.slice(i));return dn(this.ce,{dtype:this.dtype,shape:[t,t],data:f})}pseudoInverse(){}adjugateMatrix(){}minor(e,t){}map1(e,t){return dn(this.ce,{dtype:this.dtype,shape:this.shape,data:this.data.map(i=>e(i,t))})}map2(e,t){let i=t.data;return dn(this.ce,{dtype:this.dtype,shape:this.shape,data:this.data.map((r,o)=>e(r,i[o]))})}add(e){return n.broadcast(this.field.add.bind(this.field),this,e)}subtract(e){return n.broadcast(this.field.sub.bind(this.field),this,e)}multiply(e){return n.broadcast(this.field.mul.bind(this.field),this,e)}divide(e){return n.broadcast(this.field.div.bind(this.field),this,e)}power(e){return n.broadcast(this.field.pow.bind(this.field),this,e)}equals(e){if(this.rank!==e.rank||!this.shape.every((o,s)=>o===e.shape[s]))return!1;let t=this.field.equals.bind(this.field),i=this.field.cast.bind(this.field),r=this.dtype;return this.dtype!==e.dtype?!!this.data.every((o,s)=>t(o,i(e.data[s],r))):this.data.every((o,s)=>t(o,e.data[s]))}};function Om(n){let e=new Array(n.length);for(let t=n.length-1,i=1;t>=0;t--)e[t]=i,i*=n[t];return e}var ha=class extends bi{dtype="float64";data;constructor(e,t){super(e,t),this.data=t.data}get isZero(){return this.data.every(e=>e===0)}},ya=class extends bi{dtype="complex128";data;constructor(e,t){super(e,t),this.data=t.data}},xa=class extends bi{dtype="bool";data;constructor(e,t){super(e,t),this.data=t.data}},ba=class extends bi{dtype="expression";data;constructor(e,t){super(e,t),this.data=t.data}};function dn(n,e){let t=e.dtype;return t==="float64"||t==="float32"||t==="uint8"||t==="int32"?new ha(n,e):t==="bool"?new xa(n,e):t==="complex64"||t==="complex128"?new ya(n,e):new ba(n,e)}function $n(n){return n.symbol?.startsWith("_")??(n.operator==="Wildcard"||n.operator==="WildcardSequence"||n.operator==="WildcardOptionalSequence")}function Fn(n){if(n.symbol?.startsWith("_"))return n.symbol;if(n.nops===1){let e=n.op1;if(n.operator==="Wildcard")return`_${e}`;if(n.operator==="WildcardSequence")return`__${e}`;if(n.operator==="WildcardOptionalSequence")return`___${e}`}return n.operator==="Wildcard"?"_":n.operator==="WildcardSequence"?"__":n.operator==="WildcardOptionalSequence"?"___":null}var br=class n extends W{constructor(t,i,r){super(t,r?.metadata);this.input=i;this.options=r;let o=$m(t,"List",i.ops,i.shape,i.dtype);if(!o)throw new Error("Invalid tensor");this._tensor=dn(t,o)}_tensor;_expression;get structural(){return this._expression??=this._tensor.expression,this._expression}get tensor(){return this._tensor}get baseDefinition(){return this.structural.baseDefinition}get operatorDefinition(){return this.structural.operatorDefinition}get hash(){return cn("BoxedTensor")}get canonical(){return this}get isCanonical(){return this._tensor?!0:this._expression.isCanonical}get isPure(){return this._tensor?!0:this.structural.isPure}get isValid(){return this._tensor?!0:this.structural.isValid}get complexity(){return 97}get operator(){return"List"}get nops(){return this._tensor?this._tensor.shape[0]:this.structural.nops}get ops(){return this.structural.ops}get op1(){if(this._tensor){let t=this._tensor.data;return t.length===0?this.engine.Nothing:this.engine.box(t[0])}return this.structural.op1}get op2(){if(this._tensor){let t=this._tensor.data;return t.length<2?this.engine.Nothing:this.engine.box(t[1])}return this.structural.op2}get op3(){if(this._tensor){let t=this._tensor.data;return t.length<3?this.engine.Nothing:this.engine.box(t[2])}return this.structural.op3}neg(){return this.structural.neg()}inv(){return this.engine.One.div(this.structural)}abs(){return this.structural.abs()}add(t){return this.structural.add(t)}sub(t){return this.structural.sub(t)}mul(t){return this.structural.mul(t)}div(t){return this.structural.div(t)}pow(t){return this.structural.pow(t)}root(t){return this.structural.root(t)}sqrt(){return this.structural.sqrt()}get shape(){return this.tensor.shape}get rank(){try{return this.tensor.rank}catch{}return 0}get type(){return new S(this.isValid?A("list<number>"):"error")}get json(){return this.structural.json}isEqual(t){return this===t?!0:t instanceof n?this.tensor.equals(t.tensor):this.structural.isEqual(t)}get isCollection(){return!0}get isIndexedCollection(){return!0}xcontains(t){return["float64","float32","int32","uint8"].includes(this.tensor.dtype)?this.tensor.data.includes(t.re):this.tensor.data.some(i=>t.isSame(this.tensor.field.cast(i,"expression")??t.engine.Nothing))}get xsize(){return this.tensor.shape.reduce((t,i)=>t*i,1)}each(){let t=this.tensor.shape,i=this.tensor.rank;if(i===0)return function*(o){yield o}(this);let r=t[0];return i===1?function*(o){for(let s=1;s<=r;s+=1){let a=o.tensor.data,u=s-1;u>=0&&u<a.length&&(yield o.engine.box(a[u]))}}(this):function*(o){for(let s=1;s<=r;s+=1){let a=o.tensor.slice(s-1);yield new n(o.engine,{ops:a.expression.ops,shape:a.shape,dtype:a.dtype})}}(this)}at(t){let i=this.tensor.slice(t);if(i.rank===0)return this.engine.box(i.data[0]);if(i.rank===1)return this.engine.box(i.data[0]);if(i.rank>1)return new n(this.engine,{ops:i.expression.ops,shape:i.shape,dtype:i.dtype})}match(t,i){return Xn(t)||(t=this.engine.box(t,{canonical:!1})),$n(t)?{[Fn(t)]:this}:this.structural.match(t,i)}evaluate(t){return this._tensor&&this._tensor.dtype!=="expression"?this:this.structural.evaluate(t)}simplify(t){return this._tensor&&this._tensor.dtype!=="expression"?this:this.structural.simplify(t)}N(){return this._tensor&&this._tensor.dtype!=="expression"?this:this.structural.N()}};function pn(n){return n instanceof br}function Hc(n,e){let t,i=[],r=!0,o=(s,a=0)=>{if(!r)return;let u=s.length;if(u===0)return;if(i[a]===void 0)i[a]=u;else if(i[a]!==u){r=!1;return}let l=0;for(let f of s)f.operator===n&&l++;let c=u-l;if(l>0&&c>0){r=!1;return}if(l===u){for(let f of s)if(o(f.ops,a+1),!r)return}else for(let f of s)t=So(t,Zc(f))};return o(e),r?{shape:i,dtype:t}:void 0}function $m(n,e,t,i,r){let o=!0,s=[],a=_o(n,"expression"),u=a.cast.bind(a),l=(c,f=0)=>{if(c.length!==0){if(i[f]===void 0)i[f]=c.length;else if(i[f]!==c.length){o=!1;return}for(let d of c){if(!o)return;if(d.operator===e)l(d.ops,f+1);else{let p=u(d,r);if(p===void 0){o=!1;return}s.push(p)}}}};if(l(t),!!o)return{shape:i,rank:i.length,data:s,dtype:r}}var Wc=[{Matrix:{complexity:9e3,lazy:!0,signature:"(matrix, string?, string?) -> matrix",type:([n])=>n.type,canonical:Fm,evaluate:(n,e)=>n[0].evaluate(e)},Vector:{complexity:9e3,lazy:!0,signature:"(number+) -> vector",type:n=>A(`vector<${n.length}>`,n[0].engine._typeResolver),canonical:(n,{engine:e})=>e._fn("Matrix",[e.function("List",n.map(t=>e.function("List",[t])))])}},{Shape:{complexity:8200,signature:"(value) -> tuple",evaluate:([n],{engine:e})=>e.tuple(...n.shape)},Rank:{description:"The length of the shape of the expression. Note this is not the matrix rank (the number of linearly independent rows or columns in the matrix)",complexity:8200,signature:"(value) -> number",sgn:()=>"positive",evaluate:([n],{engine:e})=>e.number(n.rank)},Reshape:{complexity:8200,signature:"(list<number>, tuple) -> value",type:([n,e])=>{if(!n.type.matches("list"))return"nothing";let t=n.type.type;return E(t.elements,"number")?A(`list<number^${e.ops.map(i=>i.toString()).join("x")}>`):"nothing"},evaluate:(n,{engine:e})=>{let t=n[0],i=n[1].ops?.map(r=>r.re)??[];if(!pn(t)&&pe(t)&&(t=e.function("List",[...t.each()])),pn(t))return i.join("x")===t.shape.join("x")?t:t.tensor.reshape(...i).expression}},Flatten:{complexity:8200,signature:"(value) -> list",evaluate:(n,{engine:e})=>{let t=n[0];if(pn(t))return e.box(["List",...t.tensor.flatten().map(i=>e.box(i))]);if(pe(t))return e.function("List",[...t.each()])}},Transpose:{complexity:8200,signature:"(matrix|vector, axis1: integer?, axis2: integer?) -> matrix",evaluate:(n,{engine:e})=>{let t=n[0],i=1,r=2;if(n.length===3&&(i=n[1].re,r=n[2].re,i>0&&r>0),i!==r&&(!pn(t)&&pe(t)&&(t=e.function("List",[...t.each()])),pn(t)))return i===1&&r===2?t.tensor.transpose()?.expression:t.tensor.transpose(i,r)?.expression}},ConjugateTranspose:{complexity:8200,signature:"(tensor, axis1: integer?, axis2: integer?) -> matrix",evaluate:n=>{let e=n[0],t=1,i=2;if(n.length===3&&(t=n[1].re,i=n[2].re,t>0&&i>0),t!==i&&pn(e))return e.tensor.conjugateTranspose(t,i)?.expression}},Determinant:{complexity:8200,signature:"(matrix) -> number",evaluate:n=>{let e=n[0];if(pn(e))return e.tensor.determinant()}},Inverse:{complexity:8200,signature:"(matrix) -> matrix",type:([n])=>n.type,evaluate:([n])=>{if(pn(n))return n.tensor.inverse()?.expression}},PseudoInverse:{complexity:8200,signature:"(matrix) -> matrix",evaluate:([n])=>{if(pn(n))return n.tensor.pseudoInverse()?.expression}},AdjugateMatrix:{complexity:8200,signature:"(matrix) -> matrix",evaluate:n=>{let e=n[0];if(pn(e))return e.tensor.adjugateMatrix()?.expression}},Trace:{complexity:8200,signature:"(matrix) -> number",evaluate:n=>{let e=n[0];if(pn(e))return e.tensor.trace()}}}];function Fm(n,{engine:e}){let t="Matrix";if(n.length===0)return e._fn(t,[]);let i=n[0].operator==="Vector"?n[0].canonical.ops[0]:n[0].canonical,r=n[1]?.canonical,o=n[2]?.canonical;return n.length>3?e._fn(t,Xe(e,n,3)):o?e._fn(t,[i,r,o]):r?e._fn(t,[i,r]):e._fn(t,[i])}var Jc={True:{wikidata:"Q16751793",type:"boolean",isConstant:!0},False:{wikidata:"Q5432619",type:"boolean",isConstant:!0},And:{wikidata:"Q191081",broadcastable:!0,associative:!0,commutative:!0,idempotent:!0,complexity:1e4,signature:"(boolean+) -> boolean",evaluate:Yc},Or:{wikidata:"Q1651704",broadcastable:!0,associative:!0,commutative:!0,idempotent:!0,complexity:1e4,signature:"(boolean+) -> boolean",evaluate:Qc},Not:{wikidata:"Q190558",broadcastable:!0,involution:!0,complexity:10100,signature:"(boolean) -> boolean",evaluate:Xc},Equivalent:{wikidata:"Q220433",broadcastable:!0,complexity:10200,signature:"(boolean, boolean) -> boolean",canonical:(n,{engine:e})=>{let t=n[0].symbol,i=n[1].symbol;return t==="True"&&i==="True"||t==="False"&&i==="False"?e.True:t==="True"&&i==="False"||t==="False"&&i==="True"?e.False:e._fn("Equivalent",n)},evaluate:Kc},Implies:{wikidata:"Q7881229",broadcastable:!0,complexity:10200,signature:"(boolean, boolean) -> boolean",evaluate:ef},Exists:{signature:"function",lazy:!0},NotExists:{signature:"function",lazy:!0},ExistsUnique:{signature:"function",lazy:!0},ForAll:{signature:"function",lazy:!0},NotForAll:{signature:"function",lazy:!0},KroneckerDelta:{description:"Return 1 if the arguments are equal, 0 otherwise",signature:"(value+) -> integer",evaluate:(n,{engine:e})=>{if(n.length===1)return n[0].symbol==="True"?e.One:e.Zero;if(n.length===2)return n[0].isEqual(n[1])?e.One:e.Zero;for(let t=1;t<n.length;t++)if(!n[t].isEqual(n[0]))return e.Zero;return e.One}},Boole:{description:"Return 1 if the argument is true, 0 otherwise. Also known as the Iverson bracket",signature:"(boolean) -> integer",evaluate:(n,{engine:e})=>n[0].symbol==="True"?e.One:e.Zero}};function Yc(n,{engine:e}){if(n.length===0)return e.True;let t=[];for(let i of n){if(i.symbol==="False")return e.False;if(i.symbol!=="True"){let r=!1;for(let o of t)if(o.isSame(i))r=!0;else if(i.operator==="Not"&&i.op1.isSame(o)||o.operator==="Not"&&o.op1.isSame(i))return e.False;r||t.push(i)}}return t.length===0?e.True:t.length===1?t[0]:e._fn("And",t)}function Qc(n,{engine:e}){if(n.length===0)return e.True;let t=[];for(let i of n){if(i.symbol==="True")return e.True;if(i.symbol!=="False"){let r=!1;for(let o of t)if(o.isSame(i))r=!0;else if(i.operator==="Not"&&i.op1.isSame(o)||o.operator==="Not"&&o.op1.isSame(i))return e.True;r||t.push(i)}}return t.length===0?e.False:t.length===1?t[0]:e._fn("Or",t)}function Xc(n,{engine:e}){let t=n[0]?.symbol;if(t==="True")return e.False;if(t==="False")return e.True}function Kc(n,{engine:e}){let t=n[0].symbol,i=n[1].symbol;if(t==="True"&&i==="True"||t==="False"&&i==="False")return e.True;if(t==="True"&&i==="False"||t==="False"&&i==="True")return e.False}function ef(n,{engine:e}){let t=n[0].symbol,i=n[1].symbol;if(t==="True"&&i==="True"||t==="False"&&i==="False"||t==="False"&&i==="True")return e.True;if(t==="True"&&i==="False")return e.False}function nf(n){let e={And:Yc,Or:Qc,Not:Xc,Equivalent:Kc,Implies:ef}[n.operator]?.(n.engine,n.ops);if(e)return{value:e,because:"logic"}}var tf=[{Totient:{wikidata:"Q190026",description:"Euler\u2019s totient function \u03C6(n): count of positive integers \u2264 n that are coprime to n.",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null||t<1)return;let i=1n;for(let r=2n;r<t;r++)St(r,t)===1n&&i++;return e.number(i)}},Sigma0:{description:"Number of positive divisors of n.",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null||t<1)return;let i=0;for(let r=1n;r<=t;r++)t%r===0n&&i++;return e.number(i)}},Sigma1:{description:"Sum of positive divisors of n.",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null||t<1)return;let i=e.bignum(0);for(let r=1n;r<=t;r++)t%r===0n&&(i=i.add(e.bignum(r)));return e.number(i)}},SigmaMinus1:{description:"Sum of reciprocals of positive divisors of n.",signature:"(integer) -> number",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null||t<1)return;let i=e.bignum(0);for(let r=1n;r<=t;r++)t%r===0n&&(i=i.add(e.bignum(1).div(e.bignum(r))));return e.number(i)}},IsPerfect:{wikidata:"Q170043",description:'Returns "True" if n is a perfect number, a positive integer which equals the sum of all its divisors.',signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null||t<1)return;let i=0n;for(let r=1n;r<t;r++)t%r===0n&&(i+=r);return e.symbol(i===t?"True":"False")}},Eulerian:{description:"Eulerian number A(n, m): number of permutations of {1..n} with exactly m ascents.",signature:"(integer, integer) -> integer",evaluate:([n,e],{engine:t})=>{let i=ye(n),r=ye(e);if(i===null||r===null||i<0n||r<0n||r>=i)return;let o=(s,a)=>a===0n?1n:a>=s?0n:(a+1n)*o(s-1n,a)+(s-a)*o(s-1n,a-1n);return t.number(o(i,r))}},Stirling:{description:"Stirling number of the second kind S(n, m): ways to partition n elements into m non-empty subsets.",signature:"(integer, integer) -> integer",evaluate:([n,e],{engine:t})=>{let i=ye(n),r=ye(e);if(i===null||r===null||i<0n||r<0n||r>i)return;let o=(s,a)=>s===0n&&a===0n?1n:s===0n||a===0n?0n:o(s-1n,a-1n)+a*o(s-1n,a);return t.number(o(i,r))}},NPartition:{description:"Number of integer partitions of n.",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null||t<0n)return;let i=new Map,r=o=>{if(o===0n)return 1n;if(o<0n)return 0n;if(i.has(o))return i.get(o);let s=0n;for(let a=1n;;a++){let u=a*(3n*a-1n)/2n,l=a*(3n*a+1n)/2n;if(u>o&&l>o)break;let c=a%2n===0n?-1n:1n;s+=c*(r(o-u)+r(o-l))}return i.set(o,s),s};return e.number(r(t))}},IsTriangular:{description:"True if n is a triangular number.",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null||t<1n)return e.False;let i=8n*t+1n,r=BigInt(Ci.sqrt(e.bignum(i)).toFixed(0));return e.symbol(r*r===i&&(r-1n)%2n===0n?"True":"False")}},IsSquare:{description:"True if n is a perfect square.",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null||t<0n)return e.False;let i=BigInt(Ci.sqrt(e.bignum(t)).toFixed(0));return e.symbol(i*i===t?"True":"False")}},IsOctahedral:{description:"True if n is an octahedral number.",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null||t<1n)return e.False;let i=3n*t+1n,r=BigInt(Ci.sqrt(e.bignum(i)).toFixed(0));return e.symbol(r*r===i?"True":"False")}},IsCenteredSquare:{description:"True if n is a centered square number.",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null||t<1n||(t-1n)%4n!==0n)return e.False;let i=(t-1n)/4n,r=BigInt(Ci.sqrt(e.bignum(i)).toFixed(0));return e.symbol(r*r*4n+1n===t?"True":"False")}},IsHappy:{wikidata:"Q44535",description:"True if n is a happy number, a number which eventually reaches 1 when the number is replaced by the sum of the square of each digit",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=new Set,i=ye(n);if(i===null)return e.False;for(;!t.has(i);){if(i===1n)return e.True;t.add(i),i=Vm(i)}return e.False}},IsAbundant:{description:"True if n is an abundant number (sum of divisors > 2n).",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=ye(n);if(t===null||t<1n)return e.False;let i=1n;for(let r=2n;r*r<=t;r++)if(t%r===0n){i+=r;let o=t/r;o!==r&&(i+=o)}return e.symbol(i>t?"True":"False")}}}];function Vm(n){return n.toString().split("").map(e=>BigInt(e)).reduce((e,t)=>e+t*t,0n)}function Er(n){let e=n.engine,t=n.operator;if(Je(t))return e.function(t,n.ops.map(Er));if(t==="Divide")return n.ops[0].div(n.ops[1]);if(t==="Negate")return Er(n.ops[0]).neg();if(t==="Add"){let[i,r]=n.ops.reduce((o,s)=>(s.operator==="Divide"?(o[0].push(s.ops[0]),o[1].push(s.ops[1])):o[0].push(s),o),[[],[]]);return H(...i).div(H(...r))}return n}function gt(n){let e=n.operator;if(Je(e)){let t=Oe.from(n.op1),i=Oe.from(n.op2),[r,o]=dc(t,i),s=r.sgn()===-1;return r.isOne||(t.div(r),i.div(r)),o.is(1)||(o.isPositive?(t.div(o),i.div(o)):o.isNegative&&(t.div(o.neg()),i.div(o.neg()),s=!s)),s&&([t,i]=[i,t]),n.engine.function(e,[t.asExpression(),i.asExpression()])}if(e==="Negate")return gt(n.ops[0]).neg();if(e==="Add"){let t=n.engine,i,r=[];for(let s of n.ops){let[a,u]=s.toNumericValue();i=i?i.gcd(a):a,a.isZero||r.push({coeff:a,term:u})}if(!i||i.isOne)return n;let o=r.map(({coeff:s,term:a})=>ae(a,t.box(s.div(i))));return ae(t.number(i),H(...o))}return Oe.from(Er(n)).asExpression()}function Ea(n,e,t,i){let r=n.engine;return n.operator===t?r.box([i,...n.ops.map(o=>Ea(o,e,t,i))]):e.operator===t?r.box([i,...e.ops.map(o=>Ea(n,o,t,i))]):r.box([i,n,e])}function rf(n,e="Add",t="Multiply"){if(n.operator!==t)return n;let i=n.ops;return!i||i.length<2?n:n.engine.box([e,i.slice(1).reduce((r,o)=>Ea(r,o,e,t),i[0])])}var of=[{Expand:{description:"Expand out products and positive integer powers",lazy:!0,signature:"(value)-> value",evaluate:([n])=>Ze(n.canonical)??n.canonical},ExpandAll:{description:"Recursively expand out products and positive integer powers",lazy:!0,signature:"(value)-> value",evaluate:([n])=>cr(n.canonical)??n.canonical},Factor:{description:"Factors an algebraic expression into a product of irreducible factors",lazy:!0,signature:"(value)-> value",evaluate:([n])=>gt(n.canonical)??n.canonical},Together:{description:"Combine rational expressions into a single fraction",lazy:!0,signature:"(value)-> value",evaluate:([n])=>Er(n.canonical)},Distribute:{description:"Distribute multiplication over addition",lazy:!0,signature:"(value)-> value",evaluate:([n])=>n&&rf(n.canonical)}}];var af={Congruent:{description:"Indicate that two expressions are congruent modulo a number",complexity:11e3,signature:"(number, number, modulo: integer) -> boolean",evaluate:(n,{engine:e})=>{if(n.length<3)return;let[t,i,r]=n,o=t.value,s=i.value,a=r.value;if(typeof o=="number"&&typeof s=="number"&&typeof a=="number")return o%a===s%a?e.True:e.False}},IsSame:{description:"Compare two expressions for structural equality",lazy:!0,signature:"(any, any) -> boolean",evaluate:(n,{engine:e})=>{if(n.length!==2)return;let[t,i]=n;return t.isSame(i)?e.True:e.False}},Equal:{complexity:11e3,signature:"(any, any) -> boolean",lazy:!0,canonical:(n,{engine:e})=>ce(e,"Equal",n),eq:(n,e)=>n.operator!==e.operator?!1:n.op1.sub(n.op2).N().isEqual(e.op1.sub(e.op2).N()),evaluate:(n,{engine:e})=>{if(n.length<2)return e.True;let t;for(let i of n)if(!t)t=i;else if(no(t,i)!==!0)return e.False;return e.True}},NotEqual:{wikidata:"Q28113351",complexity:11e3,signature:"(any, any) -> boolean",canonical:(n,{engine:e})=>ce(e,"NotEqual",n),eq:(n,e)=>n.operator!==e.operator?!1:!!(n.op1.isEqual(e.op1)&&n.op2.isEqual(e.op2)||n.op1.isEqual(e.op2)&&n.op2.isEqual(e.op1)),evaluate:(n,{engine:e})=>{if(n.length<2)return e.False;let t;for(let i of n)if(!t)t=i;else if(t.isEqual(i)===!0)return e.False;return e.True}},Less:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>ce(e,"Less",n),eq:(n,e)=>sf(n,e,"Greater"),evaluate:(n,{engine:e})=>{if(n.length===2){let[i,r]=n,o=i.isLess(r);return o===void 0?void 0:o?e.True:e.False}if(n.length<2)return e.True;let t;for(let i of n)if(!t)t=i;else{let r=i.isLess(t);if(r===void 0)return;if(r===!1)return e.False;t=i}return e.True}},NotLess:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[ce(e,"Less",n)])},Greater:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>ce(e,"Less",[...n].reverse())},NotGreater:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[e._fn("Greater",n)])},LessEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>ce(e,"LessEqual",n),eq:(n,e)=>sf(n,e,"LessGreater"),evaluate:(n,{engine:e})=>{if(n.length===2){let[i,r]=n,o=i.isLessEqual(r);return o===void 0?void 0:o?e.True:e.False}if(n.length<2)return e.True;let t;for(let i of n)if(!t)t=i;else{let r=i.isLessEqual(t);if(r===void 0)return;if(r===!1)return e.False;t=i}return e.True}},NotLessNotEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[ce(e,"LessEqual",n)])},GreaterEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>ce(e,"LessEqual",[...n].reverse())},NotGreaterNotEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[ce(e,"GreaterEqual",n)])},TildeFullEqual:{description:"Indicate isomorphism, congruence and homotopic equivalence",signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>ce(e,"TildeFullEqual",n)},NotTildeFullEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[ce(e,"TildeFullEqual",n)])},TildeEqual:{description:"Approximately or asymptotically equal",complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>ce(e,"TildeEqual",n)},NotTildeEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[ce(e,"TildeEqual",n)])},Approx:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>ce(e,"Approx",n)},NotApprox:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[ce(e,"Approx",n)])},ApproxEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>ce(e,"ApproxEqual",n)},NotApproxEqual:{complexity:11100,canonical:(n,{engine:e})=>e._fn("Not",[ce(e,"ApproxEqual",n)])},ApproxNotEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>ce(e,"ApproxNotEqual",n)},NotApproxNotEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[ce(e,"ApproxNotEqual",n)])},Precedes:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>ce(e,"Precedes",n)},NotPrecedes:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[ce(e,"Precedes",n)])},Succeeds:{signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>ce(e,"Succeeds",n)},NotSucceeds:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[ce(e,"Succeeds",n)])}};function ce(n,e,t){t=Q(t,e);let i=[],r=[];for(let o of t)Je(o.operator)?(i.push(o),r.push(o.ops[o.ops.length-1])):r.push(o);return i.length===0?n._fn(e,r):n._fn("And",[n._fn(e,r),...i])}function sf(n,e,t){return n.operator===e.operator?n.nops!==e.nops?!1:n.ops.every((i,r)=>i.isEqual(e.ops[r])):e.operator===t?n.nops!==e.nops?!1:n.ops.every((i,r)=>i.isEqual(e.ops[e.nops-1-r])):!1}var lf={EmptySet:{type:"set",isConstant:!0,wikidata:"Q226183",description:"The empty set, a set containing no elements.",eq:n=>n.type.matches("set")&&n.xsize===0,collection:{iterator:()=>({next:()=>({value:void 0,done:!0})}),count:()=>0,isEmpty:()=>!0,isFinite:()=>!0,contains:()=>!1,subsetOf:()=>!0,eltsgn:()=>{},elttype:()=>"never"}},Numbers:{type:"set<number>",isConstant:!0,description:"The set of all numbers.",collection:{iterator:va,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(n,e)=>e.type.matches("number"),subsetOf:(n,e,t)=>e.operator==="Range"||e.operator==="Linspace"?!0:e.type.matches(S.setNumber)&&(!t||e.symbol!=="Numbers"),eltsgn:()=>"unsigned",elttype:()=>"number"}},ComplexNumbers:{type:"set<finite_complex>",isConstant:!0,description:"The set of all finite complex numbers.",collection:{iterator:va,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(n,e)=>e.type.matches("finite_complex"),subsetOf:(n,e,t)=>e.operator==="Range"||e.operator==="Linspace"?!0:e.type.matches(S.setComplex)&&(!t||e.symbol!=="ComplexNumbers"),eltsgn:()=>"unsigned",elttype:()=>"finite_complex"}},ExtendedComplexNumbers:{type:"set<complex>",isConstant:!0,description:"The set of all complex numbers, including infinities.",collection:{iterator:va,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(n,e)=>e.type.matches("complex"),subsetOf:(n,e,t)=>e.operator==="Range"||e.operator==="Linspace"?!0:e.type.matches(S.setComplex)&&(!t||e.symbol!=="ComplexNumbers"),eltsgn:()=>"unsigned",elttype:()=>"complex"}},ImaginaryNumbers:{type:"set<imaginary>",isConstant:!0,description:"The set of all imaginary numbers.",collection:{iterator:Um,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(n,e)=>e.type.matches(S.setImaginary),subsetOf:(n,e,t)=>e.type.matches(S.setImaginary)&&(!t||e.symbol!=="ImaginaryNumbers"),eltsgn:()=>"unsigned",elttype:()=>"imaginary"}},RealNumbers:{type:"set<finite_real>",isConstant:!0,description:"The set of all finite real numbers.",collection:{iterator:n=>ht(n),contains:(n,e)=>e.type.matches("finite_real"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>e.type.matches(S.setReal)&&(!t||e.symbol!=="RealNumbers"),eltsgn:()=>{},elttype:()=>"finite_real"}},ExtendedRealNumbers:{type:"set<real>",isConstant:!0,description:"The set of all real numbers, including infinities.",collection:{iterator:n=>ht(n),contains:(n,e)=>e.type.matches("real"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>e.type.matches(S.setReal)&&(!t||e.symbol!=="ExtendedRealNumbers"),eltsgn:()=>{},elttype:()=>"real"}},Integers:{type:"set<finite_integer>",isConstant:!0,description:"The set of all finite integers.",collection:{iterator:uf,contains:(n,e)=>e.type.matches("finite_integer"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>e.operator==="Range"?!0:e.type.matches(S.setFiniteInteger)&&(!t||e.symbol!=="Integers"),eltsgn:()=>{},elttype:()=>"finite_integer"}},ExtendedIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all integers, including infinities.",collection:{iterator:uf,contains:(n,e)=>e.type.matches("integer"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>e.operator==="Range"?!0:e.type.matches(S.setInteger)&&(!t||e.symbol!=="ExtendedIntegers"),eltsgn:()=>{},elttype:()=>"integer"}},RationalNumbers:{type:"set<finite_rational>",isConstant:!0,description:"The set of all finite rational numbers.",collection:{iterator:n=>ht(n),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(n,e)=>e.type.matches("finite_rational"),subsetOf:(n,e,t)=>e.type.matches(S.setRational)&&(!t||e.symbol!=="RationalNumbers"),eltsgn:()=>{},elttype:()=>"finite_rational"}},ExtendedRationalNumbers:{type:"set<rational>",isConstant:!0,description:"The set of all rational numbers, including infinities.",collection:{iterator:n=>ht(n),contains:(n,e)=>e.type.matches("rational"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>e.type.matches(S.setRational)&&(!t||e.symbol!=="ExtendedRationalNumbers"),eltsgn:()=>{},elttype:()=>"rational"}},NegativeNumbers:{type:"set<real>",isConstant:!0,description:"The set of all negative real numbers.",collection:{iterator:n=>ht(n,{sign:"-",includeZero:!1}),count:()=>1/0,contains:(n,e)=>e.type.matches("real")&&e.isNegative===!0,subsetOf:(n,e,t)=>{if(e.operator==="Range"||e.operator==="Linspace"){let i=e.ops[0].re,r=e.ops[1].re;return i<0&&r<0}return e.type.matches(S.setReal)&&e.baseDefinition?.collection?.eltsgn?.(e)==="negative"&&(!t||e.symbol!=="NegativeNumbers")},eltsgn:()=>"negative",elttype:()=>"real"}},NonPositiveNumbers:{type:"set<real>",isConstant:!0,description:"The set of all non-positive real numbers.",collection:{iterator:n=>ht(n,{sign:"-",includeZero:!0}),contains:(n,e)=>e.type.matches("real")&&e.isNonPositive===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"||e.operator==="Linspace"){let i=e.ops[0].re,r=e.ops[1].re;return i>=0&&r>=0}return e.type.matches(S.setReal)&&e.baseDefinition?.collection?.eltsgn?.(e)==="non-positive"&&(!t||e.symbol!=="NonPositiveNumbers")},eltsgn:()=>"non-positive",elttype:()=>"real"}},NonNegativeNumbers:{type:"set<real>",isConstant:!0,description:"The set of all non-negative real numbers.",collection:{iterator:n=>ht(n,{sign:"+",includeZero:!0}),contains:(n,e)=>e.type.matches("real")&&e.isNonNegative===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"||e.operator==="Linspace"){let i=e.ops[0].re,r=e.ops[1].re;return i<=0&&r<=0}return e.type.matches(S.setReal)&&e.baseDefinition?.collection?.eltsgn?.(e)==="non-negative"&&(!t||e.symbol!=="NonNegativeNumbers")},eltsgn:()=>"non-negative",elttype:()=>"real"}},PositiveNumbers:{type:"set<real>",isConstant:!0,description:"The set of all positive real numbers.",collection:{iterator:n=>ht(n,{sign:"+",includeZero:!1}),contains:(n,e)=>e.type.matches("real")&&e.isPositive===!0,count:()=>1/0,subsetOf:(n,e,t)=>{if(e.operator==="Range"||e.operator==="Linspace"){let i=e.ops[0].re,r=e.ops[1].re;return i>0&&r>0}return e.type.matches(S.setReal)&&e.baseDefinition?.collection?.eltsgn?.(e)==="positive"&&(!t||e.symbol!=="PositiveNumbers")},eltsgn:()=>"positive",elttype:()=>"real"}},NegativeIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all negative integers.",collection:{iterator:n=>To(n.engine,-1,-1),contains:(n,e)=>e.type.matches("integer")&&e.isNegative===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"){let i=e.ops[0].re,r=e.ops[1].re;return i<0&&r<0}return e.type.matches(S.setInteger)&&e.baseDefinition?.collection?.eltsgn?.(e)==="negative"&&(!t||e.symbol!=="NegativeIntegers")},eltsgn:()=>"negative",elttype:()=>"integer"}},NonPositiveIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all non-positive integers.",collection:{iterator:n=>To(n.engine,0,-1),contains:(n,e)=>e.type.matches("integer")&&e.isNonPositive===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"){let i=e.ops[0].re,r=e.ops[1].re;return i<=0&&r<=0}return e.type.matches(S.setInteger)&&e.baseDefinition?.collection?.eltsgn?.(e)==="non-positive"&&(!t||e.symbol!=="NonPositiveIntegers")},eltsgn:()=>"non-positive",elttype:()=>"integer"}},NonNegativeIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all non-negative integers.",collection:{iterator:n=>To(n.engine,0,1),contains:(n,e)=>e.type.matches("integer")&&e.isNonNegative===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"){let i=e.ops[0].re,r=e.ops[1].re;return i>0&&r>0}return e.type.matches(S.setInteger)&&e.baseDefinition?.collection?.eltsgn?.(e)==="non-negative"&&(!t||e.symbol!=="NonNegativeIntegers")},eltsgn:()=>"non-negative",elttype:()=>"integer"}},PositiveIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all positive integers.",collection:{iterator:n=>To(n.engine,1,1),contains:(n,e)=>e.type.matches("integer")&&e.isPositive===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"){let i=e.ops[0].re,r=e.ops[1].re;return i>0&&r>0}return e.type.matches(S.setInteger)&&e.baseDefinition?.collection?.eltsgn?.(e)==="positive"&&(!t||e.symbol!=="PositiveIntegers")},eltsgn:()=>"positive",elttype:()=>"integer"}},Element:{complexity:11200,signature:"(value, collection) -> boolean",description:"Test whether a value is an element of a collection.",evaluate:([n,e],{engine:t})=>{let i=e.xcontains(n);if(i===!0)return t.True;if(i===!1)return t.False}},NotElement:{complexity:11200,signature:"(value, collection) -> boolean",description:"Test whether a value is not an element of a collection.",evaluate:([n,e],{engine:t})=>{let i=e.xcontains(n);if(i===!0)return t.False;if(i===!1)return t.True}},Subset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a strict subset of the second.",evaluate:([n,e],{engine:t})=>{let i=Vt(n,e);if(i===!0)return t.True;if(i===!1)return t.False}},SubsetEqual:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a subset (possibly equal) of the second.",evaluate:([n,e],{engine:t})=>{let i=Vt(n,e,!1);if(i===!0)return t.True;if(i===!1)return t.False}},NotSubset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is not a strict subset of the second.",evaluate:([n,e],{engine:t})=>{let i=Vt(n,e);if(i===!0)return t.False;if(i===!1)return t.True}},Superset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a strict superset of the second.",evaluate:([n,e],{engine:t})=>{let i=Vt(e,n);if(i===!0)return t.True;if(i===!1)return t.False}},SupersetEqual:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a superset (possibly equal) of the second.",evaluate:([n,e],{engine:t})=>{let i=Vt(e,n,!0);if(i===!0)return t.True;if(i===!1)return t.False}},NotSuperset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is not a strict superset of the second.",evaluate:([n,e],{engine:t})=>{let i=Vt(e,n);if(i===!0)return t.False;if(i===!1)return t.True}},NotSupersetEqual:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is not a superset (possibly equal) of the second.",evaluate:([n,e],{engine:t})=>{let i=Vt(e,n,!0);if(i===!0)return t.False;if(i===!1)return t.True}},Complement:{wikidata:"Q242767",signature:"(set+) -> set",description:"Return the elements of the first set that are not in any of the subsequent sets.",collection:{contains:(n,e)=>{let[t,...i]=n.ops;return(t.xcontains(e)??!1)&&i.every(r=>!r.xcontains(e))},count:n=>Bo(n,e=>n.ops.slice(1).every(t=>!t.xcontains(e))),iterator:Hm}},Intersection:{wikidata:"Q185837",signature:"(set+) -> set",description:"Return the intersection of two or more sets.",canonical:(n,{engine:e})=>n.length===0||n.length===1?e.symbol("EmptySet"):(n=yi(e,Q(n,"Intersection"),A("(set+) -> set"))??n,e._fn("Intersection",n)),evaluate:zm,collection:{contains:Qm,count:n=>Bo(n,e=>n.ops.slice(1).every(t=>t.xcontains(e))),iterator:Wm}},Union:{wikidata:"Q185359",signature:"(collection+) -> set",description:"Return the union of two or more collections as a set.",canonical:(n,{engine:e})=>n.length===0?e.symbol("EmptySet"):(n=yi(e,Q(n,"Union"),A("(collection+) -> set"))??n,e._fn("Union",n)),evaluate:qm,collection:{contains:(n,e)=>n.ops.some(t=>t.xcontains(e)),count:n=>Ym(n,(e,t)=>t.every(i=>!i.xcontains(e))),isEmpty:n=>n.ops.every(e=>e.isEmptyCollection),isFinite:n=>n.ops.every(e=>e.isFiniteCollection),iterator:jm}},SetMinus:{wikidata:"Q18192442",signature:"(set, value*) -> set",description:"Return the set difference between the first set and subsequent values.",evaluate:Gm,collection:{contains:(n,e)=>{let[t,...i]=n.ops;return(t.xcontains(e)??!1)&&!i.some(r=>r.isSame(e))},count:n=>Bo(n,e=>{let[t,...i]=n.ops;return!i.some(r=>r.isSame(e))}),iterator:Zm}},SymmetricDifference:{wikidata:"Q1147242",signature:"(set, set) -> set",description:"Return the symmetric difference of two sets (elements in either set but not both).",collection:{contains:(n,e)=>{let[t,i]=n.ops,r=t.xcontains(e)??!1,o=i.xcontains(e)??!1;return r&&!o||!r&&o},count:n=>Bo(n,e=>{let[t,i]=n.ops,r=t.xcontains(e)??!1,o=i.xcontains(e)??!1;return r&&!o||!r&&o}),iterator:Jm}}};function Vt(n,e,t=!0){return!n.isCollection||!e.isCollection?!1:!!n.baseDefinition?.collection?.subsetOf?.(n,e,t)}function qm(n,{engine:e}){let t=n.map(o=>o.isCollection?o:e.function("Set",[o]));if(t.reduce((o,s)=>o+(s.xsize??0),0)>dl)return e._fn("Union",t);let r=[];for(let o of t)for(let s of o.each())r.every(a=>!a.isSame(s))&&r.push(s);return r.length===0?e.symbol("EmptySet"):e._fn("Set",r)}function zm(n,{engine:e}){let t=[...n[0].ops??[]];for(let i of n.slice(1))pe(i)?t=t.filter(r=>[...i.each()].some(o=>r.isSame(o))):t=t.filter(r=>r.isSame(i));return t.length===0?e.symbol("EmptySet"):e._fn("Set",t)}function Gm(n,{engine:e}){return e.symbol("EmptySet")}function Um(n){let e=rs();return{next:()=>{let{value:t,done:i}=e.next();if(i)return{value:void 0,done:!0};let[r,o]=t;return{value:n.engine.number({re:0,im:r/o}),done:!1}}}}function va(n){let e=vu();return{next:()=>{let{value:t,done:i}=e.next();if(i)return{value:void 0,done:!0};let[r,o]=t;return{value:n.engine.number({re:r,im:o}),done:!1}}}}function*ht(n,e){let t=e?.sign??"+-",i=e?.includeZero??!0,r=t==="+-"?rs():Eu();i||r.next();for(let o of r)if(t==="+-")yield n.engine.number(o);else{let s=t==="-"?-1:1,[a,u]=o;yield n.engine.number([s*a,u])}}function*uf(n){for(let e of Nu())yield n.engine.number(e)}function*To(n,e,t){let i=e;for(;;)yield n.number(i),i+=t}function*jm(n){let e=[];for(let t of n.ops){for(let i of t.each())e.every(r=>!r.xcontains(i))&&(yield i);e.push(t)}}function*Zm(n){let[e,...t]=n.ops;for(let i of e.each())t.some(r=>r.isSame(i))||(yield i)}function*Hm(n){let[e,...t]=n.ops;for(let i of e.each())t.every(r=>!r.xcontains(i))&&(yield i)}function*Wm(n){for(let e of n.ops[0].each())n.ops.slice(1).every(t=>t.xcontains(e))&&(yield e)}function*Jm(n){let[e,t]=n.ops;for(let i of e.each())(t.xcontains(i)??!1)||(yield i);for(let i of t.each())(e.xcontains(i)??!1)||(yield i)}function Bo(n,e){if(n.ops.some(i=>i.xsize===1/0))return 1/0;let t=0;for(let i of n.ops[0].each())e(i)&&(t+=1);return t}function Ym(n,e){if(n.ops.some(r=>r.xsize===1/0))return 1/0;let t=[],i=0;for(let r of n.ops){for(let o of r.each())e(o,t)&&(i+=1);t.push(r)}return i}function Qm(n,e){return n.ops.every(t=>t.xcontains(e)??!1)}var cf=[{Erf:{complexity:7500,signature:"(number) -> number",evaluate:(n,{engine:e})=>{let t=n[0].re;if(Number.isFinite(t))return e.number(qs(t))}},Erfc:{complexity:7500,signature:"(number) -> number",evaluate:(n,{engine:e})=>{let t=n[0].re;if(Number.isFinite(t))return e.number(1-qs(t))}},ErfInv:{complexity:7500,signature:"(number) -> number",evaluate:(n,{engine:e})=>{let t=n[0].re;if(Number.isFinite(t))return e.number(Ol(t))}}},{Mean:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",description:"The most frequently occurring value in the collection.",evaluate:(n,{engine:e})=>e.number(me(e)?$l(e.bignum.bind(e),Tn(n)):Ki(Sn(n)))},Median:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",description:"The most frequently occurring value in the collection.",examples:["Mode([1, 2, 2, 3])  // Returns 2"],evaluate:(n,{engine:e})=>e.number(me(e)?Ct(Tn(n)):Pn(Sn(n)))},Variance:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(me(e)?Us(e.bignum.bind(e),Tn(n)):At(Sn(n)))},PopulationVariance:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(me(e)?js(e.bignum.bind(e),Tn(n)):Dt(Sn(n)))},StandardDeviation:{complexity:1200,broadcastable:!1,description:"Sample Standard Deviation of a collection of numbers.",signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(me(e)?Us(e.bignum.bind(e),Tn(n)).sqrt():Math.sqrt(At(Sn(n))))},PopulationStandardDeviation:{complexity:1200,broadcastable:!1,description:"Population Standard Deviation of a collection of numbers.",signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(me(e)?js(e.bignum.bind(e),Tn(n)).sqrt():Math.sqrt(Dt(Sn(n))))},Kurtosis:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(me(e)?Fl(e.bignum.bind(e),Tn(n)):er(Sn(n)))},Skewness:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(me(e)?Vl(e.bignum.bind(e),Tn(n)):nr(Sn(n)))},Mode:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(me(e)?ql(e.bignum.bind(e),Tn(n)):tr(Sn(n)))},Quartiles:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> tuple<mid:number, lower:number, upper:number>",examples:["Quartiles([1, 2, 3, 4, 5])  // Returns (3, 2, 4)"],evaluate:(n,{engine:e})=>{let[t,i,r]=(me(e)?zl(Tn(n)):ir(Sn(n))).map(o=>e.number(o));return e.tuple(t,i,r)}},InterquartileRange:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(me(e)?Gl(Tn(n)):rr(Sn(n)))},Histogram:{description:"Compute a histogram of the values in a collection. Returns a list of (bin start, count) tuples.",complexity:8200,signature:"(collection, integer | list<number>) -> list<tuple<number, integer>>",examples:["Histogram([1, 2, 2, 3], 3)  // Returns [(1,1), (1.6667,2), (2.3333,1)]"],evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=Array.from(n.each()).map(u=>u.re).filter(Number.isFinite);if(i.length===0)return;let r=Math.min(...i),o=Math.max(...i),s;if(e?.operator==="List")s=e.ops.map(u=>u.re);else{let u=P(e);if(u===null||u<=0)return;let l=(o-r)/u;s=Array.from({length:u+1},(c,f)=>r+f*l)}let a=Array(s.length-1).fill(0);for(let u of i)for(let l=0;l<s.length-1;l++)if(u>=s[l]&&u<s[l+1]){a[l]++;break}return t.function("List",a.map((u,l)=>t._fn("Tuple",[t.number(s[l]),t.number(u)])))}},BinCounts:{description:"Count the number of elements falling into each bin.",complexity:8200,signature:"(collection, integer | list<number>) -> list<number>",examples:["BinCounts([1, 2, 2, 3], 3)  // Returns [1, 2, 1]"],evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=Array.from(n.each()).map(u=>u.re).filter(Number.isFinite);if(i.length===0)return;let r=Math.min(...i),o=Math.max(...i),s;if(e.isCollection)s=[...e.each()].map(u=>u.re);else{let u=P(e);if(u===null||u<=0)return;let l=(o-r)/u;s=Array.from({length:u+1},(c,f)=>r+f*l)}let a=Array(s.length-1).fill(0);for(let u of i)for(let l=0;l<s.length-1;l++)if(u>=s[l]&&u<s[l+1]){a[l]++;break}return t.function("List",a.map(u=>t.number(u)))}},SlidingWindow:{description:"Return overlapping sliding windows of fixed size over the collection.",complexity:8200,signature:"(collection, integer, integer?) -> list<list>",examples:["SlidingWindow([1, 2, 3, 4], 2)  // Returns [[1,2], [2,3], [3,4]]"],evaluate:([n,e,t],{engine:i})=>{if(!n.isFiniteCollection)return;let r=P(e),o=t?P(t):1;if(r===null||r<=0||o===null||o<=0)return;let s=Array.from(n.each()),a=[];for(let u=0;u<=s.length-r;u+=o)a.push(i.function("List",s.slice(u,u+r)));return i.function("List",a)}}},{Sample:{description:"Return a random sample of k elements from the collection, without replacement.",complexity:8200,signature:"(collection, integer) -> list",evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=P(e);if(i===null||i<0)return;let r=Array.from(n.each());if(i>r.length)return;for(let s=r.length-1;s>0;s--){let a=Math.floor(Math.random()*(s+1));[r[s],r[a]]=[r[a],r[s]]}let o=r.slice(0,i);return t.function("List",o)}}}];function*ff(n){for(let e of n)e.isFiniteCollection?yield*e.each():yield e}function*Sn(n){for(let e of ff(n))yield e.re}function*Tn(n){for(let e of ff(n))yield e.bignumRe??e.engine.bignum(e.re)}var Xm={Sin:[[1,"Sin"],[1,"Cos"],[-1,"Sin"],[-1,"Cos"]],Cos:[[1,"Cos"],[-1,"Sin"],[-1,"Cos"],[1,"Sin"]],Sec:[[1,"Sec"],[-1,"Csc"],[-1,"Sec"],[1,"Csc"]],Csc:[[1,"Csc"],[1,"Sec"],[-1,"Csc"],[-1,"Sec"]],Tan:[[1,"Tan"],[-1,"Cot"],[1,"Tan"],[-1,"Cot"]],Cot:[[1,"Cot"],[-1,"Tan"],[1,"Cot"],[-1,"Tan"]]},yt=["Sqrt",2],Ei=["Sqrt",3],vi=["Sqrt",5],Io=["Sqrt",6],Km=[[[0,1],{Sin:0,Cos:1,Tan:0,Cot:"ComplexInfinity",Sec:1,Csc:"ComplexInfinity"}],[[1,12],{Sin:["Divide",["Subtract",Io,yt],4],Cos:["Divide",["Add",Io,yt],4],Tan:["Subtract",2,Ei],Cot:["Add",2,Ei],Sec:["Subtract",Io,yt],Csc:["Add",Io,yt]}],[[1,10],{Sin:["Divide",["Subtract",vi,1],4],Cos:["Divide",["Sqrt",["Add",10,["Multiply",2,vi]]],4],Tan:["Divide",["Sqrt",["Subtract",25,["Multiply",10,vi]]],5],Cot:["Sqrt",["Add",5,["Multiply",2,vi]]],Sec:["Divide",["Sqrt",["Subtract",50,["Multiply",10,vi]]],5],Csc:["Add",1,vi]}],[[1,8],{Sin:"$\\frac{\\sqrt{2-\\sqrt2}}{2}$",Cos:"$\\frac{\\sqrt {2+{\\sqrt {2}}}}{2}$",Tan:"$\\sqrt{2} - 1$",Cot:"$\\sqrt{2} + 1$",Sec:"$\\sqrt{ 4 - 2\\sqrt{2}}$",Csc:"$\\sqrt{ 4 + 2\\sqrt{2}}$"}],[[1,6],{Sin:"$\\frac{1}{2}$",Cos:"$\\frac{\\sqrt{3}}{2}$",Tan:"$\\frac{\\sqrt{3}}{3}$",Cot:"$\\sqrt{3}$",Sec:"$\\frac{2\\sqrt{3}}{3}$",Csc:2}],[[1,5],{Sin:"$\\frac{\\sqrt{10- 2\\sqrt{5}}} {4}$",Cos:"$\\frac{1+ \\sqrt{5}} {4}$",Tan:"$\\sqrt{5-2\\sqrt5}$",Cot:"$\\frac{\\sqrt{25+10\\sqrt5}} {5}$",Sec:"$\\sqrt{5} - 1$",Csc:"$\\frac{\\sqrt{50+10\\sqrt{5}}} {5}$"}],[[1,4],{Sin:["Divide",yt,2],Cos:["Divide",yt,2],Tan:1,Cot:1,Sec:yt,Csc:yt}],[[3,10],{Sin:"$\\frac{1+ \\sqrt5} {4}$",Cos:"$\\frac{\\sqrt{10- 2\\sqrt5}} {4}$",Tan:"$\\frac{\\sqrt{25+10\\sqrt5}} {5}$",Cot:"$\\sqrt{5-2\\sqrt5}$",Sec:"$\\frac{\\sqrt{50+10\\sqrt5}} {5}$",Csc:"$\\sqrt5-1$"}],[[1,3],{Sin:["Divide",Ei,2],Cos:"Half",Tan:Ei,Cot:["Divide",Ei,3],Sec:2,Csc:["Divide",["Multiply",2,Ei],3]}],[[3,8],{Sin:"$\\frac{ \\sqrt{2 + \\sqrt{2}} } {2}$",Cos:"$\\frac{ \\sqrt{2 - \\sqrt{2}} } {2}$",Tan:"$\\sqrt{2} + 1$",Cot:"$\\sqrt{2} - 1$",Sec:"$\\sqrt{ 4 + 2 \\sqrt{2} }$",Csc:"$\\sqrt{ 4 - 2 \\sqrt{2} }$"}],[[2,5],{Sin:"$\\frac{\\sqrt{10+ 2\\sqrt{5}}} {4}$",Cos:"$\\frac{\\sqrt{5}-1} {4}$",Tan:"$\\sqrt{5+2\\sqrt{5}}$",Cot:"$\\frac{\\sqrt{25-10\\sqrt{5}}} {5}$",Sec:"$1 + \\sqrt{5}$",Csc:"$\\frac{\\sqrt{50-10\\sqrt{5}}} {5}$"}],[[5,12],{Sin:"$\\frac{\\sqrt{6} + \\sqrt{2}} {4}$",Cos:"$\\frac{ \\sqrt{6} - \\sqrt{2}} {4}$",Tan:"$2+\\sqrt{3}$",Cot:"$2-\\sqrt{3}$",Sec:"$\\sqrt{6}+\\sqrt{2}$",Csc:"$\\sqrt{6} - \\sqrt{2}$"}],[[1,2],{Sin:1,Cos:0,Tan:"ComplexInfinity",Cot:0,Sec:"ComplexInfinity",Csc:1}]];function mn(n,e,t,i){let r=ao(n)?.N();if(r!==void 0)return re(r,e,t,i)}function gn(n){if(!n)return n;let e=n.engine,t=e.angularUnit;if(t==="rad")return n;let i=n.N().re;return Number.isNaN(i)?n:t==="deg"?e.number(i*(180/Math.PI)):t==="grad"?e.number(i*(200/Math.PI)):t==="turn"?e.number(i/(2*Math.PI)):n}function vr(n,e){if(!e)return;let t=e.engine;switch(n){case"Arccos":return gn(re(e,Math.acos,i=>i.acos(),i=>i.acos()));case"Arccot":return gn(re(e,i=>Math.atan2(1,i),i=>M.atan2(t._BIGNUM_ONE,i),i=>i.inverse().atan()));case"Arccsc":return gn(re(e,i=>Math.asin(1/i),i=>t._BIGNUM_ONE.div(i).asin(),i=>i.inverse().asin()));case"Arccosh":return gn(re(e,Math.acosh,i=>i.acosh(),i=>i.acosh()));case"Arccoth":return gn(re(e,i=>Math.log((1+i)/(i-1))/2,i=>t._BIGNUM_ONE.add(i).div(i.sub(t._BIGNUM_ONE)).log().div(2),i=>t.complex(1).add(i).div(i.sub(1)).log().div(2)));case"Arccsch":return gn(re(e,i=>Math.log(1/i+Math.sqrt(1/(i*i)+1)),i=>t._BIGNUM_ONE.div(i.mul(i)).add(t._BIGNUM_ONE).sqrt().add(t._BIGNUM_ONE.div(i)).log(),i=>i.mul(i).inverse().add(1).sqrt().add(i.inverse()).log()));case"Arcsec":return gn(re(e,i=>Math.acos(1/i),i=>t._BIGNUM_ONE.div(i).acos(),i=>i.inverse().acos()));case"Arcsin":return gn(re(e,Math.asin,i=>i.asin(),i=>i.asin()));case"Arcsech":return gn(re(e,i=>Math.log((1+Math.sqrt(1-i*i))/i),i=>t._BIGNUM_ONE.sub(i.mul(i).add(t._BIGNUM_ONE).div(i)).log(),i=>t.complex(1).sub(i.mul(i)).add(1).div(i).log()));case"Arcsinh":return gn(re(e,Math.asinh,i=>i.asinh(),i=>i.asinh()));case"Arctan":return gn(re(e,Math.atan,i=>i.atan(),i=>i.atan()));case"Arctanh":return gn(re(e,Math.atanh,i=>i.atanh(),i=>i.atanh()));case"Cos":return mn(e,Math.cos,i=>t.chop(i.cos()),i=>i.cos());case"Cosh":return mn(e,Math.cosh,i=>i.cosh(),i=>i.cosh());case"Cot":return mn(e,i=>1/Math.tan(i),i=>t._BIGNUM_ONE.div(i.tan()),i=>i.tan().inverse());case"Coth":return mn(e,i=>1/Math.tanh(i),i=>t._BIGNUM_ONE.div(i.tanh()),i=>i.tanh().inverse());case"Csc":return mn(e,i=>1/Math.sin(i),i=>t._BIGNUM_ONE.div(i.sin()),i=>i.sin().inverse());case"Csch":return mn(e,i=>1/Math.sinh(i),i=>t._BIGNUM_ONE.div(i.sinh()),i=>i.sinh().inverse());case"Sec":return mn(e,i=>1/Math.cos(i),i=>t._BIGNUM_ONE.div(i.cos()),i=>i.cos().inverse());case"Sech":return mn(e,i=>1/Math.cosh(i),i=>t._BIGNUM_ONE.div(i.cosh()),i=>i.cosh().inverse());case"Sin":return mn(e,Math.sin,i=>t.chop(i.sin()),i=>i.sin());case"Sinh":return mn(e,Math.sinh,i=>i.sinh(),i=>i.sinh());case"Tan":return mn(e,r=>{let o=Math.tan(r);return o>1e6||o<-1e6?t.ComplexInfinity:o},r=>{let o=r.tan();return o.greaterThan(1e6)||o.lessThan(-1e6)?t.ComplexInfinity:o},r=>r.tan());case"Tanh":return mn(e,Math.tanh,i=>i.tanh(),i=>i.tanh())}}function eg(n){return!!(n.startsWith("Ar")&&Na(n))}function Na(n){return{Sin:"Arcsin",Cos:"Arccos",Tan:"Arctan",Sec:"Arcsec",Csc:" Arccsc",Sinh:"Arcsinh",Cosh:"Arccosh",Tanh:"Arctanh",Sech:"Arcsech",Csch:"Arccsch",Arccosh:"Cosh",Arccos:"Cos",Arccsc:"Csc",Arccsch:"Csch",Arcsec:"Sec",Arcsin:"Sin",Arcsinh:"Sinh",Arctan:"Tan",Arctanh:"Tanh"}[n]}function Nr(n,e){if(e.length!==1||!e[0].isValid)return;let t=e[0];if(t.operator==="InverseFunction")return t.op1.canonical;let i=t.symbol;if(typeof i!="string")return;let r=Na(i);return r?n.symbol(r):void 0}function df(n){return n!=="Cos"&&n!=="Sec"?-1:1}function ng(n,e,t,i){if(!t)return;let r=t.N().re;if(Number.isNaN(r))return;let o=Na(e),s=n._cache("constructible-inverse-trigonometric-values-"+e,()=>{let u=[];for(let[[l,c],f]of i){let d=f[o];if(d===void 0)continue;let p=d.N().re;Number.isNaN(p)||u.push([[d,p],[l,c]])}return u},u=>{for(let[[l,c],[f,d]]of u)l.reset();return u}),a=0;r<0&&(a=df(o)==-1?-1:1,r=-r,t=t.neg());for(let[[u,l],[c,f]]of s)if(n.chop(r-l)===0){let d=n.Pi.mul(c).div(f);return a==-1?d=d.neg():a==1&&(d=n.Pi.sub(d)),d.evaluate()}}function _a(n,e){let[t,i]=tg(e);if(t!==void 0)return i!==void 0&&((n==="Sin"||n==="Tan")&&(i===0||i===2)||(n==="Cos"||n==="Cot")&&(i===1||i===3))?"zero":{Sin:["positive","positive","negative","negative"],Cos:["positive","negative","negative","positive"],Sec:["positive","negative","negative","positive"],Csc:["positive","positive","negative","negative"],Tan:["positive","negative","positive","negative"],Cot:["positive","negative","positive","negative"]}[n]?.[t]}function Sa(n){return["Sin","Cos","Tan","Csc","Sec","Cot"].includes(typeof n=="string"?n:n.operator)}function _r(n,e){if(!e||!Sa(n))return;let t=e.engine;if(e=e.N(),e.im!==0)return;let i=e.re;if(Number.isNaN(i))return;let r=t._cache("constructible-trigonometric-values",()=>Km.map(([l,c])=>[l,Object.fromEntries(Object.entries(c).map(([f,d])=>[f,(t.parse(ut(d))??t.box(d)).simplify()]))]),l=>{for(let[c,f]of l)for(let d of Object.values(f))d.reset();return l});if(eg(n))return ng(t,n,e,r);let o=t.angularUnit;o!=="rad"&&(o==="deg"&&(i*=Math.PI/180),o==="grad"&&(i*=Math.PI/200),o==="turn"&&(i*=2*Math.PI));let s=df(n)==-1?Math.sign(i):1;i=Math.abs(i%(2*Math.PI));let a=Math.floor(i*2/Math.PI);i=i%(Math.PI/2);let u;[u,n]=Xm[n]?.[a]??[1,n];for(let[[l,c],f]of r){let d=f[n];if(d&&Math.abs(i-Math.PI*l/c)<=1e-12)return d.symbol==="ComplexInfinity"?d:s*u<0?d.neg():d}}function tg(n){if(!n.isValid||!n.isNumberLiteral)return[void 0,void 0];if(n.im!==0)return[void 0,void 0];let e=n.re;if(isNaN(e))return[void 0,void 0];let t=(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI);return Math.abs(t)<1e-12?[1,0]:Math.abs(t-Math.PI/2)<1e-12?[2,1]:Math.abs(t-Math.PI)<1e-12?[3,2]:Math.abs(t-3*Math.PI/2)<1e-12?[4,3]:[Math.floor(t/(Math.PI/2))+1,void 0]}var pf=[{Pi:{type:"finite_real",isConstant:!0,holdUntil:"N",wikidata:"Q167",value:n=>n.number(me(n)?n._BIGNUM_PI:Math.PI)}},{Degrees:{signature:"(real) -> real",canonical:(n,{engine:e})=>{let t=e;if(t.angularUnit==="deg")return n[0];if(n.length!==1)return t._fn("Degrees",n);let i=n[0];if(i.numericValue===null||!i.isValid)return t._fn("Degrees",n);let r=i.re;if(Number.isNaN(r))return i.mul(t.Pi).div(180);if(r=r%360,r<0&&(r+=360),Number.isInteger(r)){let o=ui([r,180]);return o[0]===0?t.Zero:o[0]===1&&o[1]===1?t.Pi:o[0]===1?t.Pi.div(o[1]):t.number(o).mul(t.Pi)}return t.number(r).div(180).mul(t.Pi)},evaluate:(n,e)=>e.engine.angularUnit==="deg"?n[0]:n[0].mul(e.engine.Pi.div(180)).evaluate(e)},Hypot:{broadcastable:!0,signature:"(real, real) -> real",sgn:()=>"non-negative",evaluate:([n,e],{engine:t})=>t.box(["Sqrt",["Add",["Square",n],["Square",e]]])},Sin:fe("Sin",5e3)},{Arctan:{wikidata:"Q2257242",complexity:5200,broadcastable:!0,signature:"(number) -> finite_real",sgn:([n])=>_a("Arctan",n),evaluate:([n],{numericApproximation:e})=>e?vr("Arctan",n):_r("Arctan",n)??vr("Arctan",n)},Arctan2:{wikidata:"Q776598",complexity:5200,broadcastable:!0,signature:"(y:number, x: number) -> real",evaluate:([n,e],{engine:t,numericApproximation:i})=>i?Rn(n,e,Math.atan2,(r,o)=>M.atan2(r,o)):n.isFinite===!1&&e.isFinite===!1?t.NaN:n.is(0)&&e.is(0)?t.Zero:e.isFinite===!1?e.isPositive?t.Zero:t.Pi:n.isFinite===!1?n.isPositive?t.Pi.div(2):t.Pi.div(-2):n.is(0)?e.isPositive?t.Zero:t.Pi:t.function("Arctan",[n.div(e)]).evaluate()},Cos:fe("Cos",5050),Tan:fe("Tan",5100)},{Arccosh:fe("Arccosh",6200),Arcsin:fe("Arcsin",5500),Arcsinh:fe("Arcsinh",6100),Arctanh:fe("Arctanh",6300),Cosh:fe("Cosh",6050),Cot:fe("Cot",5600),Csc:fe("Csc",5600,"Cosecant"),Sec:fe("Sec",5600,"Secant, inverse of cosine"),Sinh:fe("Sinh",6e3),Haversine:{wikidata:"Q2528380",broadcastable:!0,signature:"(real) -> number",evaluate:([n],{engine:e})=>e.box(["Divide",["Subtract",1,["Cos",n]],2])},InverseHaversine:{broadcastable:!0,signature:"(real) -> real",evaluate:([n],{engine:e})=>e.box(["Multiply",2,["Arcsin",["Sqrt",n]]])}},{Csch:fe("Csch",6200,"Hyperbolic cosecant"),Sech:fe("Sech",6200,"Hyperbolic secant"),Tanh:fe("Tanh",6200,"Hyperbolic tangent")},{Arccos:fe("Arccos",5550),Arccot:fe("Arccot",5650),Arccoth:fe("Arccoth",6350),Arccsch:fe("Arccsch",6250),Arcsec:fe("Arcsec",5650),Arcsech:fe("Arcsech",6250),Arccsc:fe("Arccsc",5650),Coth:fe("Coth",6300),InverseFunction:{lazy:!0,signature:"(function) -> function",canonical:(n,{engine:e})=>(n=Xe(e,n,1),Nr(e,n)??e._fn("InverseFunction",n)),evaluate:(n,{engine:e})=>Nr(e,n)}}];function fe(n,e,t){return{complexity:e,description:t,broadcastable:!0,signature:"(number) -> number",sgn:([i])=>_a(n,i),evaluate:([i],{numericApproximation:r})=>r?vr(n,i):_r(n,i)??vr(n,i)}}function Ta(n){if(n==="all")return Ta(["core","control-structures","logic","collections","relop","numeric","arithmetic","trigonometry","algebra","calculus","polynomials","combinatorics","number-theory","linear-algebra","statistics","dimensions","units","physics","other"]);typeof n=="string"&&(n=[n]);let e=[];for(let t of n){let i=ig[t];if(!i)throw Error(`Unknown library category ${t}`);Array.isArray(i)?e.push(...i):e.push(i)}return Object.freeze(e)}var ig={algebra:[],arithmetic:[...Nc,...Lc],calculus:Dc,collections:[lf,Dl],combinatorics:Pc,"control-structures":Rc,core:jc,dimensions:[],domains:[],"linear-algebra":Wc,logic:Jc,"number-theory":tf,numeric:[],other:[],relop:af,polynomials:of,physics:{Mu0:{description:"Vaccum permeability",isConstant:!0,wikidata:"Q1515261",type:"real",value:125663706212e-17}},statistics:cf,trigonometry:pf,units:[]};function rg(n){if(n=n.normalize(),Te(n))return n;throw new Error(`Invalid definition name "${n}": ${nn(n)}`)}function Ba(n,e){let t=n.context.lexicalScope.bindings;n.strict;for(let[i,r]of Object.entries(e))try{if(i=rg(i),pr(r))try{if(t.has(i))throw new Error(`Duplicate operator definition: "${i}"
${JSON.stringify(t.get(i),void 0,4)}
`);t.set(i,{operator:new kt(n,i,r)})}catch(o){console.error([`
Error in operator definition`,JSON.stringify(r,void 0,4),"",o.message].join(`
|   `)+`
`)}else if(mr(r))try{if(t.has(i))throw new Error(`The symbol "${i}" is already defined`);t.set(i,{value:new _n(n,i,r)})}catch(o){console.error([`
Error in value definition of "${i}"`,"",JSON.stringify(r,void 0,4),"",o.message].join(`
|   `))}else{let o=new _n(n,i,{value:n.box(r)});t.set(i,{value:o})}}catch(o){console.error([`
Error in definition of "${i}"`,"",JSON.stringify(r,void 0,4),"",o.message].join(`
|   `)+`
`)}}function wo(n){return typeof n=="number"?n===0?1:Number.isInteger(n)?Math.floor(Math.log2(Math.abs(n))/Math.log2(10))+(n>0?1:2):2:n.isZero?1:n.im!==0?wo(n.re)+wo(n.im)+1:wo(n.re)}function Ia(n){if(n.symbol)return 1;if(n.isNumberLiteral)return wo(n.numericValue);let e=n.operator,t=2;if(["Add"].includes(e))t=3;else if(["Subtract","Negate"].includes(e))t=4;else if(["Square","Sqrt"].includes(e))t=5;else{if(["Power","Root"].includes(e))return Ia(n.ops[1]);["Multiply"].includes(e)?t=7:["Divide"].includes(e)?t=8:["Ln","Exp","Log","Lb"].includes(e)?t=9:["Cos","Sin","Tan"].includes(e)?t=10:t=11}return t+(n.ops?.reduce((i,r)=>i+Ia(r),0)??0)}var wa=Ia;function we(n){for(let[e,t]of Object.entries(n))if(e!=="x"&&e!=="_x"&&t.has("_x"))return!1;return!0}var gf=[{match:["Multiply","_x","__a"],replace:0,id:"ax",condition:we},{match:["Add",["Divide","_a","_x"],"__b"],replace:1/0,useVariations:!0,condition:we},{match:["Add",["Multiply","_x","__a"],"__b"],replace:["Divide",["Negate","__b"],"__a"],useVariations:!0,condition:we},{match:["Add",["Multiply","_a",["Power","_x","_n"]],"__b"],replace:["Power",["Divide",["Negate","__b"],"_a"],["Divide",1,"_n"]],useVariations:!0,condition:n=>we(n)&&!n._n.is(0)},{match:["Add",["Multiply","_a",["Power","_x","_n"]],"__b"],replace:["Negate",["Power",["Divide",["Negate","__b"],"_a"],["Divide",1,"_n"]]],useVariations:!0,condition:n=>we(n)&&!n._n.is(0)&&(n._n.isEven??!1)},{match:["Add",["Multiply","__a",["Power","_x",2]],["Multiply","__b","_x"],"__c"],replace:["Divide",["Add",["Negate","__b"],["Sqrt",["Subtract",["Square","__b"],["Multiply",4,"__a","__c"]]]],["Multiply",2,"__a"]],useVariations:!0,condition:we},{match:["Add",["Multiply","__a",["Power","_x",2]],["Multiply","__b","_x"],"__c"],replace:["Divide",["Subtract",["Negate","__b"],["Sqrt",["Subtract",["Square","__b"],["Multiply",4,"__a","__c"]]]],["Multiply",2,"__a"]],useVariations:!0,condition:we},{id:"a^x + b = 0",match:["Add",["Power","_a","_x"],"__b"],replace:["Ln",["Negate","__b"],"_a"],useVariations:!0,onBeforeMatch:()=>{},condition:n=>we(n)&&(n._a.isPositive??!1)&&(n.__b.isNegative??!1)},{match:["Add",["Multiply","__a",["Exp",["Multiply","__b","_x"]]],"__c"],replace:["Divide",["Ln",["Negate",["Divide","__c","__a"]]],"__b"],useVariations:!0,condition:n=>we(n)&&((!n.__a.is(0)&&n.__c.div(n.__a).isNegative)??!1)},{match:["Add",["Multiply","__a",["Exp","_x"]],"__c"],replace:["Ln",["Negate",["Divide","__c","__a"]]],useVariations:!0,condition:n=>we(n)&&((!n.__a.is(0)&&n.__c.div(n.__a).isNegative)??!1)&&!n.__a.has("_x")&&!n.__c.has("_x")},{match:["Add",["Exp","_x"],"__c"],replace:["Ln",["Negate","__c"]],useVariations:!0,condition:n=>we(n)&&(n.__c.isNegative??!1)},{match:["Add",["Exp",["Multiply","__b","_x"]],"__c"],replace:["Divide",["Ln",["Negate","__c"]],"__b"],useVariations:!0,condition:n=>we(n)&&(n.__c.isNegative??!1)},{match:["Add",["Multiply","__a",["Log","_x","__b"]],"__c"],replace:["Power","__b",["Negate",["Divide","__c","__a"]]],useVariations:!0,condition:n=>(we(n)&&!n.__a.is(0)&&n.__b.isPositive)??!1},{match:["Multiply","__a",["Log","_x","__b"]],replace:["Power","__b",["Negate",["Divide","__c","__a"]]],useVariations:!0,condition:n=>(we(n)&&!n.__a.is(0)&&n.__b.isPositive)??!1},{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Divide",["Subtract","__b","__c"],"__a"],condition:we},{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Divide",["Negate",["Add","__b","__c"],"__a"]],condition:we},{match:"ax + \\mathrm{__b} \\sqrt{cx + \\mathrm{__d}} + \\mathrm{__g}",replace:"\\frac{-(2 a g - \\mathrm{__b}^2 c) + \\sqrt{(2 a \\mathrm{__g} - \\mathrm{__b}^2 c)^2 - 4 a^2(g^2 - b^2 \\mathrm{__d})}}{2 a^2}",useVariations:!0,condition:we},{match:"ax + \\mathrm{__b} \\sqrt{cx + \\mathrm{__d}} + \\mathrm{__g}",replace:"\\frac{-(2 a g - \\mathrm{__b}^2 c) - \\sqrt{(2 a \\mathrm{__g} - \\mathrm{__b}^2 c)^2 - 4 a^2(g^2 - b^2 \\mathrm{__d})}}{2 a^2}",useVariations:!0,condition:we}];function ko(n,e){let t=n.engine;n.operator==="Equal"?n=n.op1.expand().sub(n.op2.expand()).simplify():n=n.expand().simplify();let i=t.getRuleSet("solve-univariate"),r=[n.subs({[e]:"_x"},{canonical:!1})];t.pushScope(),t.declare("_x","number");let o=r.flatMap(s=>$t(s,i,{_x:t.symbol("_x")},{useVariations:!0,canonical:!0}));return o.length===0&&(r=r.flatMap(s=>mf(s)),o=r.flatMap(s=>$t(s,i,{_x:t.symbol(e)},{useVariations:!0,canonical:!0}))),o.length===0&&(r=r.flatMap(s=>Ze(s.canonical)).filter(s=>s!==null),r=r.flatMap(s=>mf(s)),o=r.flatMap(s=>$t(s,i,{_x:t.symbol(e)},{useVariations:!0,canonical:!0}))),t.popScope(),og(n,e,o.map(s=>s.evaluate().simplify()))}var hf=[{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Add",["Multiply","__a","_x"],"__b","__c"]},{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Add",["Negate",["Multiply","__a","_x"]],["Negate","__b"],"__c"]},{match:["Multiply","__a",["Power","_b","_n"]],replace:"_b",condition:({__a:n,_b:e,_n:t})=>!n.has("_x")&&e.has("_x")&&!t.is(0)&&!t.has("_x")},{match:["Multiply","__a",["Sqrt","_b"]],replace:["Multiply",["Square","_a"],"__b"],condition:({_b:n})=>n.has("_x")},{match:["Divide","_a","_b"],replace:"_a",condition:({_a:n,_b:e})=>n.has("_x")&&!e.is(0)},{match:["Multiply","__a","_b"],replace:"_b",condition:({__a:n,_b:e})=>!n.has("_x")&&e.has("_x")},{match:["Add",["Ln","_a"],["Ln","_b"],"__c"],replace:["Add",["Ln",["Multiply","_a","_b"]],"__c"]},{match:["Multiply",["Exp","__a"],["Exp","__b"],"__c"],replace:["Multiply",["Exp",["Add","_a","_b"]],"__c"]},{match:["Ln","_a"],replace:["Subtract","_a",1],condition:({_a:n})=>n.has("_x")},{match:["Sin","_a"],replace:"_a",condition:({_a:n})=>n.has("_x")},{match:["Cos","_a"],replace:["Subtract","_a",["Divide","Pi",2]],condition:({_a:n})=>n.has("_x")},{match:["Tan","_a"],replace:"_a",condition:({_a:n})=>n.has("_x")},{match:["Add",["Sin","_a"],["Cos","_a"]],replace:1,condition:({_a:n})=>n.has("_x")},{match:["Subtract",["Square",["Sin","_a"]],["Square",["Cos","_a"]]],replace:["PlusMinus",["Sin","_a"],["Divide",["Sqrt",2],2]],condition:({_a:n})=>n.has("_x")}];function mf(n){let e=n.engine,t=e.getRuleSet("harmonization");return $t(n,t,{_x:e.symbol("_x")})}function og(n,e,t){return t.filter(i=>{let r=n.subs({[e]:i}).canonical.evaluate();return r===null||!r.isValid||r.isNaN||r.has(e)?!1:r.isEqual(0)})}function Co(n,e){if(!n.ops)return[];let t=n.ops,i=n.operatorDefinition;if(!i||t.length===0)return t;let r=i?.associative?n.operator:"";if(t=lt(t,r),i.lazy)return t;let o=[];for(let s of t){let a=s.operator;if(a==="Hold")o.push(s);else{let u=a==="ReleaseHold"?s.op1:s;if(u){let l=e(u);l!==null&&o.push(l)}}}return lt(o,r)}async function yf(n,e){if(!n.ops)return[];let t=n.ops,i=n.operatorDefinition;if(!i||t.length===0)return t;let r=i?.associative?n.operator:"";if(t=lt(t,r),i.lazy)return t;let o=[];for(let s of t){let a=s.operator;if(a==="Hold")o.push(s);else{let u=a==="ReleaseHold"?s.op1:s;if(u){let l=await e(u);l!==null&&o.push(l)}}}return lt(o,r)}function xt(n,e,t){if((s=>t&&t.some(a=>a.value.isSame(s)))(n)||(t||(t=[{value:n,because:"initial"}]),!n.isValid))return t;if(!(n.isCanonical||n.isStructural)){let s=n.canonical;return s.isCanonical||s.isStructural?xt(s,e,t):t}let r=n.engine,o=e?.rules?r.rules(e.rules,{canonical:!0}):r.getRuleSet("standard-simplification");e={...e,rules:o};do{let s=ag(n,o,e,t);if(s.length<=t.length)break;n=s.at(-1).value,t=s}while(!t.slice(0,-1).some(s=>s.value.isSame(n)));return t}function sg(n,e,t){if(e==null||n===e||n.isSame(e))return!1;let i=n.engine;return t??=r=>i.costFunction(r),t(e)<=1.2*t(n)}function xf(n,e){return n.ops?n.engine.function(n.operator,Co(n,t=>xt(t,e).at(-1).value)):n}function ag(n,e,t,i){if(n.isNumberLiteral||n.string)return i;if(n.symbol){let s=et(n,e,{recursive:!1,canonical:!0,useVariations:!1});return s.length>0?[...i,...s]:i}let r=xf(n,t);r.isSame(n)||(i=[...i,{value:r,because:"simplified operands"}],n=r);let o=ug(n,e,t,i);return o.length>i.length?o:i}function ug(n,e,t,i){let r=et(n,e,{recursive:!1,canonical:!0,useVariations:t.useVariations??!1});if(r.length===0)return i;let o=r.at(-1).value;return o.isSame(n)||(o=xf(o),!sg(n,o,t?.costFunction))?i:(r.at(-1).value=o,[...i,...r])}function Ca(n){return typeof n=="string"?n.startsWith("_"):$n(n)?!0:n.ops?Ca(n.operator)||n.ops.some(Ca):!1}function Ao(n,e,t){return n.startsWith("_"),n==="_"||n==="__"||n==="___"?t:n in t?e.isSame(t[n])?t:null:Ca(e)?null:{...t,[n]:e}}function qt(n,e,t,i){if($n(e))return Ao(Fn(e),n,t);let r=i.acceptVariants??!0;if(i={...i,acceptVariants:!0},e.numericValue!==null)return n.numericValue===null?null:e.isEqual(n)?t:r?ka(n,e,t,i):null;let o=e.string;if(o!==null)return n.string===o?t:null;let s=e.symbol;if(s!==null)return s===n.symbol?t:r?ka(n,e,t,i):null;if(e.ops){let a=i.useVariations??!1,u=n.engine,l=null,c=e.operator;if(c.startsWith("_")?(l=Ao(c,u.box(n.operator),t),l!==null&&(l=Aa(n,e.ops,l,i))):c===n.operator&&(l=e.operatorDefinition.commutative?cg(n,e,t,i):Aa(n,e.ops,t,i)),l===null&&a){if(!r)return null;l=ka(n,e,t,i)}return l!==null&&(t=l),i.recursive&&n.ops&&(l=lg(n,e,t,{...i,acceptVariants:r})??l),l}return null}function lg(n,e,t,i){n.ops;let r=null;for(let o of n.ops){let s=qt(o,e,t,i);s!==null&&(r=s,t=s)}return r}function ka(n,e,t,i){if(!i.useVariations)return null;let r=n.engine,o={...i,acceptVariants:!1},s=(u,l)=>qt(r.function(u,l,{canonical:!1}),e,t,o),a=e.operator;if(a==="Negate"&&n.is(0))return qt(r.Zero,e.op1,t,o);if(a==="Add"){let u=s("Add",[0,n]);if(u!==null||(n.operator==="Subtract"&&(u=s("Add",[n.op1,["Negate",n.op2]])),u!==null))return u}if(a==="Subtract"){let u=s("Subtract",[n,0]);if(u!==null||(n.operator==="Negate"&&(u=s("Subtract",[0,n.op1])),u!==null))return u}if(a==="Multiply"){let u=s("Multiply",[1,n]);if(u!==null||n.operator==="Negate"&&(u=s("Multiply",[-1,n.op1]),u!==null)||n.operator==="Divide"&&(u=s("Multiply",[n.op1,["Divide",1,n.op2]]),u!==null))return u}if(a==="Divide"){let u=s("Divide",[n,1]);if(u!==null)return u}if(a==="Square"){let u=s("Power",[n,2]);if(u!==null)return u}if(a==="Exp"){let u=s("Power",[r.E,n]);if(u!==null)return u}if(a==="Power"){if(e.op2.re===2&&e.op2.im===0){let u=s("Square",[n]);if(u!==null)return u}if(e.op1.symbol==="ExponentialE"){let u=s("Exp",[n]);if(u!==null)return u}{let u=s("Power",[n,1]);if(u!==null)return u}}return null}function cg(n,e,t,i){n.operator,e.operator;let r=Yo(e.ops);for(let o of r){let s=Aa(n,o,t,i);if(s!==null)return s}return null}function Aa(n,e,t,i){if(e.length===0)return n.ops&&n.ops.length===0?t:null;let r=e[0].engine,o={...t},s=[...n.ops],a=0;for(;a<e.length;){let u=e[a],l=Fn(u);if(l!==null)if(l.startsWith("__")){let c=0;if(e[a+1]===void 0)c=s.length+1;else{let d=!1;for(;!d&&c<s.length;)d=qt(s[c],e[a+1],o,i)!==null,c+=1;if(!d&&l.startsWith("___"))return null}if(!l.startsWith("___")&&c<=1)return null;let f;if(c<=1)n.operator==="Add"?f=r.Zero:n.operator==="Multiply"?f=r.One:f=r.Nothing;else if(c===2){if(s.length===0)return null;f=s.shift()}else{let d=r.lookupDefinition(n.operator),p=s.splice(0,c-1);d&&Z(d)&&d.operator.associative?f=r.function(n.operator,p,{canonical:!1}):f=r.function("Sequence",p,{canonical:!1})}o=Ao(l,f,o)}else if(l.startsWith("_")){if(s.length===0)return null;o=Ao(l,s.shift(),o)}else o=qt(s.shift(),u,o,i);else{let c=s.shift();if(!c)return null;o=qt(c,u,o,i)}if(o===null)return null;a+=1}return s.length>0?null:o}function Ni(n,e,t){e=e.structural;let i=t?.useVariations??!1,r={recursive:t?.recursive??!1,useVariations:i,acceptVariants:i},o=t?.substitution??{};return qt(n.structural,e.structural,o,r)}function bf(n){let e=n.engine;if(n.operator==="Hold")return;let t;if(n.ops){let i=n.operatorDefinition;return i?.sgn&&(t=i.sgn(n.ops,{engine:e})),t}return n.symbol||n.isNumberLiteral?n.sgn:"unsigned"}function _i(n){if(n!==void 0){if(n==="positive")return!0;if(["non-positive","zero","negative"].includes(n))return!1}}function Si(n){if(n!==void 0){if(["positive","positive-infinity","non-negative","zero"].includes(n))return!0;if(n==="negative")return!1}}function Ti(n){if(n!==void 0){if(n==="negative")return!0;if(["non-negative","zero","positive"].includes(n))return!1}}function Bi(n){if(n!==void 0){if(["negative","non-positive","zero"].includes(n))return!0;if(["positive","positive-infinity"].includes(n))return!1}}function Da(n,e,t){return n.generation=e,n.value=t(),n.value}var fg=[5,5],he=class extends W{_operator;_ops;_def;_capturedContext;_localScope;_isPure;_isStructural;_hash;_value={value:null,generation:-1};_valueN={value:null,generation:-1};_sgn={value:null,generation:-1};_type={value:null,generation:-1};constructor(e,t,i,r){super(e,r?.metadata),this._operator=t,this._ops=i,this._localScope=r?.scope,this._isStructural=r?.structural??!1,(r?.canonical||this._isStructural)&&this.bind()}get hash(){if(this._hash!==void 0)return this._hash;let e=0;for(let t of this._ops)e=e<<1^t.hash|0;return e=e^cn(this._operator)|0,this._hash=e,e}infer(e,t){let i=this.operatorDefinition;return!i||!i.inferredSignature?!1:(i.signature.is("function")?i.signature=new S({kind:"signature",result:e},this.engine._typeResolver):Gr(i.signature.type)&&(i.signature=new S({kind:"signature",result:t==="narrow"?vt(i.signature.type.result,e):oe(i.signature.type.result,e)},this.engine._typeResolver)),this.engine._generation+=1,!0)}bind(){this._def=to(this._operator,this._localScope??this.engine.context.lexicalScope)}reset(){}get value(){}get isCanonical(){return this._def!==void 0&&this._def!==null}get isPure(){if(this._isPure!==void 0)return this._isPure;let e=this.operatorDefinition?.pure??!1;return e&&(e=this._ops.every(t=>t.isPure)),this._isPure=e,e}get isConstant(){return this.isPure&&this._ops.every(e=>e.isConstant)}get constantValue(){return this.isConstant?this.value:void 0}get json(){return[this._operator,...this.structural.ops.map(e=>e.json)]}get operator(){return this._operator}get ops(){return this._ops}get nops(){return this._ops.length}get op1(){return this._ops[0]??this.engine.Nothing}get op2(){return this._ops[1]??this.engine.Nothing}get op3(){return this._ops[2]??this.engine.Nothing}get isScoped(){return this._localScope!==void 0}get localScope(){return this._localScope}get isValid(){return this._operator==="Error"?!1:this._ops.every(e=>e?.isValid)}get canonical(){return this.isCanonical||!this.isValid?this:this.engine.function(this._operator,this._ops)}get structural(){if(this.isStructural)return this;let e=this.operatorDefinition;if(e?.associative||e?.commutative){let t=this.ops.map(r=>r.structural),i=[];if(!e.associative)i=t;else for(let r of t)r.operator===this.operator?i.push(...r.ops):i.push(r);return this.engine.function(this._operator,this.isValid?Ji(this._operator,i):i,{canonical:!1,structural:!0})}return this.engine.function(this._operator,this.ops.map(t=>t.structural),{canonical:!1,structural:!0})}get isStructural(){return this._isStructural}toNumericValue(){this.isCanonical||this.isStructural;let e=this.engine;if(this.operator==="Complex")return[e._numericValue({re:this.op1.re,im:this.op2.re}),e.One];let t=this;if(t.operator==="Add"&&(t=gt(this),t.numericValue!==null)){if(typeof t.numericValue=="number"){if(Number.isInteger(t.numericValue))return[e._numericValue(t.numericValue),e.One]}else if(t.numericValue.isExact)return[t.numericValue,e.One]}if(t.operator==="Negate"){let[i,r]=t.op1.toNumericValue();return[i.neg(),r]}if(t.operator==="Multiply"){let i=[],r=e._numericValue(1);for(let o of t.ops){let[s,a]=o.toNumericValue();r=r.mul(s),a.is(1)||i.push(a)}return i.length===0?[r,e.One]:i.length===1?[r,i[0]]:[r,_e(this.engine,i)]}if(t.operator==="Divide"){let[i,r]=t.op1.toNumericValue(),[o,s]=t.op2.toNumericValue(),a=i.div(o);return s.is(1)?[a,r]:[a,e.function("Divide",[r,s])]}if(t.operator==="Power"){if(t.op2.numericValue===null)return[e._numericValue(1),this];let[i,r]=t.op1.toNumericValue();if(i.isOne)return[i,this];let o=ee(t.op2);return o!==null?[i.pow(o),e.function("Power",[r,t.op2])]:t.op2.is(.5)?[i.sqrt(),e.function("Sqrt",[r])]:[e._numericValue(1),this]}if(t.operator==="Sqrt"){let[i,r]=t.op1.toNumericValue();return r.is(1)||r.is(0)?i.isOne||i.isZero?[i,r]:[i.sqrt(),r]:[i.sqrt(),e.function("Sqrt",[r])]}if(t.operator==="Root"){let i=t.op2.re;if(isNaN(i)||t.op2.im!==0)return[e._numericValue(1),this];let[r,o]=t.op1.toNumericValue();return i===2?[r.sqrt(),e.function("Sqrt",[o])]:[r.root(i),e.function("Root",[o,t.op2])]}if(t.operator==="Abs"){let[i,r]=t.op1.toNumericValue();return[i.abs(),e.function("Abs",[r])]}if(t.operator,t.operator,t.operator==="Log"||t.operator==="Ln"){let i=t.op2.re;isNaN(i)&&t.operator==="Log"&&(i=10);let[r,o]=t.op1.toNumericValue();return r.isOne?[r,this]:e.box(r.ln(i)).add(e.function(t.operator,[o,t.op2])).toNumericValue()}return[e._numericValue(1),t]}subs(e,t){t??={canonical:void 0},t.canonical===void 0&&(t={canonical:this.isCanonical});let i=this._ops.map(r=>r.subs(e,t));return i.every(r=>r.isValid)?this.engine.function(this._operator,i,t):this.engine.function(this._operator,i,{canonical:!1})}replace(e,t){return et(this,e,t).at(-1)?.value??null}match(e,t){return Ni(this,e,t)}has(e){if(typeof e=="string"){if(this._operator===e)return!0}else if(e.includes(this._operator))return!0;return this._ops.some(t=>t.has(e))}get sgn(){let e=this.isPure&&this._ops.every(t=>t.isConstant)?void 0:this.engine._generation;return Da(this._sgn,e,()=>{if(!(!this.isValid||this.isNumber!==!0))return bf(this)})}get isNaN(){if(!this.isNumber)return!1}get isInfinity(){if(!this.isNumber)return!1}get isFinite(){if(this.isNumber!==!0||this.isNaN||this.isInfinity)return!1;if(!(this.isNaN===void 0||this.isInfinity===void 0))return!0}get isOne(){if(this.isNonPositive===!0||this.isReal===!1)return!1}get isNegativeOne(){if(this.isNonNegative===!0||this.isReal===!1)return!1}get isPositive(){return _i(this.sgn)}get isNonNegative(){return Si(this.sgn)}get isNegative(){return Ti(this.sgn)}get isNonPositive(){return Bi(this.sgn)}get numerator(){return this.numeratorDenominator[0]}get denominator(){return this.numeratorDenominator[1]}get numeratorDenominator(){if(!this.isCanonical)return[this,this.engine.One];if(this.isNumber!==!0)return[this.engine.Nothing,this.engine.Nothing];let e=this.operator;if(e==="Divide")return[this.op1,this.op2];if(e==="Negate"){let[t,i]=this.op1.numeratorDenominator;return[t.neg(),i]}if(e==="Power"){let[t,i]=this.op1.numeratorDenominator;return[t.pow(this.op2),i.pow(this.op2)]}if(e==="Root"){let[t,i]=this.op1.numeratorDenominator;return[t.root(this.op2),i.root(this.op2)]}if(e==="Sqrt"){let[t,i]=this.op1.numeratorDenominator;return[t.sqrt(),i.sqrt()]}if(e==="Abs"){let[t,i]=this.op1.numeratorDenominator;return[t.abs(),i.abs()]}return e==="Multiply"?new Oe(this.engine,this.ops).asNumeratorDenominator():[this,this.engine.One]}neg(){if(!this.isCanonical)throw new Error("Not canonical");return Lt(this)}inv(){if(!this.isCanonical)throw new Error("Not canonical");if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.operator==="Sqrt")return this.op1.inv().sqrt();if(this.operator==="Divide")return this.op2.div(this.op1);if(this.operator==="Power"){let e=this.op2.neg();return e.operator!=="Negate"?this.op1.pow(e):this.engine.function("Power",[this.op1,e])}if(this.operator==="Root"){let e=this.op2.neg();return e.operator!=="Negate"?this.op1.root(e):this.engine.function("Root",[this.op1,e])}return this.operator==="Exp"?this.engine.E.pow(this.op1.neg()):this.operator==="Rational"?this.op2.div(this.op1):this.operator==="Negate"?this.op1.inv().neg():this.engine._fn("Divide",[this.engine.One,this])}abs(){if(!this.isCanonical)throw new Error("Not canonical");return this.operator==="Abs"||this.operator==="Negate"?this:this.isNonNegative?this:this.isNonPositive?this.neg():this.engine._fn("Abs",[this])}add(e){if(e===0)return this;if(!this.isCanonical)throw new Error("Not canonical");return H(this,this.engine.box(e))}mul(e){if(!this.isCanonical)throw new Error("Not canonical");if(e===0)return this.engine.Zero;if(e===1)return this;if(e===-1)return this.neg();if(e instanceof j){if(e.isZero)return this.engine.Zero;if(e.isOne)return this;if(e.isNegativeOne)return this.neg()}return ae(this,this.engine.box(e))}div(e){if(!this.isCanonical)throw new Error("Not canonical");return hi(this,e)}pow(e){return Ie(this,e,{numericApproximation:!1})}root(e){if(!this.isCanonical||typeof e!="number"&&!e.isCanonical)throw new Error("Not canonical");let t=typeof e=="number"?e:e.im===0?e.re:void 0;if(t===0)return this.engine.NaN;if(t===1)return this;if(t===-1)return this.inv();if(t===2)return this.engine.function("Sqrt",[this]);if(this.operator==="Power"&&t!==void 0){let[i,r]=this.ops;return i.pow(r.div(t))}if(this.operator==="Divide"){let[i,r]=this.ops;return i.root(e).div(r.root(e))}if(this.operator==="Negate"&&t!==void 0)return t%2===0?this.op1.root(e):this.op1.root(e).neg();if(this.operator==="Sqrt"){if(t!==void 0)return this.op1.root(t*2);if(typeof e!="number")return this.op1.root(e.mul(2))}if(this.operator==="Root"){let[i,r]=this.ops;return i.root(r.mul(e))}if(this.operator==="Multiply"){let i=this.ops.map(r=>r.root(e));return ae(...i)}if(this.isNumberLiteral){let i=this.numericValue;if(typeof i=="number"){if(i<0)return this.engine.NaN;if(i===0)return this.engine.Zero;if(i===1)return this.engine.One;if(t!==void 0){let r=this.engine.number(Math.pow(i,1/t));if(!r.isFinite||r.isInteger)return r}}else{if(i.isOne)return this.engine.One;if(i.isZero)return this.engine.Zero;if(t!==void 0){let r=i.root(t);if(r.isExact)return this.engine.number(r)}}}return this.engine._fn("Root",[this,this.engine.box(e)])}sqrt(){return this.root(2)}ln(e){let t=e?this.engine.box(e):void 0;if(!this.isCanonical)throw new Error("Not canonical");if(this.is(0))return this.engine.NegativeInfinity;if(this.operator==="Exp")return this.op1;if(t&&this.isSame(t))return this.engine.One;if(!t&&this.isSame(this.engine.E))return this.engine.One;if(this.operator==="Power"){let[i,r]=this.ops;return i.isSame(this.engine.E)?r:r.mul(i.ln(t))}if(this.operator==="Root"){let[i,r]=this.ops;return r.div(i.ln(t))}return this.operator==="Sqrt"?this.op1.ln(t).div(2):this.operator==="Divide"?this.op1.ln(t).sub(this.op2.ln(t)):t&&t.type.matches("finite_integer")?t.re===10?this.engine._fn("Log",[this]):this.engine._fn("Log",[this,t]):this.engine._fn("Ln",[this])}get complexity(){if(this.isCanonical)return this.operatorDefinition?.complexity??ct}get baseDefinition(){if(this._def)return Z(this._def)?this._def.operator:this._def.value}get operatorDefinition(){if(this._def)return Z(this._def)?this._def.operator:void 0}get valueDefinition(){if(this._def)return ne(this._def)?this._def.value:void 0}get isNumber(){if(!this.type.isUnknown)return E(this.type.type,"number")}get isInteger(){if(!this.type.isUnknown)return E(this.type.type,"integer")}get isRational(){if(!this.type.isUnknown)return E(this.type.type,"rational")}get isReal(){if(!this.type.isUnknown)return E(this.type.type,"real")}get isFunctionExpression(){return!0}get type(){let e=this.isPure&&this._ops.every(t=>t.isConstant)?void 0:this.engine._generation;return Da(this._type,e,()=>new S(dg(this),this.engine._typeResolver))??S.unknown}simplify(e){return xt(this,e).at(-1)?.value??this}evaluate(e){return pg(this.engine,this._computeValue(e))()}evaluateAsync(e){return mg(this.engine,this._computeValueAsync(e))()}N(){return this.evaluate({numericApproximation:!0})}solve(e){let t=fr(e??this.unknowns);return t.length!==1?null:ko(this,t[0])}get isCollection(){if(!this.isValid)return!1;let e=this.baseDefinition?.collection;return!e||e.count!==void 0&&e.iterator,e!==void 0}get isIndexedCollection(){return!this.isValid||!this.baseDefinition?.collection?.at?!1:this.type.matches("indexed_collection")}get isLazyCollection(){if(!this.isValid)return!1;let e=this.baseDefinition?.collection;return e?e?.isLazy?.(this)??!1:!1}xcontains(e){return this.baseDefinition?.collection?.contains?.(this,e)}get xsize(){return this.operatorDefinition?.collection?.count?.(this)}get isEmptyCollection(){if(this.isCollection)return this.operatorDefinition?.collection?.isEmpty?.(this)}get isFiniteCollection(){if(this.isCollection)return this.operatorDefinition?.collection?.isFinite?.(this)}each(){let e=this.operatorDefinition?.collection?.iterator?.(this);return e?function*(){let t=e.next(),i=0;for(;!t.done;)i+=1,yield t.value,t=e.next()}():function*(){}()}at(e){return this.operatorDefinition?.collection?.at?.(this,e)}get(e){if(typeof e=="string")return this.operatorDefinition?.collection?.at?.(this,e);if(e.string)return this.operatorDefinition?.collection?.at?.(this,e.string)}indexWhere(e){if(this.operatorDefinition?.collection?.indexWhere)return this.operatorDefinition.collection.indexWhere(this,e);if(!this.isIndexedCollection||!this.isFiniteCollection)return;let t=0;for(let i of this.each()){if(e(i))return t;t+=1}}subsetOf(e,t){return this.operatorDefinition?.collection?.subsetOf?.(this,e,t)??!1}_computeValue(e){return()=>{if(!this.isValid||!this._def)return this;let t=e?.numericApproximation??!1,i=e?.materialization??!1;if(ne(this._def))return Ef(this,this._def.value,e);let r=this._def.operator;if(r.broadcastable&&this.ops.some(u=>pe(u))){let u=Is(this._ops);if(!u)return this.engine.Nothing;let l=[];for(;;){let{done:c,value:f}=u.next();if(c)break;l.push(this.engine._fn(this.operator,f).evaluate(e))}return l.length===0?this.engine.Nothing:l.length===1?l[0]:this.engine._fn("List",l)}if(i!==!1&&!r.evaluate&&this.isLazyCollection)return gg(this,r,e);let o=Co(this,u=>u.evaluate(e)),s=this._localScope!==void 0||e?.withArguments;if(s&&(this.engine._pushEvalContext(this._localScope??{parent:this.engine.context?.lexicalScope,bindings:new Map}),e?.withArguments))for(let[u,l]of Object.entries(e.withArguments))this.engine.context.values[u]=l;let a=r.evaluate?.(o,{numericApproximation:t,engine:this.engine,materialization:i});return s&&this.engine._popEvalContext(),a??this.engine.function(this._operator,o)}}_computeValueAsync(e){return async()=>{if(!this.isValid||!this._def)return this;let t=e?.numericApproximation??!1;if(ne(this._def))return Ef(this,this._def.value,e);let i=this._def.operator;if(i?.broadcastable&&this.ops.some(l=>pe(l))){let l=Is(this._ops);if(!l)return this.engine.Nothing;let c=[];for(;;){let{done:f,value:d}=l.next();if(f)break;c.push(this.engine._fn(this.operator,d).evaluateAsync(e))}return c.length===0?this.engine.Nothing:c.length===1?c[0]:Promise.all(c).then(f=>this.engine._fn("List",f))}let r=await yf(this,async l=>await l.evaluateAsync(e)),o=this._localScope!==void 0||e?.withArguments;if(o&&(this.engine._pushEvalContext(this._localScope??{parent:this.engine.context?.lexicalScope,bindings:new Map}),e?.withArguments))for(let[l,c]of Object.entries(e.withArguments))this.engine.context.values[l]=c;let s=this.engine,a={numericApproximation:t,engine:s,signal:e?.signal,eager:e?.materialization},u=i.evaluateAsync?.(r,a)??i.evaluate?.(r,a);return o&&this.engine._popEvalContext(),Promise.resolve(u).then(l=>l??s.function(this._operator,r))}}};function dg(n){if(!n.isValid)return"error";if(n.operator==="Function"){let i=n.ops[0].type,r=n.ops.slice(1);return A(`(${r.map(o=>"unknown").join(", ")}) -> ${i}`,n.engine._typeResolver)}let e=n.operatorDefinition;if(e){let t=e.signature instanceof S?e.signature.type:typeof e.signature=="string"?A(e.signature,n.engine._typeResolver):e.signature,i=We(t)??"unknown";if(typeof e.type=="function"){let r=e.type(n.ops,{engine:n.engine});r&&(r instanceof S?i=r.type:i=A(r,n.engine._typeResolver)??i)}return i}return n.valueDefinition?We(n.valueDefinition.type.type)??"unknown":"unknown"}function pg(n,e){return()=>{if(n._deadline===void 0){n._deadline=Date.now()+n.timeLimit;let t=e();return n._deadline=void 0,t}return e()}}function mg(n,e){return async()=>{if(n._deadline===void 0){n._deadline=Date.now()+n.timeLimit;let t=await e();return n._deadline=void 0,t}return e()}}function Ef(n,e,t){let i=e.isConstant?e.value:n.engine._getSymbolValue(n.operator);if(i&&!i.type.matches("function"))return i.isValid?n.engine.typeError("function",i.type,i.toString()):n;let r=n.ops.map(o=>o.evaluate(t));return!i||i.type.isUnknown?n.engine.function(n.operator,r):An(i,r)}function gg(n,e,t){if(!n.isValid||t?.materialization===!1)return n;let i=t?.materialization??!1;typeof i=="boolean"&&(i=fg);let r=n.isIndexedCollection,o=n.isFiniteCollection,s=[];if(!n.isEmptyCollection)if(!r||!o){let u=typeof i=="number"?i:i[0],l=n.each();for(let c of l){if(s.length===u){l.next().done||s.push(n.engine.symbol("ContinuationPlaceholder"));break}s.push(c.evaluate(t))}}else{let[u,l]=typeof i=="number"?[Math.ceil(i/2),i-Math.ceil(i/2)]:i,c=1,f=n.each();for(let p of f)if(s.push(p.evaluate(t)),c+=1,c>u)break;let d=n.xsize;if(d===void 0||d<=u)(d===void 0||s.length<d)&&s.push(n.engine.symbol("ContinuationPlaceholder"));else{let p=Math.max(u+1,d-l+1);for(d>u+l&&s.push(n.engine.symbol("ContinuationPlaceholder")),c=p;c<=d;){let x=n.at(c);if(!x)break;s.push(x.evaluate(t)),c+=1}}}let a=e.collection?.elttype?.(n);return a&&E(a,"tuple<string, any>")?n.engine.function("Dictionary",s):r?n.engine._fn("List",s):n.engine.function("Set",[...s])}var bt=class n extends W{[Symbol.toStringTag]="[BoxedString]";_string;_utf8Buffer;_unicodeScalarValues;constructor(e,t,i){super(e,i),this._string=t.normalize()}get json(){return Ge(this._string)&&!tn(this._string)?this._string:`'${this._string}'`}get hash(){return cn("String"+this._string)}get operator(){return"String"}get isPure(){return!0}get isCanonical(){return!0}set isCanonical(e){}get value(){return this}get type(){return S.string}get complexity(){return 19}get string(){return this._string}get buffer(){if(this._utf8Buffer===void 0){let e=new TextEncoder;this._utf8Buffer=e.encode(this._string)}return this._utf8Buffer}get unicodeScalars(){return this._unicodeScalarValues===void 0&&(this._unicodeScalarValues=hg(this._string)),this._unicodeScalarValues}match(e,t){return Xn(e)||(e=this.engine.box(e,{canonical:!1})),$n(e)?{[Fn(e)]:this}:e instanceof n&&this._string===e._string?{}:null}};function hg(n){let e=[];for(let t=0;t<n.length;t++){let i=n.codePointAt(t);e.push(i),i>65535&&t++}return e}var Sr=class n extends W{[Symbol.toStringTag]="[BoxedDictionary]";_keyValues={};_type;constructor(e,t,i){super(e,i?.metadata),t instanceof W?this._initFromExpression(t,i):this._initFromRecord(t,i)}_initFromRecord(e,t){for(let i in e){if(typeof i!="string")throw new Error(`Dictionary keys must be strings, but got ${typeof i}`);if(i.length===0)throw new Error("Dictionary keys must not be empty strings");e[i]instanceof W?this._keyValues[i]=e[i]:this._keyValues[i]=this.engine.box(e[i],t)}}_initFromExpression(e,t){if(e instanceof n){Object.assign(this._keyValues,e._keyValues);return}if(e.operator==="Tuple"||e.operator==="Pair"||e.operator==="KeyValuePair"){if(e.nops!==2)throw new Error(`Expected a key/value pair, got ${e.nops} elements`);let[i,r]=e.ops,o;if(i.string)o=i.string;else if(i.symbol)o=i.symbol;else throw new Error(`Expected a string key, got ${i.type}`);this._keyValues[o]=r.canonical;return}if(e.operator==="Dictionary"){for(let i of e.ops)if(i.operator==="KeyValuePair"||i.operator==="Pair"||i.operator==="Tuple"){let[r,o]=i.ops,s;if(r.string)s=r.string;else if(r.symbol)s=r.symbol;else return;this._keyValues[s]=o.canonical}else throw new Error(`Expected a key/value pair, got ${i.type}`);return}}get json(){return["Dictionary",{dict:Object.fromEntries(Object.entries(this._keyValues).map(([e,t])=>[e,t.json]))}]}get hash(){return cn("Dictionary"+JSON.stringify(this._keyValues))}get operator(){return"Dictionary"}get type(){if(this._type)return this._type;let e=oe(...Object.values(this._keyValues).map(t=>t.type.type));return this._type=this.engine.type(`dictionary<${e}>`),this._type}get isPure(){return!0}get isCanonical(){return!0}set isCanonical(e){}get value(){}get complexity(){return 1e3}get isCollection(){return!0}get isIndexedCollection(){return!1}get isLazyCollection(){return!1}xcontains(e){}get xsize(){return Object.keys(this._keyValues).length}get isEmptyCollection(){return Object.keys(this._keyValues).length===0}get isFiniteCollection(){return!0}each(){let e=this.engine;return function*(t){for(let[i,r]of Object.entries(t._keyValues))yield e.tuple(e.string(i),r)}(this)}get(e){return this._keyValues[e]}has(e){return this._keyValues.hasOwnProperty(e)}get keys(){return Object.keys(this._keyValues)}get entries(){return Object.entries(this._keyValues)}get values(){return Object.values(this._keyValues)}match(e,t){if($n(e))return{[Fn(e)]:this};if(!(e instanceof n))return null;let i=null,r=Object.keys(e._keyValues);for(let o of r){if(!this._keyValues.hasOwnProperty(o))return null;let s=this._keyValues[o],a=e._keyValues[o];if(!s.match(a))return null;if($n(e._keyValues[o])){let u=Fn(e._keyValues[o]);u&&(i={...i??{},[u]:s})}}return i}};function Ma(n,e,t){if(e instanceof W)return e;if(e=V(e),typeof e=="string")return Bn(n,e,t);if(Array.isArray(e)){let[i,...r]=e;return new he(n,i,r.map(o=>Ma(n,o,t)),{canonical:!1})}if(typeof e=="object"){if("fn"in e)return Ma(n,e.fn,t);if("str"in e)return new bt(n,e.str);if("sym"in e)return Bn(n,e.sym,t);if("num"in e)return Bn(n,e.num,t)}return Bn(n,e,t)}function Do(n,e,t,i){if(i=i?{...i}:{},"canonical"in i||(i.canonical=!0),!Te(e))throw new Error(`Unexpected operator: "${e}" is not a valid symbol: ${nn(e)}`);let r=i.structural??!1;if(e==="Hold")return new he(n,"Hold",[Ma(n,t[0],i)],{...i,canonical:!0,structural:r});if(e==="Error"||e==="ErrorCode")return new he(n,e,t.map(s=>n.box(s,{canonical:!1})),{metadata:i?.metadata,canonical:!0});if(e==="Number"&&t.length===1)return Bn(n,t[0],i);if(r===!1&&i.canonical===!0){if((e==="Divide"||e==="Rational")&&t.length===2){let s=Qn(t[0]);if(s!==null){let a=Qn(t[1]);if(a!==null)return n.number([s,a],i)}e="Divide"}if(e==="Complex"){if(t.length===1){let s=t[0];if(s instanceof W&&s.isNumberLiteral)return n.number(n.complex(0,s.re),i);let a=R(t[0]);return a!==null&&a!==0?n.number(n.complex(0,a),i):n.box(s).mul(n.I)}if(t.length===2){let s=t[0]instanceof W?t[0].re:R(t[0]),a=t[1]instanceof W?t[1].re:R(t[1]);return a!==null&&s!==null&&!isNaN(a)&&!isNaN(s)?a===0&&s===0?n.Zero:a!==0?n.number(n._numericValue({re:s,im:a}),i):Bn(n,t[0],i):Bn(n,t[0],i).add(Bn(n,t[1],i).mul(n.I))}throw new Error("Expected one or two arguments with Complex expression")}if(e==="Negate"&&t.length===1){let s=t[0];if(typeof s=="number")return n.number(-s,i);if(s instanceof M)return n.number(s.neg(),i);let a=n.box(s,i),u=a.numericValue;if(u!==null)return n.number(typeof u=="number"?-u:u.neg(),i);t=[a]}}return i.canonical===!0?yg(n,e,t,i.metadata,i.scope):Ft(new he(n,e,t.map(s=>Bn(n,s,{canonical:i.canonical,structural:r,scope:i.scope})),{metadata:i.metadata,canonical:!1,structural:r,scope:i.scope}),i.canonical??!1,i.scope)}function Bn(n,e,t){if(e==null)return n.error("missing");if(e instanceof j)return bg(n,e);if(e instanceof W)return Ft(e,t?.canonical??!0,t?.scope);t=t?{...t}:{},"canonical"in t||(t.canonical=!0);let i=t.canonical===!0,r=t.structural??!1;if(Array.isArray(e)){if(typeof e[0]!="string")throw new Error(`The first element of an array should be a string (the function name): ${JSON.stringify(e,void 0,4)}`);return Ft(Do(n,e[0],e.slice(1),{canonical:i,structural:r,scope:t?.scope}),t?.canonical??!0,t?.scope)}if(typeof e=="number"||e instanceof M||e instanceof q)return n.number(e);if(typeof e=="string"){if(Ge(e)){let o=T(e);if(!o||!Te(o))return n.error("invalid-symbol",e);let s=i||t.canonical!==!1;return n.symbol(o,{canonical:s})}return tn(e)?n.number(e):(Hr(e),new bt(n,F(e)))}if(typeof e=="object"){if("fn"in e){let[o,...s]=e.fn;return Ft(Do(n,o,s,{canonical:i,structural:r}),t.canonical,t.scope)}if("str"in e)return new bt(n,e.str);if("sym"in e)return n.symbol(e.sym,{canonical:i});if("num"in e)return n.number(e,{canonical:i});if("dict"in e)return new Sr(n,e.dict,{canonical:i});throw new Error(`Unexpected MathJSON object: ${JSON.stringify(e,void 0,4)}`)}return n.symbol("Undefined")}function yg(n,e,t,i,r){let o=xg(n,e,t,i,r);if(o)return o;if(e==="List"){let f=t.map(p=>n.box(p,{canonical:!1})),d=Hc("List",f);return d&&d.dtype?new br(n,{ops:Qe(n,f,r),shape:d.shape,dtype:d.dtype},{metadata:i}):new he(n,"List",Qe(n,f,r),{canonical:!0})}if(e==="Dictionary"){let f=t.map(d=>n.box(d,{canonical:!1}));return new Sr(n,n._fn("Dictionary",f),{canonical:!0})}let s=n.lookupDefinition(e);if(!s)return n.declare(e,{type:"function",inferred:!0}),new he(n,e,Q(zt(n,t)),{metadata:i,canonical:!0});if(ne(s))return new he(n,e,Q(zt(n,t)),{metadata:i,canonical:!0});let a=s.operator;if(r??=a.scoped?{parent:n.context.lexicalScope,bindings:new Map}:void 0,a.lazy){let f=t.map(d=>n.box(d,{canonical:!1}));if(a.canonical){try{if(o=a.canonical(f,{engine:n,scope:r}),o)return o}catch(d){console.error(d.message)}return o=new he(n,e,f,{metadata:i,canonical:!1}),o}return o=new he(n,e,yi(n,f,a.signature.type,a.lazy,a.broadcastable)??f,{metadata:i,canonical:!0,scope:r}),o}let u=t.map(f=>n.box(f));if(a.canonical){try{let d=a.canonical(u,{engine:n,scope:r});if(d)return d}catch(d){console.error(d.message)}return new he(n,e,u,{metadata:i,canonical:!1})}let l=Q(u,a.associative?e:void 0),c=yi(n,l,a.signature.type,a.lazy,a.broadcastable);if(c)return new he(n,e,c,{metadata:i,canonical:!0,scope:r});if(l.length===1&&l[0].operator===e){if(a.involution)return l[0].op1;if(a.idempotent)return new he(n,e,u[0].ops,{metadata:i,canonical:!0,scope:r})}return new he(n,e,Ji(e,l),{metadata:i,canonical:!0,scope:r})}function xg(n,e,t,i,r){let o=[];if(e==="Add"||e==="Multiply")o=He(n,zt(n,t,r),{flatten:e});else if(e==="Negate"||e==="Square"||e==="Sqrt"||e==="Exp")o=He(n,zt(n,t,r),1);else if(e==="Ln"||e==="Log")o=He(n,zt(n,t,r)),o.length===0&&(o=[n.error("missing")]);else if(e==="Power"||e==="Root")o=He(n,zt(n,t,r),2);else if(e==="Divide")o=He(n,zt(n,t,r)),o.length===0&&(o=[n.error("missing"),n.error("missing")]),o.length===1&&(o=[o[0],n.error("missing")]);else return null;if(!o.every(s=>s.isValid))return new he(n,e,o,{metadata:i,canonical:!0});if(e==="Add")return Ke(n,o);if(e==="Negate")return cc(o[0]);if(e==="Multiply")return _e(n,o);if(e==="Divide")return o.length===2?un(...o):o.slice(1).reduce((s,a)=>un(s,a),o[0]);if(e==="Exp")return Kn(n.E,o[0]);if(e==="Square")return Kn(o[0],n.number(2));if(e==="Power")return Kn(o[0],o[1]);if(e==="Root")return wt(o[0],o[1]);if(e==="Sqrt")return wt(o[0],2);if(e==="Ln"||e==="Log"){if(o.length>0){if(o[0].is(1))return n.Zero;if(o.length===1)return new he(n,e,o,{metadata:i,canonical:!0})}return new he(n,"Log",o,{metadata:i,canonical:!0})}return null}function bg(n,e){if(e.isZero)return n.Zero;if(e.isOne)return n.One;if(e.isNegativeOne)return n.NegativeOne;if(e.isNaN)return n.NaN;if(e.isNegativeInfinity)return n.NegativeInfinity;if(e.isPositiveInfinity)return n.PositiveInfinity;if(e=e.asExact??e,!e.isExact){let o=e.im;return o===0?n.number(e.bignumRe??e.re):e.re===0?n.number(n.complex(0,o)):e.bignumRe!==void 0&&!Mt(e.bignumRe)?Ke(n,[n.number(e.bignumRe),n.number(n.complex(0,o))]):n.number(n.complex(e.re,e.im))}let t=[],i=e;if(i.sign!==0)if(i.radical===1)t.push(n.number(i.rational));else{let o=i.rational,s=n.function("Sqrt",[n.number(i.radical)]);if(Ae(o))t.push(s);else{let[a,u]=o;u===1?a===1?t.push(s):t.push(n.function("Multiply",[n.number(a),s])):a===1?t.push(n.function("Divide",[s,n.number(u)])):t.push(n.function("Divide",[n.function("Multiply",[n.number(a),s]),n.number(u)]))}}let r;return e.im===0?t.length===0?n.Zero:(r=t.length===1?t[0]:_e(n,t),r):t.length===0?n.number(n.complex(0,e.im)):(r=t.length===1?t[0]:_e(n,t),Ke(n,[r,n.number(n.complex(0,e.im))]))}function zt(n,e,t){return e.every(i=>i instanceof W&&i.isCanonical)?e:e.map(i=>n.box(i,{scope:t}))}var Tr=class n{_items;constructor(e){e?e instanceof n?this._items=new Map(e._items):this._items=new Map(e):this._items=new Map}has(e){for(let t of this._items.keys())if(t.isSame(e))return!0;return!1}get(e){for(let[t,i]of this._items)if(t.isSame(e))return i}clear(){this._items.clear()}set(e,t){for(let i of this._items.keys())if(i.isSame(e)){this._items.set(i,t);return}this._items.set(e,t)}delete(e){this._items.delete(e)}[Symbol.iterator](){return this._items.entries()}entries(){return this._items.entries()}};var qe=class extends W{_value;_hash;constructor(e,t,i){super(e,i?.metadata),t instanceof j||typeof t=="number"?this._value=t:this._value=e._numericValue(t)}get hash(){return this._hash??=cn(this._value.toString()),this._hash}get json(){let e=this._value;return typeof e=="number"?Number.isNaN(e)?"NaN":Number.isFinite(e)?e:e>0?"PositiveInfinity":"NegativeInfinity":e.toJSON()}get operator(){return"Number"}get isPure(){return!0}get isCanonical(){return!0}set isCanonical(e){}get complexity(){return 1}valueOf(){return typeof this._value=="number"?this._value:this._value.N().valueOf()}get numericValue(){return this._value}get isNumberLiteral(){return!0}get re(){return typeof this._value=="number"?this._value:this._value.re}get im(){return typeof this._value=="number"?0:this._value.im}get bignumRe(){if(typeof this._value!="number")return this._value.bignumRe}get bignumIm(){return typeof this._value=="number"?this.engine._BIGNUM_ZERO:this.engine.bignum(this._value.im)}neg(){let e=this._value;return e===0?this:typeof e=="number"?this.engine.number(-e):this.engine.number(e.neg())}inv(){return typeof this._value=="number"?Math.abs(this._value)===1?this:Number.isInteger(this._value)?this.engine.number(this.engine._numericValue({rational:[1,this._value]})):this.engine.number(1/this._value):Math.abs(this.re)===1&&this.im===0?this:this.engine.number(this._value.inv())}abs(){return this.isPositive?this:typeof this._value=="number"?this.engine.number(-this._value):this.engine.number(this._value.abs())}add(e){let t=this.engine;return this.is(0)?t.box(e):typeof e=="number"?e===0?this:typeof this._value=="number"?t.number(this._value+e):t.number(this._value.add(e)):e.numericValue!==null?typeof this._value=="number"?typeof e.numericValue=="number"?t.number(this._value+e.numericValue):t.number(e.numericValue.add(this._value)):t.number(this._value.add(e.numericValue)):H(this,e.canonical)}mul(e){if(this.is(1))return this.engine.box(e);if(this.is(-1))return this.engine.box(e).neg();let t=this.engine;return typeof e=="number"?e===1?this:e===0||this.is(0)?this.engine.Zero:e===-1?this.neg():t.number(typeof this._value=="number"?this._value*e:this._value.mul(e)):typeof this._value=="number"&&typeof e=="number"?t.number(this._value*e):e instanceof j?this.is(1)?t.number(e):this.is(-1)?t.number(e.neg()):t.number(e.mul(this._value)):e.numericValue!==null?t.number(t._numericValue(this._value).mul(e.numericValue)):ae(this,e)}div(e){return hi(this,e)}pow(e){return Ie(this,e,{numericApproximation:!1})}root(e){if(typeof e=="number"){if(e===0)return this.engine.NaN;if(e===1)return this;if(e===-1)return this.inv();if(e===2)return this.sqrt();if(this.isNegative){if(e%2===1)return this.neg().root(e).neg();if(e%2===0)return this.neg().root(e)}}else{if(e=e.canonical,e.is(0))return this.engine.NaN;if(e.is(1))return this;if(e.is(-1))return this.inv();if(e.is(2))return this.sqrt();if(this.isNegative){if(e.isOdd)return this.neg().root(e).neg();if(e.isEven)return this.neg().root(e)}}let t=typeof e=="number"?e:e.re;if(Number.isInteger(t))if(typeof this._value=="number"){let i=this._value**(1/t);if(Number.isInteger(i))return this.engine.number(i)}else{let i=this._value.root(t);if(E(i.type,"integer"))return this.engine.number(i)}return this.engine._fn("Root",[this,this.engine.box(e)])}sqrt(){return typeof this._value=="number"?this._value===0||this._value===1?this:this._value===-1?this.engine.I:this._value>0&&Number.isInteger(this._value)&&this._value<$?this.engine.number(this.engine._numericValue({radical:this._value})):this.engine.number(this.engine._numericValue(this._value).sqrt()):this.is(0)||this.is(1)?this:this.engine.number(this._value.sqrt())}ln(e){let t=e?this.engine.box(e):void 0;if(this.is(0))return this.engine.NegativeInfinity;if(t&&this.isSame(t))return this.engine.One;if((!t||t.symbol==="ExponentialE")&&this.symbol==="ExponentialE")return this.engine.One;let i=this.re;if(Number.isInteger(i)&&i>0){let r=this.engine,[o,s]=Yt(i,3);if(o!==1)return r.number(o).ln(t).mul(3).add(r.number(s).ln(t));if([o,s]=Yt(i,2),o!==1)return r.number(o).ln(t).mul(2).add(r.number(s).ln(t))}return t&&t.isInteger?typeof this._value=="number"?this.engine.number(Math.log(this._value)/Math.log(t.re)):this.engine.number(this._value.ln(t.re)):t===void 0?typeof this._value=="number"?this.engine.number(Math.log(this._value)):this.engine.number(this._value.ln()):this.engine._fn("Ln",[this])}get value(){return this}get type(){return typeof this._value=="number"?Number.isNaN(this._value)?S.number:Number.isFinite(this._value)?Number.isInteger(this._value)?S.finite_integer:S.finite_real:S.non_finite_number:new S(this._value.type,this.engine._typeResolver)}get sgn(){if(this._value===0)return"zero";let e;return typeof this._value=="number"?e=Math.sign(this._value):e=this._value.sgn(),e===void 0||Number.isNaN(e)?"unsigned":e===0?"zero":e>0?"positive":"negative"}get numerator(){return typeof this._value=="number"?this:this.engine.number(this._value.numerator)}get denominator(){return typeof this._value=="number"?this.engine.One:this.engine.number(this._value.denominator)}get numeratorDenominator(){if(typeof this._value=="number")return[this,this.engine.One];let e=this.engine;return[e.number(this._value.numerator),e.number(this._value.denominator)]}subs(e,t){return this.isStructural?this:this.structural.subs(e,t)}replace(e,t){return et(this.structural,e,t).at(-1)?.value??null}match(e,t){return Ni(this.structural,e,t)}get isPositive(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value>0:_i(this.sgn)}get isNonNegative(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value>=0:Si(this.sgn)}get isNegative(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value<0:Ti(this.sgn)}get isNonPositive(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value<=0:Bi(this.sgn)}get isOdd(){if(this.is(1)||this.is(-1))return!0;if(this.is(0))return!1;if(!this.isFinite||!this.isInteger)return;if(typeof this._value=="number")return this._value%2!==0;let[e,t]=[this._value.numerator,this._value.denominator];return t.isOne?e.re%2!==0:e.re%2!==0&&t.re%2===0}get isEven(){let e=this.isOdd;return e!==void 0?!e:void 0}get isInfinity(){return typeof this._value=="number"?!Number.isFinite(this._value)&&!Number.isNaN(this._value):Number.isFinite(this._value.im)?this._value.isPositiveInfinity||this._value.isNegativeInfinity:!0}get isNaN(){return typeof this._value=="number"?Number.isNaN(this._value):this._value.isNaN}get isFinite(){return this.isInfinity===!1&&this.isNaN===!1}get isNumber(){return!0}get isInteger(){return typeof this._value=="number"?Number.isInteger(this._value):E(this._value.type,"integer")}get isRational(){return typeof this._value=="number"?Number.isInteger(this._value):E(this._value.type,"rational")}get isReal(){return typeof this._value=="number"?!0:E(this._value.type,"real")}is(e){return typeof e=="number"?typeof this._value=="number"?Object.is(this._value,e):this._value.isNaN?Object.is(e,NaN):this._value.eq(e):typeof e=="bigint"?typeof this._value=="number"?ie(this._value)===e:this._value.eq(this.engine._numericValue(e)):typeof e=="boolean"?!1:this.isSame(e)}get canonical(){return this}get isStructural(){return typeof this._value=="number"||this.type.matches("rational")?!0:!(this._value instanceof K)}get structural(){return this.isStructural?this:this.engine.box(this.json,{canonical:!1,structural:!0})}toNumericValue(){let e=this._value;return typeof e=="number"?[this.engine._numericValue(e),this.engine.One]:[e,this.engine.One]}simplify(e){return xt(this.structural,e).at(-1).value??this}evaluate(e){return e?.numericApproximation?this.N():this}N(){let e=this._value;if(typeof e=="number")return this;let t=e.N();return e===t?this:this.engine.number(t)}};function Mo(n,e){if(e==null)return NaN;if(e instanceof j)return e;if(typeof e=="number")return Number.isInteger(e)&&e>=-$&&e<=$||!Number.isFinite(e)?e:n._numericValue(e);if(e instanceof M){let t=e.toNumber();return e.isInteger()&&Math.abs(t)<=$?t:e.isNaN()?NaN:e.isFinite()?n._numericValue(e):t>0?1/0:-1/0}if(typeof e=="bigint")return e>=-$&&e<=$?Number(e):n._numericValue(e);if(e instanceof q)return e.im===0?Mo(n,e.re):e.isNaN()?NaN:!e.isFinite()&&e.im===0?e.re>0?1/0:-1/0:n._numericValue({re:e.re,im:e.im});if(typeof e=="object"&&"num"in e){if(typeof e.num=="number")return Mo(n,e.num);if(typeof e.num!="string")throw new Error("MathJSON `num` property should be a string of digits");return vf(n,e.num)}if(typeof e=="string")return vf(n,e);if(e[1]==0)return NaN;if(typeof e[1]=="number"&&!Number.isFinite(e[1]))return Number.isFinite(e[0])?0:NaN;if(typeof e[0]=="number"&&!Number.isFinite(e[0])){let t=e[0]>0?1:-1;return e[0]>0?t>0?1/0:-1/0:e[0]<0?t>0?-1/0:1/0:NaN}return n._numericValue(e)}function vf(n,e){if(e=e.toLowerCase(),/[0-9][nd]$/.test(e)&&(e=e.slice(0,-1)),e=e.replace(/[\u0009-\u000d\u0020\u00a0]/g,""),e==="nan")return NaN;if(e==="infinity"||e==="+infinity"||e==="oo"||e==="+oo")return Number.POSITIVE_INFINITY;if(e==="-infinity"||e==="-oo")return Number.NEGATIVE_INFINITY;if(e==="0")return 0;if(e==="1")return 1;if(e==="-1")return-1;if(/\([0-9]+\)/.test(e)){let[i,r,o,s]=e.match(/(.+)\(([0-9]+)\)(.+)?$/)??[];e=r+o.repeat(Math.ceil(n.precision/o.length))+(s??"")}let t=ie(e);return t!==null?t>=-$&&t<=$?Number(t):n._numericValue(t):n._numericValue(n.bignum(e))}var Gt=class extends W{_hash;_id;_def;constructor(e,t,i){super(e,i?.metadata),Te(t),`${t}${nn(t)}`,this._id=t,this._def=i?.def}get json(){return Ge(this._id)?this._id:{sym:this._id}}get hash(){return this._hash??=cn(this._id),this._hash}get isPure(){return!0}get isConstant(){let e=this._def;return(ne(e)&&e?.value.isConstant)??!1}bind(){}reset(){}get isCanonical(){return this._def!==void 0}set isCanonical(e){throw new Error("Setting the isCanonical property is not allowed. Use the canonical() method instead.")}get canonical(){return this._def?this:this.engine.symbol(this._id)}is(e){return e===!0?this.symbol==="True"||this.value?.symbol==="True":e===!1?this.symbol==="False"||this.value?.symbol==="False":e instanceof W&&e.symbol?this.symbol===e.symbol:this.value?.is(e instanceof W?e.value:e)??!1}toNumericValue(){this.isCanonical;let e=this.engine;return this.symbol==="ImaginaryUnit"?[e._numericValue({re:0,im:1}),e.One]:this.symbol==="PositiveInfinity"||this.isInfinity&&this.isPositive?[e._numericValue(1/0),e.One]:this.symbol==="NegativeInfinity"||this.isInfinity&&this.isNegative?[e._numericValue(-1/0),e.One]:this.symbol==="NaN"?[e._numericValue(NaN),e.One]:[e._numericValue(1),this]}neg(){return Lt(this)}inv(){return this.engine._fn("Divide",[this.engine.One,this])}abs(){return this.isNonNegative?this:this.isNonPositive?this.neg():this.engine._fn("Abs",[this])}add(e){return e===0?this:H(this,this.engine.box(e))}mul(e){if(e===1)return this;if(e===-1)return this.neg();if(e===0&&!this.isNaN)return this.engine.Zero;if(e instanceof j){if(e.isOne)return this;if(e.isNegativeOne)return this.neg();if(e.isZero&&!this.isNaN)return this.engine.Zero}return ae(this,this.engine.box(e))}div(e){return hi(this,e)}pow(e){return Ie(this,e,{numericApproximation:!1})}root(e){let t=typeof e=="number"?e:e.im===0?e.re:void 0,i=this.engine;return this.symbol==="ComplexInfinity"||t===0?i.NaN:t===1?this:t===2?this.sqrt():t===-1?this.inv():i._fn("Root",[this,i.box(e)])}sqrt(){let e=this.engine;return this.symbol==="ComplexInfinity"?e.NaN:this.is(0)?this:this.is(1)?this.engine.One:this.is(-1)?e.I:e._fn("Sqrt",[this])}ln(e){let t=e?this.engine.box(e):void 0;return this.is(0)?this.engine.NegativeInfinity:(!t||t.symbol==="ExponentialE")&&this.symbol==="ExponentialE"?this.engine.One:t?t.re===10?this.engine._fn("Log",[this]):this.engine._fn("Log",[this,t]):this.engine._fn("Ln",[this])}solve(e){let t=fr(e);return t.length!==1?null:t.includes(this.symbol)?[this.engine.Zero]:null}get complexity(){return 7}get operator(){return"Symbol"}get symbol(){return this._id}get baseDefinition(){return this.valueDefinition??this.operatorDefinition}get valueDefinition(){if(ne(this._def))return this._def.value}get operatorDefinition(){if(Z(this._def))return this._def.operator}infer(e,t="narrow"){if(!this._def)return!1;let i=this._def;if(ne(i))return i.value.inferredType||i.value.type.isUnknown?(i.value.isConstant,i.value.type=this.engine.type(t==="widen"?oe(i.value.type.type,e):vt(i.value.type.type,e)),!0):!1;if(Z(i)){let r=this.engine.type(t==="widen"?oe(i.operator.signature.type,e):vt(i.operator.signature.type,e));return r.matches("function")?(i.operator.signature=r,!0):(delete i.operator,i.value={value:{type:r}},!0)}return!1}get _value(){if(!(!this._def||Z(this._def)))return this._def.value.isConstant?this._def.value.value:this.engine._getSymbolValue(this._id)}get value(){return Z(this._def)?this.engine._fn("Operator",[this.engine.string(this._id)]):this._value}set value(e){if(!this._def)throw new Error(`Cannot set value of non-canonical ${this._id}`);let t=this.engine;t.forget(this._id);let i;if(typeof e=="boolean"&&(e=e?t.True:t.False),typeof e=="string"&&(e=t.string(e)),typeof e=="object")if("re"in e&&"im"in e)e=t.complex(e.re??0,e.im);else if("num"in e&&"denom"in e)e=t.number([e.num,e.denom]);else if(Array.isArray(e))e=t._fn("List",e.map(r=>t.box(r)));else throw new Error(`Invalid value for symbol ${this._id}: ${e}`);if(e!==void 0&&(i=t.box(e).evaluate()),i?.type.matches("function")){delete this._def.value,this._def.operator={signature:i.type,evaluate:i};return}if(ne(this._def)&&this._def.value.isConstant)throw new Error(`The value of the constant "${this._id}" cannot be changed`);t._setSymbolValue(this._id,i)}get type(){let e=this._def;return ne(e)?e.value.type:Z(e)?e.operator.signature:S.unknown}set type(e){if(!this._def)throw new Error(`Cannot set type of non-canonical symbol "${this._id}"`);if(this._id[0]==="_")throw new Error(`The type of the wildcard "${this._id}" cannot be changed`);this.engine.forget(this._id),typeof e=="string"?e=A(e):e instanceof S&&(e=e.type),e==="function"||Gr(e)?Z(this._def)?this._def.operator.signature=e:(delete this._def.value,this._def.operator={signature:e}):Z(this._def)?(delete this._def.operator,this._def.value={type:e}):this._def.value.type=e}has(e){return typeof e=="string"?this._id===e:e.includes(this._id)}match(e,t){return Ni(this,e,t)}get sgn(){return this.value?.sgn}get isOdd(){return this.value?.isOdd}get isEven(){return this.value?.isEven}get isFinite(){return this.value?.isFinite}get isInfinity(){return this.value?.isInfinity}get isNaN(){return this.value?.isNaN}get isPositive(){return _i(this.sgn)}get isNonPositive(){return Bi(this.sgn)}get isNegative(){return Ti(this.sgn)}get isNonNegative(){return Si(this.sgn)}get isFunction(){if(!this.type.isUnknown)return this.type.matches("function")}get isNumber(){let e=this.type;if(!e.isUnknown)return e.matches("number")}get isInteger(){let e=this.type;if(!e.isUnknown)return e.matches("integer")}get isRational(){let e=this.type;if(!e.isUnknown)return e.matches("rational")}get isReal(){let e=this.type;if(!e.isUnknown)return e.matches("real")}get re(){return this.value?.re??NaN}get im(){return this.value?.im??NaN}get bignumRe(){return this.value?.bignumRe}get bignumIm(){return this.value?.bignumIm}simplify(e){return xt(this,e).at(-1)?.value??this}evaluate(e){let t=this.valueDefinition;if(!t)return this;let i=t.holdUntil;if(t.isConstant){if(e?.numericApproximation){if(i==="never"||i==="evaluate"||i==="N")return t.value?.N()??this}else if(i==="never"||i==="evaluate")return t.value?.evaluate(e)??this}else if(i==="never"||i==="evaluate"||i==="N"&&e?.numericApproximation){let r=this.engine._getSymbolValue(this._id)??this;return r.operator==="Unevaluated"&&(r=r.evaluate(e)??this),r}return this}N(){let e=this.valueDefinition;return e&&e.holdUntil==="never"?this:e?.value?.N()??this}replace(e,t){return et(this,e,t).at(-1)?.value??null}subs(e,t){let i=t?.canonical??this.isCanonical;return e[this._id]===void 0?i?this.canonical:this:this.engine.box(e[this._id],{canonical:i})}get _asCollection(){if(ne(this._def))return this._def.value.collection}get isCollection(){return this._asCollection?.iterator!==void 0||(this._value?.isCollection??!1)}get isIndexedCollection(){return this._asCollection?.at!==void 0||(this._value?.isIndexedCollection??!1)}get isLazyCollection(){return this._asCollection?.isLazy?.(this._value??this)??this._value?.isLazyCollection??!1}xcontains(e){return this._asCollection?.contains?.(this._value??this,e)??this._value?.xcontains?.(e)}get xsize(){return this._asCollection?.count(this._value??this)??this._value?.xsize??0}get isEmptyCollection(){return this._asCollection?.isEmpty?.(this._value??this)??this._value?.isEmptyCollection??this.xsize===0}get isFiniteCollection(){return this._asCollection?.isFinite?.(this._value??this)??this._value?.isFiniteCollection??isFinite(this.xsize)}each(){let e=this._asCollection?.iterator?.(this._value??this);return e?function*(){let t=e.next();for(;!t.done;)yield t.value,t=e.next()}():this._value?.each()??function*(){}()}at(e){return this._asCollection?.at?.(this._value??this,e)??this._value?.at?.(e)}get(e){return this._value?.get?.(e)}indexWhere(e){return this._asCollection?.indexWhere?this._asCollection.indexWhere(this._value??this,e):this._value?.indexWhere(e)}subsetOf(e,t){return this._asCollection?.subsetOf?.(this._value??this,e,t)??this._value?.subsetOf?.(e,t)??!1}};var _f=["\\varphi -> \\frac{1+\\sqrt{5}}{2}",Eg,vg,n=>{let e=Ze(n);return e?{value:e,because:"expand"}:void 0},n=>{if(n.operator==="Add")return{value:H(...n.ops.map(e=>e.canonical.simplify())),because:"addition"}},n=>{if(n.operator==="Negate")return{value:n.op1.neg(),because:"negation"}},n=>{if(n.operator==="Multiply")return{value:ae(...n.ops.map(e=>e.canonical.simplify())),because:"multiplication"}},n=>{if(n.operator==="Divide")return{value:n.op1.div(n.op2),because:"division"};if(n.operator==="Rational"&&n.nops===2)return{value:n.op1.div(n.op2),because:"rational"}},n=>{if(!n.op1.isNumberLiteral)return;if(n.operator==="Sqrt"){if(n.op1.isNegative)return{value:n.engine.box(["Multiply",["Sqrt",n.op1.neg()],"ImaginaryUnit"]).simplify(),because:"sqrt"};let i=n.op1.sqrt();return Nf(i.numericValue)?{value:i,because:"sqrt"}:void 0}let e=n.op1,t=n.op2;if(t.isNumberLiteral&&e.isInteger&&t.isInteger&&e.re<$&&t.re<$){if(n.operator==="Power")return{value:n.op1.pow(n.op2),because:"power"};if(n.operator==="Root"){let i=n.op1.root(n.op2);if(Nf(i.numericValue))return{value:n.op1.root(n.op2),because:"root"}}}},n=>{if(n.operator!=="Abs")return;let e=n.op1;if(e.isNonNegative)return{value:e,because:"|x| -> x"};if(e.isNegative)return{value:e.neg(),because:"|x| -> -x"}},n=>{if(n.operator!=="Sign")return;let e=n.sgn,t=n.engine;if(e!==void 0){if(e==="positive")return{value:t.One,because:"sign positive"};if(e==="negative")return{value:t.One,because:"sign negative"};if(e==="zero")return{value:t.Zero,because:"sign zero"};if(e==="unsigned")return{value:t.NaN,because:"sign unsinged"}}},n=>{if(n.operator==="Ln")return{value:n.op1.ln(n.ops[1]),because:"ln"};if(n.operator==="Log")return{value:n.op1.ln(n.ops[1]??10),because:"log"}},n=>{if(n.operator==="Max"){if(n.nops===0)return{value:n.engine.NegativeInfinity,because:"max"};if(n.nops===1)return{value:n.op1,because:"max"}}else if(n.operator==="Min"){if(n.nops===0)return{value:n.engine.PositiveInfinity,because:"min"};if(n.nops===1)return{value:n.op1,because:"min"}}else if(n.operator==="Supremum"){if(n.nops===0)return{value:n.engine.NegativeInfinity,because:"sup"};if(n.nops===1)return{value:n.op1,because:"sup"}}else if(n.operator==="Infimum"){if(n.nops===0)return{value:n.engine.PositiveInfinity,because:"inf"};if(n.nops===1)return{value:n.op1,because:"inf"}}},n=>{if(n.operator!=="Derivative")return;let e=n.engine,[t,i]=n.ops;if(n.nops===2)return{value:e.function("Derivative",[t.simplify(),i]),because:"derivative"};if(n.nops===1)return{value:e.function("Derivative",[t.simplify()]),because:"derivative"}},n=>n.operator!=="Hypot"?void 0:{value:n.engine.box(["Sqrt",["Add",["Square",n.op1],["Square",n.op2]]]).simplify(),because:"hypot(x,y) -> sqrt(x^2+y^2)"},n=>{if(n.operator!=="Congruent"||n.nops<3)return;let e=n.engine;return{value:e._fn("Equal",[e.function("Mod",[n.ops[0],n.ops[2]]).simplify(),e.function("Mod",[n.ops[1],n.ops[2]]).simplify()]).simplify(),because:"congruent"}},n=>{n.operator},n=>{if(!Sa(n))return;let e=_r(n.operator,n.op1);if(e)return{value:e,because:"constructible value"}},n=>{if(n.operator!=="InverseFunction")return;let e=Nr(n.engine,n.ops);if(e)return{value:e,because:"inverse function"}},n=>{if(n.operator!=="Arctan2")return;let[e,t]=n.ops,i=n.engine;return e.isFinite===!1&&t.isFinite===!1?{value:i.NaN,because:"arctan2"}:e.is(0)&&t.is(0)?{value:i.Zero,because:"arctan2"}:t.isFinite===!1?{value:t.isPositive?i.Zero:i.Pi,because:"arctan2"}:e.isFinite===!1?{value:e.isPositive?i.Pi.div(2):i.Pi.div(-2),because:"arctan2"}:e.is(0)?{value:t.isPositive?i.Zero:i.Pi,because:"arctan2"}:{value:i.function("Arctan",[e.div(t)]).simplify(),because:"arctan2"}},"\\arcsinh(x) -> \\ln(x+\\sqrt{x^2+1})","\\arccosh(x) -> \\ln(x+\\sqrt{x^2-1})","\\arctanh(x) -> \\frac{1}{2}\\ln(\\frac{1+x}{1-x})","\\arccoth(x) -> \\frac{1}{2}\\ln(\\frac{x+1}{x-1})","\\arcsech(x) -> \\ln(\\frac{1+\\sqrt{1-x^2}}{x})","\\arccsch(x) -> \\ln(\\frac{1}{x} + \\sqrt{\\frac{1}{x^2}+1})",nf];function Eg(n){let e=n.operator;if(!vn(e)&&!ti(e))return;let t=n,i=n.engine,r=n.op1.simplify(),o=n.op2.simplify();if(n=i.function(n.operator,[r,o]),n=gt(n)??n,Je(n.operator),n.nops===2&&!n.op2.is(0)){let s=gt(i.function(n.operator,[n.op1.sub(n.op2),i.Zero]));i.costFunction(s)<i.costFunction(n)&&(n=s)}if(!n.isSame(t))return{value:n,because:"simplify-relational-operator"}}function vg(n){return n.operator!=="List"||!n.ops.every(t=>ti(t.operator)||vn(t.operator))?void 0:{value:n.engine.function("List",n.ops.map(t=>t.simplify())),because:"simplify-system-of-equations"}}function Nf(n){return n===null?!1:typeof n=="number"?Number.isInteger(n):n.isExact}function Sf(n){if(n.operator==="Element")return Sg(n);if(n.operator==="Equal")return Ng(n);if(vn(n.operator))return _g(n);throw new Error("Unsupported assumption. Use `Element`, `Equal` or an inequality")}function Ng(n){n.operator;let e=n.unknowns;if(e.length===0){let r=n.evaluate();return r.symbol==="True"?"tautology":r.symbol==="False"?"contradiction":(n.canonical.evaluate(),"not-a-predicate")}let t=n.engine,i=n.op1.symbol;if(i&&!Bg(t,i)&&!n.op2.has(i)){let r=n.op2.evaluate();if(!r.isValid)return"not-a-predicate";let o=t.lookupDefinition(i);return!o||!ne(o)?(t.declare(i,{value:r}),"ok"):o.value.type&&!r.type.matches(o.value.type)&&!o.value.inferredType?"contradiction":"ok"}if(e.length===1){let r=e[0],o=ko(n,r);o.length===0&&t.context.assumptions.set(t.function("Equal",[n.op1.sub(n.op2),0]),!0);let s=o.length===1?o[0]:t.function("List",o),a=t.lookupDefinition(r);return!a||!ne(a)?(t.declare(r,{value:s}),"ok"):a.value.type&&!o.every(u=>!u.type||s.type.matches(u.type))?"contradiction":"ok"}return t.context.assumptions.set(n,!0),"ok"}function _g(n){let e=n.engine,t="",i,r;if(n.operator==="Less"?(i=n.op1,r=n.op2,t="<"):n.operator==="LessEqual"?(i=n.op1,r=n.op2,t="<="):n.operator==="Greater"?(i=n.op2,r=n.op1,t="<"):n.operator==="GreaterEqual"&&(i=n.op2,r=n.op1,t="<="),!t)return"internal-error";let o=i.sub(r),s=e.box([t==="<"?"Less":"LessEqual",o,0]).evaluate();if(s.symbol==="True")return"tautology";if(s.symbol==="False")return"contradiction";let a=s.unknowns;return a.length===0?"not-a-predicate":(a.length===1&&(e.lookupDefinition(a[0])||e.declare(a[0],{type:"real"})),s.operator==="Less"||s.operator,e.context.assumptions.set(s,!0),"ok")}function Sg(n){n.operator;let e=n.engine,t=Tg(n.op1);if(t.length===1){let r=n.op2.evaluate();if(!r.isValid)return"not-a-predicate";let o=ho(r);if(o==="unknown")throw new Error(`Invalid domain "${r.toString()}"`);return e.declare(t[0],o),"ok"}if(n.op1.symbol&&Tf(e,n.op1.symbol)){let r=n.op2.evaluate();if(!r.isValid)return"not-a-predicate";let o=ho(r);e.context?.lexicalScope?.bindings.has(n.op1.symbol)||e.declare(n.op1.symbol,ho(r));let s=e.lookupDefinition(n.op1.symbol);return ne(s)?s.value.type&&!E(o,s.value.type.type)?"contradiction":(s.value.type=new S(o,e._typeResolver),"ok"):Z(s)?E(o,We(s.operator.signature.type))?"ok":"contradiction":"not-a-predicate"}if(t.length>0)return e.context.assumptions.set(n,!0),"ok";let i=n.evaluate();return i.symbol==="True"?"tautology":i.symbol==="False"?"contradiction":"not-a-predicate"}function Tf(n,e){return n.lookupDefinition(e)!==void 0}function Tg(n){return n.symbols.filter(e=>!Tf(n.engine,e))}function Bg(n,e){let t=n.lookupDefinition(e);return t?!!(ne(t)&&t.value.isConstant||n._getSymbolValue(e)!==void 0):!1}var Ii=class n{True;False;Pi;E;Nothing;Zero;One;Half;NegativeOne;Two;I;NaN;PositiveInfinity;NegativeInfinity;ComplexInfinity;decimalSeparator=".";_BIGNUM_NAN;_BIGNUM_ZERO;_BIGNUM_ONE;_BIGNUM_TWO;_BIGNUM_HALF;_BIGNUM_PI;_BIGNUM_NEGATIVE_ONE;_precision;_angularUnit;_tolerance;_bignumTolerance;_negBignumTolerance;__cache={};_configurationChangeTracker=new Ur;_cost;_commonSymbols={Pi:null,True:null,False:null,All:null,Nothing:null,None:null,Undefined:null,ImaginaryUnit:null,ExponentialE:null};_commonNumbers={"-5":null,"-4":null,"-3":null,"-2":null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,12:null,36:null};_evalContextStack=[];get context(){return this._evalContextStack[this._evalContextStack.length-1]}get contextStack(){return[...this._evalContextStack]}set contextStack(e){this._evalContextStack=[...e]}get _typeResolver(){let e=this;return{get names(){let t=[],i=e.context.lexicalScope;for(;i;)i.types&&t.push(...Object.keys(i.types)),i=i.parent;return t},resolve:t=>{let i=e.context.lexicalScope;for(;i;){if(i.types?.[t])return i.types[t];i=i.parent}},forward:t=>{let i={kind:"reference",name:t,alias:!1,def:void 0};return e.context.lexicalScope.types??={},e.context.lexicalScope.types[t]=i,i}}}declareType(e,t,{alias:i}={}){if(!cu(e))throw Error(`The type name "${e}" is invalid`);let r=this.context.lexicalScope;if(r.types?.[e])throw Error(`The type "${e}" is already defined in the current scope`);r.types??={},i??=!1,r.types[e]={kind:"reference",name:e,alias:i,def:void 0};let o=t instanceof S?t.type:typeof t=="string"?A(t,this._typeResolver):t;r.types[e].def=o}get trace(){return this._evalContextStack.map(e=>e.name).filter(e=>e!==void 0).reverse()}_generation=0;strict;deadline;_latexDictionaryInput;__indexedLatexDictionary;_bignum;static getStandardLibrary(e="all"){return Ta(e)}static getLatexDictionary(e="all"){return ul(e)}constructor(e){if(e!==void 0&&typeof e!="object")throw Error("Unexpected argument");this.strict=!0;let t=e?.precision??es;t==="machine"&&(t=Math.floor(kn)),this._bignum=M.clone({precision:t}),this._precision=t,this.tolerance=e?.tolerance??"auto",this._angularUnit="rad",this.Zero=new qe(this,0),this.One=new qe(this,1),this.Half=new qe(this,{rational:[1,2]}),this.NegativeOne=new qe(this,-1),this.Two=new qe(this,2),this.NaN=new qe(this,Number.NaN),this.PositiveInfinity=new qe(this,Number.POSITIVE_INFINITY),this.NegativeInfinity=new qe(this,Number.NEGATIVE_INFINITY),this.I=new qe(this,{im:1}),this.ComplexInfinity=new qe(this,{re:1/0,im:1/0}),this._reset(),this.pushScope(void 0,"system"),this.declareType("limits","expression<Limits>");for(let r of n.getStandardLibrary("domains"))Ba(this,r);let i=e?.ids??n.getStandardLibrary();for(let r of i)Ba(this,r);for(let r of Object.keys(this._commonSymbols))this._commonSymbols[r]=new Gt(this,r,{def:this.lookupDefinition(r)});this.True=this._commonSymbols.True,this.False=this._commonSymbols.False,this.Pi=this._commonSymbols.Pi,this.E=this._commonSymbols.ExponentialE,this.Nothing=this._commonSymbols.Nothing,this.pushScope(void 0,"global"),du(this)}toJSON(){return"[ComputeEngine]"}[Symbol.toStringTag]="ComputeEngine";get latexDictionary(){return this._latexDictionaryInput??n.getLatexDictionary()}set latexDictionary(e){this._latexDictionaryInput=e,this.__indexedLatexDictionary=Es(e,t=>{throw Error(typeof t.message=="string"?t.message:t.message.join(","))})}get _indexedLatexDictionary(){return this.__indexedLatexDictionary??=Es(this.latexDictionary,e=>console.error(e)),this.__indexedLatexDictionary}_reset(){this._bignum,this._generation+=1,this._BIGNUM_NEGATIVE_ONE=this.bignum(-1),this._BIGNUM_NAN=this.bignum(NaN),this._BIGNUM_ZERO=this.bignum(0),this._BIGNUM_ONE=this.bignum(1),this._BIGNUM_TWO=this.bignum(2),this._BIGNUM_HALF=this._BIGNUM_ONE.div(this._BIGNUM_TWO),this._BIGNUM_PI=this._BIGNUM_NEGATIVE_ONE.acos();for(let e of Object.values(this._commonSymbols))e?.reset();for(let e of Object.keys(this.__cache))this.__cache[e].value&&(this.__cache[e].purge?this.__cache[e].value=this.__cache[e].purge(this.__cache[e].value):delete this.__cache[e]);this._configurationChangeTracker.notifyNow()}listenToConfigurationChange(e){return this._configurationChangeTracker.listen(e)}get precision(){return this._precision}set precision(e){e==="machine"&&(e=kn),e==="auto"&&(e=es);let t=this._precision;if(e!==t){if(typeof e!="number"||e<=0)throw Error('Expected "machine" or a positive number');this._precision=Math.max(e,kn),this._bignum=this._bignum.config({precision:this._precision}),this.tolerance="auto",this._reset()}}get angularUnit(){return this._angularUnit}set angularUnit(e){if(e!==this._angularUnit){if(typeof e!="string")throw Error("Expected a string");this._angularUnit=e,this._reset()}}get timeLimit(){return this._timeLimit}set timeLimit(e){e<=0&&(e=Number.POSITIVE_INFINITY),this._timeLimit=e}_timeLimit=2e3;_deadline=void 0;get _timeRemaining(){return this.deadline===void 0?Number.POSITIVE_INFINITY:this.deadline-Date.now()}get iterationLimit(){return this._iterationLimit}set iterationLimit(e){e<=0&&(e=Number.POSITIVE_INFINITY),this._iterationLimit=e}_iterationLimit=1024;get recursionLimit(){return this._recursionLimit}set recursionLimit(e){e<=0&&(e=Number.POSITIVE_INFINITY),this._recursionLimit=e}_recursionLimit=1024;get tolerance(){return this._tolerance}set tolerance(e){e==="auto"&&(e=ns),(!Number.isFinite(e)||e<0)&&(e=Math.pow(10,-this._precision+2)),this._tolerance=e,this._bignumTolerance=this.bignum(e),this._negBignumTolerance=this.bignum(-e)}chop(e){return typeof e=="number"?Math.abs(e)<=this._tolerance?0:e:e instanceof M?e.isPositive()&&e.lte(this._bignumTolerance)||e.isNegative()&&e.gte(this._negBignumTolerance)||e.isZero()?0:e:e instanceof q&&Math.abs(e.re)<=this._tolerance&&Math.abs(e.im)<=this._tolerance?0:e}bignum(e){if(typeof e=="bigint")return new this._bignum(e.toString());try{return new this._bignum(e)}catch(t){console.error(t.message)}return this._BIGNUM_NAN}complex(e,t){return e instanceof M&&(e=e.toNumber()),t instanceof M&&(t=t.toNumber()),new q(e,t)}_numericValue(e){if(e instanceof j)return e.asExact??e;let t=r=>this.bignum(r),i=this._precision>kn?r=>new Rt(r,t):r=>new Pt(r,t);if(typeof e=="number")return Number.isInteger(e)?new K(e,i,t):i(e);if(typeof e=="bigint")return new K(e,i,t);if(Yn(e))return new K({rational:e},i,t);if(e instanceof M)return e.isInteger()&&e.e<=yu?new K(ie(e.toString()),i,t):i(e);if(e instanceof q)return e.im===0?this._numericValue(e.re):i({re:e.re,im:e.im});if("im"in e||"re"in e)return e.im!==void 0&&e.im!==0?i(e):e.re instanceof M&&e.re.isInteger()?new K({rational:[ie(e.re.toString()),BigInt(1)]},i,t):typeof e.re=="number"&&Number.isInteger(e.re)?new K({rational:[e.re,1]},i,t):i(e);if("radical"in e||"rational"in e){if(e.radical!==void 0&&(!Number.isInteger(e.radical)||e.radical>=$))throw Error("Unexpected value for radical part:"+e.radical);return e.rational&&se(e.rational)&&(!Number.isInteger(e.rational[0])||!Number.isInteger(e.rational[1]))?i(e):new K(e,i,t)}throw Error("Unexpected value")}get costFunction(){return this._cost??wa}set costFunction(e){typeof e!="function"&&(this._cost=wa),this._cost=e}lookupDefinition(e){return to(e,this.context.lexicalScope)}_declareSymbolValue(e,t,i){i??=this.context.lexicalScope,i.bindings.set(e,{value:new _n(this,e,{type:"unknown",inferred:!0})});let r=i.bindings.get(e);return gr(this,e,r,t),i===this.context.lexicalScope&&ne(r)&&r.value.value&&!r.value.isConstant&&(this.context.values[e]=r.value.value),this._generation+=1,r}_declareSymbolOperator(e,t,i){i??=this.context.lexicalScope,i.bindings.set(e,{value:new _n(this,e,{type:"function"})});let r=i.bindings.get(e);return gr(this,e,r,t),this._generation+=1,r}pushScope(e,t){this._pushEvalContext(e??{parent:this.context?.lexicalScope,bindings:new Map},t)}popScope(){this._popEvalContext()}_pushEvalContext(e,t){if(!t){let r=this._evalContextStack.length;r===0&&(t="system"),r===1&&(t="global"),t??=`anonymous_${r-1}`}let i={};for(let[r,o]of e.bindings.entries())ne(o)&&!o.value.isConstant&&(i[r]=o.value.value);this._evalContextStack.push({lexicalScope:e,name:t,assumptions:new Tr(this.context?.assumptions??[]),values:i})}_popEvalContext(){this._evalContextStack.pop()}_inScope(e,t){if(!e)return t();this._evalContextStack.push({lexicalScope:e,name:"",assumptions:new Tr([]),values:{}});try{return t()}finally{this._evalContextStack.pop()}}_printStack(e){e?(e={...e},e.maxDepth??=1,e.details??=!1):e={details:!1,maxDepth:-2},e.maxDepth!==void 0&&e.maxDepth<0&&(e.maxDepth=this._evalContextStack.length+e.maxDepth),e.maxDepth=Math.min(this._evalContextStack.length-1,e.maxDepth);let t=0;for(;t<=e.maxDepth;){let i=this._evalContextStack[this._evalContextStack.length-1-t];t===0?console.group(`${Or}${Go}${i.name}${$e}`):console.groupCollapsed(`${Or}${Go}${i.name}${$e} ${Ht}(${t})${$e}`);let r=[...i.assumptions.entries()].map(([s,a])=>`${s}: ${a}`);if(r.length>0){console.groupCollapsed(`${Or}${r.length} assumptions${$e}`);for(let s of r)console.info(s);console.groupEnd()}let o=Object.entries(i.values);if(o.length+i.lexicalScope.bindings.size===0){console.groupEnd(),t+=1;continue}for(let[s,a]of o)i.lexicalScope.bindings.has(s)?console.info(wf(s,i.lexicalScope.bindings.get(s),a)):console.info(a===void 0?`${Ai}${s}${$e}: ${Ht}undefined${$e}`:`${Ai}${s}${$e}: ${Ht}${a.toString()}${$e}`);for(let[s,a]of i.lexicalScope.bindings)s in i.values||console.info(wf(s,a));console.groupEnd(),t+=1}}_getSymbolValue(e){let t=this._evalContextStack.length-1;if(!(t<0))for(let i=t;i>=0;i--){let r=this._evalContextStack[i].values;if(e in r)return r[e]}}_setSymbolValue(e,t){let i=this._evalContextStack.length-1;if(i<0)throw new Error(`Unknown symbol "${e}"`);typeof t=="number"?t=this.number(t):typeof t=="boolean"&&(t=t?this.True:this.False);for(let o=i;o>=0;o--){let s=this._evalContextStack[o].values;if(e in s){s[e]=t,this._generation+=1;return}}let r=this.lookupContext(e);if(!r)throw new Error(`Unknown symbol "${e}"`);r.values[e]=t}declare(e,t,i){if(typeof e!="string"){for(let[a,u]of Object.entries(e))this.declare(a,u);return this}let r=e;if(r==="Nothing")return this;if(t==null)throw Error(`Expected a definition or type for "${r}"`);if(typeof r!="string"||r.length===0||!Te(r))throw new Error(`Invalid symbol "${r}": ${nn(r)}`);if(i??=this.context.lexicalScope,i.bindings.has(r))throw new Error(`The symbol "${r}" is already declared in this scope`);let s=t;if(mr(s))return this._declareSymbolValue(r,s,i),this;if(pr(s))return this._declareSymbolOperator(r,s,i),this;{let a=A(s,this._typeResolver);if(!st(a))throw Error([`Invalid argument for "${r}"`,JSON.stringify(s,void 0,4),"Use a type, a `OperatorDefinition` or a `ValueDefinition`"].join(`
|   `));this._declareSymbolValue(r,{type:a},i)}return this}lookupContext(e){if(e.length===0||!Te(e))throw Error(`Invalid symbol "${e}": ${nn(e)}}`);let t=this._evalContextStack.length-1;if(!(t<0))for(let i=t;i>=0;i--){let r=this._evalContextStack[i];if(r.lexicalScope.bindings.has(e))return r}}_swapContext(e){for(;this._evalContextStack.length>0&&this._evalContextStack[this._evalContextStack.length-1]!==e;)this._evalContextStack.pop();this._evalContextStack.length===0&&(this._evalContextStack=[e])}assign(e,t){if(typeof e=="object"){for(let[a,u]of Object.entries(e))this.assign(a,u);return this}let i=e;if(i==="Nothing")return this;let r=this.lookupDefinition(i);if(Z(r)){if(Bf(this,t))throw Error(`Cannot change the operator "${i}" to a value`);let u=If(this,t);if(!u)throw Error(`Cannot change the operator "${i}" to a value`);return gr(this,i,r,u),this}let o=Bf(this,t);if(o!==void 0){if(!r)return this._declareSymbolValue(i,{value:o}),this;if(r.value.isConstant)throw Error(`Cannot assign a value to the constant "${i}"`);return r.value.inferredType&&(r.value.type=this.type(oe(r.value.type.type,o.type.type))),this._setSymbolValue(i,o),this}let s=If(this,t);if(s===void 0)throw Error(`Invalid definition for symbol "${i}"`);return r?(ne(r),gr(this,i,r,s),this._setSymbolValue(i,void 0)):this.declare(i,s),this}_shouldContinueExecution(){return this.deadline===void 0||this.deadline>=Date.now()}_checkContinueExecution(){if(!this._shouldContinueExecution())throw new Error("timeout")}_cache(e,t,i){if(this.__cache[e]===void 0)try{this.__cache[e]={build:t,purge:i,value:t()}}catch(r){console.error(`Fatal error building cache "${e}":
	 ${r.toString()}`)}return this.__cache[e]?.value}box(e,t){return Bn(this,e,t)}function(e,t,i){return Do(this,e,t,i)}error(e,t){let i;typeof e=="string"?i=this.string(e):i=this.function("ErrorCode",e.map(s=>this.string(s)));let r;t&&zi(t)?r=this.function("LatexString",[this.string(ut(t))]):typeof t=="string"&&t.length>0&&(r=this.string(t));let o=[this.box(i)];return r&&o.push(r),this.function("Error",o)}typeError(e,t,i){return t?this.error(["incompatible-type",U(e),t.toString()],i):this.error(["incompatible-type",U(e)],i)}hold(e){return this._fn("Hold",[this.box(e,{canonical:!1})])}tuple(...e){return new he(this,"Tuple",e.map(t=>typeof t=="number"?this.number(t):t.canonical),{canonical:!0})}type(e){return e instanceof S?e:new S(e,this._typeResolver)}string(e,t){return new bt(this,e,t)}symbol(e,t){let i=t?.canonical??!0;e=e.normalize();let r=e.toLowerCase();if(r==="infinity"||r==="+infinity")return this.PositiveInfinity;if(r==="-infinity")return this.NegativeInfinity;if(this.strict&&!Te(e))return this.error(["invalid-symbol",nn(e)],e);if(!i)return new Gt(this,e);let o=this._commonSymbols[e];if(o)return o;let s=this.lookupDefinition(e);return ne(s)&&s.value.holdUntil==="never"?s.value.value??this.Nothing:s?new Gt(this,e,{def:s}):(s=this._declareSymbolValue(e,{type:"unknown",inferred:!0}),new Gt(this,e,{def:s}))}number(e,t){let i=t?.metadata,r=!1;if((!t||t.canonical===void 0||t.canonical==="Number"||t.canonical===!0||Array.isArray(t.canonical)&&t.canonical.includes("Number"))&&(r=!0),!r&&Yn(e))return this._fn("Rational",[this.number(e[0]),this.number(e[1])],{...i,canonical:!1});if(e=Mo(this,e),i===void 0){if(typeof e=="number"){let o=e;if(o===1)return this.One;if(o===0)return this.Zero;if(o===-1)return this.NegativeOne;if(o===2)return this.Two;if(Number.isInteger(o)&&this._commonNumbers[o]!==void 0)return this._commonNumbers[o]??=new qe(this,e),this._commonNumbers[o];if(Number.isNaN(o))return this.NaN;if(!Number.isFinite(o))return o<0?this.NegativeInfinity:this.PositiveInfinity}else if(e instanceof j){if(e.isZero)return this.Zero;if(e.isOne)return this.One;if(e.isNegativeOne)return this.NegativeOne;if(e.isNaN)return this.NaN;if(e.isNegativeInfinity)return this.NegativeInfinity;if(e.isPositiveInfinity)return this.PositiveInfinity}}return new qe(this,e,{metadata:i})}rules(e,t){return yr(this,e,t)}getRuleSet(e){if(e??="standard-simplification",e==="standard-simplification")return this._cache("standard-simplification-rules",()=>yr(this,_f,{canonical:!0}));if(e==="solve-univariate")return this._cache("univariate-roots-rules",()=>yr(this,gf));if(e==="harmonization")return this._cache("harmonization-rules",()=>yr(this,hf))}_fn(e,t,i){let r=i?.canonical??!0;return new he(this,e,t,{...i,canonical:r})}parse(e,t){if(e==null)return null;if(typeof e!="string")throw Error("ce.parse(): expected a LaTeX string");let i={imaginaryUnit:"\\imaginaryI",positiveInfinity:"\\infty",negativeInfinity:"-\\infty",notANumber:"\\operatorname{NaN}",decimalSeparator:this.decimalSeparator,digitGroup:3,digitGroupSeparator:"\\,",exponentProduct:"\\cdot",beginExponentMarker:"10^{",endExponentMarker:"}",truncationMarker:"\\ldots",repeatingDecimal:"auto",skipSpace:!0,parseNumbers:"auto",getSymbolType:o=>{let s=this.lookupDefinition(o);return s?Z(s)?s.operator.signature:ne(s)?s.value.type:S.unknown:S.unknown},parseUnexpectedToken:(o,s)=>null,preserveLatex:!1},r=fl(ut(e)??e,this._indexedLatexDictionary,{...i,...t});if(r===null)throw Error("Failed to parse LaTeX string");return this.box(r,{canonical:t?.canonical??!0})}ask(e){let t=this.box(e,{canonical:!1}),i=[],r=this.context.assumptions;for(let[o,s]of r){let a=t.match(o);a!==null&&s===!0&&i.push(a)}return i}verify(e){return!1}assume(e){try{let t=zi(e)?this.parse(e,{canonical:!1}):this.box(e,{canonical:!1});return this._generation+=1,Sf(t)}catch(t){throw console.error(t.message.toString()),t}}forget(e){if(e===void 0){this.context.assumptions?.clear(),this._generation+=1;return}if(Array.isArray(e)){for(let t of e)this.forget(t);return}if(typeof e=="string")for(let[t,i]of this.context.assumptions)t.has(e)&&this.context.assumptions.delete(t);this._generation+=1}};function Bf(n,e){if(e==null||typeof e=="function")return;if(typeof e=="boolean")return e?n.True:n.False;if(typeof e=="number"||typeof e=="bigint")return n.number(e);let t=n.box(e);if(!(t.unknowns.length>0))return t}function If(n,e){if(typeof e=="function")return{evaluate:e,signature:"function"};if(e==null||typeof e=="boolean")return;let t=ve(n.box(e));if(t!==void 0)return{evaluate:t,signature:"function"}}function wf(n,e,t){let i="";if(ne(e)){let r=[];e.value.holdUntil==="never"&&r.push("(hold never)"),e.value.holdUntil==="N"&&r.push("(hold until N)"),e.value.inferredType&&r.push("inferred");let o=r.length>0?` ${r.join(" ")}`:"";i=`${Ai}${n}${$e}:${o}`,e.value.isConstant?(i+=` const ${e.value.type.toString()}`,e.value.value!==void 0&&(i+=` = ${e.value.value?.toString()}`)):i+=` ${e.value.type.toString()}`}else if(Z(e)){let r=[];e.operator.inferredSignature&&r.push("(inferred)");let o=r.length>0?` (${r.join(" ")})`:"";i=`${Ai}${n}${$e}:${o} ${e.operator.signature.toString()}`;let s=[];e.operator.lazy&&s.push("lazy"),e.operator.scoped&&s.push("scoped"),e.operator.broadcastable&&s.push("broadcastable"),e.operator.associative&&s.push("associative"),e.operator.commutative&&s.push("commutative"),e.operator.idempotent&&s.push("idempotent"),e.operator.involution&&s.push("involution"),e.operator.pure||s.push("not pure");let a=s.map(u=>`${Ht}${u}${$e}`).join(" ");a.length>0&&(i+=`
   \u2514 ${a}`)}else i="unknown";return t&&(t.isValid?t.isCanonical?i+=` = ${Ht}${t.toString()}${$e}`:i+=` = ${Wa}${t.toString()}${$e} (not canonical)`:i+=` = ${Ja}${t.toString()}${$e} (not valid)`),i}var Ig="0.30.2";globalThis[Symbol.for("io.cortexjs.compute-engine")]={ComputeEngine:Ii.prototype.constructor,version:"0.30.2"};return Rf(wg);})();
/*! Bundled license information:

complex-esm/dist/src/complex.js:
  (**
   * @license Complex.js v2.1.1 12/05/2020
   *
   * Copyright (c) 2020, Robert Eisele (robert@xarg.org)
   * Dual licensed under the MIT or GPL Version 2 licenses.
   **)

decimal.js/decimal.mjs:
  (*!
   *  decimal.js v10.6.0
   *  An arbitrary-precision Decimal type for JavaScript.
   *  https://github.com/MikeMcl/decimal.js
   *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
   *  MIT Licence
   *)
*/
Object.assign(exports, ComputeEngine); Object.defineProperty(exports, '__esModule', { value: true });}));
